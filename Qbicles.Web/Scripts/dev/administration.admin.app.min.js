function OpenTraderFromAdministrator(){$.ajax({type:"get",url:"/Trader/CheckTrader",datatype:"json",success:function(n){window.location.href=n?"/Trader/AppTrader":"/Trader/TraderSetup"},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function AddRoleDomain(){$("#add-role-domain").valid()&&$.ajax({type:"post",url:"/DomainRole/AddRoleDomainByName",datatype:"json","async":!1,data:{roleDomainName:$("#txtRoleDomainName").val()},success:function(n){if(n.result){var t='<option value="'+n.Object.Id+'">'+n.Object.Name+"<\/option>";$("#selectRolesDomain").append(t);$("#selectRolesDomain").val(n.Object.Id).change();$("#select-role-app-use").append(t);$("#changeAvailableApps").removeClass("hidden");$("#add-role").modal("hide")}else $("#add-role-domain").validate().showErrors({roleDomainName:n.msg})},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function ChangePermissions(n,t,i){var r=$("#selectRolesDomain").val(),u={appId:n,rightId:t,isCheck:i,roleId:r};$.ajax({type:"post",url:"/Apps/ChangePermissions",datatype:"json","async":!1,data:u,success:function(n){n.result?(n.msgId!==""&&$("#row-"+n.msgId).remove(),cleanBookNotification.updateSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function RemoveUserFromRoles(n,t){var i={rolesId:n,userId:t};$.ajax({type:"post",url:"/DomainRole/RemoveUserFromRoles",datatype:"json","async":!1,data:i,success:function(n){n.result===!1?cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"):(reloadUsersByRole(),loadUsersNotExistInRole(),cleanBookNotification.removeSuccess())},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function AddUserToRoles(){var n=$("#user-for-rules").val(),t;if(n===null||n===""){cleanBookNotification.error(_L("ERROR_MSG_12"),"Qbicles");return}t=$("#select-role-app-use").val();$.ajax({type:"POST",url:"/DomainRole/AddUserToRoles",dataType:"JSON",data:JSON.stringify({listUserId:n,roleId:t}),contentType:"application/json","async":!1,success:function(n){n.result?($("#add-user").modal("hide"),reloadUsersByRole(),cleanBookNotification.updateSuccess(),loadUsersNotExistInRole()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function initTblUsersByRole(){var n=$("#tblUsersByRole");n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?n.LoadingOverlay("show"):n.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,autoWidth:!0,pageLength:10,deferLoading:30,order:[[1,"asc"]],ajax:{url:"/DomainRole/GetDomainUsersByRoleId",data:function(n){return $.extend({},n,{roleId:$("#select-role-app-use").val()})}},columns:[{data:"AvatarUri",orderable:!1,render:function(n){return'<div style="background-image: url('+n+'&size=T)" class="table-avatar mini">&nbsp;<\/div>'}},{data:"FullName",orderable:!0},{data:"RoleName",orderable:!1},{data:"Id",orderable:!0,render:function(n,t,i){var r='<button class="btn btn-danger" onclick="RemoveUserFromRoles(\''+i.RoleId+"', '"+i.Id+"', '"+fixQuoteCode(i.FullName)+'\' )"><i class="fa fa-trash"><\/i><\/button>';return i.IsCurrentUser==!0&&(r='<button class="btn btn-danger" disabled><i class="fa fa-trash"><\/i><\/button>'),r}}]})}function reloadUsersByRole(){$.fn.DataTable.isDataTable("#tblUsersByRole")?$("#tblUsersByRole").DataTable().ajax.reload():setTimeout(function(){$("#tblUsersByRole").DataTable().ajax.reload()},1500)}function loadUsersNotExistInRole(){var n=$("#user-for-rules");$.get("/DomainRole/GetUsersNotExistInRole?roleId="+$("#select-role-app-use").val(),function(t){n.select2("destroy");n.empty();n.select2({placeholder:"Please select",data:t})})}function ClearUserSelect(){loadUsersNotExistInRole()}function GenerateRows2TableAppByArr(n){var t="";$.each(n,function(n,i){t+='<tr id="row-'+i.Id+'">';t+="  <td>"+i.Name+"<\/td>";t+="<td>";$.each(i.listRight,function(n,r){t+=' <div class="checkbox toggle">';t+=" <label>";t+='<input data-toggle="toggle" class="app-right" onchange="ChangePermissions(\''+i.Id+"', '"+r.Id+"', this.checked)\""+r.Ischeck+' data-onstyle="success"  type="checkbox">';t+=r.Name+"<\/label>";t+="<\/div>"});t+=" <\/td>";t+=" <\/tr>"});$("#tbl-body-roles").prepend(t);$(".app-right").bootstrapToggle("destroy");$(".app-right").bootstrapToggle()}function GetAppByRoleId(n){$.ajax({type:"POST",url:"/Application/GetAppByRoleId",dataType:"JSON",data:{roleId:n},"async":!1,success:function(n){n&&(GenerateRows2TableAppByArr(n),$("input:checkbox.apps-account").each(function(){$(this).bootstrapToggle("off")}),$.each(n,function(n,t){$("#app-account-"+t.Id).bootstrapToggle("on")}))},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function SuspendOrActive(n,t){$.ajax({type:"POST",url:"/Qbicles/SuspendOrActive",dataType:"JSON","async":!1,data:{userId:n,type:t},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#tbdatatable").DataTable().ajax.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function checkBankmateAccountSetup(n){$(n).prop("checked")&&$.get("/Bankmate/CheckBankmateAccountSetup",function(t){t||(BKAccount.Id=0,$("#mbmaccount").empty(),$("#mbmaccount").modal("show"),$("#mbmaccount").load("/Bankmate/LoadModalAccountSetup?elId="+$(n).attr("id"),function(){$("#frmBankmateAccountSetup").validate({ignore:[]});$("#frmBankmateAccountSetup").submit(function(n){n.preventDefault();$("#frmBankmateAccountSetup").valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:new FormData(this),processData:!1,contentType:!1,beforeSend:function(){},success:function(n){$.LoadingOverlay("hide");n.actionVal===1?($("#mbmaccount").modal("hide"),cleanBookNotification.createSuccess()):n.actionVal===2?($("#mbmaccount").modal("hide"),cleanBookNotification.updateSuccess()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){$.LoadingOverlay("hide");cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}))})}))})}function initSelectedAccount(){}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");$("#accountId").val(t);BKAccount.Id=t;BKAccount.Name=i;$("#accountId").val(t);$("#accountId").valid();closeSelected();$("#app-bookkeeping-treeview").modal("hide")}function closeSelected(){BKAccount.Id?($(".accountInfo").empty(),$(".accountInfo").append(BKAccount.Name)):$(".accountInfo").empty();$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"))}function UpdateDomain(){if($("#form-domain-update").valid()){$.LoadingOverlay("show");var n=document.getElementById("domain-logo").files;n&&n.length>0?UploadMediaS3ClientSide("domain-logo").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#domain-logo-current").val(n.objectKey);SubmitDomain()}):SubmitDomain()}}function SubmitDomain(){$.ajax({type:"POST",url:"/Domain/UpdateDateDomainSetting",dataType:"JSON","async":!1,data:{domainKey:$("#current-domain-key").val(),name:$("#domain-name").val(),image:$("#domain-logo-current").val()},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$(".tab-settings-button").attr("disabled"),$("#domain-name-current").val($("#domamin-name").val())):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function CancelChangeDomain(){$("#domain-logo-preview").attr("src",apiDocRetrievalUrl+$("#domain-logo-current").val());$("#domain-name").val($("#domain-name-current").val());document.getElementById("domain-logo").value=null;$(".tab-settings-button").attr("disabled","disabled")}function readImgURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}function updateExtensionRequestStatus(n,t,i,r,u){LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/DomainExtension/ChangeExtensionRequestStatus",data:{requestId:n,domainKey:t,status:i,type:r,note:u},success:function(n){if(n.result){var u=$("#col-type-"+r);i==2?(u.find(".last-updated").remove(),u.prepend('<span class="last-updated" style="background: #f0ad4e;">Pending<\/span>'),u.find("button").removeClass().addClass("btn btn-warning community-button").text("Pending").attr("disabled","disabled")):i==3?(u.find(".last-updated").remove(),u.prepend('<span class="last-updated">Subscribed<\/span>'),u.find("button").removeClass().addClass("btn btn-danger community-button").text("Cancel")):(i==1||i==4)&&(u.find(".last-updated").remove(),u.find("button").removeClass().addClass("btn btn-success community-button").text("Request").attr("onClick","updateExtensionRequestStatus("+n.Object+", '"+t+"', 2, "+r+', "")'));cleanBookNotification.updateSuccess();LoadingOverlayEnd()}else cleanBookNotification.error(n.msg,"Qbicles"),LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function upgradeDomainToPremium(n){LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Domain/UpgradeBusinessDomain",data:{domainKey:n},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#upgrade-domain-container button").addClass("disabled").text("Upgrade pending").attr("onclick",""),LoadingOverlayEnd()):(cleanBookNotification.error(n.msg,"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function updateDomainTotalSlotNumber(){var n=Number($("#slot-required-number").val()),t=$("#current-level-default-slot-number").val(),i={newTotalSlotNumber:n};$.ajax({method:"POST",dataType:"JSON",data:i,url:"/Domain/UpdateDomainSlotNumber",beforeSend:function(){LoadingOverlay()},success:function(i){var f;if(i.result){f=Number($("#current-domain-user-number").val());$("#current-slot-number").text(f+"/"+n+" used");var e=n-t,o=$("#current-level-cost-per-extra-user").val(),r=Number(o)*e,s=$("#current-level-cost").val(),h=Number(r)+Number(s),u=$("#current-level-currency-symbol").val();$("#extra-user-number-row").text(e);$("#extra-user-money-row").text(toCurrencyDecimalPlace(r)+u);$("#total-cost-row").text(toCurrencyDecimalPlace(h)+u);$("#extra-slot-money-row").text(toCurrencyDecimalPlace(r)+u);$("#newslots").attr("disabled","true");cleanBookNotification.success("Total number slots of the domain updated!","Qbicles")}else cleanBookNotification.error(i.msg,"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function validateOnChangingDomainPlanLevel(n){var t={newDomainLevelId:n};LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Administration/ValidateOnChangingDomainPlanLevel",data:t,success:function(t){t.result?t.Object?($("#domchange-entry").load("/Administration/ShowChangeDomainPlanLevelConfirmationPopup?newDomainLevelId="+n),$("#domchange-entry").modal("show"),LoadingOverlayEnd()):($("#downgrade-slots").load("/Administration/ShowChangeDomainPlanLevelErrorPopup?newDomainLevelId="+n),$("#downgrade-slots").modal("show"),LoadingOverlayEnd()):(cleanBookNotification.error(t.msg,"Qbicles"),LoadingOverlayEnd())},error:function(){cleanBookNotification.error("Validate on changing domain plan level fails","Qbicles");LoadingOverlayEnd()}})}function updateDomainPlanLevel(n){var t={newDomainLevelId:n};$.ajax({method:"POST",dataType:"JSON",url:"/Administration/ChangeDomainPlanLevel",data:t,beforeSend:function(){LoadingOverlay()},success:function(n){n.result?n.Object.RedirectionNeeded?window.location=n.Object.RedirectionUrl:($("#domchange-entry").modal("hide"),$("#packagesuccess").modal("show")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).then(function(){LoadingOverlayEnd()})}function updateSubAccInfo(){var n=$("#subacc-business-name").val(),t=$("#subacc-bank-code").val(),i=$("#subacc-account-number").val(),r={businessName:n,bankCode:t,accountNumber:i};$.ajax({method:"POST",dataType:"JSON",url:"/Domain/UpdatePaystackSubAccountInformation",data:r,beforeSend:function(){LoadingOverlay()},success:function(n){n.result?cleanBookNotification.success("SubAccount information updated","Qbicles"):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).then(function(){LoadingOverlayEnd()})}var $viewLoaded=!1,BKAccount;$(function(){$("#selectRolesDomain").val()?$("#changeAvailableApps").removeClass("hidden"):$("#changeAvailableApps").addClass("hidden");$("#selectRolesDomain").select2();$("#select-role-app-use").select2();$("#user-for-rules").select2();$("#selectRolesDomain").on("change",function(){RoleManageChange()});$("#select-role-app-use").on("change",function(){reloadUsersByRole()});initTblUsersByRole()});RoleManageChange=function(){$viewLoaded&&($("#tbl-body-roles").empty(),GetAppByRoleId($("#selectRolesDomain").val()))};$("#add-role").on("shown.bs.modal",function(){$("#txtRoleDomainName").val("");$("#txtRoleDomainName").focus()});$("#selectRolesDomain").val()&&$("#selectRolesDomain").val($("#selectRolesDomain").val()).trigger("change");$("#select-role-app-use").val()&&$("#select-role-app-use").val($("#select-role-app-use").val()).trigger("change");LearnMoreApp=function(n){$("#app-detail-image").attr("src",$("#app-image-"+n).text());$("#app-detail-name").text($("#app-name-"+n).text());$("#app-detail-description").text($("#app-description-"+n).text());$("#app-detail-adpage").text($("#app-adpage-"+n).text());$("#app-detail").modal("show")};SubcribeApp=function(n){$.ajax({url:"/Apps/SubscribeApp",type:"POST",dataType:"JSON",data:{appId:n},success:function(t){t.result?($("#subscribed-label-"+n).text("Subscribed"),$("#subscribed-label-"+n).attr("style","display:block;"),$("#learn-more-button-"+n).attr("style","display:none;;margin-top: 5px"),$("#manage-app-title-"+n).text("Unsubscribe"),$("#manage-app-button-"+n).removeClass("btn-success"),$("#manage-app-button-"+n).addClass("btn-danger"),$("#manage-app-button-"+n).attr("onclick","UnSubcribeApp("+n+")"),cleanBookNotification.updateSuccess()):cleanBookNotification.error("Error: "+t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};UnSubcribeApp=function(n){$.ajax({url:"/Apps/UnSubscribeApp",type:"POST",dataType:"JSON",data:{appId:n},success:function(t){t.result?($("#subscribed-label-"+n).text(""),$("#subscribed-label-"+n).attr("style","display:none;"),$("#learn-more-button-"+n).attr("style","display:block;;margin-top: 5px"),$("#manage-app-title-"+n).text("Subscribe"),$("#manage-app-button-"+n).removeClass("btn-danger"),$("#manage-app-button-"+n).addClass("btn-success"),$("#manage-app-button-"+n).attr("onclick","SubcribeApp("+n+")"),cleanBookNotification.updateSuccess()):cleanBookNotification.error("Error: "+t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};ChangeAvailableApps=function(){$.ajax({url:"/Apps/ChangeAvailableApps",type:"POST",dataType:"JSON",data:{roleId:$("#selectRolesDomain").val()},success:function(n){n.result&&($("#add-app").empty().append(n.msg),$(".apps-account").bootstrapToggle(),$("input:checkbox.apps-account").each(function(){var n=$(this).attr("appRed");n===!1&&$(this).bootstrapToggle("off")}),$("#add-app").modal("show"))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};ManagePermission=function(){$viewLoaded=!0;RoleManageChange()};BKAccount={Id:0,Name:""};$("#domain-logo").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn();$(".tab-settings-button").removeAttr("disabled")});initExtensionRequestHistoryDtTable=function(){var n=$("#extension-request-list").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#extension-request-list").LoadingOverlay("show"):$("#extension-request-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/DomainExtension/LoadExtensionRequestTableContent",type:"POST",data:function(n){return $.extend({},n,{keySearch:$("#extension-keysearch").val(),createdUserIdSearch:$("#extension-usersearch").val(),dateRange:$("#extension-datesearch").val(),extensionTypeSearch:0,lstRequestStatusSearch:[3,4],domainKey:$("#current-domain-key").val()})}},columns:[{data:"RequestedDate",orderable:!0},{data:"RequestedByName",orderable:!0,render:function(n,t,i){var u=i.RequestedByName,f=i.RequestedByLogoUri,e=i.RequestById,r="";return r+='<a href="/Community/UserProfilePage?uId='+e+'">',r+='<div class="table-avatar mini pull-left" style="background-image: url(\''+f+"');\"><\/div>",r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+u+"<\/div>",r+'<div class="clearfix"><\/div><\/a>'}},{data:"TypeName",orderable:!0,render:function(n,t,i){var r="";return r+='<label class="label label-lg label-info">Highlights<\/label>',r+("&nbsp; "+i.TypeName+"<\/td>")}},{data:"Status",orderable:!0,render:function(n,t,i){return i.StatusLabel}},{data:"Note",orderable:!0}]})};