function showImageFromInputFile(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result);$(t).css({display:"block"})};i.readAsDataURL(n.files[0])}}function ProcessTaskLocationPlace(){$.LoadingOverlay("show");var n=document.getElementById("taskAttachments").files;n&&n.length>0?UploadMediaS3ClientSide("taskAttachments").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-place-task-object-key").val(n.objectKey);$("#sm-place-task-object-name").val(n.fileName);$("#sm-place-task-object-size").val(n.fileSize);SubmitTaskLocationPlace()}):SubmitTaskLocationPlace()}function SubmitTaskLocationPlace(){var n=new FormData($form_task_addedit[0]);$.ajax({type:"POST",url:"/SalesMarketingLocation/SaveSMLocationQbicleTask",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#create-task").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_199"),"Sales Marketing"),ResetTask(),$("#tblScheduledVisits").DataTable().ajax.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function SaveTaskLocationPlace(){var i;if(lstDate=[],$("#taskName").val()===""||$("#taskProgrammedStart").val()===""||$("#taskDuration").val()==="0"||$("#taskDescription").val()===""){cleanBookNotification.error(_L("ERROR_MSG_361"),"Task");return}if(i=task_validtabs(),i){if(!ValidateStepsWeight()){cleanBookNotification.error(_L("ERROR_MSG_360"),"Task");$('#taskTabs a[href="#create-task-checklist"]').tab("show");return}if(!isBusyAddTaskForm){$("#hdTaskLastOccurrence").val($("input[name='recur-final']").val());var t="",n="",r=$("#hdTaskRecurrenceType").val();if(r==="0"?(t="",n="",$(".daily").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n===""?n=$(this).val():n+=","+$(this).val())})):r==="1"?(t="",n="",$(".weekly").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n===""?n=$(this).val():n+=","+$(this).val())})):(t="",n="",$(".monthTask").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n===""?n=$(this).val():n+=","+$(this).val())})),$("#create-task-recurrence").find("input[name=isRecurs]").is(":checked")&&$("#lstDate tbody tr").find("input[type='checkbox']").each(function(){$(this).is(":checked")&&lstDate.push($(this).attr("att-date"))}),$("#create-task-recurrence").find("input[name=isRecurs]").is(":checked")&&lstDate.length<=0){cleanBookNotification.error(_L("ERROR_MSG_110"),"Task");return}$("#hdTaskDayOrMonth").val(t);$("#hdTaskDayOfWeek").val(n);$form_task_addedit.data("validator").settings.ignore=$("input[name=isSteps]").prop("checked")?"":":hidden";$form_task_addedit.valid()?(ReDataStep(),$.ajax({url:"/Tasks/DuplicateTaskNameCheck",data:{cubeId:$("#taskQbicleId").val(),taskKey:$("#taskKey").val(),taskName:$("#taskName").val()},type:"GET",dataType:"json","async":!1}).done(function(n){if(n.result)$form_task_addedit.validate().showErrors({Name:_L("ERROR_MSG_111")});else if($("#taskAttachments").val()){var t=checkfile($("#taskAttachments").val());t.stt?ProcessTaskLocationPlace():$form_task_addedit.validate().showErrors({taskAttachments:t.err})}else ProcessTaskLocationPlace()}).fail(function(){$("#form_task_addedit").validate().showErrors({Name:_L("ERROR_MSG_112")})})):task_validtabs()}}}function LoadModalPlace(n){$("#app-marketing-place-add").load("/SalesMarketing/LoadModalPlace",{id:n},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#frm-place-addedit").validate({ignore:"",rules:{Name:{required:!0,minlength:4,maxlength:50},Summary:{maxlength:200}}})})}function LoadModalVisit(n){$("#app-marketing-visit-add").load("/SalesMarketingLocation/LoadModalVisit",{placeId:n},function(){$("#reason").select2({placeholder:"Please select"});$("#task").select2({placeholder:"Please select"});$(".singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});var n=$("#frm-visitlogs-add");n.validate({ignore:"",rules:{DateTimeOfVisit:{required:!0},Reasons:{required:!0},Notes:{maxlength:3e3}}});n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=new FormData(this);$.ajax({type:this.method,url:this.action,data:i,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-visit-add").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_202"),"Sales Marketing"),$("#tblVisitLogs").DataTable().ajax.reload(),$("#visitLogs").trigger("click")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}})})}function LoadModalActivity(n){$("#app-marketing-activity-add").load("/SalesMarketingLocation/LoadModalActivity",{placeId:n},function(){$(".datetimerange").daterangepicker({autoUpdateInput:!0,timePicker:!0,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});var n=$("#frm-activitylogs-add");n.validate({ignore:"",rules:{Date:{required:!0},Recorded:{required:!0},Notes:{maxlength:3e3}}});n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=new FormData(this);$.ajax({type:this.method,url:this.action,data:i,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-activity-add").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_235"),"Sales Marketing"),$("#tblActivityLogs").DataTable().ajax.reload(),$("#activityLogs").trigger("click")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}})})}function LoadScheduledVisits(){$("#tblScheduledVisits").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#tblScheduledVisits").LoadingOverlay("show"):$("#tblScheduledVisits").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketingLocation/LoadScheduledVisits",type:"POST",data:function(n){return $.extend({},n,{placeId:$("#id").val()})}},columns:[{data:"DateTimeOfVisit",orderable:!1},{data:"Duration",orderable:!1},{data:"Agent",orderable:!1},{data:"Status",orderable:!1,render:function(n,t,i){return i.Status==="Pending"?'<span class="label label-info label-lg">Pending<\/span>':i.Status==="In progress"?'<span class="label label-warning label-lg">In progress<\/span>':i.Status==="Overdue"?'<span class="label label-danger label-lg">Overdue<\/span>':'<span class="label label-success label-lg">Complete<\/span>'}}],order:[[1,"asc"]]})}function LoadVisitLogs(){$("#tblVisitLogs").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#tblVisitLogs").LoadingOverlay("show"):$("#tblVisitLogs").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketingLocation/LoadVisitLogs",type:"POST",data:function(n){return $.extend({},n,{placeId:$("#id").val()})}},columns:[{data:"DateTimeOfVisit",orderable:!1},{data:"Agent",orderable:!1},{data:"txtReason",orderable:!1,width:"250px",render:function(n,t,i){return i.TaskId!==0?'<a href="/Qbicles/Dashboard" target="_blank" style="color: #5bc0de; text-decoration: none;">'+n+"<\/>":n}},{data:"Leads",orderable:!1},{data:"Notes",orderable:!1},],order:[[1,"asc"]]})}function LoadActivityLogs(){$("#tblActivityLogs").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#tblActivityLogs").LoadingOverlay("show"):$("#tblActivityLogs").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketingLocation/LoadActivityLogs",type:"POST",data:function(n){return $.extend({},n,{placeId:$("#id").val()})}},columns:[{data:"Date",orderable:!1},{data:"Timeframe",orderable:!1},{data:"Agent",orderable:!1},{data:"Recorded",orderable:!1},{data:"Notes",orderable:!1},],order:[[1,"asc"]]})}function SocialCreateDiscussion(){isBusyAddTaskForm||$("#frm-create-discussion").submit(function(n){n.preventDefault();$.LoadingOverlay("show");$.ajax({type:"post",url:"/Discussions/SaveDiscussionForPlace",datatype:"json",data:{placeId:$("#placeId").val(),openingmessage:$("#ds_openingmessage").val(),isexpiry:$("#ds_isexpiry").prop("checked"),expirydate:$("#ds_expirydate").val()},beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){var t,i;n.result?($(".new-discuss").hide(),t=$("#btnJoinDiscussion"),n.Object.Id>0&&(i=t.attr("href")+"?disId="+n.Object.Id,t.attr("href",i),t.show()),cleanBookNotification.success(_L("ERROR_MSG_203"),"Sales Marketing"),$("#create-discussion").modal("hide")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()}})})}function SubmitPlaceDetail(){var n=new FormData($("#frm-place-addedit")[0]);$.ajax({type:"post",url:"/SalesMarketing/SavePlace",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){if(n.result){var t=parseInt($("#placeId").val());t>0?(cleanBookNotification.success(_L("ERROR_MSG_200"),"Sales Marketing"),window.location.href.includes("PlaceDetail")&&window.location.reload()):cleanBookNotification.success(_L("ERROR_MSG_237"),"Sales Marketing");LoadPlace(!0)}else n.msg?cleanBookNotification.error(n.msg,"Sales Marketing"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}var skip=0,take=8;$(function(){SocialCreateDiscussion();LoadScheduledVisits();LoadVisitLogs();LoadActivityLogs();$("#tblScheduledVisits").DataTable().ajax.reload()});ProcessPlaceAdd=function(){if($("#frm-place-addedit").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-place-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-place-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-place-object-key").val(n.objectKey);$("#sm-place-object-name").val(n.fileName);$("#sm-place-object-size").val(n.fileSize);SubmitPlaceDetail()}):($("#sm-place-object-key").val(""),$("#sm-place-object-name").val(""),$("#sm-place-object-size").val(""),SubmitPlaceDetail())}};