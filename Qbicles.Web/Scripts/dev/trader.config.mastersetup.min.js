function initmultiselectPG(){$("#slProductGroups").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0,onChange:function(n,t){checkshowtabconfig();t?addGroupTab($(n).val(),fixQuoteCode($(n).text())):removeGroupTab($(n).val())}});$("#version-1 .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}function checkshowtabconfig(){var n=$("#slProductGroups").val();n&&n.length>0?$("#version-1").show():$("#version-1").hide()}function addGroupTab(n,t){$("#tabs-pgroup").append('<li><a data-toggle="tab" onclick="$(\'#tblGroup'+n+"').DataTable().ajax.reload();\" href='#group"+n+"'>"+t+"<\/a><\/li>");$("#tabs-content").append('<div class="tab-pane fade" id=\'group'+n+"'><\/div>");$("#group"+n).load("/TraderConfiguration/LoadGroupConfigTab?groupid="+n,function(){$("select.select2").select2({placeholder:"Please select"});$("#version-1 .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#tabs-pgroup a[href=#group"+n+"]").click()});$("#tabs-pgroup a[href=#group"+n+"]").tab("show")}function removeGroupTab(n){var t="#group"+n,i;$(t).remove();i="a[href='"+t+"']";$(i).closest("li").remove();$("#tabs-pgroup a:first").tab("show");$.post("/TraderConfiguration/RemoveMasterSetup",{groupid:n})}function initDatatable(n){var t=$("#tblGroup"+n);t.on("processing.dt",function(n,i,r){$("#processingIndicator").css("display","none");r?t.LoadingOverlay("show"):t.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,autoWidth:!0,pageLength:10,order:[[0,"asc"]],deferLoading:10,ajax:{url:"/TraderConfiguration/ItemsTraderGroupMaster",data:function(t){return $.extend({},t,{groupid:n,keyword:$("#group"+n+" .txtsearch").val(),type:$("#group"+n+" .sltype").val()})}},columns:[{title:"Item",data:"Item",searchable:!0,orderable:!0},{title:"Type",data:"Type",searchable:!0,orderable:!0},{title:"Taxes",data:"Taxes",searchable:!0,orderable:!0},{title:"Accounts",data:"Accounts",searchable:!0,orderable:!0},{title:"Actions",data:"Id",searchable:!0,orderable:!1}],columnDefs:[{targets:4,data:"Id",render:function(t){return'<button type="button" class="btn btn-warning" onclick="loadAccountingItemConfig('+t+","+n+')"><i class="fa fa-pencil"><\/i><\/button>'}}]});$("#group"+n+" .txtsearch").keyup(delay(function(){t.DataTable().ajax.reload()},500));$("#group"+n+" .sltype").change(function(){t.DataTable().ajax.reload()})}function LoadAccountsTree(){LoadingOverlay();$("#app-bookkeeping-treeview").html("");$("#app-bookkeeping-treeview").load("/Bookkeeping/TreeViewAccountByNodeIdPartial?id=0&number=0",function(){initJsTree();$(".jstree").on("select_node.jstree",function(n,t){$("#content").html("<div class='text-center' style='margin-top: 50px;'><img src='/Content/DesignStyle/img/loading.gif' class='loader'><\/div>");var i=t.node.data.node,r=t.node.data.value;selectedNode=t.node.data;typeof selectedNode.parent=="number"?lstParent.push(selectedNode.parent):typeof selectedNode.parent=="string"&&(lstParent=selectedNode.parent.split(","));$(document).width()<978&&$("html, body").animate({scrollTop:$("#content").offset().top-120},"slow")});LoadingOverlayEnd()})}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");idGroup>0?($("#btn_"+typeGroup+"_add"+idAccount+"_account"+idGroup).addClass("hidden"),$("#btn_"+typeGroup+"_edit"+idAccount+"_account"+idGroup).removeClass("hidden"),$("#"+typeGroup+"_"+idAccount+"_account"+idGroup).val(t),$("#"+typeGroup+"_"+idAccount+"_accounttext"+idGroup).text(i)):($("#btn_"+typeGroup+"_add"+idAccount+"_account").addClass("hidden"),$("#btn_"+typeGroup+"_edit"+idAccount+"_account").removeClass("hidden"),$("#"+typeGroup+"_"+idAccount+"_account").val(t),$("#"+typeGroup+"_"+idAccount+"_accounttext").text(i));$("#app-bookkeeping-treeview").modal("hide")}function ApplyAll(){var n=$("#cfgroupid").val(),t={GroupId:n,IBuy:{ibuy_purchaseTaxRate:$("#ibuy_purchaseTaxRate"+n).val()?$("#ibuy_purchaseTaxRate"+n).val():[],ibuy_purchaseAccount:$("#ibuy_purchase_account"+n).val(),ibuy_pnventoryAccount:$("#ibuy_inventory_account"+n).val()},IBuySell:{ibuysell_purchaseTaxRate:$("#ibuysell_purchaseTaxRate"+n).val()?$("#ibuysell_purchaseTaxRate"+n).val():[],ibuysell_purchaseAccount:$("#ibuysell_purchase_account"+n).val(),ibuysell_salesTaxRate:$("#ibuysell_salesTaxRate"+n).val()?$("#ibuysell_salesTaxRate"+n).val():[],ibuysell_salesAccount:$("#ibuysell_sale_account"+n).val(),ibuysell_inventoryAccount:$("#ibuysell_inventory_account"+n).val()},ISellSCompound:{isellcompound_salesTaxRate:$("#isellcompound_salesTaxRate"+n).val()?$("#isellcompound_salesTaxRate"+n).val():[],isellcompound_salesAccount:$("#isellcompound_sale_account"+n).val(),isellcompound_inventoryAccount:$("#isellcompound_inventory_account"+n).val()},ISellService:{isellservices_salesTaxRate:$("#isellservices_salesTaxRate"+n).val()?$("#isellservices_salesTaxRate"+n).val():[],isellservices_salesAccount:$("#isellservices_sale_account"+n).val(),isellservices_inventoryAccount:$("#isellservices_inventory_account"+n).val()},ApplyType:$("#cftype").val()};$.LoadingOverlay("show");$.post("/TraderConfiguration/SaveApplyMasterSetup",t,function(t){t.result?($("#confirm-apply").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),$("#tblGroup"+n).DataTable().ajax.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()})}function bindTabApply(n,t){$("#cfgroupid").val(n);$("#cftype").val(t)}function loadAccountingItemConfig(n,t){$("#app-trader-master-accounting-item-edit").html("");$("#app-trader-master-accounting-item-edit").modal("show");$("#app-trader-master-accounting-item-edit").load("/TraderConfiguration/LoadAccountingConfigItem?traderitemid="+n,function(){$("#app-trader-master-accounting-item-edit .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#hdfGroupId").val(t)})}function UpdateAccountingItemSetting(n){var t={TraderItemId:n,IBuy:{ibuy_purchaseTaxRate:$("#ibuy_purchaseTaxRate").val()?$("#ibuy_purchaseTaxRate").val():[],ibuy_purchaseAccount:$("#ibuy_purchase_account").val(),ibuy_pnventoryAccount:$("#ibuy_inventory_account").val()},IBuySell:{ibuysell_purchaseTaxRate:$("#ibuysell_purchaseTaxRate").val()?$("#ibuysell_purchaseTaxRate").val():[],ibuysell_purchaseAccount:$("#ibuysell_purchase_account").val(),ibuysell_salesTaxRate:$("#ibuysell_salesTaxRate").val()?$("#ibuysell_salesTaxRate").val():[],ibuysell_salesAccount:$("#ibuysell_sale_account").val(),ibuysell_inventoryAccount:$("#ibuysell_inventory_account").val()},ISellSCompound:{isellcompound_salesTaxRate:$("#isellcompound_salesTaxRate").val()?$("#isellcompound_salesTaxRate").val():[],isellcompound_salesAccount:$("#isellcompound_sale_account").val(),isellcompound_inventoryAccount:$("#isellcompound_inventory_account").val()},ISellService:{isellservices_salesTaxRate:$("#isellservices_salesTaxRate").val()?$("#isellservices_salesTaxRate").val():[],isellservices_salesAccount:$("#isellservices_sale_account").val(),isellservices_inventoryAccount:$("#isellservices_inventory_account").val()}};$.LoadingOverlay("show");$.post("/TraderConfiguration/UpdateAccountingItemSettings",t,function(n){if(n.result){$("#app-trader-master-accounting-item-edit").modal("hide");cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader");var t=$("#hdfGroupId").val();$("#tblGroup"+t).DataTable().ajax.reload()}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()})}function closeSelected(){}function initSelectedAccount(){}function initFormAppconfigPrice(n){var t=$("#frmConfigsPrice"+n);t.validate({ignore:"",rules:{Locations:{required:!0},Salechannels:{required:!0},MarkupValue:{required:!0},DiscountValue:{required:!0}}});t.submit(function(n){var r,i;if(n.preventDefault(),t.valid())r=$("#cfpricegroupid").val(),$.LoadingOverlay("show"),i=$(this).serializeArray(),i.push({name:"IsExistingOverwritten",value:$("#isOverwrite").is(":checked")}),$.post("/TraderConfiguration/ApplyConfigPriceByGroup",$.param(i),function(n){n.result?($("#confirm-price-apply").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"),$("#tblPrice"+r).DataTable().ajax.reload()):!n.result&&n.msg?cleanBookNotification.warning(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");LoadingOverlayEnd()});else return;LoadingOverlayEnd()})}function initDatatablePrices(n){var t=$("#tblPrice"+n);t.on("processing.dt",function(n,i,r){$("#processingIndicator").css("display","none");r?t.LoadingOverlay("show"):t.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,autoWidth:!0,pageLength:10,order:[[0,"asc"]],deferLoading:10,ajax:{url:"/TraderConfiguration/PricesTraderGroupMaster",data:function(t){return $.extend({},t,{groupid:n,keyword:$("#txtKeyword"+n).val(),locationid:$("#slFilterLocation"+n).val(),saleschannel:$("#slFilterSalesChannel"+n).val()})}},columns:[{title:"Item",data:"Item",searchable:!0,orderable:!0},{title:"Location",data:"Location",searchable:!0,orderable:!0},{title:"Sales Channel",data:"SalesChannel",searchable:!0,orderable:!0},{data:"AverageCost",searchable:!0,orderable:!1},{data:"PriceExcTax",searchable:!0,orderable:!0},{data:"Tax",searchable:!0,orderable:!0},{data:"GrossPrice",searchable:!0,orderable:!0}],columnDefs:[{targets:4,data:"PriceExcTax",render:function(n,t,i){return'<input id="numPriceExcTax'+i.Id+'" onchange="updateValuePrice('+i.Id+',false,$(this).val())" type="number" class="form-control" value="'+n+'">'}},{targets:6,data:"GrossPrice",render:function(n,t,i){return'<input id="numPriceIncTax'+i.Id+'" onchange="updateValuePrice('+i.Id+',true,$(this).val())" type="number" class="form-control" value="'+toCurrencyDecimalPlace(i.GrossPrice)+'">'}}]});$("#txtKeyword"+n).keyup(delay(function(){t.DataTable().ajax.reload()},500));$("#slFilterLocation"+n).change(function(){t.DataTable().ajax.reload()});$("#slFilterSalesChannel"+n).change(function(){t.DataTable().ajax.reload()})}function loadReloadPrices(n){var t=$("#tblPrice"+n);$.fn.DataTable.isDataTable("#tblPrice"+n)?t.DataTable().ajax.reload():setTimeout(function(){t.DataTable().ajax.reload()},1e3)}function loadReloadAccounting(n){var t=$("#tblGroup"+n);$.fn.DataTable.isDataTable("#groupId"+n)?t.DataTable().ajax.reload():setTimeout(function(){t.DataTable().ajax.reload()},1500)}function updateValuePrice(n,t,i){i=i?i:0;$.post("/TraderConfiguration/UpdateValuePrice",{id:n,isInclusiveTax:t,value:i},function(i){if(i.result){var r=i.Object;t?($("#numPriceExcTax"+n).val(r.PriceExcTax),$("#numPriceExcTax"+n).closest("tr").find("td:eq(5)").text(r.Tax)):($("#numPriceIncTax"+n).val(parseFloat(r.PriceExcTax)+parseFloat(r.Tax)),$("#numPriceExcTax"+n).closest("tr").find("td:eq(5)").text(r.Tax));cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")}else i.Object2<0&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function applyPriceConfig(n){if($("#frmConfigsPrice"+n).valid())$("#cfpricegroupid").val(n),$("#confirm-price-apply").modal("show");else return}var idAccount="",idGroup=0,typeGroup="";$(document).ready(function(){$("#tabs-pgroup a:first").click()});initmultiselectPG();