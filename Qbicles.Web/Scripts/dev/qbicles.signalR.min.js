function removeTypingElement(){for(var n=document.getElementsByClassName($chatting.ChatElement);n.length>0;)n[0].remove()}function onCommunityConnected(){$chatting.Chatting&&(removeTypingElement(),$chatting.ChatFrom!=$connectedC2C?$("#"+$chatting.ChatElement).append($chatting.NotConnected):htmlActivityRender($chatting.Connected,0))}function htmlActivityRender(n,t){var i,r,u,f;n&&(i=document.getElementById("activity-"+t),i&&i.remove(),r=document.getElementById("post-"+t),r&&r.remove(),u=document.getElementById("dashboard-date-today"),n=convertUnicodeEmojiToImg(n),u!==null?($("#dashboard-date-today-sub").remove(),$("#dashboard-date-today").prepend('<div class="clearfix"><\/div>'+n+'<div class="clearfix"><\/div>'),$("#dashboard-date-today").prepend("<div id='dashboard-date-today-sub' class='day-date day-date-first'><span class='date'>Today<\/span><\/div>")):($(".day-block").removeClass("day-block-first"),f='<div id="dashboard-date-today" class="day-block day-block-first" style="margin-bottom: 0;"><div id=\'dashboard-date-today-sub\' class="day-date day-date-first"><span class="date">Today<\/span><\/div><div class="clearfix"><\/div>'+n+'<div class="clearfix"><\/div><\/div>',signalRParmaters.$dashboardpagedisplay.prepend(f+'<div class="clearfix"><\/div>')),setTimeout(function(){$("#forward-to-qbicle").length==0&&$(".op-forward").remove()},100))}function getNotificationById(n){if(!n)return!1;$.ajax({type:"get",dataType:"json",contentType:"application/json; charset=utf-8",url:"/Notifications/GetNotificationById",data:{id:n}}).done(function(t){var r=t.ElementId,s,h,o,e,c,l;if((t.CreatorTheQbcile!=1||t.IsAlertDisplay)&&enqueue(n),t.Event==notificationEvent.JoinToWaitlist){CheckPendingWaitlist();return}if(t.Event==notificationEvent.ApprovalSubscriptionAndCustomWaitlist||t.Event==notificationEvent.ApprovalSubscriptionWaitlist||t.Event==notificationEvent.ApprovalCustomWaitlist||t.Event==notificationEvent.RejectWaitlist){CheckApprovalWaitlist(t.AssociatedById);return}if(UpdateOrderStatus(t.Event,r),(t.Event==notificationEvent.TaskStart||t.Event==notificationEvent.TaskComplete)&&t.IsCurrentQbicle&&t.IsCurrentTask){setTimeout(function(){window.location.reload()},1500);return}if(t.Event==notificationEvent.RemoveUserOutOfDomain&&t.IsCurrentAssociator){cleanBookNotification.error("Administrator have been removed you from the Domain","Qbicles");setTimeout(function(){window.location.href="/"},1e3);return}if(t.Event==notificationEvent.RemoveUserOutOfQbicle&&t.IsCurrentAssociator){cleanBookNotification.error("Administrator have been removed you from the Qbicle","Qbicles");setTimeout(function(){window.location.href="/Qbicles"},1e3);return}if(t.Event==notificationEvent.UpdateMembersList)UpdatePeopleData();else if(t.Event==notificationEvent.B2BOrderCompleted)UpdateB2BOrderStatus();else{var i=t.HtmlNotification,u=t.AppendToPageName,f=!1;if(u==="Qbicle"&&signalRParmaters.$dashboardpagedisplay.length>0&&signalRParmaters.$currentQbicleId.val()==t.CurrentQbicleKey){isDisplayFlicker(!1);htmlActivityRender(i,r);qbicleStreamToTop();f=!0;return}if(u=="Domain"&&signalRParmaters.$currentPage==="Qbicles"&&t.IsCurrentDomain)s=document.getElementById("domain-qbicle-"+r),s&&s.remove(),isDisplayFlicker(!1),$("#qbicles-dash-grid").prepend(i),f=!0;else if(u=="Activities"&&signalRParmaters.$dashboardpagedisplay.length>0&&t.IsCurrentQbicle)removeTypingElement(t.CreatedById),isDisplayFlicker(!1),htmlActivityRender(i,r),qbicleStreamToTop(),f=!0;else if(u=="Activities"&&$("#isReloadPageNeeded").length>0&&t.IsCurrentQbicle&&window.location.href.includes("app-trader-pos-cash-device")){var a=window.location.search,v=new URLSearchParams(a),y=v.get("tillId");ShowTillDetailTable(y)}else if(u=="bookkeeping")i.indexOf("appentTransaction")!==-1?($("#transaction-comments-"+r).prepend(i),e=$("#comment-"+r).text(),e=parseInt(e)+1,$("#comment-"+r).text(e)):$("#list-comments-journal").prepend(i),isPlaceholder(!1,"");else if(u=="Activity")(t.Event==notificationEvent.MediaAddVersion||t.Event==notificationEvent.MediaRemoveVersion)&&t.IsCurrentMedia?(f=!0,setTimeout(function(){window.location.reload()},5e3)):($("#list-medias").prepend(t.HtmlNotification),f=!0);else if(u=="B2C Order"||u=="B2B Order")UpdateOrderStatus(t.Event,r);else{if(u=="Activities")return;h=document.getElementById("post-"+r);h&&h.remove();t.IsCurrentTask?($("#list-comments-task").prepend(i),isPlaceholder(!1,"")):t.IsCurrentAlert?($("#list-comments-alert").prepend(i),isPlaceholder(!1,"")):t.IsCurrentEvent?($("#list-comments-event").prepend(i),isPlaceholder(!1,"")):t.IsCurrentMedia?($("#list-comments-media").prepend(i),isPlaceholder(!1,"")):t.IsCurrentLink?($("#list-comments-link").prepend(i),isPlaceholder(!1,"")):t.IsCurrentApproval?($("#list-comments-approval").prepend(i),isPlaceholder(!1,"")):t.IsCurrentDiscussion?($("#list-comments-discussion").prepend(i),o=$("#list-comments-discussion").attr("discussionType"),o&&t.HasActionToHandle&&$originatingCreationId!=t.CurrentConnectionId&&(o=="orderdiscussion-business"?reloadDataTable():o=="orderdiscussion-customer"?showOrderCartB2C():(o=="b2b-buyingdomain"||o=="b2b-sellingdomain")&&reloadOrderStatus()),t.HasActionToHandle&&$("#hdfRelationshipId").length>0&&!t.IsCurrentCreator&&refreshLogisticsView(),isPlaceholder(!1,"")):t.IsCurrentJournalEntry&&(i.indexOf("appentTransaction")!==-1?($("#transaction-comments-"+r).prepend(i),e=$("#comment-"+r).text(),e=parseInt(e)+1,$("#comment-"+r).text(e)):$("#list-comments-journal").prepend(i));f=!0}signalRParmaters.$userNotificationMethod!==signalRParmaters.$NonNotification&&t.IsCurrentCreator&&(t.Event!==notificationEvent.MediaCreation&&(CheckUnreadNotifications(),f=!0),t.Event==notificationEvent.QbicleInvited&&(c=$("#lblCountInvitation-"+u).text(),l=parseInt(c)+1,$("#lblCountInvitation-"+u).text(l),$("#lblCountInvitation-"+u).show()),signalRParmaters.$userPlaySound===signalRParmaters.$SoundNotification&&f===!0&&$("#notify-sound")[0].play());b2COrderByQbicle(t.CurrentQbicleKey);$("li[data-b2cqbicleid="+t.CurrentQbicleKey+"]").hasClass("active")||$("li[data-b2cqbicleid="+t.CurrentQbicleKey+"] a .comms-newstuff").removeAttr("hidden")}})}function b2COrderByQbicle(n){var i=$("select[name='orderBy']"),t;i!=null&&i.val()==0&&(t=[],$("li[data-b2cqbicleid]").each(function(){t.push($(this).data("b2cqbicleid"))}),$("li[data-c2cqbicleid]").each(function(){t.push($(this).data("c2cqbicleid"))}),$.post("/B2C/MapQbicleKeyIsUpdated",{currentKey:n,listQbicleKey:t},function(n){var t,i;n&&(t=$("ul li[data-b2cqbicleid="+n+"]"),t!=null&&t.index()!=0&&t.slideToggle(500,function(){t.prependTo(t.parent()).slideToggle(500)}),t.length>0&&!t.hasClass("active")&&t.find(".comms-newstuff").removeAttr("hidden"),i=$('li[data-c2cqbicleid="'+n+'"]'),i.length>0&&!i.hasClass("active")&&i.find(".comms-newstuff").removeAttr("hidden"))}))}function UpdateOrderStatus(n,t){var i=_.toNumber($("#tradeorderid").val())==_.toNumber(t);if(i){try{$("#order-context-flyout-table").DataTable().ajax.reload(null,!1)}catch(r){}showOrderCartB2C(!1);reloadStatusSubmit();n==notificationEvent.B2COrderInvoiceCreationCompleted?DisplayPaymentTabToCustomer():n==notificationEvent.B2COrderBeginProcess?($("#order-li-tab").remove(),$("#tab0").remove(),$("#cart-li-tab").addClass("active"),$("#order-cart-tab").addClass("in active")):n==notificationEvent.B2COrderCompleted||n==notificationEvent.B2COrderPaymentApproved&&DisplayPaymentTabToCustomer()}}function convertUnicodeEmojiToImg(n){try{return jQuery().emojioneArea&&typeof emojione!="undefined"?emojione.unicodeToImage(n):n}catch{return n}}function enqueue(n){this.$queueNotify.push(n)}function dequeue(){return this.$queueNotify.shift()}function isEmpty(){return this.$queueNotify.length==0}var notificationEvent,$chatting,$originatingCreationId;$.connection.hub.url=$("#connection-hub-uri").val();var stocks=$.connection.broadcastUpdate,signalRParmaters={},$queueNotify=[];$(document).ready(function(){signalRParmaters={$userPlaySound:$("#userPlaySound").val(),$userNotificationMethod:$("#UserNotificationMethod").val(),$NonNotification:$("#NonNotification").val(),$SoundNotification:$("#SoundNotification").val(),$dashboardpagedisplay:$("#dashboard-page-display"),$currentQbicleId:$("#hdfCurrentQbicleId"),$currentDomainId:$("#hdfCurrentDomainId")};var n=0;n=window.setInterval(function(){isEmpty()==!1&&(this.$queueNotify.length==1?NewAlertNotification(dequeue(),!0):NewAlertNotification(dequeue(),!1))},5e3)});notificationEvent={QbicleCreation:1,QbicleUpdate:2,DiscussionCreation:3,DiscussionUpdate:4,TaskCreation:5,TaskCompletion:6,AlertCreation:7,EventCreation:8,EventWithdrawl:9,MediaCreation:10,PostCreation:11,ApprovalCreation:12,CreateMember:13,InvitedMember:14,AlertUpdate:15,ApprovalUpdate:16,TaskUpdate:17,EventUpdate:18,TopicPost:19,MediaUpdate:20,ApprovalReviewed:21,ApprovalApproved:22,ApprovalDenied:23,JournalPost:24,TransactionPost:25,LinkCreation:26,RemoveUserOutOfDomain:27,ReminderCampaignPost:28,RemoveQueue:29,QbicleInvited:30,AssignTask:31,C2CConnectionIssued:32,C2CConnectionAccepted:33,B2CConnectionCreated:34,LinkUpdate:35,ActivityComment:36,ListingInterested:37,RemoveUserOutOfQbicle:38,AddUserParticipants:39,RemoveUserParticipants:40,AddUserToQbicle:41,TypingChat:66,EndTypingChat:88,CreateRequest:90,ProcessExtensionRequest:91,B2COrderUpdated:92,PostEdit:93,B2COrderInvoiceCreationCompleted:94,B2COrderBeginProcess:95,B2COrderCompleted:96,B2COrderPaymentApproved:97,MediaRemoveVersion:98,MediaAddVersion:99,EventNotificationPoints:42,TaskNotificationPoints:43,TaskStart:44,TaskComplete:45,JoinToWaitlist:102,ApprovalSubscriptionAndCustomWaitlist:103,ApprovalSubscriptionWaitlist:104,ApprovalCustomWaitlist:105,RejectWaitlist:106,UpdateMembersList:108,B2BOrderCompleted:110};$chatting={NotConnected:"",Connected:"",ChatFrom:"",ChatFromId:"",Chatting:!1,ChatElement:""};$originatingCreationId="";stocks.client.updateNotifications=function(n){console.log("--------------broadcast-dev------------------");console.log(n);console.log("--------------end broadcast-dev------------------");setTimeout(function(){var i,t;if($originatingCreationId=n.OriginatingCreationId,n.BroadcastEvent==notificationEvent.TypingChat){if(i=document.getElementsByClassName($chatting.ChatElement),i.length>0)return;if($chatting.ChatFromId=n.CreatedId,$chatting.ChatElement="typing-chat-"+$chatting.ChatFromId,$chatting.Chatting=!0,$chatting.ChatFrom=n.CreatedEmail,t="",$chattingType&&$chattingType=="Order"){if($discussionId!=n.NotificationId)return;t+="<article class='"+$chatting.ChatElement+" activity event_snippet animated fadeInUp' style='margin-bottom: 25px;'>";t+="<div class='activity-avatar tiny' style=\"background-image: url('"+n.CreatedByIcon+"'); \"><\/div>";t+="<div class='activity-detail'>";t+="<a href='#'>";t+="<div class='activity-overview plain' style='padding: 0;'>";t+="<img src='/Content/DesignStyle/img/ellipsis.gif' class='typing tiny'>";t+="<\/div>";t+="<\/a>";t+="<\/div>";t+="<div class='clearfix'><\/div>";t+="<\/article>";$chatting.Connected=t;$("#list-comments-discussion").prepend($chatting.Connected)}else $chatting.NotConnected="<img class='"+$chatting.ChatElement+"' src='/Content/DesignStyle/img/ellipsis.gif' style='width: 50%;height: 50%;'>",t="<article id='typing-"+$chatting.ChatElement+"' class='"+$chatting.ChatElement+" activity event_snippet animated bounceIn' style='margin-bottom: 35px;'>",t+="<div class='activity-avatar' style=\"background-image: url('"+n.CreatedByIcon+"'); \"><\/div>",t+="<div class='activity-detail'>",t+="<a href='#'>",t+="<div class='activity-overview plain' style='padding: 0;'>",t+="<img src='/Content/DesignStyle/img/ellipsis.gif' class='typing'>",t+="<\/div>",t+="<\/a>",t+="<\/div>",t+="<div class='clearfix'><\/div>",t+="<\/article>",$chatting.Connected=t,$chatting.ChatFrom!=$connectedC2C?$("#"+$chatting.ChatElement).append($chatting.NotConnected):htmlActivityRender($chatting.Connected,0)}else n.BroadcastEvent==notificationEvent.EndTypingChat?(removeTypingElement(),$chatting={NotConnected:"",Connected:"",ChatFrom:"",ChatFromId:"",Chatting:!1,ChatElement:""}):n.BroadcastEvent==notificationEvent.CreateRequest?CheckPendingRequest():getNotificationById(n.NotificationId)})};$.connection.hub.logging=!0;$.connection.hub.start({transport:"longPolling"}).done(function(){$.ajax({type:"post",url:"/Qbicles/SetHubConnect?id="+$.connection.hub.id,dataType:"json",success:function(){}})}).fail(function(){});$.connection.hub.disconnected(function(){setTimeout(function(){$.connection.hub.start({transport:"longPolling"}).fail(function(){})},1e4)});$.connection.hub.error(function(){});