function getCurrencySettings(){$.ajax({url:"/Qbicles/GetCurrencySettings",type:"get","async":!1,success:function(n){currencySetting=n?n:{CurrencySymbol:"",SymbolDisplay:0,DecimalPlace:2}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function initModalWorkgroup(){var n=$("#frmSpanneredWorkgroup");n.validate({ignore:"",rules:{Name:{required:!0,maxlength:50},Processes:{required:!0},QbicleId:{required:!0},TopicId:{required:!0}}});n.submit(function(t){if(t.preventDefault(),!isBusy)if(n.valid())$.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?($("#app-spannered-workgroup-add").modal("hide"),$tblWorkgroups.DataTable().ajax.reload(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Spannered")):!n.result&&n.msg&&cleanBookNotification.error(_L(n.msg),"Spannered");checkPermissionAddEdit("Assets",0);isHideLoading=!0;loadAssets(0);isHideLoading=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")}});else{$("#tabNavWorkgroup a[href=#add-specifics]").tab("show");return}})}function initModalTag(){var n=$("#frmSpanneredTag");n.validate({ignore:"",rules:{Name:{required:!0,maxlength:50},Summary:{required:!0,maxlength:500}}});n.submit(function(t){if(t.preventDefault(),n.valid())$.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?($("#app-spannered-tag-add").modal("hide"),$tblAssetTags.DataTable().ajax.reload(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Spannered")):!n.result&&n.msg&&cleanBookNotification.error(_L(n.msg),"Spannered");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")}});else return})}function initDataTable(){$tblWorkgroups.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#config-2").LoadingOverlay("show"):$("#config-2").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!1,searching:!1,deferLoading:30,order:[[2,"desc"]],ajax:{url:"/Spanneredfree/GetWorkgroupsAll",data:function(n){return $.extend({},n,{locationId:$slLocation.val()})}},columns:[{title:"Name",data:"Name",searchable:!0,orderable:!0},{title:"Creator",data:"Creator",searchable:!0,orderable:!0},{title:"Created",data:"Created",searchable:!0,orderable:!0},{title:"Process",data:"Process",searchable:!0,orderable:!0},{title:"Qbicle",data:"Qbicle",searchable:!0,orderable:!0},{title:"Members",data:"Members",searchable:!0,orderable:!1},{title:"Product group(s)",data:"ProductGroups",searchable:!0,orderable:!1},{title:"Options",data:"Id",searchable:!0,orderable:!1}],columnDefs:[{targets:4,data:"Qbicle",render:function(n,t,i){return'<a href="javascript:void(0)" onclick="QbicleSelected(\''+i.QbicleId+"','Dashboard')\">"+n+"<\/a>"}},{targets:7,data:"Id",render:function(n){var t='<button class="btn btn-warning" onclick="loadModalWorkgroup('+n+');"><i class="fa fa-pencil"><\/i><\/button>';return t+(' <button class="btn btn-danger" onclick="deleteConfirmWorkgroup('+n+');"><i class="fa fa-trash"><\/i><\/button>')}}]});$tblAssetTags.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#config-2").LoadingOverlay("show"):$("#config-2").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!1,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/Spanneredfree/GetTagsAll"},columns:[{title:"Name",data:"Name",searchable:!0,orderable:!0},{title:"Summary",data:"Summary",searchable:!0,orderable:!0},{title:"Created",data:"Created",searchable:!0,orderable:!0},{title:"Creator",data:"Creator",searchable:!0,orderable:!0},{title:"Instances",data:"Instances",searchable:!0,orderable:!0},{title:"Options",data:"Id",searchable:!0,orderable:!1}],columnDefs:[{targets:5,data:"Id",render:function(n){var t='<button class="btn btn-warning" onclick="loadModalTag('+n+');"><i class="fa fa-pencil"><\/i><\/button>';return t+(' <button class="btn btn-danger" onclick="deleteConfirmTag('+n+');"><i class="fa fa-trash"><\/i><\/button>')}}]});$tblInventories.dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/Spanneredfree/GetSpanneredInventoryItems",type:"POST",data:function(n){return $.extend({},n,{locationId:$slLocation.val(),keyword:$("#txtInventorySearch").val(),groupId:$("#slInventoryGroup").val()?$("#slInventoryGroup").val():0})}},columns:[{title:"Item",data:"Item",searchable:!0,orderable:!0},{title:"Unit",data:"Unit",searchable:!0,orderable:!0},{title:"Barcode",data:"Barcode",searchable:!0,orderable:!0},{title:"SKU",data:"SKU",searchable:!0,orderable:!0},{title:"Group",data:"Group",searchable:!0,orderable:!0},{title:"Current stock",data:"CurrentStock",searchable:!0,orderable:!1},{title:"Additional",data:"ItemId",searchable:!0,orderable:!0},{title:"Options",data:"Id",searchable:!0,orderable:!1}],columnDefs:[{targets:0,data:"Item",render:function(n){return'<a href="#">'+n+"<\/a>"}},{targets:5,data:"CurrentStock",render:function(n){return toCurrencySymbol(n,!1)}},{targets:6,data:"ItemId",render:function(n){return'<button class="btn btn-info" data-toggle="modal" data-target="#app-trader-item-additional" onclick="ShowTraderItemAdditional('+n+')"><i class="fa fa-list"><\/i> &nbsp; View<\/button>'}},{targets:7,data:"Id",render:function(n,t,i){var r='<div class="btn-group options"><button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Options &nbsp; <i class="fa fa-angle-down"><\/i><\/button>';return r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a href="#" onclick="removeFromSpannered('+n+')">Remove from Spannered<\/a><\/li>',r+='<li><a href="#" onclick="loadModalConsume('+i.ItemId+')">Consume<\/a><\/li>',r+='<li><a href="#" onclick="loadModalTranferItems('+n+')">Transfer<\/a><\/li>',r+"<\/ul><\/div>"}}]});reloadTraderGroups()}function reloadTraderGroups(){$("#slInventoryGroup").empty();var n=$("#wg-qbicle").val();$.getJSON("/Spanneredfree/GetTraderGroupsByLocation",{lid:$slLocation.val()},function(n){n.unshift({id:0,text:"Show all"});$("#slInventoryGroup").select2({placeholder:"Please select",data:n})})}function reloadDataTableConfig(){$.fn.DataTable.isDataTable("#tblWorkgroups")?$tblWorkgroups.DataTable().ajax.reload():setTimeout(function(){$tblWorkgroups.DataTable().ajax.reload()},1500);$.fn.DataTable.isDataTable("#tblAssetTags")?$tblAssetTags.DataTable().ajax.reload():setTimeout(function(){$tblAssetTags.DataTable().ajax.reload()},1500)}function initSearch(){$("#txtAssetSearch").keyup(searchThrottle(function(){isInitpagination=!1;loadAssets(0)}));$("#sltags").change(searchThrottle(function(){isInitpagination=!1;loadAssets(0)}));$("#chkIsHidden").change(searchThrottle(function(){isInitpagination=!1;loadAssets(0)}));$("#slLocations").change(function(){isInitpagination=!1;loadAssets(0);reloadTraderGroups();$("#tab-spannered li.active a[href=#app-config]").length>0&&reloadDataTableConfig();$("#tab-spannered li.active a[href=#app-main-inventory]").length>0&&reloadDataTableInventory();$.post("/Spanneredfree/SaveLocationSelected",{lid:$(this).val()})});$("#txtInventorySearch").keyup(searchThrottle(function(){reloadDataTableInventory()}));$("#slInventoryGroup").change(function(){reloadDataTableInventory()})}function reloadDefaultTopic(n){var t=$("#wg-qbicle").val();$.getJSON("/Topics/GetTopicByQbicleId",{qbicleId:t?t:0,currentTopicId:n},function(n){$("#wg-topic").select2({placeholder:"Select a state",data:n})})}function loadModalWorkgroup(n){var t=$slLocation.val();$("#app-spannered-workgroup-add").modal("show");$("#app-spannered-workgroup-add").load("/Spanneredfree/LoadModalWorkgroup",{id:n,locationId:t},function(){$("#txtLocationName").val($("#slLocations option:selected").text());$("#txtWGLocationId").val(t);$("select.select2").select2();$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".btnNext").click(function(){var n=$(this).closest(".modal");$(n).find("#tabNavWorkgroup .active").next("li").find("a").trigger("click")});$(".btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find("#tabNavWorkgroup .active").prev("li").find("a").trigger("click")});initModalWorkgroup()})}function deleteConfirmWorkgroup(n){$("#wg-delete-id").val(n);$("#wg-delete-modal").modal("show")}function deleteWorkgroup(){$.post("/Spanneredfree/DeleteWorkgroup",{id:$("#wg-delete-id").val()},function(n){n.result?($("#wg-delete-id").val(0),$("#wg-delete-modal").modal("hide"),$tblWorkgroups.DataTable().ajax.reload()):!n.result&&n.msg&&cleanBookNotification.error(_L(n.msg),"Spannered")})}function loadModalTag(n){$("#frmSpanneredTag").validate().resetForm();n>0?$.get("/Spanneredfree/getTagById?id="+n,function(t){t?($("#app-spannered-tag-add h5.modal-title").text("Edit a Tag"),$('#frmSpanneredTag input[name="Id"]').val(t.Id),$('#frmSpanneredTag input[name="Name"]').val(t.Name),$('#frmSpanneredTag input[name="Summary"]').val(t.Summary),$("#app-spannered-tag-add").modal("show")):cleanBookNotification.error(_L("ERROR_MSG_410",[n]),"Spannered")}):($("#app-spannered-tag-add h5.modal-title").text("Add a Tag"),$('#frmSpanneredTag input[name="Id"]').val(0),$('#frmSpanneredTag input[name="Name"]').val(""),$('#frmSpanneredTag input[name="Summary"]').val(""),$("#app-spannered-tag-add").modal("show"))}function deleteConfirmTag(n){$("#tag-delete-id").val(n);$("#tag-delete-modal").modal("show")}function deleteTag(){$.post("/Spanneredfree/DelectTag",{id:$("#tag-delete-id").val()},function(n){n.result?($("#tag-delete-id").val(0),$("#tag-delete-modal").modal("hide"),$tblAssetTags.DataTable().ajax.reload()):!n.result&&n.msg&&cleanBookNotification.error(_L(n.msg),"Spannered")})}function addMembers(n){var t=$("#slMembers").val();t||(t=[]);t.push(n);$("#slMembers").val(t)}function removeMembers(n){var i=$("#slMembers").val(),t;i&&(i=$.grep(i,function(t){return t!=n}));t=$("#slReviewersApprovers").val();t&&(t=$.grep(t,function(t){return t!=n}));$("#slReviewersApprovers").val(t);$("#slMembers").val(i);$("#apr"+n).prop("checked",!1);$("#apr"+n).change()}function isApprover(n,t){var i=$("#slReviewersApprovers").val();$(t).prop("checked")?(i||(i=[]),i.push(n)):i&&(i=$.grep(i,function(t){return t!=n}));$("#slReviewersApprovers").val(i)}function filterMembers(){try{var n=$("#spkeyword").val(),t=$("#slShow").val();n?$("#wgMembers li").each(function(){var i=$(this),r=i.attr("fullname");t=="1"?i.hasClass("ismember")&&r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide():r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide()}):t=="1"?($("ul.widget-contacts li.ismember").show(),$("ul.widget-contacts li:not(.ismember)").hide()):$("ul.widget-contacts li").show()}catch(i){return}}function loadAssets(n){var r=$("#chkIsHidden").prop("checked")?2:3,t,i;!isHideLoading&&$("#tab-spannered li.active a[href=#app-assets]").length>0&&$("#app-assets").LoadingOverlay("show");t=$("#sltags").val();i={lid:$slLocation.val(),skip:n,take:assetPageSize,keyword:$("#txtAssetSearch").val(),option:r,tags:t?t:[]};$.ajax({url:"/Spanneredfree/LoadAssets",type:"POST",data:JSON.stringify(i),contentType:"application/json",dataType:"json",success:function(n){n.result&&n.Object&&($("#app-assets div.flex-grid-quarters-lg").html(n.Object.strResult),isInitpagination||initPagination(n.Object.totalRecord,assetPageSize,"#AssetPaginateTemplate"));$("#app-assets").LoadingOverlay("hide",!0)},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");$("#app-assets").LoadingOverlay("hide",!0)}})}function updateOptionAsset(n,t){$.post("/Spanneredfree/UpdateOptionAsset",{id:n,option:t},function(){if($("#chkIsHidden").prop("checked")){var n=$("#AssetPaginateTemplate").pagination("getSelectedPageNum");loadAssets((n-1)*assetPageSize)}else isInitpagination=!1,loadAssets(0)})}function initPagination(n,t,i){var r=$(i),u,f;n!=0?(r.show(),u=function(){for(var i=[],t=1;t<=n;t++)i.push(t);return i}(),f={prevText:"&nbsp; &laquo; Prev &nbsp;",nextText:"&nbsp; Next &raquo; &nbsp;",currentPage:1,pageSize:t,dataSource:u,callback:function(n,i){isInitpagination&&loadAssets((i.pageNumber-1)*t,t)}},r.pagination(f),isInitpagination=!0):(r.hide(),isInitpagination=!1)}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||800)}}function backupValueOfUnit(n){$("#valueOfUnit_"+n).val($("#valueOfUnit_"+n).data("backup"))}function checkAndUpdateValueOfUnit(n){$("#valueOfUnit_"+n).val()?$.ajax({type:"post",url:"/Spanneredfree/UpdateValueOfUnit",datatype:"json",data:{meterId:n,valueOfUnit:$("#valueOfUnit_"+n).val()},success:function(t){t.result?($(".addreading_"+n).hide(),$(".meter-options_"+n).fadeIn(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Spannered"),searchMeters()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")},fail:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")}}):cleanBookNotification.error("Value of unit cannot be empty!","Spannered")}function checkPermissionAddEdit(n,t){$.post("/Spanneredfree/CheckPermissionAddEdit",{process:n,workgroupId:t},function(t){t.result?n==="Assets"?($("#options-assets button").show(),$("a[href='#app-spannered-asset-edit']").show()):n==="Asset Tasks"?$("#task-options button").show():n==="Meters"?$("#meter-options button").show():n=="Consumption Reports,Purchases,Transfers"&&($("#btnAddCPT").show(),t.Object&&t.Object.indexOf("Consumption Reports")>=0?$(".add-consume-report").show():$(".add-consume-report").hide(),t.Object&&t.Object.indexOf("Purchases")>=0?$(".add-consume-purchase").show():$(".add-consume-purchase").hide(),t.Object&&t.Object.indexOf("Transfers")>=0?$(".add-consume-transfer").show():$(".add-consume-transfer").hide()):n==="Assets"?($("#options-assets button").hide(),$("a[href='#app-spannered-asset-edit']").hide()):n==="Asset Tasks"?$("#task-options button").hide():n==="Meters"?$("#meter-options button").hide():n=="Consumption Reports,Purchases,Transfers"&&$("#btnAddCPT").hide()})}function loadModalTransfer(n){$("#app-spannered-asset-relocate").modal("show");$("#app-spannered-asset-relocate").load("/Spanneredfree/LoadModalTransfer",{assetId:n,locationId:$slLocation.val()},function(){$("#app-spannered-asset-relocate select.select2").select2({placeholder:"Please select"});initFormTransferAsset(n)})}function initFormTransferAsset(n){var t=$("#frmTransferAsset");t.validate({ignore:"",rules:{WorkgroupId:{required:!0},DestinationLocationId:{required:!0}}});t.submit(function(i){if(i.preventDefault(),!isBusy)if(t.valid()){$.LoadingOverlay("show");var r={Status:"PendingPickup",OriginatingLocation:{Id:$slLocation.val()},DestinationLocation:{Id:$("#frmTransferAsset select[name=DestinationLocationId]").val()},Workgroup:{Id:$("#frmTransferAsset select[name=WorkgroupId]").val()}};$.ajax({type:"post",url:"/Spanneredfree/SaveTransferAsset",data:{assetId:n,transfer:r},dataType:"json",success:function(n){if($.LoadingOverlay("hide"),$("#app-spannered-asset-relocate").modal("hide"),n.result){cleanBookNotification.createSuccess();var t=$("#AssetPaginateTemplate").pagination("getSelectedPageNum");loadAssets((t-1)*assetPageSize)}else cleanBookNotification.error(n.msg,"Spannered")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")}})}else{$("#frmTransferAsset ul.app_subnav a[href=#relocate-1]").tab("show");return}});initNextPreviousTab("#frmTransferAsset","#tabtransferasset")}function previewLocation(n){var t=$(n).children("option:selected");t&&($("#preview-destination-location-title").text("To "+$(t).data("name")),$("#preview-destination-location-address").html($(t).data("address")))}function reloadDataTableInventory(){$.fn.DataTable.isDataTable("#tblInventories")?$tblInventories.DataTable().ajax.reload():setTimeout(function(){$tblInventories.DataTable().ajax.reload()},1500)}function ShowTraderItemAdditional(n){var t="/TraderItem/GetTraderItem?id="+n;LoadingOverlay();$("#app-trader-item-additional").empty();$("#app-trader-item-additional").load(t,function(){LoadingOverlayEnd()})}function removeFromSpannered(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Spannered",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/Spanneredfree/RemoveItemSpanneredByAIId",{aiId:n},function(n){n.result?$tblInventories.DataTable().ajax.reload():!n.result&&n.msg?cleanBookNotification.error(response.msg,"Spannered"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")});return}}})}function loadModalConsume(n){$("#app-spannered-inventory-consume").empty();$("#app-spannered-inventory-consume").modal("show");$("#app-spannered-inventory-consume").load("/Spanneredfree/loadModalConsume",{itemId:n,lid:$slLocation.val()},function(){n>0&&(unitId=0);initModalConsume(n)})}function initModalConsume(n){$(frmConsumeinventory+" select.select2").select2({placeholder:"Please select"});var t=$("#frmConsumeinventory");t.validate({ignore:"",rules:{SPWorkgroupId:{required:!0},Name:{required:!0,minlength:5,maxlength:150},Description:{required:!0,maxlength:500}},invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});t.submit(function(n){if((n.preventDefault(),!isBusy)&&t.valid()){$.LoadingOverlay("show");var i={Status:"Pending",LocationId:$slLocation.val(),TaskId:$("#hdfAssocicatedLinkTaskId").val(),WorkgroupId:$(frmConsumeinventory+" select[name=SPWorkgroupId]").val(),Name:$(frmConsumeinventory+" input[name=Name]").val(),Description:$(frmConsumeinventory+" textarea[name=Description]").val(),Items:[]},r=$("#tblConsumedStock").DataTable().rows().data();if($.each(r,function(n,t){var r=0;t.Used&&(r=t.Used,i.Items.push({ItemId:t.ItemId,UnitId:t.UnitId,Allocated:stringToNumber(t.Allocated?t.Allocated:0),Used:r,Note:t.Note}))}),i.Items.length==0){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MIN_ITEM_CONSUME"),"Spannered");return}$.ajax({type:"post",url:this.action,data:{consumeReport:i},dataType:"json",success:function(n){$.LoadingOverlay("hide");$("#app-spannered-inventory-consume").modal("hide");n.result?cleanBookNotification.createSuccess():cleanBookNotification.error(_L(n.msg),"Spannered")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Spannered")}})}});initNextPreviousTab(frmConsumeinventory,"#tabConsumeInventory");$("#tblAssetTasks").DataTable({destroy:!0});initTableConsumeStock(n);$("#slCSGroups").select2({ajax:{url:"/Spanneredfree/GetTraderGroupsByLocation",delay:250,data:function(n){return{search:n.term,lid:$slLocation.val()}},cache:!0,processResults:function(n){return n.unshift({id:0,text:"Show all"}),{results:n}}}});$("#slATGroups").select2();$("#txtATKeyword").keyup(searchThrottle(function(){$("#tblAssetTasks").DataTable().search($(this).val()).draw()}));$("#slATGroups").change(function(){$("#tblAssetTasks").DataTable().columns(2).search($(this).val()).draw()});$("#txtCSKeyword").keyup(searchThrottle(function(){loadConsumedStock()}));$("#slCSGroups").change(function(){loadConsumedStock()})}function initTableConsumeStock(n){n==0?$("#tblConsumedStock").DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,order:[[2,"asc"]],ajax:{url:"/Spanneredfree/GetSpanneredInventoryItems",type:"POST",data:function(n){return $.extend({},n,{locationId:$slLocation.val(),keyword:$("#txtCSKeyword").val(),groupId:$("#slCSGroups").val()?$("#slCSGroups").val():0,linkTaskId:$("#hdfAssocicatedLinkTaskId").val()})}},columns:[{title:"ItemId",data:"ItemId",searchable:!1,orderable:!1},{title:"UnitId",data:"UnitId",searchable:!1,orderable:!1},{title:"Item",data:"Item",searchable:!0,orderable:!0},{title:"Unit",data:"Unit",searchable:!0,orderable:!0},{title:"Barcode",data:"Barcode",searchable:!0,orderable:!0},{title:"SKU",data:"SKU",searchable:!0,orderable:!0},{title:"Group",data:"Group",searchable:!0,orderable:!0},{title:"In stock",data:"CurrentStock",searchable:!0,orderable:!1},{title:"Allocated",data:"Allocated",searchable:!0,orderable:!0},{title:"Used",data:"Used",searchable:!1,orderable:!1},],columnDefs:[{targets:0,visible:!1},{targets:1,visible:!1},{targets:2,data:"Item",render:function(n){return'<a href="#">'+n+"<\/a>"}},{targets:7,data:"CurrentStock",render:function(n){return toCurrencySymbol(n,!1)}},{targets:8,data:"Allocated",render:function(n){return n?toCurrencySymbol(n,!1):""}},{targets:9,data:"Used",render:function(){return'<input type="number" class="form-control trackInput">'}}],drawCallback:function(){$(".trackInput").on("change",function(){var n=$(this).parents("tr"),t=$("#tblConsumedStock").DataTable().row(n).data();t.Used=$(this).val()})}}):$("#tblConsumedStock").DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,order:[[2,"asc"]],ajax:{url:"/Spanneredfree/GetSpanneredInventoryItems",type:"POST",data:function(t){return $.extend({},t,{locationId:$slLocation.val(),keyword:$("#txtCSKeyword").val(),groupId:$("#slCSGroups").val()?$("#slCSGroups").val():0,linkTaskId:$("#hdfAssocicatedLinkTaskId").val(),itemId:n,unitId:unitId})}},columns:[{title:"ItemId",data:"ItemId",searchable:!1,orderable:!1},{title:"UnitId",data:"UnitId",searchable:!1,orderable:!1},{title:"Item",data:"Item",searchable:!0,orderable:!0},{title:"Unit",data:"Unit",searchable:!0,orderable:!0},{title:"Barcode",data:"Barcode",searchable:!0,orderable:!0},{title:"SKU",data:"SKU",searchable:!0,orderable:!0},{title:"Group",data:"Group",searchable:!0,orderable:!0},{title:"In stock",data:"CurrentStock",searchable:!0,orderable:!1},{title:"Allocated",data:"Allocated",searchable:!0,orderable:!0},{title:"Used",data:"Used",searchable:!1,orderable:!1},],columnDefs:[{targets:0,visible:!1},{targets:1,visible:!1},{targets:2,data:"Item",render:function(n){return'<a href="#">'+n+"<\/a>"}},{targets:3,data:"Unit",render:function(n,t,i){var r='<select name="unit" onchange="changeUnitConsumeReport(this)" class="form-control select2" style="width: 100%;">';return i.Units&&$.each(i.Units,function(n,t){r+='<option value="'+t.id+'" '+(t.id==i.UnitId?"selected":"")+">"+fixQuoteCode(t.text)+"<\/option>"}),r+="<\/select>"}},{targets:7,data:"CurrentStock",render:function(n){return toCurrencySymbol(n,!1)}},{targets:8,visible:!1},{targets:9,data:"Used",render:function(){return'<input type="number" class="form-control trackInput" style="border: 1px solid #e1e1e1;">'}}],drawCallback:function(){$(".trackInput").on("change",function(){var n=$(this).parents("tr"),t=$("#tblConsumedStock").DataTable().row(n).data();t.Used=$(this).val()});$("#tblConsumedStock .select2").select2()}})}function consumeWorkgroupSelect(n){var t,r,i,u;$(n).valid()&&(t=$("option:selected",n).attr("detail-info"),t=t.split("|"),r=JSON.parse(t[3]),$(frmConsumeinventory+" .prv-Location").text($("option:selected",$slLocation).text()),$(frmConsumeinventory+" .prv-process").text(t[2]),$(frmConsumeinventory+" .prv-qbicle").text(t[0]),$(frmConsumeinventory+" .prv-members").text(t[1]),$(frmConsumeinventory+" .prv-members").closest("button").attr("onclick","loadTeamsWorkgroupSpannered("+$(n).val()+")"),r&&(i='<ul class="unstyled" style="margin: 0; padding: 8px 0;">',r.forEach(function(n){i+="<li>"+fixQuoteCode(n)+"<\/li>"}),i+="<\/ul>",$(frmConsumeinventory+" .prv-groups").html(i)),u={search:"",wgId:$("#frmConsumeinventory select[name=SPWorkgroupId]").val()?$("#frmConsumeinventory select[name=SPWorkgroupId]").val():0},$.get("/Spanneredfree/GetMembersQbicleByWorkgroupId",u).done(function(n){n.Object.unshift({id:"0",text:"Show all"});$("#slATGroups").select2({data:n.Object})}))}function loadConsumedStock(){$.fn.DataTable.isDataTable("#tblConsumedStock")?$("#tblConsumedStock").DataTable().ajax.reload():setTimeout(function(){$("#tblConsumedStock").DataTable().ajax.reload()},1500)}function initNextPreviousTab(n,t){$(n+" .btnNext").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").next("li").find("a").trigger("click")});$(n+" .btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").prev("li").find("a").trigger("click")})}function associcatedConsumeLinkTask(n,t,i){n?($("#hdfAssocicatedLinkTaskId").val(t),$("#tblAssetTasks").DataTable().columns(5).search(t).draw(),$(i).hide(),$("#taskchange"+t).show(),$("#optnext").removeAttr("disabled"),$("#skip").hide(),loadConsumedStock()):($("#tblAssetTasks").DataTable().columns(5).search("").draw(),$("#hdfAssocicatedLinkTaskId").val(0),$(i).hide(),$("#taskuse"+t).show(),$("#optnext").attr("disabled",!0),$("#skip").show(),loadConsumedStock())}function changeUnitConsumeReport(n){var t=$(n).val();unitId=t?t:0;loadConsumedStock()}function loadTeamsWorkgroupSpannered(n){$("#team-view").empty();$("#team-view").modal("show");$("#team-view").load("/Spanneredfree/LoadTeamsByWorkgroupId?wgId="+n)}function loadConsumeItemsByTaskId(n){$("#app-spannered-items-task").empty();$("#app-spannered-items-task").modal("show");$("#app-spannered-items-task").load("/Spanneredfree/LoadConsumeItemsByTaskId?taskId="+n+"&lId="+$slLocation.val())}function inventoryPermissions(){checkPermissionAddEdit("Consumption Reports,Purchases,Transfers",0)}var isBusy=!1,$tblWorkgroups=$("#tblWorkgroups"),$tblAssetTags=$("#tblAssetTags"),$tblInventories=$("#tblInventories"),$slLocation=$("#slLocations"),frmConsumeinventory="#frmConsumeinventory",assetPageSize=8,isInitpagination=!1,isHideLoading=!1,unitId=0;$(document).ready(function(){getCurrencySettings();initDataTable();initModalTag();loadAssets(0);initSearch();checkPermissionAddEdit("Assets",0)});