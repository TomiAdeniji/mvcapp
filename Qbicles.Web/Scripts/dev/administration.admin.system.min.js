function editDomain(n,t,i){$("#domain-logo").attr("src",i);$("#domainId-UI").val("");$("#domainName-UI").val("");$("#logoDomain-UI").val("");ClearError();$("#title-add-update-domain").text("Edit Domain");$("#title-btn-addEdit-domain").text("Save Domain");$("#create-domain").modal("show");$("#domainId-UI").val(n);$("#domainName-UI").val(t)}function addDomain(){$("#domainId-UI").val("");$("#domainName-UI").val("");$("#logoDomain-UI").val("");ClearError();$("#title-add-update-domain").text("Add a Domain");$("#title-btn-addEdit-domain").text("Add Domain");$("#domain-logo").attr("src","");$("#create-domain").modal("show")}function openOrCloseDomainById(n,t){$.ajax({type:"post",url:"/Domain/OpenOrCloseDomainById",datatype:"json",data:{domainKey:n},success:function(n){n.result?($("#status-"+t).text(n.msg),$("#openOrClose-"+t).text(n.Object.Label)):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function ListUserBySysTemAdmin(){$("#tbdatatable").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tbdatatable").LoadingOverlay("show",{minSize:"70x60px"}):$("#tbdatatable").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,responsive:!0,lengthMenu:[[10,20,50,100,200],[10,20,50,100,200]],pageLength:10,order:[[1,"desc"]],ajax:{url:"/Qbicles/LoadAllUserBySystemAdmin",type:"POST"},columns:[{data:"ProfilePic",orderable:!1,render:function(n,t,i){return i.ProfilePic?' <div class="table-avatar mini" style="background-image: url(\''+apiDocRetrievalUrl+i.ProfilePic+"&size=T');\">&nbsp;<\/div>":' <div class="table-avatar mini" style="background-image: url(\'../Content/DesignStyle/img/icon_contact.png\');">&nbsp;<\/div>'}},{data:"UserName",orderable:!0,render:function(n,t,i){return i.UserName}},{data:"Email","class":"Email",orderable:!0},{data:"Roles",orderable:!1,render:function(n,t,i){return RenderSystemRolesColumn(i.Id,i.SystemRoles)}},{data:"Domain",orderable:!1,render:function(n,t,i){return" <ul>"+i.Domain+"<\/ul>"}},{data:"IsEnabled",orderable:!0,render:function(n,t,i){return i.IsEnabled?'<span class="label label-success label-lg">Active<\/span>':'<span class="label label-danger label-lg">Blocked<\/span>'}},{data:null,orderable:!1,width:"80px",render:function(n,t,i){return i.IsEnabled?'<button class="btn btn-danger" onclick="SuspendOrActive(\''+i.Id+'\',0)"><i class="fa fa-user-lock" style="color: #fff;"><\/i> &nbsp; Block<\/button>':'<button class="btn btn-primary" onclick="SuspendOrActive(\''+i.Id+'\',1)"><i class="fa fa-lock-open" style="color: #fff;"><\/i> &nbsp; Unblock<\/button>'}}],drawCallback:function(){$("#tbdatatable").DataTable().columns.adjust().responsive.recalc();$(".role-multi").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}})}function RenderSystemRolesColumn(n,t){var i="<select id='user-"+n+"' onchange='UpdateSystemUserRoles(\""+n+"\")'class='form-control role-multi' multiple>";return _.forEach($domanRoles,function(n){var r="",u=_.find(t,t=>t.Id===n.Id);u!=null&&(r="selected");i+="<option value='"+n.Name+"' "+r+">"+n.Name+"<\/option>"}),i+="<\/select>"}function UpdateSystemUserRoles(n){$.ajax({type:"POST",url:"/Administration/UpdateSystemUserRoles",dataType:"JSON","async":!1,data:{userId:n,roles:$("#user-"+n).val()},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){})}function SuspendOrActive(n,t){$.ajax({type:"POST",url:"/Qbicles/SuspendOrActive",dataType:"JSON","async":!1,data:{userId:n,type:t},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#tbdatatable").DataTable().ajax.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||500)}}function triggerSessionId(n){$("#sessionId").val($(n).text());changeFilterLog()}function InitLogTable(){var n=$("#tblLogs").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblLogs").LoadingOverlay("show"):$("#tblLogs").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,order:[[0,"desc"]],ajax:{url:"/Administration/LoadLogs",type:"POST",data:function(n){return $.extend({},n,{searchAll:$("#searchAll").val(),dateRangeLog:$("#dateRangeLog").val(),sessionId:$("#sessionId").val(),domainKey:$("#domainKey").val(),appType:$("#appType").val(),action:$("#action").val()})}},columns:[{data:"StrCreatedDate",orderable:!0},{data:"SessionID",orderable:!0,render:function(n,t,i){return'<a href="javascript:void(0)" onclick="triggerSessionId(this)" title="Click to filter by this ID">'+i.SessionID+"<\/a>"}},{data:"Domain",orderable:!0},{data:"Qbicle",orderable:!0},{data:"User",orderable:!0},{data:"IPAddress",orderable:!0},{data:"App",orderable:!0},{data:"Action",orderable:!0},]});$('#filterColumn input[type="checkbox"]').on("change",function(){var t=n.column($(this).data("column"));t.visible(!t.visible())})}function LoadLogFilter(){$("#tab-logs").load("/Administration/LoadLogFilter",function(){$("select.select2").select2({placeholder:"Please select"});$("#log_filter .daterange").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:"DD-MM-YYYY"}});$("#log_filter .daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateFormatByUser.toUpperCase())+" - "+t.endDate.format($dateFormatByUser.toUpperCase()));changeFilterLog()});$("#log_filter .daterange").on("cancel.daterangepicker",function(){$(this).val("");changeFilterLog()});InitLogTable();$("#searchAll, #sessionId").keyup(searchThrottle(function(){changeFilterLog()}));$("#domainKey, #appType, #action").change(function(){changeFilterLog()})})}function downloadFile(n){window.location.href=n}function ExportToCSV(){LoadingOverlay();var n={};n.searchAll=$("#searchAll").val();n.dateRangeLog=$("#dateRangeLog").val();n.sessionId=$("#sessionId").val();n.domainKey=$("#domainKey").val();n.appType=$("#appType").val();n.act=$("#action").val();downloadFile("/Administration/ExportToCSV?"+$.param(n));LoadingOverlayEnd()}function changeFilterLog(){$("#tblLogs").DataTable().ajax.reload()}function LoadApplicationAccess(){$("#tbl-appaccess-domains").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");$(".batch").hide();$(".domain-all-chk").prop("checked",!1);i?$("#tbl-appaccess-domains").LoadingOverlay("show"):$("#tbl-appaccess-domains").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100,200],[10,20,50,100,200]],pageLength:10,order:[[2,"desc"]],ajax:{url:"/Domain/GetListDomainApplicationAccess",type:"POST",data:function(n){return $.extend({},n,{name:$("#appaccess-domain-name").val(),status:$("#appaccess-domain-status").val()})}},columns:[{data:"Id",orderable:!1,render:function(n,t,i){return"<input value='"+i.Key+'\' type="checkbox" onchange="CheckDomain()">'}},{data:"LogoUri",width:"80px",orderable:!1,render:function(n,t,i){return i.LogoUri?' <div class="table-avatar" style="background-image: url(\''+apiDocRetrievalUrl+i.LogoUri+"&size=T');\">&nbsp;<\/div>":'<div class="table-avatar" style="background-image: url(\'/Content/DesignStyle/img/icon_domain_default.png\');">&nbsp;<\/div>'}},{data:"Name",orderable:!0,render:function(n,t,i){return i.Name}},{data:"Status",orderable:!0,render:function(n,t,i){var r="success";return i.Status!="Active"&&(r="danger"),'<span class="label label-lg label-'+r+'">'+i.Status+"<\/span>"}},{data:"AvailableApps",orderable:!0,render:function(n,t,i){return i.AvailableApps}},{data:null,orderable:!1,width:"80px",render:function(n,t,i){return'<input hidden id="domain-name-'+i.Id+'" value="'+i.Name+'"/><button class="btn btn-warning" onclick="ShowManageDomainApps(\''+i.Key+"', "+i.Id+')"><i class="fa fa-pencil"><\/i> &nbsp; Manage<\/button>'}}]});$("#appaccess-domain-name").keyup(searchThrottle(function(){LoadListApplicationAccess()}));$("#appaccess-domain-status").change(function(){LoadListApplicationAccess()})}function LoadListApplicationAccess(){$("#tbl-appaccess-domains").DataTable().ajax.reload()}function CheckDomain(){var n=$("#tbl-appaccess-domains").DataTable().$('input[type="checkbox"]:checked').length;n>0?$(".batch").show():$(".batch").hide()}function GetDomainsSelected(){var n=[];return $("#tbl-appaccess-domains").DataTable().rows().every(function(){var i=$(this.node()),t=$(i).find("input[type=checkbox]");$(t).prop("checked")&&n.push($(t).val())}),n}function GetAppsSelected(){return $("#app-add-remove-selected").val()}function RevokeAllApps(){$.LoadingOverlay("show");$.ajax({type:"post",url:"/Administration/RevokeAllApps?all="+$isAdllDomains,dataType:"json",data:{domainIds:GetDomainsSelected()},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#tbl-appaccess-domains").DataTable().ajax.reload(null,!1),$("#revoke-all-apps-modal").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ConfirmRevokeApp(n){$isAdllDomains=n;n?$("#confirm-revoke-title").text("Are you sure you want to remove all app access rights from all Domains?"):$("#confirm-revoke-title").text("Are you sure you want to remove all app access rights from the chosen Domains?")}function ShowAddRemoveApps(n,t){var i="/Administration/SysadminAppAddRemoveModalShow?add="+n+"&all="+t;AjaxElementShowModal(i,"sysadmin-app-add-remove-modal")}function SaveAddRemoveAppsDomains(){$.LoadingOverlay("show");$.ajax({type:"post",url:"/Administration/SaveAddRemoveAppsDomains?add="+$("#app-add-or-edit").val()+"&all="+$("#app-to-all-domain").val(),dataType:"json",data:{domainKeys:GetDomainsSelected(),appIds:GetAppsSelected()},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#tbl-appaccess-domains").DataTable().ajax.reload(null,!1),$("#sysadmin-app-add-remove-modal").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function OnSelectApp(){var n=$("#app-add-remove-selected").val();n==null?$("#button-confirm-apps").attr("disabled","disabled"):$("#button-confirm-apps").removeAttr("disabled")}function ShowManageDomainApps(n,t){$.LoadingOverlay("show");var i="/Administration/SysadminAppAssignModalShow?domainkey="+n;$("#sysadmin-app-assign").empty();$("#sysadmin-app-assign").load(i,function(){$(".app-domain-access").bootstrapToggle();$("#domain-name").text($("#domain-name-"+t).val());$("#sysadmin-app-assign").modal("show");LoadingOverlayEnd()})}function SaveManageDomainApps(n){var t=[];$("input:checkbox.app-domain-access").each(function(){var n=$(this).prop("checked");n==!0&&t.push($(this).val())});$.ajax({type:"post",url:"/Administration/SaveAppAssignModal",dataType:"json",data:{addAppIds:t,domainKey:n},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#tbl-appaccess-domains").DataTable().ajax.reload(null,!1),$("#sysadmin-app-assign").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function initLoyaltySystemSetting(){var n=$("#loyalty-syssetting-form");n.validate({rules:{amount:{required:!0},point:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){var i=$("#setting-amount").val(),r=$("#setting-point").val();i<0?n.validate().showErrors({amount:"Setting Amount must be greater than or equal to 0."}):r<0?n.validate().showErrors({point:"Setting Amount must be greater than or equal to 0."}):saveLoyaltySystemSetting()}})}function saveLoyaltySystemSetting(){var t=$("#setting-amount").val(),i=$("#setting-point").val(),r={Points:i,Amount:t},n;$("#tab-loyalty").LoadingOverlay("show");n="/LoyaltyPointConversion/AddLoyaltySystemSetting";$.ajax({method:"POST",url:n,data:{sysSettings:r},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#confirm").attr("disabled","disabled")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});$("#tab-loyalty").LoadingOverlay("hide")}$(function(){LoadLogFilter();ListUserBySysTemAdmin();LoadApplicationAccess()});var $isAdllDomains=!1;