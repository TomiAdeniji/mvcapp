function reloadDataItemImports(){$("#table-item-import").DataTable().ajax.reload(null,!1)}function UploadNew(){$("#button-import-now").attr("disabled","disabled");$("#item-upload-file").val("");$("#location-select").val(0).trigger("change");ShowImport();$("#import-items-modal").modal("toggle")}function OnSelectLocation(){$("#location-select").val()=="0"?$("#button-import-now").attr("disabled","disabled"):$("#button-import-now").removeAttr("disabled")}function uploading(){var n,t,i;if(ShowImporting(),n=document.getElementById("item-upload-file").files,n<=0||$("#item-upload-file").val()==""){cleanBookNotification.error("Spreadsheet file is required!","Qbicles");ShowImport();return}if($("#location-select").val()=="0"){cleanBookNotification.error("Location will items be added is required!","Qbicles");ShowImport();return}t=document.getElementById("item-upload-file").files;i=t[0];$.ajax({type:"post",url:"/TraderItemImport/FileNameAndExtensionVerify",data:{fileName:i.name,locationId:parseInt($("#location-select").val())},dataType:"json",success:function(n){n.result?SaveItemImport():n.actionVal==2?ShowImportFailed():(ShowImport(),cleanBookNotification.error(n.msg,"Qbicles"))},error:function(n){ShowImport();cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){})}function ShowImporting(){$("#import").hide();$("#importing").show();$("#imported").hide();$("#importfailed").hide()}function ShowImport(){$("#import").show();$("#importing").hide();$("#imported").hide();$("#importfailed").hide();$("#button-import-now").show()}function ShowImportFailed(){$("#import").show();$("#importing").hide();$("#imported").hide();$("#importfailed").show();$("#button-import-now").hide()}function SaveItemImport(){ShowImporting();UploadMediaS3ClientSide("item-upload-file").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}var t={Id:0,Location:{Id:parseInt($("#location-select").val())},Domain:{Id:0},SpreadsheetKey:n.objectKey,Spreadsheet:n.fileName};$.ajax({type:"post",url:"/TraderItemImport/SaveItemImport",data:{itemImport:t},dataType:"json",success:function(n){n.result?($("#import").hide(),$("#importing").hide(),$("#imported").show()):($("#import").show(),$("#importing").hide(),$("#imported").hide(),cleanBookNotification.error(n.msg,"Qbicles"))},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){})})}function LoadItemImports(){$("#table-item-import").on("processing.dt",function(n,t,i){i?$("#table-item-import").LoadingOverlay("show",{minSize:"70x60px"}):$("#table-item-import").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/TraderItemImport/GetItemImports",type:"POST",dataType:"json",data:function(n){return $.extend({},n,{keyword:$("#search-dt").val(),datetime:$("#input-datetime-range").val(),locationId:$("#location-filter").val()})}},columns:[{name:"Spreadsheet",data:"Spreadsheet",orderable:!0},{name:"Location",data:"Location",orderable:!0},{name:"CreatedDate",data:"CreatedDate",orderable:!0},{name:"Uploader",data:"Uploader",orderable:!0},{name:null,data:null,orderable:!0,render:function(n,t,i){switch(i.Status){case 1:return"<span class='label label-lg label-info'>Verifying file format<\/span>";case 2:return"<span class='label label-lg label-primary'>Uploading &amp; updating items<\/span>";case 3:return"<span class='label label-lg label-success'>Uploaded<\/span>";case 4:return"<span class='label label-lg label-danger'>Uploaded with errors<\/span>";case 5:return"<span class='label label-lg label-warning'>File error<\/span>"}}},{name:null,data:null,orderable:!0,render:function(n,t,i){var r="";switch(i.Status){case 3:case 4:i.ItemsImported!=null&&(r+="<span class='label label-lg label-success'> Imported: "+i.ItemsImported+"<\/span>&nbsp;");i.ItemsUpdated!=null&&(r+="<span class='label label-lg label-primary'> Updated: "+i.ItemsUpdated+"<\/span>&nbsp;");i.ItemsError!=null&&(r+="<span class='label label-lg label-warning'> Error: "+i.ItemsError+"<\/span>")}return r}},{name:null,data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="";return(i.Status==1||i.Status==2)&&(r+='<button class="btn btn-soft" data-tooltip="Refresh for the latest status update" onclick="RefreshStatus(\''+i.Key+"',"+i.Id+');"><i class="fa fa-redo"><\/i><\/button>'),i.Status==3&&(r+='<a class="btn btn-primary" href="javascript:void(0)" onclick="DownloadItemImport(\'done\',\''+i.SpreadsheetKey+'\');"><i class="fas fa-cloud-download-alt"><\/i> &nbsp;Download<\/a>'),(i.Status==4||i.Status==5)&&(r+="<div class='btn-group'>",r+="<button type='button' class='btn btn-primary dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' aria-expanded='true'>",r+="Options &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i class='fa fa-angle-down'><\/i>",r+="<\/button>",r+="<ul class='dropdown-menu primary dropdown-menu-right' style='right: 0;'>",r+="<li><a href=\"javascript:void(0)\" onclick=\"DownloadItemImport('done','"+i.SpreadsheetKey+"');\"> &nbsp;Download<\/a><\/li>",r+="<li><a href=\"javascript:void(0)\" onclick=\"DownloadItemImport('error','"+i.SpreadsheetKey+"');\"> &nbsp;Error report<\/a><\/li>",r+="<\/ul>",r+="<\/div>"),r}}],drawCallback:function(){$.getScript("/Content/DesignStyle/js/html5tooltips.js")},order:[[2,"desc"]]})}function RefreshStatus(){reloadDataItemImports()}function DeleteItemImport(n){$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderItemImport/DeleteItemImport",data:{key:n},dataType:"json",success:function(n){n.result?(reloadDataItemImports(),cleanBookNotification.removeSuccess()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){$.LoadingOverlay("hide")})}function DownloadItemImport(n,t){$.ajax({type:"post",url:"/TraderItemImport/DownloadImportedFile",datatype:"json",data:{Uri:t,Name:n},success:function(n){var t=document.createElement("a");t.target="_blank";t.href=n;document.body.appendChild(t);t.click();document.body.removeChild(t);delete t},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}$(function(){$("#location-select").select2();$("#location-filter").select2();$("#search-dt").keyup(delay(function(){reloadDataItemImports()},1e3));$(".item-import-daterange").daterangepicker({autoUpdateInput:!1,timePicker:!0,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});$(".item-import-daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$(".item-import-daterange").html(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));filter.DateRange=$(".item-import-daterange").val();reloadDataItemImports()});$(".item-import-daterange").on("cancel.daterangepicker",function(){$(this).val(null);filter.DateRange=$(".item-import-daterange").val();$(".item-import-daterange").html("full history");reloadDataItemImports()});LoadItemImports()});