function SearchMenu(){var i=$(".trading-items-catalogues-tabs li.active a").attr("catalogtype"),n=$("#pos-menu-list"),t;i==1&&(n=$("#catalog-distribution-list"));n.LoadingOverlay("show");n.empty();t=$("#items-catalogues select[name=locations]").val();n.load("/PointOfSaleMenu/LoadPosMenu",{catalogSearchType:i,locationIds:t?t:[],keyword:$("#search-name").val(),salesChannel:$("#search-salechannel").val()},function(){n.LoadingOverlay("hide")})}function ConfirmDeleteMenu(n){var t=$("#input_"+n).val();$("#name-delete").text(t+" catalog");$menuId=n}function DeleteMenu(){$.LoadingOverlay("show");$.ajax({type:"delete",url:"/PointOfSaleMenu/DeleteMenu",data:{id:$menuId},dataType:"json",success:function(n){n.result?($("#pos-menu-"+$menuId).remove(),$("#confirm-delete").modal("hide"),cleanBookNotification.removeSuccess()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function SuccessAction(n){setTimeout(function(){window.location.href="/PointOfSale/PoSMenu?id="+n.msgId},100)}function SetMenuId(n){$currentMenuId=n}function UpdatePosMenuProduct(){$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/UpdatePosMenuProduct",type:"post",dataType:"json",data:{menuId:$currentMenuId},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#pos-menu-updadte-pos-menu-modal").modal("hide")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function CatalogueQuickAddShow(){var n=0,t;n=getCatalogType();t="/PointOfSale/CatalogueQuickAddShow?type="+n;$("#bprofile-menu-quick-add").empty();$("#bprofile-menu-quick-add").load(t);$("#bprofile-menu-quick-add").modal("show")}function loadTraderGroupsByLocationId(n){var t=$("#catalogue-quickadd-form select[name=pgroups]");$.get("/PointOfSale/GetTraderGroupByLocation?locaionId="+$(n).val(),function(n){t.multiselect("destroy");t.empty();$.each(n,function(n,i){t.append('<option value="'+i.id+'">'+i.text+"<\/option>")});t.multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0,enableCaseInsensitiveFiltering:!0})})}function SavePosMenu(n){if($menuAction===3&&$("#menu-salechannel").val()==="B2B"&&!confirm("B2B catalogs do not contain items with variants or extras. Only items that do not have variants and extras will be cloned"))return 0;if($("#pos-menu-form").valid()){$.LoadingOverlay("show");var t=document.getElementById("expert-catalog-img").files;t&&t.length>0?UploadMediaS3ClientSide("expert-catalog-img").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}processSavingCatalogExpertMode(t.objectKey,n)}):processSavingCatalogExpertMode(null,n)}else return}function processSavingCatalogExpertMode(n,t){var e=[],o=getCatalogType(),i,r,u,f;if(o!=1){if(i=$("#report_filters").val(),i==null||i==="")return $("#pos-menu-form").validate().showErrors({filters:"Reporting Filter required"}),LoadingOverlayEnd(),!1;if(i&&i.length>0)for(r=0;r<i.length;r++)e.push({Id:i[r]})}u={Id:$menuId,Name:$("#menu-name").val(),SalesChannel:$("#menu-salechannel").val(),OrderItemDimensions:e,Description:$("#menu-summary").val(),Location:{Id:$(".display-locations select[name=Locations]").val()},Type:getCatalogType(),Image:n};f="/PointOfSaleMenu/CreatePosMenu";$menuAction===2?f="/PointOfSaleMenu/UpdatePosMenu":$menuAction===3&&(f="/PointOfSaleMenu/ClonePosMenu");$.ajax({url:f,type:"post",dataType:"json",data:{posMenu:u,isLocationFromLocal:t?t:!1},success:function(n){if(n.result){if($("#app-trader-pos-menu-modal").modal("hide"),$menuAction===1)cleanBookNotification.createSuccess(),SuccessAction(n);else if($menuAction===2)SearchMenu(),cleanBookNotification.updateSuccess();else if($menuAction===3){var t=getCatalogType();t!=1?$("#pos-menu-list #new-menu-div").before(preparingCatalog(n.msgId,u.Name,n.msgName)):$("#catalog-distribution-list #new-menu-div").before(preparingCatalog(n.msgId,u.Name,n.msgName));StartVerifyCatalogStatus(n.msgId,t)}}else!n.result&&n.msg?n.actionVal===8?cleanBookNotification.error(n.msg,"Qbicles"):$("#pos-menu-form").validate().showErrors({menuname:n.msg}):n.result||cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function initQuickAddCatalogueForm(){var n=$("#catalogue-quickadd-form"),t=getCatalogType();t!=1?n.validate({rules:{name:{required:!0},location:{required:!0},pgroups:{required:!0},channel:{required:!0},filters:{required:!0},summary:{required:!0}}}):n.validate({rules:{name:{required:!0},pgroups:{required:!0},channel:{required:!0},summary:{required:!0}}});n.submit(function(i){if(i.preventDefault(),n.valid()){var r=document.getElementById("quick-catalog-img").files;r&&r.length>0?UploadMediaS3ClientSide("quick-catalog-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}quickAddCatalog(n.objectKey,t)}):quickAddCatalog(null,t)}})}function quickAddCatalog(n,t){var i={Name:$("#catalogue-name").val(),Description:$("#catalogue-summary").val(),SalesChannel:$("#catalogue-channelid").val(),Type:getCatalogType(),Image:n},r=0,u=[],f;r=$("#catalogue-locationid").val();t!=1&&(u=$("#catalogue-dimensionIds").val());f="/PointOfSaleMenu/SaveCatalogueQuickMode";LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:f,data:{catalogue:i,productGroupIds:$("#catalogue-groupIds").val(),locationId:r,filterIds:u},success:function(n){n.result?($("#bprofile-menu-quick-add").modal("hide"),LoadingOverlayEnd(),t==1?$("#catalog-distribution-list #new-menu-div").before(preparingCatalog(n.msgId,i.Name,n.msgName)):t==0?$("#pos-menu-list #new-menu-div").before(preparingCatalog(n.msgId,i.Name,n.msgName)):$("#new-menu-div").before(preparingCatalog(n.msgId,i.Name,n.msgName)),StartVerifyCatalogStatus(n.msgId,t)):(cleanBookNotification.error(n.msg,"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function preparingCatalog(n,t,i){return"<article class='col nvinprogress' id='preparing-menu-"+n+"'><span class='last-updated'>Added "+i+"<\/span><div class='nvloading'><img style='width:200px;height:auto;' src=\"/Content/DesignStyle/img/loading-new.gif\"><p>Preparing <strong>"+t+"<\/strong> catalog<\/p><\/div><\/article>"}function NewCatalog2UI(n,t,i){$.get("/PointOfSaleMenu/RenderCatalogUI?catalogId="+n+"&locationId="+i,function(i){i.result?(cleanBookNotification.updateSuccess(),$("#preparing-menu-"+n).remove(),t==1?$("#catalog-distribution-list #new-menu-div").after(i.msg):t==0?$("#pos-menu-list #new-menu-div").after(i.msg):$("#new-menu-div").after(i.msg)):cleanBookNotification.error(i.msg,"Qbicles")})}function StartVerifyCatalogStatus(n,t){var i=setInterval(()=>{var r=$("#select2-local-manage-select-container").val();(r==undefined||typeof r=="undefined")&&(r=0);$.get("/PointOfSaleMenu/VerifyCatalogStatus?catalogId="+n+"&locationId="+r,function(u){u.result==!1&&(StopInterval(i),NewCatalog2UI(n,t,r))})},1e4)}function getCatalogType(){var t=$(".trading-items-catalogues-tabs > .active > a"),n=0;return t&&(n=t.attr("catalogType")),n==null&&(n=$("#catalog-type-value").val()),n}var $menuAction=0,$menuId=0,$currentMenuId;jQuery(document).ready(function(){$(".validate-control select").on("change",function(){$(".validate-control select").val()!=null&&$(".validate-control select").val()!==""&&$(".validate-control select + label.error").remove()});$("#search-name").keyup(delay(function(){SearchMenu()},500))});resetValidateMenuForm=function(){$(".display-locations").hide();$("#menu-name").removeClass("error valid");$("#pos-menu-form").validate().resetForm()};CreateMenu=function(){$menuAction=1;$("#menu-name").val("");$("#menu-summary").val("");$("#menu-salechannel").prop("disabled",!1);$("#menu-salechannel").val("POS").change();$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Add a Catalog");resetValidateMenuForm();$menuId=0;$("#app-trader-pos-menu-modal").modal("show");var n=getCatalogType();n==1?($("#menu-salechannel").val("B2B").change(),$("#menu-salechannel").attr("disabled","disabled"),$(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show())};UpdateMenu=function(n){$menuAction=2;$menuId=n;$("#menu-modal-title").text("Edit catalog");resetValidateMenuForm();EditMenuOpen()};CloneMenu=function(n){$menuAction=3;$menuId=n;$("#menu-modal-title").text("Clone this catalog");resetValidateMenuForm();$(".display-locations").show();EditMenuOpen(!0)};EditMenuOpen=function(n){$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/GetById?id="+$menuId,type:"post",dataType:"json",success:function(t){if(t.actionVal>0){$("#menu-name").val(t.Object.Name);var i=$("#menu-salechannel"),r=$(".display-locations select[name=Locations]");n?(i.prop("disabled",!1),i.val(t.Object.SalesChannel).trigger("change"),r.prop("disabled",!1),r.change(),t.Object.Type==1&&i.prop("disabled",!0)):(i.prop("disabled",!0),i.val(t.Object.SalesChannel).trigger("change"),r.prop("disabled",!0),r.val(t.Object.LocationId).trigger("change"));$("#menu-summary").val(t.Object.Description);$("#report_filters").val(t.Object.Dimensions);$("#report_filters").select2({placeholder:"Please select"});$("#app-trader-pos-menu-modal").modal("show");t.Object.Type==1?($(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show());$("#catalog-type-value").val(t.Object.Type)}},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})};$currentMenuId=0;StopInterval=function(n){console.log("stop interval id: "+n);clearInterval(n)};