function readImgURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}function initItemTable(){var n=$("#menu_id").val(),t=$("#catalog_status").val();$("#item-list").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#item-list").LoadingOverlay("show"):$("#item-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/PointOfSale/LoadCatalogItemTableContent",type:"POST",data:function(t){return $.extend({},t,{catalogId:n,keySearch:$("#search-item-list").val(),categoryIdSearch:$("#subfilter-group").val()})}},columns:[{data:"ImageUri",orderable:!1,render:function(n,t,i){var r="";return r+='<a href="javascript:" data-toggle="tab" data-target="#item-detail">',r+='<div class="table-avatar mini" style="background-image: url(\''+i.ImageUri+"');\">&nbsp;<\/div>",r+"<\/a>",r}},{data:"Name",orderable:!0},{data:"SKU",orderable:!0},{data:"CategoryName",orderable:!0},{data:"Price",orderable:!0},{data:"Level",orderable:!0,render:function(n,t,i){var r="";return r+=i.Level,r+i.InStockLabel}},{orderable:!1,render:function(data,n,i){var r="",u;return r+="<div class='btn-group options table-button'>",r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a class="viewdetail_'+i.Id+'" href="#item-detail-basic" onclick="ViewPoscategoryItemDetail(\''+i.Id+'\')" data-toggle="tab">View &amp; edit<\/a><\/li>',t=="Inactive"&&(u=encodeURIComponent(i.Name),u=u.replace(/'/g,"Ⓞ"),r+="<li><input hidden id='item-row-id-"+i.Id+"' value='"+u+"'/> <a href='#' data-toggle='modal' data-target='#menu-item-delete-confirm' onclick='ConfirmDeleteMenuItem("+i.Id+")'>Remove item<\/a><\/li>"),r}}]})}function SavePosMenu(){if($("#pos-menu-form").valid()){$.LoadingOverlay("show");var n=document.getElementById("expert-catalog-img").files;n&&n.length>0?UploadMediaS3ClientSide("expert-catalog-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}menuSave(n.objectKey)}):menuSave(null)}}function menuSave(n){var f=$(".nav-stacked > .active > a"),i=0,u,t,r,e,o;if(f&&(i=f.attr("catalogType")),i==null&&(i=$("#catalog-type-value").val()),u=[],i==1){if(t=$("#report_filters").val(),t==null||t==="")return $("#pos-menu-form").validate().showErrors({filters:"Reporting Filter required"}),!1;if(t&&t.length>0)for(r=0;r<t.length;r++)u.push({Id:t[r]})}e={Id:$menuId,Name:$("#menu-name").val(),SalesChannel:$("#menu-salechannel").val(),OrderItemDimensions:u,Description:$("#menu-summary").val(),Type:i,Image:n};o="/PointOfSaleMenu/UpdatePosMenu";$.ajax({url:o,type:"post",dataType:"json",data:{posMenu:e},success:function(n){n.result?(cleanBookNotification.updateSuccess(),n.Object&&($("#menu-name-description").text(n.Object.Description),$("#menu-name-title").text(n.Object.Name),$(".txtsalechannel").text(n.Object.SalesChannel+" Menu"),$("#lstDimension").text(n.Object.Dimensions),n.Object.SalesChannel=="POS"?$("#btnUpdatePosmenu").show():$("#btnUpdatePosmenu").hide()),$("#app-trader-pos-menu-modal").modal("hide")):!n.result&&n.msg?$("#pos-menu-form").validate().showErrors({menuname:n.msg}):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function FindSKU(){var n;$("#app-trader-pos-itemlist").empty();var r=$("#item_sku").val(),t=$locationManager,i=$("#catalog_type");i&&i.val()=="1"&&(t=0);n="/PointOfSaleMenu/ShowPosItemModal?search="+r+"&locationid="+t+"&selectItemType=1&idposition=0";n=n.replace(/\s/g,"%20");$("#app-trader-pos-itemlist").load(n)}function FindSKUDetail(){var n;$("#app-trader-pos-itemlist").empty();var r=$("#poscategoryitem_detail_sku_search").val(),t=$locationManager,i=$("#catalog_type");i&&i.val()=="1"&&(t=0);n="/PointOfSaleMenu/ShowPosItemModal?search="+r+"&locationid="+t+"&selectItemType=2&idposition=0";n=n.replace(/\s/g,"%20");$("#app-trader-pos-itemlist").load(n)}function FindSKUVariants(n){var t;$("#app-trader-pos-itemlist").empty();var u=$("#table_variants_sku_"+n).val(),i=$locationManager,r=$("#catalog_type");r&&r.val()=="1"&&(i=0);t="/PointOfSaleMenu/ShowPosItemModal?search="+u+"&locationid="+i+"&selectItemType=3&idposition="+n;t=t.replace(/\s/g,"%20");$("#app-trader-pos-itemlist").load(t)}function LoadPosCategories(){$("#item-list").DataTable().ajax.reload(null,!1)}function categorychanged(){$("#item_category").val()!==""&&$("#item_category").val()?$("#item_category + label.error").remove():$("#form_additem").validate().showErrors({categoryitem_add_category:"Category is required."})}function validatePosCategoryItem(){var n=!0;return $("#item_name").val()===""?(SaveProcessdCategoryitem,n=!1,$("#form_additem").validate().showErrors({categoryitem_add_name:"Name is required."})):$("#item_name + label.error").remove(),$("#item_category").val()!==""&&$("#item_category").val()?$("#item_category + label.error").remove():(n=!1,$("#form_additem").validate().showErrors({categoryitem_add_category:"Category is required."})),$("#item_novariant")[0].checked&&(($("#traderitem").val()===""||$("#traderitem").val()==="0")&&(n=!1,$("#form_additem").validate().showErrors({categoryitem_sku:"Sku of Item product is required."})),($("#item_product_unit").val()==null||$("#item_product_unit").val()==""||$("#item_product_unit").val()=="0")&&(n=!1,cleanBookNotification.error("The selected product does not have any units. Please add units to product.","Qbicles"))),n}function ChangeItemVariant(n){$(".onlysold").toggle();$("#itemextras").hide();$(".newpreview").attr("style","display:none");$(".newpreview").attr("src","");$("#item_featuredimg").val(null);var t=$("#item_novariant")[0].checked;t||($(".newpreview").attr("src",$api+n),$(".newpreview").attr("style","display:block"),$("#traderitem").val(0),$("#item_sku").val(""))}function selectItem(n,t,i){var u,r;$("#itemextras").show();$("#traderitem").val(n);$("#item_sku").val(t);$("#image-default").val(i);$(".newpreview").attr("src",$api+i);$(".newpreview").attr("style","block");u=$("#menu_salechannel").val();$("#item_product_unit").empty();r=$("#catalog_type").val();$.ajax({url:"/PointOfSaleMenu/GetPriceValue?traderid="+n+"&locationid="+$locationManager+"&saleChannel="+u,type:"get",dataType:"json",success:function(n){if(!n.result){r&&r==1||cleanBookNotification.error(_L("ERROR_MSG_343"),"Qbicles");return}$("#item_product_unit").append(n.Object2);$("#item_product_unit").select2();$("#priceDefault").val(n.Object.GrossPrice);$("#price_id").val(n.Object.Id);$("#unitprice").val(n.Object.GrossPrice);($("#traderitem").val()===""||$("#traderitem").val()==="0")&&$("#form_additem").validate().showErrors({categoryitem_sku:_L("ERROR_MSG_342")})}})}function selectItemDetail(n,t){$("#poscategoryitem_detail_itemid").val(n);$("#poscategoryitem_detail_sku_search").val(t)}function selectItemToTable(n,t,i,r){var u=$("#menu_salechannel").val();$.ajax({url:"/PointOfSaleMenu/GetPriceValue?traderid="+t+"&locationid="+$locationManager+"&saleChannel="+u,type:"get",dataType:"json",success:function(u){var f,e;if(!u.result){cleanBookNotification.error(_L("ERROR_MSG_343"),"Qbicles");return}if($("#table_variants_traderitem_"+n).val(t),$("#table_variants_sku_"+n).val(i),$("#variant-image-preview-"+n).attr("src",imgApi+r),$("#table_variants_pricebase_"+n).val(u.Object.GrossPrice),$("#table_variants_priceid_"+n).val(u.Object.Id),$("#table_variants_price_"+n).val(u.Object.GrossPrice),f='<select name="unit" onchange="changeUnitTable(\''+n+'\')" id="table_variants_unit_'+n+'" class="form-control select2" style="width: 100 %;">',f+=u.Object2,f+="<\/select>",$("#table_variants_tdunit_"+n).empty(),$("#table_variants_tdunit_"+n).append(f),$("#table_variants_tdunit_"+n+" select").select2({placeholder:"Please select"}),e=$("#table_variants_unit_"+n).val(),e&&e!==""&&$("#table_variants_price_"+n).val((_.toNumber(u.Object.GrossPrice)*_.toNumber(e.split("|")[1])).toFixed(2)),u.Object.Id==="0"){cleanBookNotification.error(_L("ERROR_MSG_344"),"Qbicles");return}SaveVariantsTable(n)}})}function changeUnitTable(n){var t=_.toNumber($("#table_variants_pricebase_"+n).val()),i=_.toNumber($("#table_variants_unit_"+n).val().split("|")[1]);$("#table_variants_price_"+n).val((t*i).toFixed(2));SaveVariantsTable(n)}function SaveVariantsTable(n){var r,i,t;if($.LoadingOverlay("show"),$("#table_variants_unit_"+n)==null||$("#table_variants_unit_"+n).val()==null||$("#table_variants_traderitem_"+n)==null||$("#table_variants_traderitem_"+n).val()==null||$("#table_variants_unit_"+n).val().split("|")[0]===""||$("#table_variants_traderitem_"+n).val()===""||$("#table_variants_traderitem_"+n).val()==="0"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_343"),"Qbicles");return}if($("#table_variants_image_"+n).val()===""&&$("#table_variants_file_"+n).val()!==""&&UploadMediaS3ClientSide("table_variants_file_"+n).then(function(t){t==="no_image"&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$("#table_variants_image_"+n).val(t)}),r=$("#table_variants_options_"+n).val().split(","),i=[],_.forEach(r,function(n){i.push({Id:n})}),t={Id:$("#table_variants_id_"+n).val(),Name:$("#table_variants_name_"+n).text(),TraderItem:{Id:$("#table_variants_traderitem_"+n).val()},ImageUri:$("#table_variants_image_"+n).val(),Unit:{Id:$("#table_variants_unit_"+n).val().split("|")[0]},BaseUnitPrice:{Id:$("#table_variants_priceid_"+n).val()},Price:{GrossPrice:$("#table_variants_price_"+n).val()},CategoryItem:{Id:$("#poscategoryitem_detail_id").val()},IsDefault:$("#table_variants_default_"+n)[0].checked,IsActive:$("#table_variants_isactive_"+n)[0].checked,VariantOptions:i},t.TraderItem.Id===""||t.TraderItem.Id==="0"||t.Unit.Id===""||t.Unit.Id==="0")return cleanBookNotification.error(_L("ERROR_MSG_343"),"Qbicles"),LoadingOverlayEnd(),$("#table_variants_sku_"+n).val(""),$("#table_variants_sku_"+n).css("border-color","red"),setTimeout(function(){$("#table_variants_sku_"+n).css("border-color","#e1e1e1")},2e3),!1;$("#table_variants_image_"+n).val()===""&&$("#table_variants_file_"+n).val()!==""?UploadMediaS3ClientSide("table_variants_file_"+n).then(function(i){if(i.objectKey==="no_image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}$("#table_variants_image_"+n).val(i.objectKey);t.ImageUri=i.objectKey;SubmitPOSMenuVariant(t)}):SubmitPOSMenuVariant(t)}function UpdateVariantPriceTable(n,t){var i=$("#table_variants_price_"+t).val();LoadingOverlay();$.ajax({type:"POST",dataType:"JSON",url:"/PointOfSaleMenu/UpdateCatalogItemVariantPrice",data:{variantId:n,variantGrossPrice:i},success:function(n){n.result?(cleanBookNotification.success("Update the price of the variant successfully!","Qbicles"),LoadingOverlayEnd()):(cleanBookNotification.error(n.msg,"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function SubmitPOSMenuVariant(n){$.ajax({url:"/PointOfSaleMenu/SaveVariant",type:"post",dataType:"json",data:{variant:n},success:function(t){t.actionVal===1?(cleanBookNotification.createSuccess(),$("#table_variants_id_"+n.Id).val(t.msgId),LoadVariantsPropertyTable($("#poscategoryitem_detail_id").val())):t.actionVal===2?cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function selectItemDetail(n,t){$("#poscategoryitem_detail_itemid").val(n);$("#poscategoryitem_detail_sku_search").val(t)}function SelectProductUnitChanged(){var n=$("#item_product_unit").val();n&&n!==""?$("#unitprice").val((_.toNumber(n.split("|")[1])*_.toNumber($("#priceDefault").val())).toFixed(2)):($("#unitprice").val($("#priceDefault").val()),cleanBookNotification.error("The selected product does not have any units. Please add units to product.","Qbicles"))}function SaveProcessdCategoryitem(){if(validatePosCategoryItem()){$.LoadingOverlay("show");var n={Id:0,Name:$("#item_name").val(),Description:$("#item_description").text(),Category:{Id:$("#item_category").val(),Name:$("#item_category option:selected").text(),Menu:{Id:$("#menu_id").val()}},PosVariants:[],ImageUri:$("#image-default").val(),VariantProperties:[]};$("#item_novariant")[0].checked&&(n.PosVariants=[{Id:0,Name:$("#item_name").val(),Unit:{Id:$("#item_product_unit").val().split("|")[0]},TraderItem:{Id:$("#traderitem").val()},Price:{GrossPrice:$("#unitprice").val()},BaseUnitPrice:{Id:$("#price_id").val()}}]);$("#item_featuredimg").val()!=""?UploadMediaS3ClientSide("item_featuredimg").then(function(t){if(t.objectKey==="no_image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}n.ImageUri=t.objectKey;SubmitItemCategory(n)}):SubmitItemCategory(n)}}function SubmitItemCategory(n){$.ajax({url:"/PointOfSaleMenu/SaveCategoryItem",type:"post",dataType:"json",data:{posCategoryItem:n},success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$("#app-trader-pos-item-add").modal("hide"),ViewPoscategoryItemDetail(n.msgId)):n.actionVal===2?($("#catalog-price-table").DataTable().ajax.reload(null,!1),cleanBookNotification.updateSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function AddAnItem(n){$("#item_featuredimg + label.error").remove();$("#item_name + label.error").remove();$("#item_category + label.error").remove();$("#item_name").val("");$("#item_category").val("");$("#item_category").select2({placeholder:"Please select",tags:!0});$("#item_sku").val("");$("#item_product_unit").val("");$("#item_product_unit").select2();$("#unitprice").val("");$("#item_featuredimg").val(null);$("#itemextras").hide();$("#item_description").text("");$("#image-default").val(n);$(".newpreview").attr("src",$api+n);GetListCategoryByMenu(refershCategorySelect,"item_category","")}function GetListCategoryByMenu(n,t,i){var r=$("#menu_id").val(),u="/PointOfSaleMenu/GetCategoryByMenu?idMenu="+r;$.LoadingOverlay("show");$.ajax({url:u,type:"get",dataType:"json",success:function(r){r.result?(n(r.Object.Categories,t,i),LoadingOverlayEnd()):(cleanBookNotification.error("Have an error, detail: "+r.msg,"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function ViewPoscategoryItemDetail(n){$("#item-detail-basic").empty();$("#item-detail-basic").load("/PointOfSaleMenu/GetPosCategoryItemView?id="+n,function(){$("#items-list").css("display","none").removeClass("fade in");$("#item-detail-basic").css("display","block").addClass("fade in")})}function ConfirmDeleteMenuItem(n){var t=$("#item-row-id-"+n).val();t=t.replace(/Ⓞ/g,"'");t=decodeURIComponent(t);$("#label-confirm-item-delete").text(t);$("#id-item-delete").val(n)}function deleteCategoryItem(){var n=$("#id-item-delete").val(),t="/PointOfSaleMenu/DeleteCategoryItem?id="+n;$.LoadingOverlay("show");$.ajax({url:t,type:"GET",dataType:"json",success:function(n){n.result?LoadPosCategories():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function BackToList(){$("#item-detail-basic").css("display","none");$("#items-list").css("display","block");$("#item-list").DataTable().ajax.reload(null,!1)}function ChangeDetailItem(){var n,t;if($("#poscategoryitem_detail_name").val()===""){cleanBookNotification.error(_L("ERROR_MSG_347"),"Qbicles");return}n={Id:$("#poscategoryitem_detail_id").val(),Name:$("#poscategoryitem_detail_name").val(),SKU:$("#poscategoryitem_detail_sku").val(),Description:$("#poscategoryitem_detail_category_description").text(),Category:{Id:$("#poscategoryitem_detail_category").val(),Name:$("#poscategoryitem_detail_category option:selected").val(),Menu:{Id:$("#menu_id").val()}}};t=$("#poscategoryitem-price").val();$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/UpdatePosCategoryItem",type:"post",dataType:"json",data:{posCategoryItem:n,itemPrice:t},success:function(n){n.actionVal===2?(cleanBookNotification.updateSuccess(),GetListCategoryByMenu(refershCategorySelect,"poscategoryitem_detail_category",n.msgId),LoadCategoryTable(),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function cancelAddExtras(){$("#poscategoryitem_detail_itemid").val("");$("#poscategoryitem_detail_sku_search").val("")}function confirmAddExtras(){if(isNaN(parseInt($("#poscategoryitem_detail_itemid").val())))return!1;var n={TraderItem:{Id:$("#poscategoryitem_detail_itemid").val(),SKU:$("#poscategoryitem_detail_sku_search").val()},CategoryItem:{Id:$("#poscategoryitem_detail_id").val()}},t="/PointOfSaleMenu/SaveExtras?locationid="+$locationManager;$.LoadingOverlay("show");$.ajax({url:t,type:"post",dataType:"json",data:{extras:n},success:function(n){n.actionVal===1?(cleanBookNotification.updateSuccess(),$("#poscategoryitem_detail_itemid").val(""),$("#poscategoryitem_detail_sku_search").val(""),LoadExtrasTable(),$(".addextras2").hide(),$("#addextras2").show()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function deletePosVariants(n){var t="/PointOfSaleMenu/DeleteExtras?id="+n;$.LoadingOverlay("show");$.ajax({url:t,type:"GET",dataType:"json",success:function(n){n.result?(LoadExtrasTable(),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function LoadExtrasTable(){$("#item_extras").empty();$("#item_extras").load("/PointOfSaleMenu/GetPosCategoryItemPosExtras?idItem="+$("#poscategoryitem_detail_id").val(),function(){$("#extras_table_view").DataTable({responsive:!0});$("#extras_table_view").show()})}function changerow(n){$.LoadingOverlay("show");var i=$("#table_unit_"+n).val(),r=$("#table_price_base_"+n).val(),t={Id:n,Unit:{Id:$("#table_unit_"+n).val().split("|")[0],Quantity:$("#table_qty_"+n).val()},Price:{GrossPrice:$("#table_price_"+n).val()},CategoryItem:{Id:$("#poscategoryitem_detail_id").val()}};$.ajax({url:"/PointOfSaleMenu/UpdateExtrasPosCategoryItem",type:"post",dataType:"json",data:{extras:t},success:function(t){t.actionVal===2?(cleanBookNotification.updateSuccess(),$("#table_qty_"+n).val(t.Object.Quantity),$("#table_price_"+n).val(t.Object.GrossPrice),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function ChangeImageItem(){$.LoadingOverlay("show");readURL("item_categorydetail_imageurl","preview");UploadMediaS3ClientSide("item_categorydetail_imageurl").then(function(n){if(n.objectKey==="no_image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t="/PointOfSaleMenu/UpdatePosCategoryItemImage?idItem="+$("#poscategoryitem_detail_id").val()+"&imageurl="+n.objectKey;$.ajax({url:t,type:"post",dataType:"json",success:function(n){n.actionVal===2?cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})})}function readURL(n,t){var i=$("#"+n),r;i.length>0&&i[0].files.length>0?(r=new FileReader,r.onload=function(i){$("#"+n+"_"+t).attr("src",i.target.result)},r.readAsDataURL(i[0].files[0]),$("#item_categorydetail_imageurl").css("color","")):$("#item_categorydetail_imageurl").css("color","transparent")}function PropertyRowChanged(n,t){var e=confirm(_L("ERROR_MSG_348")),u,i,r,f;if(e===!1)return!1;if(u={Id:t,CategoryItem:{Id:$("#poscategoryitem_detail_id").val()},VariantOptions:[]},i=$("#property_select_"+t).val(),i==null){cleanBookNotification.error("Option can not be null!","Qbicles");return}for(r=0;r<i.length;r++)u.VariantOptions.push({Name:i[r]});$.LoadingOverlay("show");f="/PointOfSaleMenu/UpdateVariantOptions";$.ajax({url:f,type:"post",dataType:"json",data:{posVariantProperty:u},success:function(t){t.actionVal===2?(cleanBookNotification.updateSuccess(),$(n).hide(),LoadVariantsPropertyTable($("#poscategoryitem_detail_id").val()),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function PropertyRowDelete(n){var i=confirm(_L("ERROR_MSG_348")),t;if(i===!1)return!1;t="/PointOfSaleMenu/DeleteProperty?id="+n;$.LoadingOverlay("show");$.ajax({url:t,type:"GET",dataType:"json",success:function(n){n.result?(LoadPropertyTable(),LoadVariantsPropertyTable($("#poscategoryitem_detail_id").val()),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}function addProperty(){$("#posPropertyAdd_options").val(null);$("#posPropertyAdd_name").val("");$("#posPropertyAdd_options").select2({placeholder:"Please select",tags:!0})}function confirmAddProperty(){var u=confirm(_L("ERROR_MSG_348")),i,n,t,r;if(u===!0){if(i={Name:$("#posPropertyAdd_name").val(),CategoryItem:{Id:$("#poscategoryitem_detail_id").val()},VariantOptions:[]},n=$("#posPropertyAdd_options").val(),n!==null)for(t=0;t<n.length;t++)i.VariantOptions.push({Name:n[t]});$.LoadingOverlay("show");r="/PointOfSaleMenu/UpdateVariantOptions";$.ajax({url:r,type:"post",dataType:"json",data:{posVariantProperty:i},success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),LoadPropertyTable(),LoadVariantsPropertyTable($("#poscategoryitem_detail_id").val()),$("#app-trader-pos-property-add").modal("hide"),LoadingOverlayEnd()):n.actionVal===2?(cleanBookNotification.updateSuccess(),LoadPropertyTable(),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(n){cleanBookNotification.error(n,"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()})}}function LoadPropertyTable(){$("#variants_properties_table").empty();$("#variants_properties_table").load("/PointOfSaleMenu/GetPosCategoryItemPosProperties?idItem="+$("#poscategoryitem_detail_id").val(),function(){$(".table_properties").DataTable({responsive:!0});$(".table_properties").show()})}function LoadVariantsPropertyTable(n){$("#posCategoryItem_variants_table").empty();$("#posCategoryItem_variants_table").load("/PointOfSaleMenu/GetVariantsByProperty?categoryItemId="+n,function(){$(".posCategoryItem_variants_table").DataTable({responsive:!0,pageLength:25});$(".posCategoryItem_variants_table").show();$(".checkbox.toggle input").bootstrapToggle()})}function addCategory(){$.LoadingOverlay("show");var n={Name:$("#item_category_add_name").val(),Menu:{Id:$("#menu_id").val()}};$.ajax({url:"/PointOfSaleMenu/AddCategory",type:"post",dataType:"json",data:{category:n},success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$(".newcat").toggle(),$(".addcat").toggle(),LoadCategoryTable()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function updateCategory(n){$(".table_category_itemdetailt").LoadingOverlay("show");var t={Id:n,IsVisible:$("#table_category_visible_"+n)[0].checked,Name:$("#table_category_name_"+n).val(),Menu:{Id:$("#menu_id").val()}};$.ajax({url:"/PointOfSaleMenu/UpdateCategory",type:"post",dataType:"json",data:{category:t},success:function(n){n.actionVal===2?cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){$(".table_category_itemdetailt").LoadingOverlay("hide",!0)})}function deleteCategory(n){var t="/PointOfSaleMenu/DeleteCategory?id="+n;$.LoadingOverlay("show");$.ajax({url:t,type:"GET",dataType:"json",success:function(n){n.result?LoadCategoryTable():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function LoadCategoryTable(n){$("#table_category_categoryitem").load("/PointOfSaleMenu/GetCategoryByMenuId?idMenu="+$("#menu_id").val(),function(){n||$(".table_category_itemdetailt").DataTable().draw();$(".checkbox.toggle input").bootstrapToggle();$(".select2.taginput").select2({placeholder:"Please select",tags:!0})})}function OpenPriceAdvance(n,t){var i="/PointOfSaleMenu/OpenPriceAdvance?menuId="+$("#menu_id").val()+"&type="+n;AjaxElementShowModal(i,t)}function ManagerDimension(){$.LoadingOverlay("show");$("#app-trader-pos-menu-dimensions").load("/PointOfSale/GetDimensionManager?idMenu="+$("#menu_id").val(),function(){LoadingOverlayEnd()})}function SaveDimension(){for(var r,t={Id:$("#menu_id").val(),OrderItemDimensions:[]},i=$("#dimension_select").val(),n=0;n<i.length;n++)t.OrderItemDimensions.push({Id:i[n]});$.LoadingOverlay("show");r="/PointOfSale/SaveDimensions";$.ajax({url:r,type:"post",dataType:"json",data:{posMenu:t},success:function(n){n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#app-trader-pos-menu-dimensions").modal("hide"),$("#lstDimension").text(n.msgId)):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function GoToAllProduct(){window.location="/Trader/AppTrader#PointOfSale"}function RefreshPrices(){$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/RefreshPrices",type:"post",dataType:"json",data:{categoryIds:$("#categories-refresh").val()},success:function(n){if(n.result){DisableButton("RefreshPrice","Refresh prices processing",!0);DisableButton("UpdatePosmenu","Update POS Menu",!1);StartVerifyCatalogStatus($("#menu_id").val(),"Price");var t=document.getElementById("item-detail-basic");t.style.display==="block"&&($("#item-detail-basic").empty(),$("#item-detail-basic").css("display","none"),$("#li-categories").removeClass("active"),$("#li-items").addClass("active"),$("#itemlist-categories").removeClass("in active"),$("#itemlist-items").addClass("in active"),$("#items-list").css("display","block"));$("#pos-menu-refresh-prices-modal").modal("hide")}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function PushPrices(){$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/PushPricesToPricingPool",type:"post",dataType:"json",data:{categoryIds:$("#categories-push").val()},success:function(n){n.result?$("#push-prices").modal("hide"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function UpdatePosMenuProduct(){$.LoadingOverlay("show");$.ajax({url:"/PointOfSaleMenu/UpdatePosMenuProduct",type:"post",dataType:"json",data:{menuId:$("#menu_id").val()},success:function(n){n.result?(LoadingOverlayEnd(),$("#pos-menu-updadte-pos-menu-modal").modal("hide"),DisableButton("UpdatePosmenu","Update POS Menu processing",!0),StartVerifyCatalogStatus($("#menu_id").val(),"Database")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function DisableButton(n,t,i){$(".table-button").addClass("disabled");$disableButton="disabled";$("#btn"+n).attr("disabled","disabled");i==!0&&$("#icon-"+n).removeClass("fa-refresh").addClass("fa-spinner fa-spin");$("#span"+n).text(t);$("#btn"+n).removeAttr("data-target")}function EnableButton(){$(".table-button").removeClass("disabled");$disableButton="";$("#btnUpdatePosmenu").removeAttr("disabled");$("#spanUpdatePosmenu").text("Update POS Menu");$("#icon-UpdatePosmenu").removeClass("fa-spinner fa-spin").addClass("fa-refresh");$("#btnUpdatePosmenu").attr("data-target","#pos-menu-updadte-pos-menu-modal");$("#btnRefreshPrice").removeAttr("disabled");$("#spanRefreshPrice").text("Refresh prices");$("#icon-RefreshPrice").removeClass("fa-spinner fa-spin").addClass("fa-refresh");$("#btnRefreshPrice").attr("data-target","#pos-menu-refresh-prices-modal");$("#catalog-price-table").DataTable().ajax.reload(null,!1);$("#item-list").DataTable().ajax.reload(null,!1)}function StartVerifyCatalogStatus(n,t){$disableButton="disabled";var i=setInterval(()=>{var r=$("#select2-local-manage-select-container").val();(r==undefined||typeof r=="undefined")&&(r=0);$.get("/PointOfSaleMenu/VerifyCatalogStatus?catalogId="+n+"&locationId="+r+"&type="+t,function(n){n.result==!1&&(StopInterval(i),EnableButton(),t=="Price"&&($("#catalog-price-table").DataTable().ajax.reload(null,!1),$("#item-list").DataTable().ajax.reload(null,!1)))})},1e4)}function variantImageChange(n,t){var i=$(n).data("target");readImgURL(n,i,t);$(i).fadeIn();SaveVariantsTable(t)}function readImgURL(n,t,i){if(n.files&&n.files[0]){var r=new FileReader;r.onload=function(n){$(t).attr("src",n.target.result)};r.readAsDataURL(n.files[0]);$("#table_variants_image_"+i).css("color","")}else $("#table_variants_image_"+i).css("color","transparent")}function LoadCatalogPriceDataTable(){var n=$("#catalog-price-table");price_table=n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r&&$(".loadingoverlay").length===0?n.LoadingOverlay("show"):n.LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,preDrawCallback:function(){is_dataTable_reloading=!0},aaSorting:[],ajax:{url:"/PointOfSale/GetListPriceItem",type:"POST",dataType:"json",data:function(n){return $.extend({},n,{catalogKey:$("#catalog-key").val(),traderItemSKU:$("#sku-search-price").val(),lstCategoryId:$("#list-category-search-price").val(),categoryItemNameKeySearch:$("#category-item-search-price").val(),variantOrExtraName:$("#variant-extra-name-search-price").val(),locationId:$("#location-manager").val(),taxupdate:$("#tax-update-select").val(),lastcostupdate:$("#last-cost-update-select").val()})}},columnDefs:[{width:"80px",targets:9},],columns:[{name:"Id",data:"Id",searchable:!1,orderable:!1,render:function(n,t,i){var r="";return r+='<input type="checkbox" class="dt-checkboxes" style="margin: 0;" ',r+='price-id-value="'+i.PriceId+'" item-id="'+i.TraderItemId+'" ',r+=i.IsVariant==!0?'variant-id="'+i.Id+'" extra-id="0" ':'variant-id="0" extra-id="'+i.Id+'" ',r+'"class="price-table-checkbox">'},checkboxes:{selectRow:!0,selectCallback:function(n,t){var r=$(n[0]).find(".dt-checkboxes").attr("item-id"),u=$(n[0]).find(".dt-checkboxes").attr("price-id-value"),f=$(n[0]).find(".dt-checkboxes").attr("variant-id"),e=$(n[0]).find(".dt-checkboxes").attr("extra-id"),o={item_id:r,price_id:u,variant_id:f,extra_id:e},i=lst_selected_trader_item_ids.findIndex(n=>n.item_id==r&&n.price_id==u);i<=-1&&t?lst_selected_trader_item_ids.push(o):i>=0&&!t&&lst_selected_trader_item_ids.splice(i,1);is_dataTable_reloading&&is_all_price_selected||(togglePriceActionPanel(),lst_ignored_page_ids_on_selecting_all.push(price_table.page.info().page))},selectAllCallback:function(n,t,i){if(i===!1){var r=$(".dt-checkboxes");_.forEach(r,function(n){var r=$(n).attr("item-id"),u=$(n).attr("price-id-value"),f=$(n).attr("variant-id"),e=$(n).attr("extra-id"),o={item_id:r,price_id:u,variant_id:f,extra_id:e},i=lst_selected_trader_item_ids.findIndex(n=>n.item_id==r&&n.price_id==u);i<=-1&&t?lst_selected_trader_item_ids.push(o):i>=0&&!t&&lst_selected_trader_item_ids.splice(i,1)});is_dataTable_reloading&&is_all_price_selected||(togglePriceActionPanel(),lst_ignored_page_ids_on_selecting_all.push(price_table.page.info().page))}}}},{name:"ItemSKU",data:"ItemSKU",orderable:!1},{name:"CategoryId",data:"CategoryId",orderable:!1,render:function(n,t,i){return""+('<a href="javascript:void(0)" onclick="SetCategoryFiltering('+i.CategoryId+')">'+i.CategoryName+"<\/a>")}},{name:"CategoryItemId",data:"CategoryItemId",orderable:!1,render:function(n,t,i){return""+('<a href="javascript:void(0)" onclick="SetCategoryItemFiltering(\''+i.CategoryItemName+'\')" class="filtering">'+i.CategoryItemName+"<\/a>")}},{name:"Id",data:"Id",orderable:!1,render:function(n,t,i){return""+(i.IsVariant?'<label class="label label-lg label-primary">'+i.Name+"<\/label>":'<label class="label label-lg label-info">'+i.Name+"<\/label>")}},{name:"AverageAndLastestCost",data:"AverageAndLastestCost",orderable:!1},{name:"MarginLatestCost",data:"MarginLatestCost",orderable:!1},{name:"MarginAverageCost",data:"MarginAverageCost",orderable:!1},{name:"NetPrice",data:"NetPrice",orderable:!1,render:function(n,t,i){return""+('<input type="number" class="form-control" onchange="updateValuePrice('+i.CatalogId+","+i.PriceId+', false, $(this).val())" min="0" value="'+i.NetPrice+'">')}},{name:"ListTaxes",data:"ListTaxes",orderable:!1,render:function(n,t,i){var r="";return r+='<ul class="unstyled">',i.ListTaxes.length==0?r+="--":_.forEach(i.ListTaxes,function(n){r+="<li>"+n.Amount+" <small> &nbsp; <i>("+n.TaxName+")<\/i><\/small><\/li>"}),r+="<\/ul>"}},{name:"GrossPrice",data:"GrossPrice",orderable:!1,render:function(n,t,i){return""+('<input type="number" class="form-control" onchange="updateValuePrice('+i.CatalogId+","+i.PriceId+', true, $(this).val())" min="0" value="'+i.GrossPrice+'">')}},{name:"FlaggedForTaxUpdate",data:"FlaggedForTaxUpdate",orderable:!1,render:function(n,t,i){return buildInputFlagged(i.FlaggedForTaxUpdate)}},{name:"FlaggedForLatestCostUpdate",data:"FlaggedForLatestCostUpdate",orderable:!1,render:function(n,t,i){return buildInputFlagged(i.FlaggedForLatestCostUpdate)}},],select:{style:"multi"}});$("#catalog-price-table").on("draw.dt",function(){$(".dt-checkboxes").on("click",function(){var t=$(this).is(":checked"),i=$(this).attr("item-id"),r=$(this).attr("price-id-value"),u=$(this).attr("variant-id"),f=$(this).attr("extra-id"),e={item_id:i,price_id:r,variant_id:u,extra_id:f},n=lst_selected_trader_item_ids.findIndex(n=>n.item_id==i&&n.price_id==r);n<=-1&&t?lst_selected_trader_item_ids.push(e):n>=0&&!t&&lst_selected_trader_item_ids.splice(n,1);is_dataTable_reloading&&is_all_price_selected||(togglePriceActionPanel(),lst_ignored_page_ids_on_selecting_all.push(price_table.page.info().page))});is_dataTable_reloading=!1;is_all_price_selected&&!lst_ignored_page_ids_on_selecting_all.includes(price_table.page.info().page)&&setTimeout(function(){var n=$("#catalog-price-table > thead input[type=checkbox]").is(":checked");n||$("#catalog-price-table > thead input[type=checkbox]").click()},200)})}function buildInputFlagged(n){return n?"<i class='fa fa-check green'><\/i>":"<i class='fa fa-remove red'><\/i>"}function updateValuePrice(n,t,i,r){r=r?r:0;$.post("/PointOfSaleMenu/UpdateCatalogPriceItem",{catalogId:n,id:t,isTaxIncluded:i,value:r},function(n){n.result?($("#catalog-price-table").DataTable().ajax.reload(null,!1),$("#item-list").DataTable().ajax.reload(null,!1),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function togglePriceActionPanel(){var n=lst_selected_trader_item_ids.length;n>0?($(".itemcount").html(n),$(".alert_matches.projects").addClass("active")):($(".itemcount").html(n),$(".alert_matches.projects").removeClass("active"))}function deselectAllPriceCheckBox(){var n=$("#check-all-btn");is_all_price_selected=!1;$(n).html("Check all");lst_selected_trader_item_ids=[];price_table.column(0).checkboxes.deselectAll();isCheckAllBtnReady=!0;togglePriceActionPanel()}function bulkApplyMargin(){var i;LoadingOverlay();var n=!0,t=1;$("#margin-tab").hasClass("active")?(n=$("#margin-average-cost").is(":checked"),t=$("#margin-unit").val()):$("#discount-tab").hasClass("active")&&(n=$("#discount-average-cost").is(":checked"),t=$("#discount-unit").val());i={marginValue:$("#margin-value").val(),discountValue:$("#discount-value").val(),isAppliedToAverageCost:n,unitType:t,catalogKey:$("#catalog-key").val(),isMarginUpdated:$("#margin-tab").hasClass("active"),lstExtraIds:lst_selected_trader_item_ids.map(n=>n.extra_id),lstVariantIds:lst_selected_trader_item_ids.map(n=>n.variant_id)};$.ajax({method:"POST",dataType:"JSON",url:"/PointOfSaleMenu/AppplyBulkMargin",data:i,success:function(n){n.result?(cleanBookNotification.success("The change is applied successfully.","Qbicles"),$("#catalog-price-table").DataTable().ajax.reload(null,!1),$("#item-list").DataTable().ajax.reload(null,!1)):cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function toggleMarginTab(){var n=$("#margin-tab");n.addClass("active");$("#discount-tab").removeClass("active");$(".tmeth").hide();$("#tmargin").show()}function toggleDiscountTab(){var n=$("#discount-tab");n.addClass("active");$("#margin-tab").removeClass("active");$(".tmeth").show();$("#tmargin").hide()}function LoadListAffectedPriceModal(){$("#pricing-affected").modal("show");LoadAffectedPriceDataTable()}function LoadAffectedPriceDataTable(){var n=$("#catalog-price-affected-table");n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r&&$(".loadingoverlay").length===0?n.LoadingOverlay("show"):n.LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,ajax:{url:"/PointOfSaleMenu/GetListAffectedPriceItem",type:"POST",dataType:"json",data:function(n){return $.extend({},n,{catalogKey:$("#catalog-key").val(),lstVariants:lst_selected_trader_item_ids.map(n=>n.variant_id),lstExtras:lst_selected_trader_item_ids.map(n=>n.extra_id),keySearch:$("#affected-price-keysearch").val(),locationId:$("#location-manager").val()})}},columns:[{name:"ItemSKU",data:"ItemSKU",orderable:!1},{name:"CategoryId",data:"CategoryId",orderable:!1,render:function(n,t,i){return""+('<a href="#">'+i.CategoryName+"<\/a>")}},{name:"CategoryItemId",data:"CategoryItemId",orderable:!1,render:function(n,t,i){return""+('<a href="#" class="filtering">'+i.CategoryItemName+"<\/a>")}},{name:"Id",data:"Id",orderable:!1,render:function(n,t,i){return""+(i.IsVariant?'<label class="label label-lg label-primary">'+i.Name+"<\/label>":'<label class="label label-lg label-info">'+i.Name+"<\/label>")}},{name:"NetPrice",data:"NetPrice",orderable:!1},{name:"ListTaxes",data:"ListTaxes",orderable:!1,render:function(n,t,i){var r="";return r+='<ul class="unstyled">',_.forEach(i.ListTaxes,function(n){r+="<li>"+n.Amount+" <small> &nbsp; <i>("+n.TaxName+")<\/i><\/small><\/li>"}),r+="<\/ul>"}},{name:"GrossPrice",data:"GrossPrice",orderable:!1}]})}function SetCategoryFiltering(n){$("#list-category-search-price").val([n]).multiselect("rebuild").change()}function SetCategoryItemFiltering(n){$("#category-item-search-price").val(n).text(n).keyup()}function ToggleCheckAllPriceButton(){var n,t;isCheckAllBtnReady&&(LoadingOverlay(),lst_ignored_page_ids_on_selecting_all=[],isCheckAllBtnReady=!1,n=$("#check-all-btn"),is_all_price_selected?(is_all_price_selected=!1,$(n).html("Check all"),lst_selected_trader_item_ids=[],price_table.column(0).checkboxes.deselectAll(),isCheckAllBtnReady=!0,togglePriceActionPanel(),LoadingOverlayEnd()):(t="/PointOfSaleMenu/GetFilteredPriceIds",$.ajax({method:"POST",dataType:"JSON",url:t,data:{catalogKey:$("#catalog-key").val(),traderItemSKU:$("#sku-search-price").val(),lstCategoryId:$("#list-category-search-price").val(),categoryItemNameKeySearch:$("#category-item-search-price").val(),variantOrExtraName:$("#variant-extra-name-search-price").val()},success:function(t){if(t.result){is_all_price_selected=!0;$(n).html("Uncheck all");lst_selected_trader_item_ids=t.Object;var i=$("#catalog-price-table > thead input[type=checkbox]").is(":checked");i||$("#catalog-price-table > thead input[type=checkbox]").click()}else cleanBookNotification.error(t.msg,"Qbicles");isCheckAllBtnReady=!0;LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");isCheckAllBtnReady=!0;LoadingOverlayEnd()}}).done(function(){togglePriceActionPanel()})))}function getListProductGroup(){LoadingOverlay();$.get("/PointOfSale/GetTraderGroupByLocation?locaionId="+domainId,function(n){listProductGroupsFromServer=n;isFinishLoading?(LoadingOverlayEnd(),LoadingOverlayEnd()):isFinishLoading=!0})}function getListCategoryByMenuImport(){LoadingOverlay();var n=$("#menu_id").val(),t="/PointOfSaleMenu/GetCategoryByCatalog?idMenu="+n;$.ajax({url:t,type:"get",dataType:"json",success:function(n){n.result?(listCategoryFromServer=n.Object.Categories,isFinishLoading?(LoadingOverlayEnd(),LoadingOverlayEnd()):isFinishLoading=!0):cleanBookNotification.error("Have an error, detail: "+n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}})}function setListProductGroup(){var n=$(".import-pgroup");n.empty();n.append("<option><\/option>");$.each(listProductGroupsFromServer,function(t,i){n.append('<option value="'+i.id+'">'+i.text+"<\/option>")});n.select2({placeholder:"Select a Product group"})}function setListCategoryByMenuImport(){$selector=$(".import-cgroup");$selector.empty();$selector.append("<option><\/option>");$.each(listCategoryFromServer,function(n,t){$selector.append('<option value="'+t.Id+'">'+t.Name+"<\/option>")});$selector.select2({placeholder:"Select a category"})}function updateListProductGroup(){var n=[],t=$(".pgrouping");return t.each((t,i)=>{idItemSelected=$(i).find(".import-pgroup").val(),n.push(idItemSelected)}),currentListUnselectedProductGroups=listProductGroupsFromServer.filter(t=>!n.find(n=>n===t.id))}function reupdateTemplateRowProductGroups(n,t){var i="";return i+='<option value="'+t.id+'">'+t.text+"<\/option>",$.each(n,function(n,t){i+='<option value="'+t.id+'">'+t.text+"<\/option>"}),i}function templateRowImportMenu(n,t){var i="<tr>";return i+='<td class="tweak-select2-custom">',i+='<div class="form-group pgrouping" style="margin: 0;">',i+='<select name="pgroup" class="form-control select2 import-pgroup" style="width: 100%;">',i+="<option><\/option>",$.each(n,function(n,t){i+='<option value="'+t.id+'">'+t.text+"<\/option>"}),i+="<\/select><\/div><\/td>",i+='<td class="tweak-select2-custom">',i+='<div class="form-group cgrouping" style="display: block; margin: 0;">',i+='<select name="cgroup" class="form-control select2 import-cgroup" style="width: 100%;">',i+="<option><\/option>",$.each(t,function(n,t){i+='<option value="'+t.Id+'">'+t.Name+"<\/option>"}),i+="<\/select><\/div><\/td>",i+="<td>",i+='<button class="btn btn-soft" onclick="$(this).closest(\'tr\').remove(); updateProductGroups();checkValidCategorryDropdown();" ><i class="fa fa-trash"><\/i><\/button>',i+="<\/td>",i+="<\/tr>"}function setValueSelectedCategory(){var n=$(".import-pgroup").val()}function resetRow(){$(".proceedtoimport").hide();$("#import-table-product-groups tbody tr").remove()}function initImportProductFunction(){getListProductGroup();getListCategoryByMenuImport();initOtherSetting()}function initRow(){setListProductGroup();setListCategoryByMenuImport()}function initNewRow(){$(".proceedtoimport").hide();$("#import-table-product-groups").append(templateRowImportMenu(updateListProductGroup(),listCategoryFromServer));initOtherSetting()}function initOtherSetting(){$(".import-cgroup:last-child").select2({placeholder:"Select a category"}).on("select2:select",function(){checkValidCategorryDropdown()});$(".import-pgroup:last-child").select2({placeholder:"Select a product group"}).on("select2:select",function(n){checkValidCategorryDropdown();var t=n.params.data.text;currentDropdownCategory=$(this).parents("td").next().find(".import-cgroup");currentDropdownCategory.val()>0||(listOptionsCurrentDropDownCategory=$(this).parents("td").next().find(".import-cgroup option"),listOptionsCurrentDropDownCategory.each(function(n,i){var r=$(i).text(),u=$(i).val();compare=r.localeCompare(t);compare==0&&currentDropdownCategory.val(u).trigger("change")}));updateProductGroups()})}function updateProductGroups(){$(".import-pgroup").each((n,t)=>{var i=$(t).val(),r,u;r=listProductGroupsFromServer.find(n=>n.id===i)===undefined?"":listProductGroupsFromServer.find(n=>n.id===i).text;u={id:i,text:r};$(t).html("");$(t).append(reupdateTemplateRowProductGroups(updateListProductGroup(),u));$(t).select2({placeholder:"Select a product group"})})}function importNow(){var i=[],t=[],n=[],r=!0;$(".importing").show();$(".proceedtoimport").attr("disabled",!0);$("#import-table-product-groups tbody tr").each((i,u)=>{var f=parseInt($(u).find(".import-cgroup").val()),e=parseInt($(u).find(".import-pgroup").val());isNaN(f)&&(r=!1,$(".importing").hide(),$(".proceedtoimport").removeAttr("disabled"));n.includes(f)?t[n.indexOf(f)].ProductGroupsId.push(e):(n.push(f),t[n.indexOf(f)]={CategoryId:f,ProductGroupsId:[e]})});t.forEach(n=>i.push(n));r?$.ajax({url:"/PointOfSaleMenu/MappingProductGroupsWithCategories",type:"POST",dataType:"JSON",data:{listProductGroups:i,menuId:$menuId,locationId:$locationManager},success:function(){location.reload()},error:function(n){console.log(n)}}):alert("Null category")}function checkValidCategorryDropdown(){var r=[],t=[],n=[],i=!0;$("#import-table-product-groups tbody tr").each((r,u)=>{var f=parseInt($(u).find(".import-cgroup").val()),e=parseInt($(u).find(".import-pgroup").val());(isNaN(f)||isNaN(e))&&(i=!1);n.includes(f)?t[n.indexOf(f)].ProductGroupsId.push(e):(n.push(f),t[n.indexOf(f)]={CategoryId:f,ProductGroupsId:[e]})});t.forEach(n=>r.push(n));i?$(".proceedtoimport").show():$(".proceedtoimport").hide()}var refershCategorySelect,$jobId,$reloadData,$updateProcessing,$refreshProcessing,isCheckAllBtnReady;$("#search-item-list").keyup(function(){$("#item-list").DataTable().ajax.reload()});var categorys=[],traderItemsFilter=[],$locationManager=$("#location-manager").val();$("#subfilter-group").on("change",function(){$("#item-list").DataTable().ajax.reload()});var $disableButton="",imgApi=$("#img-api").val(),$menuId=0;UpdateMenu=function(n){$.LoadingOverlay("show");$("#menu-name").val("");$("#menu-summary").val("");$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Edit catalog");$menuId=n;$.ajax({url:"/PointOfSaleMenu/GetById?id="+n,type:"post",dataType:"json",success:function(n){if(n.actionVal>0){$("#menu-name").val(n.Object.Name);var t=$("#menu-salechannel");t.prop("disabled",!0);t.val(n.Object.SalesChannel).trigger("change");$("#menu-summary").val(n.Object.Description);$("#report_filters").val(n.Object.Dimensions);$("#report_filters").select2({placeholder:"Please select"});n.Object.Type==1?($(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show());$("#catalog-type-value").val(n.Object.Type);$("#app-trader-pos-menu-modal").modal("show")}},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()})};$("#item_featuredimg").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});refershCategorySelect=function(n,t,i){var u,r;if(n&&n.length>0){for(categorys=n,$("#"+t).empty(),u='<option value=""><\/option>',r=0;r<n.length;r++)u+=n[r].Id===i?'<option selected value="'+n[r].Id+'">'+n[r].Name+"<\/option>":'<option value="'+n[r].Id+'">'+n[r].Name+"<\/option>";$("#"+t).append(u);$("#"+t).val(i);$("#"+t).select2({placeholder:"Please select",tags:!0})}};$jobId="";$reloadData=!1;$updateProcessing=!1;$refreshProcessing=!1;StopInterval=function(n){clearInterval(n)};var price_table="",lst_selected_trader_item_ids=[],is_all_price_selected=!1,is_dataTable_reloading=!0,lst_ignored_page_ids_on_selecting_all=[];isCheckAllBtnReady=!0;var currentListUnselectedProductGroups=[],listProductGroupsFromServer=[],listCategoryFromServer=[],unuseListProductGroups=[],isFinishLoading=!1,domainId=$("#location-id-domain").text();