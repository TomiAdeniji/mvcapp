function initFormBuilder(){var n=$("#frmFormBuilder");n.validate({ignore:".ql-container *",rules:{TemplateName:{required:!0,maxlength:150},TemplateDescription:{required:!0,maxlength:350}},invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(n){var r,t,i;if(n.preventDefault(),!isBusy)if($(this).valid()){if(r=quillEditor.root.innerHTML,r=="<p><br><\/p>"){cleanBookNotification.error(_L("ERROR_MSG_176"),"Sales Marketing");return}if(!$("#FeaturedImage").val()&&!$("#FileFeaturedImg").val()){cleanBookNotification.error(_L("ERROR_MSG_817"),"Sales Marketing");return}if($("input[name=AdvertImgiIsHidden]").prop("checked")&&!$("#AdvertImage").val()&&!$("#FileAdvImg").val()){cleanBookNotification.error(_L("ERROR_MSG_816"),"Sales Marketing");return}$.LoadingOverlay("show");t=document.getElementById("FileFeaturedImg").files;i=document.getElementById("FileAdvImg").files;t&&t.length>0&&i&&i.length>0?Promise.all([UploadMediaS3ClientSide("FileFeaturedImg"),UploadMediaS3ClientSide("FileAdvImg")]).then(n=>{$("#sm-email-builder-feature-object-key").val(n[0].objectKey),$("#sm-email-builder-feature-object-name").val(n[0].fileName),$("#sm-email-builder-feature-object-size").val(n[0].fileSize),$("#sm-email-builder-adv-object-key").val(n[1].objectKey),$("#sm-email-builder-adv-object-name").val(n[1].fileName),$("#sm-email-builder-adv-object-size").val(n[1].fileSize),SaveEmailBuilder()}).catch(()=>{LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}):t&&t.length>0&&!i&&i.length>=0?UploadMediaS3ClientSide("FileFeaturedImg").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-email-builder-feature-object-key").val(n.objectKey);$("#sm-email-builder-feature-object-name").val(n.fileName);$("#sm-email-builder-feature-object-size").val(n.fileSize);SaveEmailBuilder()}):!t&&t.length<=0&&i&&i.length>0?UploadMediaS3ClientSide("FileAdvImg").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-email-builder-adv-object-key").val(n.objectKey);$("#sm-email-builder-adv-object-name").val(n.fileName);$("#sm-email-builder-adv-object-size").val(n.fileSize);SaveEmailBuilder()}):SaveEmailBuilder()}else return})}function SaveEmailBuilder(){$("#BodyContent").val($(quillEditor.root.innerHTML).html());var n=new FormData($("#frmFormBuilder")[0]);$.ajax({type:"post",cache:!1,url:"/SalesMarketing/SaveEmailBuilder",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?(isBusy=!1,location.href=n.Object):n.msg?cleanBookNotification.error(n.msg,"Operator"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Operator");LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Operator");LoadingOverlayEnd()}})}function changeResourseType(n,t){$(n).val()=="1"?t=="FeaturedImage"?($(".campaign-resource-picker").show(),$(".uploadnew").hide(),loadResources("Choose-campaign-resources")):($(".campaign-resource-picker-ad").show(),$(".uploadnew-ad").hide(),loadResources("Choose-campaign-resources-ad")):t=="FeaturedImage"?($(".campaign-resource-picker").hide(),$(".uploadnew").show()):($(".campaign-resource-picker-ad").hide(),$(".uploadnew-ad").show());$(n).valid()}function loadResources(n){$.LoadingOverlay("show");$("#"+n).load("/SalesMarketing/LoadImageResources?refdivid="+n,function(){LoadingOverlayEnd()})}function chooseMediaAdd(n,t,i,r,u){$("#"+u+" .change"+t).hide();$("#"+u+".usetheme"+t).hide();r?($(n).hide(),$("#"+u+" .change"+t).show(),$("#"+u+" .other").hide(),$("#"+u+" .rs-"+t).show(),u=="Choose-campaign-resources"?($("#FeaturedImage").val(t),$("#fimg").attr("src",i)):($("#AdvertImage").val(t),$("#adimg").attr("src",i))):($(n).hide(),$("#"+u+" .usetheme"+t).show(),$("#"+u+" .other").show(),u=="Choose-campaign-resources"?($("#FeaturedImage").val(""),$("#fimg").attr("src","https://via.placeholder.com/600x200?text=Featured+image (600x200px)")):($("#AdvertImage").val(""),$("#adimg").attr("src","https://via.placeholder.com/600x200?text=Optional+advert (600x200px)")),$("html, body").animate({scrollTop:$("#"+u).offset().top-200},200))}function validateAdve(n){$(n).prop("checked")?($("input[name=AdvertLink]").prop("required",!0),$("select[name=AdvertImageType]").prop("required",!0)):($("input[name=AdvertLink]").prop("required",!1),$("select[name=AdvertImageType]").prop("required",!1))}function validateBodyButton(n){$(n).prop("checked")?($("input[name=ButtonText]").prop("required",!0),$("input[name=ButtonLink]").prop("required",!0),$("input[name=ButtonFontSize]").prop("required",!0),$("input[name=ButtonText]").valid(),$("input[name=ButtonLink]").valid(),$("input[name=ButtonFontSize]").valid(),$("#button").css("display","inline-block")):($("input[name=ButtonText]").prop("required",!1),$("input[name=ButtonLink]").prop("required",!1),$("input[name=ButtonFontSize]").prop("required",!1),$("input[name=ButtonText]").valid(),$("input[name=ButtonLink]").valid(),$("input[name=ButtonFontSize]").valid(),$("#button").css("display","none"))}function validateSocial(n,t){$(n).prop("checked")?($("input[name="+t+"]").prop("required",!0),$("input[name="+t+"]").valid()):($("input[name="+t+"]").prop("required",!1),$("input[name="+t+"]").valid())}function validateAdvImg(n){$(n).prop("checked")?($("input[name=AdvertLink]").prop("required",!0),$("input[name=AdvertLink]").valid(),$("select[name=AdvertImageType]").prop("required",!0),$("select[name=AdvertImageType]").valid()):($("input[name=AdvertLink]").prop("required",!1),$("input[name=AdvertLink]").valid(),$("select[name=AdvertImageType]").prop("required",!1),$("select[name=AdvertImageType]").valid())}function readURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}var quillEditor,isBusy=!1;$(document).ready(function(){$("#headlinefont").change(function(){$("#headline").css("font-family",$(this).val())});$("#bodyfont").change(function(){$("#bodypreview p").css("font-family",$(this).val())});$("#buttonfont").change(function(){$("#button").css("font-family",$(this).val())});var n=Quill.import("blots/block");n.tagName="div";Quill.register(n);quillEditor=new Quill("#editor",{modules:{toolbar:"#toolbar-container"},placeholder:"Enter your email's main content here...",theme:"snow"});quillEditor.on("text-change",function(){var n=quillEditor.root.innerHTML;$("#bodypreview p").html(n)});initFormBuilder();$(".previewimg").change(function(){var n=$(this).data("target");readURL(this,n);$(n).fadeIn()})});