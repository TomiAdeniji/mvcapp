function initPuginsGalary(){$("#page_templates_builder .nvgalleryowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}})}function saveUserPageBuilder(n){_pageBuilder.Status=n;$("#frmpageBuilder").valid()&&($.LoadingOverlay("show"),$.each(_pageBuilder.BlockHeroes,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockTextImages,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockGalleries,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockMasonryGalleries,function(n,t){t.Id>0&&(t.ElmId="")}),$.ajax({type:"POST",url:"/ProfilePage/SaveUserPageBuilder",data:{pageBuilder:_pageBuilder},success:function(t){t.result?(n=="IsActive"&&$("#btnDiscardChange").attr("disabled",!0),$("#hdfPageID").val(t.Object).trigger("change"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):!t.result&&t.msg?cleanBookNotification.error(t.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()}))}function addBlock(n){var u,i,t,r;$("#btnDiscardChange").removeAttr("disabled");u=$(n).clone();i=$(u);i.length>0&&(t=UniqueId(5),i.attr("id",t),r=i.data("type"),$("#newstart").hide(),$("#page_templates_builder").append(i),$("#"+t+" button.btn-edit-block").attr("onclick","bindDataForBlock('"+t+"','"+r+"')"),$("#"+t+" button.btn-delete-block").attr("onclick","removeBlock('"+t+"')"),$("#"+t+" button.moveup").attr("onclick","moveUpDown('"+t+"',true)"),$("#"+t+" button.movedown").attr("onclick","moveUpDown('"+t+"',false)"),$("#"+t).fadeIn(),$("#"+t+" .nvgalleryowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}}),$("#"+t+" .masonry").masonry({columnWidth:420,isFitWidth:!0,itemSelector:".masonitem"}),initDefaultBlockData(r,t),hideUpDownBlock())}function initDefaultBlockData(n,t){var i=$("#page_templates_builder .profile-pageblock").length,r,u,f,e;switch(n){case"HeroPersonal":r={ElmId:t,Id:0,HeroBackgroundType:"SingleColour",HeroBackgroundColour:"#60a7bd",HeroGradientColour1:"#1dd8cf",HeroGradientColour2:"#8845f0",HeroBackGroundImage:"",HeroHeadingText:"I'm<span>Sarah<\/span>",HeroHeadingFontSize:58,HeroHeadingColour:"#ffffff",HeroHeadingAccentColour:"#d0d265",HeroSubHeadingText:"I'm an amateur photographer and go- getter who's just dying to show off my latest snaps.",HeroSubHeadingFontSize:24,HeroSubHeadingColour:"#ffffff",HeroFeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/happy.jpg",HeroIsIncludeButton:!0,HeroButtonText:"Tell me more",HeroButtonColour:"#4ccba9",HeroButtonJumpTo:0,HeroExternalLink:"",DisplayOrder:i==0?1:i+1,Type:"HeroPersonal",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockHeroes.push(r);break;case"TextAndImage":u={ElmId:t,Id:0,HeadingText:"Text panel <span>with image<\/span>",HeadingFontSize:32,HeadingColour:"#224157",HeadingAccentColour:"#d0d265",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec commodo augue a metus interdum, ac tincidunt sapien semper. Nam consequat lorem a quam viverra, eu ornare eros condimentum. Aenean pulvinar vitae ligula vitae vulputate. Morbi odio eros, tincidunt in luctus eget, facilisis a ante. Etiam lobortis erat at libero ultricies ultrices.",ContentFontSize:16,ContentColour:"#333333",IsIncludeButton:!0,ButtonText:"Button example",ButtonColour:"#2990ea",ButtonJumpTo:0,ExternalLink:"",FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/thinking.jpg",DisplayOrder:i==0?1:i+1,Type:"TextImage",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockTextImages.push(u);break;case"Gallery":f={ElmId:t,Id:0,GalleryItems:[{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/bee.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:1},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/tree.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:2},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/cow.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:3},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/woman.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:4}],DisplayOrder:i==0?1:i+1,Type:"Gallery",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockGalleries.push(f);break;case"MasonryGallery":e={Id:0,ElmId:t,HeadingText:"My stuff",HeadingFontSize:32,HeadingColour:"#000000",HeadingAccentColour:"#4ccba9",SubHeadingText:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam facilisis dui at turpis laoreet vestibulum. In pretium libero diam!",SubHeadingFontSize:16,SubHeadingColour:"#889aa7",GalleryItems:[{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry7.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:1},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry1.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:2},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry2.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:3},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry3.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:4},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry4.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:5},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry5.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:6},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry6.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:7},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/masonry8.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:8}]};_pageBuilder.BlockMasonryGalleries.push(e)}}function bindDataForBlock(n,t){var r,e,u,i,f;switch(t){case"HeroPersonal":if(i="#pages-blocks-hero-edit",r=_pageBuilder.BlockHeroes.find(t=>t.ElmId==n||n=="block"+t.Id),r&&!r.ElmId)r.ElmId="block"+r.Id;else if(!r)return;e="";r.HeroBackgroundType==="SingleColour"?e="#bgcolour":r.HeroBackgroundType==="Gradient"?e="#bggradient":r.HeroBackgroundType==="Image"&&(e="#bgimage");$(i+" select[name=HeroBackgroundType]").val(e).change();$(i+" input[name=HeroBackgroundColour]").val(r.HeroBackgroundColour);$(i+" input[name=HeroGradientColour1]").val(r.HeroGradientColour1);$(i+" input[name=HeroGradientColour2]").val(r.HeroGradientColour2);$(i+" input[name=HeroHeadingAccentColour]").val(r.HeroHeadingAccentColour);$(i+" input[name=HeroBackGroundImage]").val(r.HeroBackGroundImage);$(i+" input[name=HeroHeadingText]").val(r.HeroHeadingText);$(i+" input[name=HeroHeadingFontSize]").val(r.HeroHeadingFontSize);$(i+" input[name=HeroHeadingColour]").val(r.HeroHeadingColour);$(i+" textarea[name=HeroSubHeadingText]").val(r.HeroSubHeadingText);$(i+" input[name=HeroSubHeadingFontSize]").val(r.HeroSubHeadingFontSize);$(i+" input[name=HeroSubHeadingColour]").val(r.HeroSubHeadingColour);$(i+" input[name=HeroFeaturedImage]").val(r.HeroFeaturedImage);$(i+" .preview-HeroFeaturedImage").attr("src",getUrlImage(r.HeroFeaturedImage));getBlocksForJumbTo(i+" select[name=ButtonJumpTo]",n);$(i+" select[name=ButtonJumpTo]").val(r.HeroButtonJumpTo=="0"?"external":r.HeroButtonJumpTo).change();$(i+" input[name=ExternalLink]").val(r.HeroExternalLink);$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$("#drag-drop-area").data("blockid",n);$(i).modal("show");break;case"TextAndImage":if(i="#pages-blocks-textimg-edit",u=_pageBuilder.BlockTextImages.find(t=>t.ElmId==n||n=="block"+t.Id),u&&!u.ElmId)u.ElmId="block"+u.Id;else if(!u)return;$(i+" input[name=HeadingAccentColour]").val(u.HeadingAccentColour);$(i+" input[name=HeadingText]").val(u.HeadingText);$(i+" input[name=HeadingFontSize]").val(u.HeadingFontSize);$(i+" input[name=HeadingColour]").val(u.HeadingColour);$(i+" input[name=Content]").val(u.Content);$(i+" input[name=ContentFontSize]").val(u.ContentFontSize);$(i+" input[name=ContentColour]").val(u.ContentColour);$(i+" input[name=IsIncludeButton]").prop("checked",u.IsIncludeButton);$(i+" input[name=ButtonText]").val(u.ButtonText);$(i+" input[name=ButtonColour]").val(u.ButtonColour);getBlocksForJumbTo(i+" select[name=ButtonJumpTo]",n);$(i+" select[name=ButtonJumpTo]").val(u.ButtonJumpTo=="0"?"external":u.ButtonJumpTo).change();$(i+" input[name=ExternalLink]").val(u.ExternalLink);$(i+" input[name=FeaturedImage]").val(u.FeaturedImage);$(i+" .preview-FeaturedImage").attr("src",getUrlImage(u.FeaturedImage));$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$(i).modal("show");break;case"Gallery":if(i="#pages-blocks-gallery-edit",f=_pageBuilder.BlockGalleries.find(t=>t.ElmId==n||n=="block"+t.Id),f&&!f.ElmId)f.ElmId="block"+f.Id;else if(!f)return;$("#gallery-items").empty();f.GalleryItems.length>0?($("#gallery-intro").hide(),$("#gallery-items").show()):($("#gallery-intro").show(),$("#gallery-items").hide());$.each(f.GalleryItems,function(n,t){var u=$("#gallery-item-block").clone(),i=$(u),r;i.show();r="item-"+UniqueId(5);$("#gallery-items").append(i);i.attr("id",r);i.find("input[name=Title]").val(t.Title);i.find("textarea[name=Content]").val(t.Content);i.find("input[name=FeaturedImage]").val(t.FeaturedImage);i.find("div.preview").css("background-image","url("+getUrlImage(t.FeaturedImage)+")");i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','gallery-items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'gallery-items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'gallery-items')")});hideUpDownFirstLastItem("gallery-items");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$("#btnResetUppy").click();$(i).modal("show");break;case"MasonryGallery":if(i="#pages-blocks-masonry-edit",f=_pageBuilder.BlockMasonryGalleries.find(t=>t.ElmId==n||n=="block"+t.Id),f&&!f.ElmId)f.ElmId="block"+f.Id;else if(!f)return;$("#masonry-items").empty();f.GalleryItems.length>0?($("#masonry-intro").hide(),$("#masonry-items").show()):($("#masonry-intro").show(),$("#masonry-items").hide());$.each(f.GalleryItems,function(n,t){var u=$("#gallery-item-block").clone(),i=$(u),r;i.show();r="item-"+UniqueId(5);$("#masonry-items").append(i);i.attr("id",r);i.find("input[name=Title]").val(t.Title);i.find("textarea[name=Content]").val(t.Content);i.find("input[name=FeaturedImage]").val(t.FeaturedImage);i.find("div.preview").css("background-image","url("+getUrlImage(t.FeaturedImage)+")");i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','gallery-items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'gallery-items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'gallery-items')")});hideUpDownFirstLastItem("masonry-items");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$("#btnResetUppy").click();$(i).modal("show")}}function updateDataBlock(n,t){var u,e,i,f,h;$("#btnDiscardChange").removeAttr("disabled");switch(t){case"HeroPersonal":var i="#pages-blocks-hero-edit",r=_pageBuilder.BlockHeroes.find(t=>t.ElmId==n),o=$(i+" select[name=HeroBackgroundType]").val();o==="#bgcolour"?r.HeroBackgroundType="SingleColour":o==="#bggradient"?r.HeroBackgroundType="Gradient":o==="#bgimage"&&(r.HeroBackgroundType="Image");r.HeroBackgroundColour=$(i+" input[name=HeroBackgroundColour]").val();r.HeroGradientColour1=$(i+" input[name=HeroGradientColour1]").val();r.HeroGradientColour2=$(i+" input[name=HeroGradientColour2]").val();r.HeroHeadingAccentColour=$(i+" input[name=HeroHeadingAccentColour]").val();r.HeroBackGroundImage=$(i+" input[name=HeroBackGroundImage]").val();r.HeroHeadingText=$(i+" input[name=HeroHeadingText]").val();r.HeroHeadingFontSize=$(i+" input[name=HeroHeadingFontSize]").val();r.HeroHeadingColour=$(i+" input[name=HeroHeadingColour]").val();r.HeroSubHeadingText=$(i+" textarea[name=HeroSubHeadingText]").val();r.HeroSubHeadingFontSize=$(i+" input[name=HeroSubHeadingFontSize]").val();r.HeroSubHeadingColour=$(i+" input[name=HeroSubHeadingColour]").val();r.HeroFeaturedImage=$(i+" input[name=HeroFeaturedImage]").val();r.HeroIsIncludeButton=$(i+" input[name=IsIncludeButton]").prop("checked");r.HeroButtonText=$(i+" input[name=ButtonText]").val();r.HeroButtonColour=$(i+" input[name=ButtonColour]").val();e=$(i+" select[name=ButtonJumpTo]").val();r.HeroButtonJumpTo=e=="external"?0:e;r.HeroExternalLink=$(i+" input[name=ExternalLink]").val();updateBlockPreview(n,r,t);$(i).modal("hide");break;case"TextAndImage":i="#pages-blocks-textimg-edit";u=_pageBuilder.BlockTextImages.find(t=>t.ElmId==n);u.HeadingAccentColour=$(i+" input[name=HeadingAccentColour]").val();u.HeadingText=$(i+" input[name=HeadingText]").val();u.HeadingFontSize=$(i+" input[name=HeadingFontSize]").val();u.HeadingColour=$(i+" input[name=HeadingColour]").val();u.Content=$(i+" textarea[name=Content]").val();u.ContentFontSize=$(i+" input[name=ContentFontSize]").val();u.ContentColour=$(i+" input[name=ContentColour]").val();u.IsIncludeButton=$(i+" input[name=IsIncludeButton]").prop("checked");u.ButtonText=$(i+" input[name=ButtonText]").val();u.ButtonColour=$(i+" input[name=ButtonColour]").val();e=$(i+" select[name=ButtonJumpTo]").val();u.ButtonJumpTo=e=="external"?0:e;u.ExternalLink=$(i+" input[name=ExternalLink]").val();u.FeaturedImage=$(i+" input[name=FeaturedImage]").val();updateBlockPreview(n,u,t);$(i).modal("hide");break;case"Gallery":var i="#pages-blocks-gallery-edit",s=_pageBuilder.BlockGalleries.find(t=>t.ElmId==n),h=$("#gallery-items div.item-block");s.GalleryItems=[];h.each(function(n,t){var i=$(t),r={Id:0,FeaturedImage:i.find("input[name=FeaturedImage]").val(),Title:i.find("input[name=Title]").val(),Content:i.find("textarea[name=Content]").val(),DisplayOrder:n+1};s.GalleryItems.push(r)});updateBlockPreview(n,s,t);$(i).modal("hide");break;case"MasonryGallery":i="#pages-blocks-masonry-edit";f=_pageBuilder.BlockMasonryGalleries.find(t=>t.ElmId==n);f.HeadingAccentColour=$(i+" input[name=HeadingAccentColour]").val();f.HeadingText=$(i+" input[name=HeadingText]").val();f.HeadingFontSize=$(i+" input[name=HeadingFontSize]").val();f.HeadingColour=$(i+" input[name=HeadingColour]").val();f.SubHeadingText=$(i+" textarea[name=SubHeadingText]").val();f.SubHeadingFontSize=$(i+" input[name=SubHeadingFontSize]").val();f.SubHeadingColour=$(i+" input[name=SubHeadingColour]").val();h=$("#masonry-items div.item-block");f.GalleryItems=[];h.each(function(n,t){var i=$(t),r={Id:0,FeaturedImage:i.find("input[name=FeaturedImage]").val(),Title:i.find("input[name=Title]").val(),Content:i.find("textarea[name=Content]").val(),DisplayOrder:n+1};f.GalleryItems.push(r)});updateBlockPreview(n,f,t);$(i).modal("hide")}}function updateBlockPreview(n,t,i){var n="#"+n,s,r,f,o,e,u;switch(i){case"HeroPersonal":t.HeroBackgroundType=="Gradient"?$(n).css("background","linear-gradient(140deg, "+t.HeroGradientColour1+" 0%, "+t.HeroGradientColour2+" 100%)"):t.HeroBackgroundType=="SingleColour"?($(n).css("background","none"),$(n).css("background-color",t.HeroBackgroundColour)):t.HeroBackgroundType=="Image"&&($(n).css("background-image","url("+getUrlImage(t.HeroBackGroundImage)+")"),$(n).css("-webkit-background-size","cover"),$(n).css("-moz-background-size","cover"),$(n).css("-ms-background-size","cover"),$(n).css("-o-background-size","cover"),$(n).css("background-size","cover"));f=$(n+" h1.block-heading");f.html(t.HeroHeadingText);f.css("font-size",t.HeroHeadingFontSize+"px");f.css("color",t.HeroHeadingColour);o=$(n+" h1.block-heading span");o.css("color",t.HeroHeadingAccentColour);s=$(n+" h2.block-subheading");s.html(t.HeroSubHeadingText);s.css("font-size",t.HeroSubHeadingFontSize+"px");s.css("color",t.HeroSubHeadingColour);$(n+" img.nvpfeature").attr("src",getUrlImage(t.HeroFeaturedImage));r=$(n+" button.nvpbutton");t.HeroIsIncludeButton?r.show():r.hide();r.text(t.HeroButtonText);r.css("background-color",t.HeroButtonColour);t.HeroButtonJumpTo==0?r.attr("onclick",'location.href="https://'+t.HeroExternalLink+'"'):r.attr("onclick",'location.href="'+t.HeroButtonJumpTo+'"');break;case"TextAndImage":f=$(n+" h1.block-heading");f.html(t.HeadingText);f.css("font-size",t.HeadingFontSize+"px");f.css("color",t.HeadingColour);o=$(n+" h1.block-heading span");o.css("color",t.HeadingAccentColour);e=$(n+" p.block-content");e.html(t.Content);e.css("font-size",t.ContentFontSize+"px");e.css("color",t.ContentColour);r=$(n+" button.nvbutton");t.IsIncludeButton?r.show():r.hide();r.text(t.ButtonText);r.css("background-color",t.ButtonColour);t.ButtonJumpTo==0?r.attr("onclick",'location.href="https://'+t.ExternalLink+'"'):r.attr("onclick",'location.href="'+t.ButtonJumpTo+'"');$(n+" div.block-img").css("background-image","url("+getUrlImage(t.FeaturedImage)+")");break;case"Gallery":u=$(n+" div.nvgalleryowl");u.empty();$.each(t.GalleryItems,function(n,t){var i='<div class="item">';i+='<div class="nvgalleryitem" style="background-image: url(\''+getUrlImage(t.FeaturedImage)+"');\">";i+='<div class="nvcaption">';i+="<h5>"+t.Title+"<\/h5>";i+="<p>"+t.Content+"<\/p>";i+="<\/div><\/div><\/div>";u.append(i)});u.owlCarousel("destroy");u.owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}});break;case"MasonryGallery":f=$(n+" h1.block-heading");f.html(t.HeadingText);f.css("font-size",t.HeadingFontSize+"px");f.css("color",t.HeadingColour);o=$(n+" h1.block-heading span");o.css("color",t.HeadingAccentColour);e=$(n+" p.block-content");e.html(t.SubHeadingText);e.css("font-size",t.SubHeadingFontSize+"px");e.css("color",t.SubHeadingColour);u=$(n+" div.masonry");u.empty();$.each(t.GalleryItems,function(n,t){var i='<div class="masonitem">';i+='<a href="'+getUrlImage(t.FeaturedImage)+'" class="image-pop" data-fancybox="gallery" title="'+t.Title+'"><img src="'+getUrlImage(t.FeaturedImage)+'" class="img-responsive"><\/a>';i+="<\/div>";u.append(i)});u.imagesLoaded(function(){u.css("height","");u.masonry("destroy");u.removeData("masonry");u.masonry({columnWidth:420,isFitWidth:!0,itemSelector:".masonitem"})})}}function removeBlock(n){var i=confirm("Are you sure you want to delete this block? This action cannot be undone"),t;if(i==!0){$("#btnDiscardChange").removeAttr("disabled");t=$("#"+n).data("type");switch(t){case"HeroPersonal":_pageBuilder.BlockHeroes=$.grep(_pageBuilder.BlockHeroes,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"TextAndImage":_pageBuilder.BlockTextImages=$.grep(_pageBuilder.BlockTextImages,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"Gallery":_pageBuilder.BlockGalleries=$.grep(_pageBuilder.BlockGalleries,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"MasonryGallery":_pageBuilder.BlockMasonryGalleries=$.grep(_pageBuilder.BlockMasonryGalleries,function(t){return t.ElmId!=n&&n!="block"+t.Id})}n="#"+n;$(n).remove();updateDisplayOrderBlocks()}}function moveUpDown(n,t){var r=$("#page_templates_builder .profile-pageblock"),u=$("#page_templates_builder .profile-pageblock").length,i=$("#"+n).index()-1;t&&i>0?(jQuery(r.eq(i-1)).before(jQuery(r.eq(i))),i=i-1):!t&&i<u&&(jQuery(r.eq(i+1)).after(r.eq(i)),i=i+1);updateDisplayOrderBlocks()}function moveUpDownItems(n,t,i){var u=$("#"+i+" .item-block"),e=u.length,r=$("#"+n).index(),f=u.eq(r);t&&r>0?(u.eq(r-1).before(f),r=r-1):!t&&r<e&&(u.eq(r+1).after(f),r=r+1);document.getElementById(f.attr("id")).scrollIntoView();hideUpDownFirstLastItem(i)}function updateDisplayOrderBlocks(){var n=$("#page_templates_builder .profile-pageblock");if(n.length==0){$("#newstart").show();return}$.each(n,function(n,t){var o=$(t).data("type"),i=$(t).attr("id"),r,u,f,e;switch(o){case"HeroPersonal":r=_pageBuilder.BlockHeroes.find(n=>n.ElmId==i||i=="block"+n.Id);r&&(r.DisplayOrder=n+1);break;case"TextAndImage":u=_pageBuilder.BlockTextImages.find(n=>n.ElmId==i||i=="block"+n.Id);u&&(u.DisplayOrder=n+1);break;case"Gallery":f=_pageBuilder.BlockGalleries.find(n=>n.ElmId==i||i=="block"+n.Id);f&&(f.DisplayOrder=n+1);break;case"MasonryGallery":e=_pageBuilder.BlockMasonryGalleries.find(n=>n.ElmId==i||i=="block"+n.Id);e&&(e.DisplayOrder=n+1)}});hideUpDownBlock()}function hideUpDownBlock(){var n=$("#page_templates_builder .profile-pageblock");n.find("button.moveup").show();n.find("button.movedown").show();n.first().find("button.moveup").hide();n.last().find("button.movedown").hide()}function getBlocksForJumbTo(n,t){var r=$("#page_templates_builder .profile-pageblock"),i;r.length!=0&&(i=$(n),i.empty(),i.append('<option value="external">External link<\/option>'),$.each(r,function(n,r){var e=$(r).data("type"),u=$(r).data("id"),f=$(r).attr("id");f!=t&&i.append('<option value="'+(u?"#block"+u:"#"+f)+'">Block '+n+" ("+e+")<\/option>")}),i.not(".multi-select").select2({placeholder:"Please select"}))}function getUrlImage(n){var t=$("#api-uri").val();return isUUID(n)?t+n:n}function isUUID(n){let t=""+n;return(t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),t===null)?!1:!0}function getPageBuilderById(n){$.getJSON("/ProfilePage/GetJsonUserPageById?id="+n,function(n){_pageBuilder=n;_pageBuilder.BlockHeroes||(_pageBuilder.BlockHeroes=[]);_pageBuilder.BlockTextImages||(_pageBuilder.BlockTextImages=[]);_pageBuilder.BlockGalleries||(_pageBuilder.BlockGalleries=[]);_pageBuilder.BlockMasonryGalleries||(_pageBuilder.BlockMasonryGalleries=[]);$("#btnAddBlock").removeAttr("disabled")})}function addItemsGallary(n){$.each(n,function(n,t){var u,i,r;t.meta.id&&(u=$("#gallery-item-block").clone(),i=$(u),i.show(),r="item-"+UniqueId(5),$("#gallery-items").append(i),i.attr("id",r),i.find("input[name=Title]").val("Gallery item title"),i.find("textarea[name=Content]").val("Image caption content displayed here"),i.find("input[name=FeaturedImage]").val(t.meta.id),i.find("div.preview").css("background-image","url("+getUrlImage(t.meta.id)+")"),i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','gallery-items');"),i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'gallery-items')"),i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'gallery-items')"))});n.length>0?($("#gallery-intro").hide(),$("#gallery-items").show()):($("#gallery-intro").show(),$("#gallery-items").hide());hideUpDownFirstLastItem("gallery-items")}function addItemsMasonryGallary(n){$.each(n,function(n,t){var u,i,r;t.meta.id&&(u=$("#gallery-item-block").clone(),i=$(u),i.show(),r="item-"+UniqueId(5),$("#masonry-items").append(i),i.attr("id",r),i.find("input[name=Title]").val("Gallery item title"),i.find("textarea[name=Content]").val("Image caption content displayed here"),i.find("input[name=FeaturedImage]").val(t.meta.id),i.find("div.preview").css("background-image","url("+getUrlImage(t.meta.id)+")"),i.find("button.btn-delete").attr("onclick","removeGallaryItem('#"+r+"');"))});n.length>0?($("#masonry-intro").hide(),$("#masonry-items").show()):($("#gallery-intro").show(),$("#masonry-items").hide());$("#masonry-items div.item-block").first().find("button.btn-moveup").hide();$("#masonry-items div.item-block").last().find("button.btn-movedown").hide()}function removeItem(n,t){$(n).remove();$("#"+t+" div.item-block").first().find("button.btn-moveup").hide();$("#"+t+" div.item-block").last().find("button.btn-movedown").hide()}function hideUpDownFirstLastItem(n){var t=$("#"+n+" div.item-block");t.find("button.btn-moveup").show();t.find("button.btn-movedown").show();t.first().find("button.btn-moveup").hide();t.last().find("button.btn-movedown").hide()}function uploadImageBlock(n,t,i,r){var f=$(n).attr("id"),u=n.files;u&&u.length>0&&($(t).LoadingOverlay("show",{minSize:50}),UploadMediaS3ClientSide(f).then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$(i).val(n.objectKey);r?($(t).css("background-image","url("+getUrlImage(n.objectKey)+")"),$(t).css("background-size","cover")):($(t).attr("src",""),$(t).attr("src",getUrlImage(n.objectKey)));$(t).LoadingOverlay("hide",!0)}))}function uploadNoPreview(n,t){$("#"+n).LoadingOverlay("show");UploadMediaS3ClientSide(n).then(function(i){if(i.objectKey==="no_image"||i.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#"+t).val(i.objectKey);$("#"+n).LoadingOverlay("hide",!0)})}function initPluginPicker(n){$(n+" .fa-picker").iconpicker()}function removeHttps(n){var t=$(n).val(),i,r;t&&(i=new RegExp("http://","ig"),r=new RegExp("https://","ig"),$(n).val(t.replace(i,"").replace(r,"")))}var _pageBuilder;_pageBuilder={Id:0,PageTitle:"",Status:"IsDraft",BlockHeroes:[],BlockTextImages:[],BlockGalleries:[],BlockMasonryGalleries:[]};$(function(){function i(n,t){var i=n.split("."),r;i.length==1?_pageBuilder[n]=t:(r=_pageBuilder[i[0]],r[i[1]]=t)}function n(){var n=$("[data-bind]");n.on("change",function(){var n;n=$(this);i(n.data("bind"),n.val())})}$(document).on("updateBindableElements",n);n();var t=$("#hdfPageID").val();t!=0&&(hideUpDownBlock(),$("#btnAddBlock").attr("disabled",!0),getPageBuilderById(t));initPuginsGalary()});