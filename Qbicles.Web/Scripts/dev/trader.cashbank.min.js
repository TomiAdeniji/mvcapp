function onKeySearchChanged(n){filter.Key=$(n).val();setTimeout(function(){searchOnTableCashBank()},200)}function searchOnTableCashBank(){var i=[],t=$("#search_dt_cb").val().split(" "),n;if($("#search_dt_cb").val()!==""&&$("#search_dt_cb").val()!==null&&t.length>0)for(n=0;n<t.length;n++)t[n]!==""&&i.push(t[n]);$("#community-list").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#community-list").val("")}function initBKAccount(n,t){BKAccount.Id=n;BKAccount.Name=t}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");$("#accountId").val(t);BKAccount.Id=t;BKAccount.Name=i;$("#accountId").val(t);closeSelected();$("#app-bookkeeping-treeview").modal("hide")}function closeSelected(){BKAccount.Id?($(".accountInfo").empty(),$(".accountInfo").append(BKAccount.Name)):$(".accountInfo").empty();$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"))}function showChangeAccount(){setTimeout(function(){CollapseAccount()},1)}function CollapseAccount(){$(".jstree").jstree("close_all")}function initSelectedAccount(){setTimeout(function(){$(".selectaccount").removeClass("selectaccount");$(".accountid-"+BKAccount.Id).addClass("selectaccount")},1)}function ProcessCashBankAccount(){$.LoadingOverlay("show");var n=document.getElementById("cash-bank-icon").files;n&&n.length>0?UploadMediaS3ClientSide("cash-bank-icon").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#cash-bank-object-key").val(n.objectKey);$("#cash-bank-object-name").val(n.fileName);$("#cash-bank-object-size").val(n.fileSize);CashBankAccountSubmit()}):CashBankAccountSubmit()}function manageonclick(n){$.LoadingOverlay("show");window.location.href="/TraderCashBank/TraderCashAccount?id="+n+"&locationid="+$locationManageId.val()}function ShowTableCashBankValue(){$("#cashbank-content").LoadingOverlay("show");$("#cashbank-content").load("/TraderCashBank/TraderCashBankContents",function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#community-list-cash-bank").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#cashbank-content").LoadingOverlay("hide");setTimeout(function(){searchOnTableCashBank()},300)})}function LoadTableDataCashBank(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:"",processing:loadingoverlay_value},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keysearch:$("#search_dt_cb").val()})}},columns:i,order:[[r,"asc"]]})}function FilterDataCashBankByServerSide(){var n=[{name:"Image",data:"Image",render:function(n,t,i){return""+('<div class="table-avatar" style="background-image: url(\''+$("#api-uri").val()+i.Image+"&size=T');\">&nbsp;<\/div>")}},{name:"Name",data:"Name",orderable:!0,render:function(n,t,i){return""+('<h5 style="margin: 0; padding: 0 0 3px 0;">'+i.Name+"<\/h5>")}},{name:"BookkeepingAccount",data:"BookkeepingAccount",orderable:!1},{name:"FundsIn",data:"FundsIn",orderable:!1},{name:"FundsOut",data:"FundsOut",orderable:!1},{name:"Charges",data:"Charges",orderable:!1},{name:"Transactions",data:"Transactions",orderable:!1},{data:null,orderable:!1,render:function(n,t,i){var r='<div class="btn-group options">';return r+='<button type="button" class="btn btn-success dropdown-toggle"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a href="#" onclick="manageonclick('+i.Id+')">Manage<\/a><\/li>',i.BankmateType==0&&(r+='<li><a href="#" data-toggle="modal" onclick="AddEditTraderCashBank('+i.Id+')" >Edit<\/a><\/li>'),r+="<\/ul> <\/div>",i.AllowEdit?r:""}}];LoadTableDataCashBank("community-list-cash-bank","/TraderCashBank/GetCashBankContent",n,1);CallBackFilterDataCashBankServeSide()}function CallBackFilterDataCashBankServeSide(){$("#community-list-cash-bank").DataTable().ajax.reload()}var $cashAccountId=0,$locationManageId=$("#local-manage-select"),BKAccount={Id:0,Name:""},filter={Workgroup:"",Key:""};ClearAllModal=function(){$("#cashbank-transfer").empty();$("#app-trader-cashbank").empty();$("#cashbank-payment").empty()};AddEditTraderCashBank=function(n){$.LoadingOverlay("show");ClearAllModal();setTimeout(function(){$("#app-trader-cashbank").load("/TraderCashBank/TraderCashBankAddEdit?id="+n);$.LoadingOverlay("hide");$("#app-trader-cashbank").modal("toggle")},2e3)};SaveCashAccount=function(){if($("#form_cash_bank").valid()){if($("#cash-bank-icon").val()===""&&$("#cash-bank-id").val()==="0"){cleanBookNotification.error(_L("ERROR_MSG_618"),"Qbicles");return}var n={Id:$("#cash-bank-id").val(),Name:$("#cash-bank-name").val()};$.ajax({type:"post",url:"/TraderCashBank/TraderCashAccountNameCheck",data:{cashBank:n},dataType:"json",success:function(n){if(n.result===!1){$("#form_cash_bank").validate().showErrors({Name:n.msg});return}ProcessCashBankAccount()},error:function(){return}})}};CashBankAccountSubmit=function(){var n=new FormData($("#form_cash_bank")[0]);$.ajax({type:"post",cache:!1,url:"/TraderCashBank/SaveTraderCashAccount",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){},success:function(n){LoadingOverlayEnd();n.actionVal===1?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.createSuccess();ShowTableCashBankValue()},100)):n.actionVal===2?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.updateSuccess();ShowTableCashBankValue()},100)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){$.LoadingOverlay("hide");cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})};UploadImage=function(){UploadMediaS3ClientSide("form_specifics_icon").then(function(n){return n.objectKey})};DeleteTraderCashBank=function(){};$(function(){ShowTableCashBankValue();ClearAllModal()});