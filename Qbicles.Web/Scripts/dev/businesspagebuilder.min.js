function initPuginsGalary(){$("#page_templates_builder .nvgalleryowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}});$("#page_templates_builder .nvtestimonialsowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},600:{items:2},1024:{items:3}}})}function saveBusinessPageBuilder(n){_pageBuilder.Status=n;$("#frmpageBuilder").valid()&&($.LoadingOverlay("show"),$.each(_pageBuilder.BlockHeroes,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockFeatures,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockTextImages,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockPromotions,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockGalleries,function(n,t){t.Id>0&&(t.ElmId="")}),$.each(_pageBuilder.BlockTestimonials,function(n,t){t.Id>0&&(t.ElmId="")}),$.ajax({type:"POST",url:"/ProfilePage/SaveBusinessPageBuilder",data:{pageBuilder:_pageBuilder},success:function(t){t.result?(n=="IsActive"&&$("#btnDiscardChange").attr("disabled",!0),$("#hdfPageID").val(t.Object).trigger("change"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):!t.result&&t.msg?cleanBookNotification.error(t.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()}))}function addBlock(n){var u,i,t,r;$("#btnDiscardChange").removeAttr("disabled");u=$(n).clone();i=$(u);i.length>0&&(t=UniqueId(5),i.attr("id",t),r=i.data("type"),$("#newstart").hide(),$("#page_templates_builder").append(i),$("#"+t+" button.btn-edit-block").attr("onclick","bindDataForBlock('"+t+"','"+r+"')"),$("#"+t+" button.btn-delete-block").attr("onclick","removeBlock('"+t+"')"),$("#"+t+" button.moveup").attr("onclick","moveUpDown('"+t+"',true)"),$("#"+t+" button.movedown").attr("onclick","moveUpDown('"+t+"',false)"),$("#"+t).fadeIn(),$("#"+t+" .nvgalleryowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}}),$("#"+t+" .nvtestimonialsowl").owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},600:{items:2},1024:{items:3}}}),initDefaultBlockData(r,t),hideUpDownBlock())}function initDefaultBlockData(n,t){var r,u,f,e,o,i,s;switch(n){case"Hero":i=$("#page_templates_builder .profile-pageblock").length;r={ElmId:t,Id:0,HeroBackgroundType:"Gradient",HeroBackgroundColour:"#60a7bd",HeroGradientColour1:"#1dd8cf",HeroGradientColour2:"#8845f0",HeroBackGroundImage:"",HeroHeadingText:"Promotional <span>hero<\/span>",HeroHeadingFontSize:38,HeroHeadingColour:"#ffffff",HeroHeadingAccentColour:"#d0d265",HeroSubHeadingText:"With a strapline included",HeroSubHeadingFontSize:20,HeroSubHeadingColour:"#ffffff",HeroFeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/nvfeature.png",HeroLogo:"/Content/DesignStyle/img/pagebuilder/demos/mslogo.png",DisplayOrder:i==0?1:i+1,Type:"Hero",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockHeroes.push(r);break;case"Features":i=$("#page_templates_builder .profile-pageblock").length;u={ElmId:t,Id:0,HeadingText:"Subsection heading",HeadingFontSize:32,HeadingColour:"#224157",FeatureHeadingAccentColour:"#d0d265",SubHeadingText:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce sollicitudin ante et ante pellentesque, at ultrices ipsum aliquet. Vestibulum semper et justo sed auctor.",SubHeadingFontSize:16,SubHeadingColour:"#657581",FeatureItems:[{Id:0,FeatureTitle:"Feature one",FeatureContent:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin blandit tempor purus. Sed mollis, odio eu maximus iaculis, massa nunc porta orci, in porta erat leo quis risus. Etiam condimentum dolor a dolor rhoncus iaculis.",FeatureIcon:"fa fa-chalkboard",FeatureColour:"#333333",DisplayOrder:1}],DisplayOrder:i==0?1:i+1,Type:"FeatureList",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockFeatures.push(u);break;case"TextAndImage":i=$("#page_templates_builder .profile-pageblock").length;f={ElmId:t,Id:0,HeadingText:"Text panel <span>with image<\/span>",HeadingFontSize:32,HeadingColour:"#224157",HeadingAccentColour:"#d0d265",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec commodo augue a metus interdum, ac tincidunt sapien semper. Nam consequat lorem a quam viverra, eu ornare eros condimentum. Aenean pulvinar vitae ligula vitae vulputate. Morbi odio eros, tincidunt in luctus eget, facilisis a ante. Etiam lobortis erat at libero ultricies ultrices.",ContentFontSize:16,ContentColour:"#333333",IsIncludeButton:!0,ButtonText:"Button example",ButtonColour:"#2990ea",ButtonJumpTo:0,ExternalLink:"",FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/thinking.jpg",DisplayOrder:i==0?1:i+1,Type:"TextImage",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockTextImages.push(f);break;case"Promo":i=$("#page_templates_builder .profile-pageblock").length;e={ElmId:t,Id:0,HeadingText:"Big feature or promotion here",HeadingFontSize:46,HeadingColour:"#224157",HeadingAccentColour:"#d0d265",SubHeadingText:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla malesuada dolor ut arcu maximus, sit amet pretium neque scelerisque. Curabitur vel diam arcu. Aliquam egestas sem ut tincidunt porttitor. Quisque porta massa sed porttitor rhoncus.",SubHeadingFontSize:16,SubHeadingColour:"#657581",IsIncludeButton:!0,ButtonText:"Button example",ButtonColour:"#2990ea",ButtonJumpTo:0,ExternalLink:"",FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/promo-ex.jpg",Items:[{Id:0,Icon:"fa fa-check",Colour:"#5cb85c",Text:"Some descriptive text can be added here",DisplayOrder:1},{Id:0,Icon:"fa fa-check",Colour:"#5cb85c",Text:"Some descriptive text can be added here",DisplayOrder:2},{Id:0,Icon:"fa fa-check",Colour:"#5cb85c",Text:"Some descriptive text can be added here",DisplayOrder:3}],DisplayOrder:i==0?1:i+1,Type:"Promotion",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockPromotions.push(e);break;case"Gallery":i=$("#page_templates_builder .profile-pageblock").length;o={ElmId:t,Id:0,GalleryItems:[{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/bee.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:1},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/tree.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:2},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/cow.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:3},{Id:0,FeaturedImage:"/Content/DesignStyle/img/pagebuilder/demos/woman.jpg",Title:"Gallery item title",Content:"Image caption content displayed here",DisplayOrder:4}],DisplayOrder:i==0?1:i+1,Type:"Gallery",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockGalleries.push(o);break;case"Testimonial":i=$("#page_templates_builder .profile-pageblock").length;s={ElmId:t,Id:0,TestimonialItems:[{Id:0,PersonName:"Sarah Price",FurtherInfo:"Graphic designer",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin blandit tempor purus. Sed mollis, odio eu maximus iaculis, massa nunc porta orci, in porta erat leo quis risus. Etiam condimentum dolor a dolor rhoncus iaculis.",AvatarUri:"/Content/DesignStyle/img/pagebuilder/demos/av_1.jpg",DisplayOrder:1},{Id:0,PersonName:"Richard McAllister",FurtherInfo:"UX consultant",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin blandit tempor purus. Sed mollis, odio eu maximus iaculis, massa nunc porta orci, in porta erat leo quis risus. Etiam condimentum dolor a dolor rhoncus iaculis.",AvatarUri:"/Content/DesignStyle/img/pagebuilder/demos/av_2.jpg",DisplayOrder:2},{Id:0,PersonName:"Peter Jones",FurtherInfo:"Web content admin",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin blandit tempor purus. Sed mollis, odio eu maximus iaculis, massa nunc porta orci, in porta erat leo quis risus. Etiam condimentum dolor a dolor rhoncus iaculis.",AvatarUri:"/Content/DesignStyle/img/pagebuilder/demos/av_3.jpg",DisplayOrder:3}],DisplayOrder:i==0?1:i+1,Type:"Testimonial",ParentPage:{Id:_pageBuilder.Id}};_pageBuilder.BlockTestimonials.push(s)}}function bindDataForBlock(n,t){var r,h,e,f,u,s,i,o;switch(t){case"Hero":if(i="#pages-blocks-hero-edit",r=_pageBuilder.BlockHeroes.find(t=>t.ElmId==n||n=="block"+t.Id),r&&!r.ElmId)r.ElmId="block"+r.Id;else if(!r)return;h="";r.HeroBackgroundType==="SingleColour"?h="#bgcolour":r.HeroBackgroundType==="Gradient"?h="#bggradient":r.HeroBackgroundType==="Image"&&(h="#bgimage");$(i+" select[name=HeroBackgroundType]").val(h).change();$(i+" input[name=HeroBackgroundColour]").val(r.HeroBackgroundColour);$(i+" input[name=HeroGradientColour1]").val(r.HeroGradientColour1);$(i+" input[name=HeroGradientColour2]").val(r.HeroGradientColour2);$(i+" input[name=HeroHeadingAccentColour]").val(r.HeroHeadingAccentColour);$(i+" input[name=HeroBackGroundImage]").val(r.HeroBackGroundImage);$(i+" input[name=HeroHeadingText]").val(r.HeroHeadingText);$(i+" input[name=HeroHeadingFontSize]").val(r.HeroHeadingFontSize);$(i+" input[name=HeroHeadingColour]").val(r.HeroHeadingColour);$(i+" textarea[name=HeroSubHeadingText]").val(r.HeroSubHeadingText);$(i+" input[name=HeroSubHeadingFontSize]").val(r.HeroSubHeadingFontSize);$(i+" input[name=HeroSubHeadingColour]").val(r.HeroSubHeadingColour);$(i+" input[name=HeroFeaturedImage]").val(r.HeroFeaturedImage);$(i+" .preview-HeroFeaturedImage").attr("src",getUrlImage(r.HeroFeaturedImage));$(i+" input[name=HeroLogo]").val(r.HeroLogo);$(i+" .preview-HeroLogo").attr("src",getUrlImage(r.HeroLogo));$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$("#drag-drop-area").data("blockid",n);$(i).modal("show");break;case"Features":if(i="#pages-blocks-features-edit",e=_pageBuilder.BlockFeatures.find(t=>t.ElmId==n||n=="block"+t.Id),e&&!e.ElmId)e.ElmId="block"+e.Id;else if(!e)return;$(i+" input[name=HeadingText]").val(e.HeadingText);$(i+" input[name=HeadingFontSize]").val(e.HeadingFontSize);$(i+" input[name=HeadingColour]").val(e.HeadingColour);$(i+" input[name=FeatureHeadingAccentColour]").val(e.FeatureHeadingAccentColour);$(i+" input[name=SubHeadingText]").val(e.SubHeadingText);$(i+" input[name=SubHeadingFontSize]").val(e.SubHeadingFontSize);$(i+" input[name=SubHeadingColour]").val(e.SubHeadingColour);$("#features-Items").empty();$.each(e.FeatureItems,function(n,t){var u=$("#feaute-item-block").clone(),i=$(u),r;i.show();r="item-"+UniqueId(5);$("#features-Items").append(i);i.attr("id",r);i.find("input[name=FeatureTitle]").val(t.FeatureTitle);i.find("input[name=FeatureIcon]").val(t.FeatureIcon);i.find("input[name=FeatureColour]").val(t.FeatureColour);i.find("textarea[name=FeatureContent]").val(t.FeatureContent);i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','features-Items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'features-Items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'features-Items')")});hideUpDownFirstLastItem("features-Items");$(i+" button.btn-addfeature-item").attr("onclick","addItemFeature()");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");initPluginPicker(i);$(i).modal("show");break;case"TextAndImage":if(i="#pages-blocks-textimg-edit",f=_pageBuilder.BlockTextImages.find(t=>t.ElmId==n||n=="block"+t.Id),f&&!f.ElmId)f.ElmId="block"+f.Id;else if(!f)return;$(i+" input[name=HeadingAccentColour]").val(f.HeadingAccentColour);$(i+" input[name=HeadingText]").val(f.HeadingText);$(i+" input[name=HeadingFontSize]").val(f.HeadingFontSize);$(i+" input[name=HeadingColour]").val(f.HeadingColour);$(i+" input[name=Content]").val(f.Content);$(i+" input[name=ContentFontSize]").val(f.ContentFontSize);$(i+" input[name=ContentColour]").val(f.ContentColour);$(i+" input[name=IsIncludeButton]").prop("checked",f.IsIncludeButton);f.IsIncludeButton?$(".btn-options-30").show():$(".btn-options-30").hide();$(i+" input[name=ButtonText]").val(f.ButtonText);$(i+" input[name=ButtonColour]").val(f.ButtonColour);getBlocksForJumbTo(i+" select[name=ButtonJumpTo]",n);$(i+" select[name=ButtonJumpTo]").val(f.ButtonJumpTo=="0"?"external":f.ButtonJumpTo).change();$(i+" input[name=ExternalLink]").val(f.ExternalLink);$(i+" input[name=FeaturedImage]").val(f.FeaturedImage);$(i+" .preview-FeaturedImage").attr("src",getUrlImage(f.FeaturedImage));$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$(i).modal("show");break;case"Promo":if(i="#pages-blocks-promo-edit",u=_pageBuilder.BlockPromotions.find(t=>t.ElmId==n||n=="block"+t.Id),u&&!u.ElmId)u.ElmId="block"+u.Id;else if(!u)return;$(i+" input[name=HeadingAccentColour]").val(u.HeadingAccentColour);$(i+" input[name=HeadingText]").val(u.HeadingText);$(i+" input[name=HeadingFontSize]").val(u.HeadingFontSize);$(i+" input[name=HeadingColour]").val(u.HeadingColour);$(i+" input[name=SubHeadingText]").val(u.SubHeadingText);$(i+" input[name=SubHeadingFontSize]").val(u.SubHeadingFontSize);$(i+" input[name=SubHeadingColour]").val(u.SubHeadingColour);$(i+" input[name=IsIncludeButton]").prop("checked",u.IsIncludeButton);u.IsIncludeButton?$(".btn-options-50").show():$(".btn-options-50").hide();$(i+" input[name=ButtonText]").val(u.ButtonText);$(i+" input[name=ButtonColour]").val(u.ButtonColour);getBlocksForJumbTo(i+" select[name=ButtonJumpTo]",n);$(i+" select[name=ButtonJumpTo]").val(u.ButtonJumpTo=="0"?"external":u.ButtonJumpTo).change();$(i+" input[name=ExternalLink]").val(u.ExternalLink);$(i+" input[name=FeaturedImage]").val(u.FeaturedImage);$(i+" .preview-FeaturedImage").attr("src",getUrlImage(u.FeaturedImage));$("#promo-items").empty();$.each(u.Items,function(n,t){var u=$("#promo-item-block").clone(),i=$(u),r;i.show();r="item-"+UniqueId(5);$("#promo-items").append(i);i.attr("id",r);i.find("input[name=Icon]").val(t.Icon);i.find("input[name=Colour]").val(t.Colour);i.find("input[name=Text]").val(t.Text);i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','promo-items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'promo-items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'promo-items')")});hideUpDownFirstLastItem("promo-items");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");initPluginPicker(i);$(i).modal("show");break;case"Testimonial":if(i="#pages-blocks-testimonials-edit",s=_pageBuilder.BlockTestimonials.find(t=>t.ElmId==n||n=="block"+t.Id),s&&!s.ElmId)s.ElmId="block"+s.Id;else if(!s)return;$("#testimonial-items").empty();$.each(s.TestimonialItems,function(n,t){var f=$("#testimonial-item-block").clone(),i=$(f),r,u;i.show();r="item-"+UniqueId(5);$("#testimonial-items").append(i);i.attr("id",r);i.find("div.nvavatar").css("background-image","url("+getUrlImage(t.AvatarUri)+")");i.find("input[name=AvatarUri]").val(t.AvatarUri);i.find("input[name=PersonName]").val(t.PersonName);i.find("input[name=FurtherInfo]").val(t.FurtherInfo);i.find("textarea[name=Content]").val(t.Content);i.find("button.btn-changeimage").attr("onclick","$('#file"+r+"').trigger('click');");u=i.find("input[name=Avatar-File]");u.attr("id","file"+r);u.attr("onchange","uploadImageBlock(this,'#"+r+" .nvavatar','#"+r+"  input[name=AvatarUri]',true)");i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','testimonial-items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'testimonial-items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'testimonial-items')")});hideUpDownFirstLastItem("testimonial-items");$(i+" button.btn-addtestimonial-item").attr("onclick","addItemTestimonial()");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$(i).modal("show");break;case"Gallery":if(i="#pages-blocks-gallery-edit",o=_pageBuilder.BlockGalleries.find(t=>t.ElmId==n||n=="block"+t.Id),o&&!o.ElmId)o.ElmId="block"+o.Id;else if(!o)return;$("#gallery-items").empty();o.GalleryItems.length>0?($("#gallery-intro").hide(),$("#gallery-items").show()):($("#gallery-intro").show(),$("#gallery-items").hide());$.each(o.GalleryItems,function(n,t){var u=$("#gallery-item-block").clone(),i=$(u),r;i.show();r="item-"+UniqueId(5);$("#gallery-items").append(i);i.attr("id",r);i.find("input[name=Title]").val(t.Title);i.find("textarea[name=Content]").val(t.Content);i.find("input[name=FeaturedImage]").val(t.FeaturedImage);i.find("div.preview").css("background-image","url("+getUrlImage(t.FeaturedImage)+")");i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','gallery-items');");i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'gallery-items')");i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'gallery-items')")});hideUpDownFirstLastItem("gallery-items");$(i+" button.btn-update-block").attr("onclick","updateDataBlock('"+n+"','"+t+"')");$("#btnResetUppy").click();$(i).modal("show")}}function updateDataBlock(n,t){var e,f,i,u,s,o;$("#btnDiscardChange").removeAttr("disabled");switch(t){case"Hero":var i="#pages-blocks-hero-edit",r=_pageBuilder.BlockHeroes.find(t=>t.ElmId==n),h=$(i+" select[name=HeroBackgroundType]").val();h==="#bgcolour"?r.HeroBackgroundType="SingleColour":h==="#bggradient"?r.HeroBackgroundType="Gradient":h==="#bgimage"&&(r.HeroBackgroundType="Image");r.HeroBackgroundColour=$(i+" input[name=HeroBackgroundColour]").val();r.HeroGradientColour1=$(i+" input[name=HeroGradientColour1]").val();r.HeroGradientColour2=$(i+" input[name=HeroGradientColour2]").val();r.HeroHeadingAccentColour=$(i+" input[name=HeroHeadingAccentColour]").val();r.HeroBackGroundImage=$(i+" input[name=HeroBackGroundImage]").val();r.HeroHeadingText=$(i+" input[name=HeroHeadingText]").val();r.HeroHeadingFontSize=$(i+" input[name=HeroHeadingFontSize]").val();r.HeroHeadingColour=$(i+" input[name=HeroHeadingColour]").val();r.HeroSubHeadingText=$(i+" textarea[name=HeroSubHeadingText]").val();r.HeroSubHeadingFontSize=$(i+" input[name=HeroSubHeadingFontSize]").val();r.HeroSubHeadingColour=$(i+" input[name=HeroSubHeadingColour]").val();r.HeroFeaturedImage=$(i+" input[name=HeroFeaturedImage]").val();r.HeroLogo=$(i+" input[name=HeroLogo]").val();updateBlockPreview(n,r,t);$(i).modal("hide");break;case"Features":i="#pages-blocks-features-edit";e=_pageBuilder.BlockFeatures.find(t=>t.ElmId==n);e.HeadingText=$(i+" input[name=HeadingText]").val();e.HeadingFontSize=$(i+" input[name=HeadingFontSize]").val();e.HeadingColour=$(i+" input[name=HeadingColour]").val();e.FeatureHeadingAccentColour=$(i+" input[name=FeatureHeadingAccentColour]").val();e.SubHeadingText=$(i+" textarea[name=SubHeadingText]").val();e.SubHeadingFontSize=$(i+" input[name=SubHeadingFontSize]").val();e.SubHeadingColour=$(i+" input[name=SubHeadingColour]").val();o=$("#features-Items div.item-block");e.FeatureItems=[];o.each(function(n,t){var i=$(t),r=i.find("input[name=FeatureTitle]").val(),u=i.find("textarea[name=FeatureContent]").val(),f;r&&u&&(f={Id:0,FeatureTitle:r,FeatureContent:u,FeatureIcon:i.find("input[name=FeatureIcon]").val(),FeatureColour:i.find("input[name=FeatureColour]").val(),DisplayOrder:n+1},e.FeatureItems.push(f))});updateBlockPreview(n,e,t);$(i).modal("hide");break;case"TextAndImage":i="#pages-blocks-textimg-edit";f=_pageBuilder.BlockTextImages.find(t=>t.ElmId==n);f.HeadingAccentColour=$(i+" input[name=HeadingAccentColour]").val();f.HeadingText=$(i+" input[name=HeadingText]").val();f.HeadingFontSize=$(i+" input[name=HeadingFontSize]").val();f.HeadingColour=$(i+" input[name=HeadingColour]").val();f.Content=$(i+" textarea[name=Content]").val();f.ContentFontSize=$(i+" input[name=ContentFontSize]").val();f.ContentColour=$(i+" input[name=ContentColour]").val();f.IsIncludeButton=$(i+" input[name=IsIncludeButton]").prop("checked");f.ButtonText=$(i+" input[name=ButtonText]").val();f.ButtonColour=$(i+" input[name=ButtonColour]").val();s=$(i+" select[name=ButtonJumpTo]").val();f.ButtonJumpTo=s=="external"?0:s;f.ExternalLink=$(i+" input[name=ExternalLink]").val();f.FeaturedImage=$(i+" input[name=FeaturedImage]").val();updateBlockPreview(n,f,t);$(i).modal("hide");break;case"Promo":i="#pages-blocks-promo-edit";u=_pageBuilder.BlockPromotions.find(t=>t.ElmId==n);u.HeadingAccentColour=$(i+" input[name=HeadingAccentColour]").val();u.HeadingText=$(i+" input[name=HeadingText]").val();u.HeadingFontSize=$(i+" input[name=HeadingFontSize]").val();u.HeadingColour=$(i+" input[name=HeadingColour]").val();u.SubHeadingText=$(i+" textarea[name=SubHeadingText]").val();u.SubHeadingFontSize=$(i+" input[name=SubHeadingFontSize]").val();u.SubHeadingColour=$(i+" input[name=SubHeadingColour]").val();u.IsIncludeButton=$(i+" input[name=IsIncludeButton]").prop("checked");u.ButtonText=$(i+" input[name=ButtonText]").val();u.ButtonColour=$(i+" input[name=ButtonColour]").val();s=$(i+" select[name=ButtonJumpTo]").val();u.ButtonJumpTo=s=="external"?0:s;u.ExternalLink=$(i+" input[name=ExternalLink]").val();u.FeaturedImage=$(i+" input[name=FeaturedImage]").val();o=$("#promo-items div.item-block");u.Items=[];o.each(function(n,t){var i=$(t),r={Id:0,Icon:i.find("input[name=Icon]").val(),Colour:i.find("input[name=Colour]").val(),Text:i.find("input[name=Text]").val(),DisplayOrder:n+1};u.Items.push(r)});updateBlockPreview(n,u,t);$(i).modal("hide");break;case"Testimonial":var i="#pages-blocks-testimonials-edit",c=_pageBuilder.BlockTestimonials.find(t=>t.ElmId==n),o=$("#testimonial-items div.item-block");c.TestimonialItems=[];o.each(function(n,t){var i=$(t),r={Id:0,PersonName:i.find("input[name=PersonName]").val(),FurtherInfo:i.find("input[name=FurtherInfo]").val(),Content:i.find("textarea[name=Content]").val(),AvatarUri:i.find("input[name=AvatarUri]").val(),DisplayOrder:n+1};c.TestimonialItems.push(r)});updateBlockPreview(n,c,t);$(i).modal("hide");break;case"Gallery":var i="#pages-blocks-gallery-edit",l=_pageBuilder.BlockGalleries.find(t=>t.ElmId==n),o=$("#gallery-items div.item-block");l.GalleryItems=[];o.each(function(n,t){var i=$(t),r={Id:0,FeaturedImage:i.find("input[name=FeaturedImage]").val(),Title:i.find("input[name=Title]").val(),Content:i.find("textarea[name=Content]").val(),DisplayOrder:n+1};l.GalleryItems.push(r)});updateBlockPreview(n,l,t);$(i).modal("hide")}}function updateBlockPreview(n,t,i){var n="#"+n,h,c,l,r,f,a,u,e,o,s;switch(i){case"Hero":t.HeroBackgroundType=="Gradient"?$(n).css("background","linear-gradient(140deg, "+t.HeroGradientColour1+" 0%, "+t.HeroGradientColour2+" 100%)"):t.HeroBackgroundType=="SingleColour"?($(n).css("background","none"),$(n).css("background-color",t.HeroBackgroundColour)):t.HeroBackgroundType=="Image"&&($(n).css("background-image","url("+getUrlImage(t.HeroBackGroundImage)+")"),$(n).css("-webkit-background-size","cover"),$(n).css("-moz-background-size","cover"),$(n).css("-ms-background-size","cover"),$(n).css("-o-background-size","cover"),$(n).css("background-size","cover"));r=$(n+" h1.block-heading");r.html(t.HeroHeadingText);r.css("font-size",t.HeroHeadingFontSize+"px");r.css("color",t.HeroHeadingColour);f=$(n+" h1.block-heading span");f.css("color",t.HeroHeadingAccentColour);h=$(n+" h2.block-subheading");h.html(t.HeroSubHeadingText);h.css("font-size",t.HeroSubHeadingFontSize+"px");h.css("color",t.HeroSubHeadingColour);$(n+" img.nvlogo").attr("src",getUrlImage(t.HeroLogo));$(n+" img.nvfeature").attr("src",getUrlImage(t.HeroFeaturedImage));break;case"Features":r=$(n+" h1.block-heading");r.html(t.HeadingText);r.css("font-size",t.HeadingFontSize+"px");r.css("color",t.HeadingColour);f=$(n+" h1.block-heading span");f.css("color",t.FeatureHeadingAccentColour);c=$(n+" h5.block-subheading");c.html(t.SubHeadingText);c.css("font-size",t.SubHeadingFontSize+"px");c.css("color",t.SubHeadingColour);e=$(n+" div.nvfeaturelist");e.empty();$.each(t.FeatureItems,function(n,t){var i='<div class="col">';i+='<div class="nvicon" style="color:'+t.FeatureColour+'"><i class="'+t.FeatureIcon+'"><\/i><\/div>';i+='<div class="nvfeaturecontent">';i+='<h6 class="block-feature-heading">'+t.FeatureTitle+"<\/h6>";i+='<p class="block-feature-content">'+t.FeatureContent+"<\/p>";i+="<\/div>";i+="<\/div>";e.append(i)});break;case"TextAndImage":r=$(n+" h1.block-heading");r.html(t.HeadingText);r.css("font-size",t.HeadingFontSize+"px");r.css("color",t.HeadingColour);f=$(n+" h1.block-heading span");f.css("color",t.HeadingAccentColour);l=$(n+" p.block-content");l.html(t.Content);l.css("font-size",t.ContentFontSize+"px");l.css("color",t.ContentColour);u=$(n+" button.nvbutton");t.IsIncludeButton?u.show():u.hide();u.text(t.ButtonText);u.css("background-color",t.ButtonColour);t.ButtonJumpTo==0?u.attr("onclick",'location.href="https://'+t.ExternalLink+'"'):u.attr("onclick",'location.href="'+t.ButtonJumpTo+'"');$(n+" div.block-img").css("background-image","url("+getUrlImage(t.FeaturedImage)+")");break;case"Promo":r=$(n+" h1.block-heading");r.html(t.HeadingText);r.css("font-size",t.HeadingFontSize+"px");r.css("color",t.HeadingColour);f=$(n+" h1.block-heading span");f.css("color",t.HeadingAccentColour);a=$(n+" h3.block-subheading");a.html(t.SubHeadingText);a.css("font-size",t.SubHeadingFontSize+"px");a.css("color",t.SubHeadingColour);u=$(n+" button.nvbutton");t.IsIncludeButton?u.show():u.hide();u.text(t.ButtonText);u.css("background-color",t.ButtonColour);t.ButtonJumpTo==0?u.attr("onclick",'location.href="https://'+t.ExternalLink+'"'):u.attr("onclick",'location.href="'+t.ButtonJumpTo+'"');$(n+" img.promo-img").attr("src",getUrlImage(t.FeaturedImage));e=$(n+" ul.promo-features");e.empty();$.each(t.Items,function(n,t){var i="<li>";i+='<i class="'+t.Icon+'" style="color:'+t.Colour+'"><\/i> ';i+='<span class="promo-list-item">'+t.Text+"<\/span>";i+="<\/li>";e.append(i)});break;case"Testimonial":o=$(n+" div.nvtestimonialsowl");o.empty();$.each(t.TestimonialItems,function(n,t){var i='<div class="item"><div class="nvtestimonial">';i+='<div class="nvavatar" style="background-image: url(\''+getUrlImage(t.AvatarUri)+"');\">&nbsp;<\/div>";i+=' <h2 class="testimonial-name">'+t.PersonName+"<\/h2>";i+='<h3 class="testimonial-info">'+t.FurtherInfo+"<\/h3>";i+='<p class="testimonial-content">"'+t.Content+'"<\/p>';i+="<\/div><\/div>";o.append(i)});o.owlCarousel("destroy");o.owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},600:{items:2},1024:{items:3}}});break;case"Gallery":s=$(n+" div.nvgalleryowl");s.empty();$.each(t.GalleryItems,function(n,t){var i='<div class="item">';i+='<div class="nvgalleryitem" style="background-image: url(\''+getUrlImage(t.FeaturedImage)+"');\">";i+='<div class="nvcaption">';i+="<h5>"+t.Title+"<\/h5>";i+="<p>"+t.Content+"<\/p>";i+="<\/div><\/div><\/div>";s.append(i)});s.owlCarousel("destroy");s.owlCarousel({loop:!0,nav:!1,dots:!0,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,margin:30,responsive:{0:{items:1},768:{items:2},1400:{items:3}}})}}function removeBlock(n){var i=confirm("Are you sure you want to delete this block?"),t;if(i==!0){$("#btnDiscardChange").removeAttr("disabled");t=$("#"+n).data("type");switch(t){case"Hero":_pageBuilder.BlockHeroes=$.grep(_pageBuilder.BlockHeroes,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"Features":_pageBuilder.BlockFeatures=$.grep(_pageBuilder.BlockFeatures,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"TextAndImage":_pageBuilder.BlockTextImages=$.grep(_pageBuilder.BlockTextImages,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"Promo":_pageBuilder.BlockPromotions=$.grep(_pageBuilder.BlockPromotions,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"Gallery":_pageBuilder.BlockGalleries=$.grep(_pageBuilder.BlockGalleries,function(t){return t.ElmId!=n&&n!="block"+t.Id});break;case"Testimonial":_pageBuilder.BlockTestimonials=$.grep(_pageBuilder.BlockTestimonials,function(t){return t.ElmId!=n&&n!="block"+t.Id})}n="#"+n;$(n).remove();updateDisplayOrderBlocks()}}function moveUpDown(n,t){var r=$("#page_templates_builder .profile-pageblock"),u=$("#page_templates_builder .profile-pageblock").length,i=$("#"+n).index()-1;t&&i>0?(jQuery(r.eq(i-1)).before(jQuery(r.eq(i))),i=i-1):!t&&i<u&&(jQuery(r.eq(i+1)).after(r.eq(i)),i=i+1);updateDisplayOrderBlocks()}function moveUpDownItems(n,t,i){var u=$("#"+i+" .item-block"),e=u.length,r=$("#"+n).index(),f=u.eq(r);t&&r>0?(u.eq(r-1).before(f),r=r-1):!t&&r<e&&(u.eq(r+1).after(f),r=r+1);document.getElementById(f.attr("id")).scrollIntoView();hideUpDownFirstLastItem(i)}function updateDisplayOrderBlocks(){var n=$("#page_templates_builder .profile-pageblock");if(n.length==0){$("#newstart").show();return}$.each(n,function(n,t){var h=$(t).data("type"),i=$(t).attr("id"),r,u,f,e,o,s;switch(h){case"Hero":r=_pageBuilder.BlockHeroes.find(n=>n.ElmId==i||i=="block"+n.Id);r&&(r.DisplayOrder=n+1);break;case"Features":u=_pageBuilder.BlockFeatures.find(n=>n.ElmId==i||i=="block"+n.Id);u&&(u.DisplayOrder=n+1);break;case"TextAndImage":f=_pageBuilder.BlockTextImages.find(n=>n.ElmId==i||i=="block"+n.Id);f&&(f.DisplayOrder=n+1);break;case"Promo":e=_pageBuilder.BlockPromotions.find(n=>n.ElmId==i||i=="block"+n.Id);e&&(e.DisplayOrder=n+1);break;case"Gallery":o=_pageBuilder.BlockGalleries.find(n=>n.ElmId==i||i=="block"+n.Id);o&&(o.DisplayOrder=n+1);break;case"Testimonial":s=_pageBuilder.BlockTestimonials.find(n=>n.ElmId==i||i=="block"+n.Id);s&&(s.DisplayOrder=n+1)}});hideUpDownBlock()}function hideUpDownBlock(){var n=$("#page_templates_builder .profile-pageblock");n.find("button.moveup").show();n.find("button.movedown").show();n.first().find("button.moveup").hide();n.last().find("button.movedown").hide()}function getBlocksForJumbTo(n,t){var r=$("#page_templates_builder .profile-pageblock"),i;r.length!=0&&(i=$(n),i.empty(),i.append('<option value="external">External link<\/option>'),$.each(r,function(n,r){var e=$(r).data("type"),u=$(r).data("id"),f=$(r).attr("id");f!=t&&i.append('<option value="'+(u?"#block"+u:"#"+f)+'">Block '+n+" ("+e+")<\/option>")}),i.not(".multi-select").select2({placeholder:"Please select"}))}function getUrlImage(n){var t=$("#api-uri").val();return isUUID(n)?t+n:n}function isUUID(n){let t=""+n;return(t=t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),t===null)?!1:!0}function getPageBuilderById(n){$.getJSON("/ProfilePage/GetJsonBusinessPageById?id="+n,function(n){_pageBuilder=n;_pageBuilder.BlockHeroes||(_pageBuilder.BlockHeroes=[]);_pageBuilder.BlockPromotions||(_pageBuilder.BlockPromotions=[]);_pageBuilder.BlockTestimonials||(_pageBuilder.BlockTestimonials=[]);_pageBuilder.BlockTextImages||(_pageBuilder.BlockTextImages=[]);_pageBuilder.BlockGalleries||(_pageBuilder.BlockGalleries=[]);_pageBuilder.BlockFeatures||(_pageBuilder.BlockFeatures=[]);$("#btnAddBlock").removeAttr("disabled")})}function addItemsGallary(n){$.each(n,function(n,t){var u,i,r;t.meta.id&&(u=$("#gallery-item-block").clone(),i=$(u),i.show(),r="item-"+UniqueId(5),$("#gallery-items").append(i),i.attr("id",r),i.find("input[name=Title]").val("Gallery item title"),i.find("textarea[name=Content]").val("Image caption content displayed here"),i.find("input[name=FeaturedImage]").val(t.meta.id),i.find("div.preview").css("background-image","url("+getUrlImage(t.meta.id)+")"),i.find("button.btn-delete").attr("onclick","removeItem('#"+r+"','gallery-items');"),i.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+r+"',true,'gallery-items')"),i.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+r+"',false,'gallery-items')"))});n.length>0?($("#gallery-intro").hide(),$("#gallery-items").show()):($("#gallery-intro").show(),$("#gallery-items").hide());hideUpDownFirstLastItem("gallery-items")}function removeItem(n,t){$(n).remove();$("#"+t+" div.item-block").first().find("button.btn-moveup").hide();$("#"+t+" div.item-block").last().find("button.btn-movedown").hide()}function addItemFeature(){var i={Id:0,FeatureTitle:"",FeatureContent:"",FeatureIcon:"fa fa-chalkboard",FeatureColour:"#333333"},r=$("#feaute-item-block").clone(),n=$(r),t;n.show();t="item-"+UniqueId(5);$("#features-Items").append(n);n.attr("id",t);n.find("input[name=FeatureTitle]").val(i.FeatureTitle);n.find("input[name=FeatureIcon]").val(i.FeatureIcon);n.find("input[name=FeatureColour]").val(i.FeatureColour);n.find("textarea[name=FeatureContent]").val(i.FeatureContent);n.find("button.btn-delete").attr("onclick","removeItem('#"+t+"','features-Items');");n.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+t+"',true,'features-Items')");n.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+t+"',false,'features-Items')");hideUpDownFirstLastItem("features-Items");initPluginPicker("#features-Items")}function addItemTestimonial(){var i={Id:0,PersonName:"Sarah Price",FurtherInfo:"Graphic designer",Content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin blandit tempor purus. Sed mollis, odio eu maximus iaculis, massa nunc porta orci, in porta erat leo quis risus. Etiam condimentum dolor a dolor rhoncus iaculis.",AvatarUri:"/Content/DesignStyle/img/pagebuilder/demos/av_1.jpg",DisplayOrder:1},u=$("#testimonial-item-block").clone(),n=$(u),t,r;n.show();t="item-"+UniqueId(5);$("#testimonial-items").append(n);n.attr("id",t);n.find("div.nvavatar").css("background-image","url("+getUrlImage(i.AvatarUri)+")");n.find("input[name=AvatarUri]").val(i.AvatarUri);n.find("input[name=PersonName]").val(i.PersonName);n.find("input[name=FurtherInfo]").val(i.FurtherInfo);n.find("textarea[name=Content]").val(i.Content);n.find("button.btn-changeimage").attr("onclick","$('#file"+t+"').trigger('click');");r=n.find("input[name=Avatar-File]");r.attr("id","file"+t);r.attr("onchange","uploadImageBlock(this,'#"+t+" .nvavatar','#"+t+"  input[name=AvatarUri]',true)");n.find("button.btn-delete").attr("onclick","removeItem('#"+t+"','testimonial-items');");n.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+t+"',true,'testimonial-items')");n.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+t+"',false,'testimonial-items')");hideUpDownFirstLastItem("testimonial-items")}function addItemPromo(){var i={Id:0,Icon:"fa fa-check",Colour:"#5cb85c",Text:"Some descriptive text can be added here",DisplayOrder:1},r=$("#promo-item-block").clone(),n=$(r),t;n.show();t="item-"+UniqueId(5);$("#promo-items").append(n);n.attr("id",t);n.find("input[name=Icon]").val(i.Icon);n.find("input[name=Colour]").val(i.Colour);n.find("input[name=Text]").val(i.Text);n.find("button.btn-delete").attr("onclick","removeItem('#"+t+"','promo-items');");n.find("button.btn-moveup").attr("onclick","moveUpDownItems('"+t+"',true,'promo-items')");n.find("button.btn-movedown").attr("onclick","moveUpDownItems('"+t+"',false,'promo-items')");hideUpDownFirstLastItem("promo-items");initPluginPicker("#promo-items")}function hideUpDownFirstLastItem(n){var t=$("#"+n+" div.item-block");t.find("button.btn-moveup").show();t.find("button.btn-movedown").show();t.first().find("button.btn-moveup").hide();t.last().find("button.btn-movedown").hide()}function uploadImageBlock(n,t,i,r){var f=$(n).attr("id"),u=n.files;u&&u.length>0&&($(t).LoadingOverlay("show",{minSize:50}),UploadMediaS3ClientSide(f).then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$(i).val(n.objectKey);r?($(t).css("background-image","url("+getUrlImage(n.objectKey)+")"),$(t).css("background-size","cover")):($(t).attr("src",""),$(t).attr("src",getUrlImage(n.objectKey)));$(t).LoadingOverlay("hide",!0)}))}function uploadNoPreview(n,t){$("#"+n).LoadingOverlay("show");UploadMediaS3ClientSide(n).then(function(i){if(i.objectKey==="no_image"||i.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#"+t).val(i.objectKey);$("#"+n).LoadingOverlay("hide",!0)})}function initPluginPicker(n){$(n+" .fa-picker").iconpicker()}function removeHttps(n){var t=$(n).val(),i,r;t&&(i=new RegExp("http://","ig"),r=new RegExp("https://","ig"),$(n).val(t.replace(i,"").replace(r,"")))}var _pageBuilder;_pageBuilder={Id:0,PageTitle:"",Status:"IsDraft",BlockHeroes:[],BlockPromotions:[],BlockTestimonials:[],BlockTextImages:[],BlockGalleries:[],BlockFeatures:[]};$(function(){function i(n,t){var i=n.split("."),r;i.length==1?_pageBuilder[n]=t:(r=_pageBuilder[i[0]],r[i[1]]=t)}function n(){var n=$("[data-bind]");n.on("change",function(){var n;n=$(this);i(n.data("bind"),n.val())})}$(document).on("updateBindableElements",n);n();var t=$("#hdfPageID").val();t!=0&&(hideUpDownBlock(),$("#btnAddBlock").attr("disabled",!0),getPageBuilderById(t));initPuginsGalary()});