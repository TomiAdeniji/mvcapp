function SocialIdeaAdd(){$(".previewimgidea").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});var n=$("#frm-idea-theme");n.validate({rules:{Name:{required:!0,minlength:5,maxlength:35},Explanation:{required:!0,maxlength:200},Url:{url:!0}}})}function SocialIdeaAutoGenerateFolderName(){$.getJSON("/SalesMarketingIdea/AutoGenerateFolderName",function(n){n&&$("#ideaFolderName").val(n)})}function SocialMarketingIdeaMediaSave(n){$form_media_addedit.valid()&&$.ajax({url:"/Medias/DuplicateMediaNameCheck",data:{qbicleId:n,mediaId:0,MediaName:$("#form_media_smresource input[name=name]").val()},type:"GET",dataType:"json"}).done(function(n){n.result?$form_media_addedit.validate().showErrors({name:"Name of Media already exists."}):ProcessSaleMarketingIdeaResource()}).fail(function(){$form_media_addedit.validate().showErrors({name:_L("ERROR_MSG_75")})})}function ProcessSaleMarketingIdeaResource(){$.LoadingOverlay("show");var n=document.getElementById("sm-idea-resource-upload-image").files;n&&n.length>0?UploadMediaS3ClientSide("sm-idea-resource-upload-image").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-idea-resource-object-key").val(n.objectKey);$("#sm-idea-resource-object-name").val(n.fileName);$("#sm-idea-attribute-object-size").val(n.fileSize);SubmitSocialMediaBranchResourceSaveMedia()}):($("#sm-idea-resource-object-key").val(""),$("#sm-idea-resource-object-name").val(""),$("#sm-idea-resource-object-size").val(""),SubmitSocialMediaBranchResourceSaveMedia())}function SocialMediasByIdea(n,t){$.LoadingOverlay("show");var i=$("#sl-media-type").val();$.ajax({type:"post",url:"/SalesMarketingIdea/LoadMediasByIdea",datatype:"json",data:{fid:n,qid:t},success:function(n){if(n){var t=$("#idea-content");t.html(n);totop();LoadingOverlayEnd()}},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function SocialIdeaAddLink(){var t=$("#frm-idea-theme input[name=Url]"),n,i;t.valid()&&(n=extractHostname(t),$('#ideaLinks tr[lnkUrl="'+n+'"]').length==0?($("#ideaLinks").show(),i='<tr lnkUrl="'+n+'"><td><a href="'+n+'" target="_blank"><i class="fa fa-external-link"><\/i> &nbsp; '+n+'<\/a><\/td><td> <button class="btn btn-danger" onclick="SocialIdeaRemoveLink(this)"><i class="fa fa-trash"><\/i><\/button><\/td><\/tr>',$("#ideaLinks").append(i),$(".links-associate").show(),t.val("")):t.val(""))}function SocialIdeaRemoveLink(n){$(n).parent().parent().remove();$("#ideaLinks tr").length==1&&$("#ideaLinks").hide()}function extractHostname(n){var t=document.createElement("a");return(t.href=$(n).val(),t.origin)?t.origin:""}function SocialCreateDiscussion(){isBusyAddTaskForm||$("#frm-create-discussion").submit(function(n){n.preventDefault();$.LoadingOverlay("show");$.ajax({type:"post",url:"/Discussions/SaveDiscussion",datatype:"json",data:{ideaId:$("#ideaId").val(),openingmessage:$("#ds_openingmessage").val(),isexpiry:$("#ds_isexpiry").prop("checked"),expirydate:$("#ds_expirydate").val()},beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){var t,i;n.result?($(".new-discuss").hide(),t=$("#btnJoinDiscussion"),n.Object.Id>0&&(i=t.attr("href")+"?disId="+n.Object.Id,t.attr("href",i),t.show()),cleanBookNotification.success(_L("ERROR_MSG_196"),"Sales Marketing"),$("#create-discussion").modal("hide")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()}})})}function LoadCampaignsInTheme(){$("#community-list").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#community-list").LoadingOverlay("show"):$("#community-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketingIdea/LoadCampaignsInTheme",type:"POST",data:function(n){return $.extend({},n,{themeId:$("#ideaId").val(),types:$("#campaignType").val(),search:$("#searchCampaign").val()})}},columns:[{data:"PostTitle",orderable:!1},{data:"CampaignName",orderable:!1},{data:"Type",orderable:!1},{data:"StrDateOfIssue",orderable:!1},{data:null,orderable:!1,render:function(n,t,i){var r;return i.Status=="Complete"?'<span class="label label-lg label-success">Complete<\/span>':'<span class="label label-lg label-primary">Queued<\/span>'}},{data:null,orderable:!1,render:function(n,t,i){var r="";return r=i.Type=="Automated Social"?"/SalesMarketing/SocialPostInApp?id="+i.PostId:i.Type=="Manual Social"?"/SalesMarketing/ManualSocialPostInApp?id="+i.PostId:"/SalesMarketing/EmailPostInApp?id="+i.PostId,'<button class="btn btn-info" onclick="window.location.href=\''+r+'\';"><i class="fa fa-eye"><\/i> &nbsp; View Post<\/button>'}}],initComplete:function(){$("#community-list").DataTable().ajax.reload()}})}function readImgURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}function ProcessSMIdea(){var i=$("#frm-idea-theme select[name=Type]").val(),n,t;if(!i){$frm_idea_theme.validate().showErrors({Type:"This field is required."});return}if(n=$("#frm-idea-theme select[name=ResourcesFolder]").val(),!n){$frm_idea_theme.validate().showErrors({ResourcesFolder:"This field is required."});return}if(n=="0"&&!$("#ideaFolderName").val()){$frm_idea_theme.validate().showErrors({FolderName:"This field is required."});return}$("#frm-idea-theme").valid()&&($.LoadingOverlay("show"),t=document.getElementById("sm-idea-upload-media").files,t&&t.length>0?UploadMediaS3ClientSide("sm-idea-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-idea-object-key").val(n.objectKey);$("#sm-idea-object-name").val(n.fileName);$("#sm-idea-object-size").val(n.fileSize);SubmitSMIdea()}):($("#sm-idea-object-key").val(""),$("#sm-idea-object-name").val(""),$("#sm-idea-object-size").val(""),SubmitSMIdea()))}function SubmitSMIdea(){var n=new FormData($("#frm-idea-theme")[0]);$("#ideaLinks tr[lnkUrl]").each(function(){n.append("Links[]",$(this).attr("lnkUrl"))});$.ajax({type:"post",cache:!1,url:"/SalesMarketingIdea/SaveIdea",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-idea-add").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_198"),"Sales Marketing")):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}var $form_media_addedit=$("#form_media_sm_idea_resource"),isBusyAddTaskForm=!1;SubmitSocialMediaBranchResourceSaveMedia=function(){var n=new FormData($form_media_addedit[0]);n.append("qbicleId",$("#media-qbicleId").val());$.ajax({type:"post",cache:!1,url:"/SalesMarketing/SaveCampaignResource",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#create-resource").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_197"),"Sales Marketing"),SocialMediasByIdea($("#hdfmediaFolderId").val(),$("#media-qbicleId").val()),$form_media_addedit.trigger("reset")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){LoadingOverlayEnd();isBusyAddTaskForm=!1})};$(document).ready(function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});LoadCampaignsInTheme();SocialIdeaAdd();SocialCreateDiscussion()});