function LoadModalSegment(n){$("#app-marketing-segment-add").load("/SalesMarketingSegment/GenerateModalSegmentAddEdit",{segmentId:n},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#segmentType").select2({placeholder:"Please select"});$("#frm-segment").validate({ignore:[],rules:{Name:{required:!0,maxlength:150,minlength:3},Summary:{maxlength:250}},invalidHandler:function(){$('#segment-1 label.error:not([style*="display: none"])').length!=0?$('#tabSegment a[href="#segment-1"]').tab("show"):$('#segment-2 label.error:not([style*="display: none"])').length!=0&&$('#tabSegment a[href="#segment-2"]').tab("show")}})})}function SocialLoadOptionVal(n,t){var u=$(n).val(),i,r;if(u){if(i=[],$(".criteria-el").each(function(n){var t=$('.criteria-el select[name="Criterias['+n+'].CriteriaId"]').val();t&&i.push(t)}),r=i.filter(function(n){return n==u}),r&&r.length>1){cleanBookNotification.error(_L("ERROR_MSG_205"),"Sales Marketing");$(n).val("").change();return}$.ajax({url:"/SalesMarketingSegment/GetOptionValuesByCriteriaId",type:"get",data:{criteriaId:$(n).val()},error:function(){isBusyAddTaskForm=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},success:function(n){if(n.length>0){var i=$("#"+t);$("#"+t+" option").remove();$.each(n,function(n,t){i.append('<option value="'+t.id+'">'+t.text+"<\/option>")});i.multiselect("destroy");i.hide();i.multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}}})}}function SocialMoreCriteria(){var t=$("#more-criteria-content .criteria-el").length+1,n=[];$(".item-criterial").each(function(){var t=$(this).val();if(t)n.push(t);else{cleanBookNotification.error(_L("ERROR_MSG_370"),"Sales Marketing");return}});$.ajax({url:"/SalesMarketingSegment/GenerateMoreCriteria",type:"get",data:{index:t,criterias:JSON.stringify(n)},error:function(){isBusyAddTaskForm=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},success:function(n){if(n){var t=$(n);$("#more-criteria-content div.criteria-el").length==0&&t.find(".lblAnd").remove();$("#more-criteria-content").append(t);$(".select2").select2({placeholder:"Please select"});$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}}})}function SocialGenerateList(n){var t,i,r;$("#frm-segment").valid()&&(t=[],$(".criteria-el").each(function(n){var i=$('.criteria-el select[name="Criterias['+n+'].CriteriaId"]').val(),r=$('.criteria-el select[name="Criterias['+n+'].CriteriaValues"]').val();i&&r&&t.push({CriteriaId:i,CriteriaValues:r})}),i=$("#segment-1 select[name=Areas]").val(),r={clauses:t,areaIds:i?i:[],cContacts:n},$('#tabSegment a[href="#segment-3"]').tab("show"),$("#lst-contact-content").load("/SalesMarketingSegment/GenerateListContact",r,function(){$("#lst-contacts").DataTable({destroy:!0,responsive:!0,order:[[0,"asc"]],language:{lengthMenu:"_MENU_ &nbsp; per page"}});$("#lst-contacts").on("draw.dt",function(){$("#lst-contacts tbody input:checkbox").bootstrapToggle()});$("#lst-contacts tbody input:checkbox").bootstrapToggle()}))}function bindValCheckbox(n){var t=$(n);t.prop("checked")?$("#hdfSelectContacts option[value='"+t.val()+"']").attr("selected","selected"):$("#hdfSelectContacts option[value='"+t.val()+"']").removeAttr("selected")}function SocialRefreshContacts(){$("#app-marketing-segment-add").modal("show");$("#btnContactsGenerateList").trigger("click");$('#tabSegment a[href="#segment-3"]').tab("show")}var isBusyAddTaskForm=!1;ProcessSegmentAdd=function(){if($("#frm-segment").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-segment-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-segment-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-segment-object-key").val(n.objectKey);$("#sm-segment-object-name").val(n.fileName);$("#sm-segment-object-size").val(n.fileSize);SubmitSegmentDetail()}):($("#sm-segment-object-key").val(""),$("#sm-segment-object-name").val(""),$("#sm-segment-object-size").val(""),SubmitSegmentDetail())}};SubmitSegmentDetail=function(){var n=new FormData($("#frm-segment")[0]);$.ajax({type:"post",cache:!1,url:"/SalesMarketingSegment/SaveSegment",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_204"),"Sales Marketing"),location.reload()):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})};$(document).ready(function(){LoadModalSegment($("#hdfIdSm").val())});