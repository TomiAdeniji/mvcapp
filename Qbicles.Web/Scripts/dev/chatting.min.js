function StopTyping(){TypingNotification(!1);clearTimeout($typingTimer)}function TypingNotification(n){n&&($canSend2SignalR=!1,setTimeout(function(){$canSend2SignalR=!0},$throttleTime));var t="";t=$chattingType=="Order"?$("#order-chat-to-users").val():$connectedC2C;$.ajax({type:"GET",url:"/QbicleComments/SignalRTyping?toUsers="+t+"&typing="+n+"&discussionId="+$discussionId,dataType:"json",success:function(){},error:function(){}}).always(function(){})}function ChatCommunity(){var n=$("#post-text").val(),t;if(/(\<\w*)((.*\>)|(.*\<\/\w*\>)|(\>))/gm.test(n)){cleanBookNotification.error(_L("ERROR_MSG_INVALID_POST"),"Qbicles");return}isDisplayFlicker(!0);resetPostInput();t="General";$.ajax({url:"/QbicleComments/AddPostToTopic",data:{message:n,topicName:t},type:"POST",success:function(n){n.result?(n.msg!=""&&(isDisplayFlicker(!1),htmlActivityRender(n.msg,0)),resetPostInput(),qbicleStreamToTop()):cleanBookNotification.error(_L("ERROR_MSG_133"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles");$(".general-state").show();$(".loading-state").hide();isDisplayFlicker(!1)}})}function ChatQbicle(){var t=$("#post-text").val(),n;if(/(\<\w*)((.*\>)|(.*\<\/\w*\>)|(\>))/gm.test(t)){cleanBookNotification.error(_L("ERROR_MSG_INVALID_POST"),"Qbicles");return}isDisplayFlicker(!0);resetPostInput();n=$("#toppic-value").val();$.ajax({url:"/QbicleComments/AddPostWithTopicId",data:{message:t,topicId:n},type:"POST",success:function(t){t.result?(t.msg!=""&&(isDisplayFlicker(!1),htmlActivityRender(t.msg,0)),resetPostInput(),SetTopic(n),qbicleStreamToTop()):cleanBookNotification.error(_L("ERROR_MSG_133"),"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles");$(".general-state").show();$(".loading-state").hide();isDisplayFlicker(!1)}})}function qbicleStreamToTop(){var n=$("#dashboard-page-display");$(document).width()>768&&n&&$(window).scrollTop(0)}function ChatFromOrder(n){$messageOrderChat.val()&&!$("#addcomment-error").is(":visible")&&(isPlaceholder(!0,"#list-comments-discussion"),$messageOrderButton.attr("disabled",!0),$.ajax({url:"/QbicleComments/AddComment2DiscussionOrder",data:{message:$messageOrderChat.val(),disKey:n},type:"POST",success:function(n){n.result&&(n.msg!=""&&(isDisplayFlicker(!1),$("#list-comments-discussion").prepend(n.msg)),$messageOrderChat.val(""));$messageOrderButton.attr("disabled",!1)},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isPlaceholder(!1,"")}}).always(function(){$messageOrderButton.attr("disabled",!1)}))}function initEmoji(n){var t=$(n).emojioneArea({inline:!0,pickerPosition:"bottom",autocomplete:!0,events:{keyup:function(t,i){let r=$(n)[0].emojioneArea.getText();console.log(r);$(n).val(r).trigger("keyup");i.which===13&&$("#button-post-submit").trigger("click")}}});t[0].emojioneArea.on("emojibtn.click",function(){$messageButton.attr("disabled",!1)})}function resetPostInput(){let n=$messageChat[0].emojioneArea;n?($messageChat[0].emojioneArea.setText(""),$messageChat.trigger("keyup")):$messageChat.val("")}function ChatFromProviderB2B(n){var t=$("#txt-comment-item"),i=$("#btn-comment-item"),u=$(".heading-comment"),r=[];r.push(u.text(),t.val());t.val()&&!$("#addcomment-error").is(":visible")&&(isPlaceholder(!0,"#list-comments-discussion"),i.attr("disabled",!0),$.ajax({url:"/QbicleComments/AddBulkComment2DiscussionOrder",data:{messages:r,disKey:n},type:"POST",success:function(n){n.result&&(n.Object!=null&&(isDisplayFlicker(!1),n.Object.forEach(n=>{$("#list-comments-discussion").prepend(n)})),t.val(""));i.attr("disabled",!1);$("#b2b-seller-add-item").modal("hide")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isPlaceholder(!1,"")}}).always(function(){i.attr("disabled",!1)}))}var $chattingType=$("#chatting-type").val(),$messageButton=$("#button-post-submit"),$messageChat=$("#post-text"),$discussionId=$("#order-discussion-id").val(),$throttleTime=5e3,$canSend2SignalR=!0,$typingTimer,$doneTypingInterval=2e4,$messageOrderChat,$messageOrderButton;$messageChat.keyup(function(){var n=$messageChat.val();(n&&n.length>0?n.length<=1e3?$messageButton.attr("disabled",!1):$messageButton.attr("disabled",!0):$messageButton.attr("disabled",!0),$chattingType=="C2C")&&(clearTimeout($typingTimer),n&&n.length>0?$canSend2SignalR&&TypingNotification(!0):TypingNotification(!1),$canSend2SignalR||($typingTimer=setTimeout(StopTyping,$doneTypingInterval)))});$messageChat.keypress(function(n){var t=n.which;t===13&&(clearTimeout($typingTimer),$chattingType=="Qbicle"?ChatQbicle():ChatCommunity())});$messageOrderChat=$("#txt-comment-order");$messageOrderButton=$("#message-order-button");$messageOrderChat.keyup(function(){clearTimeout($typingTimer);$messageOrderChat.val()&&$messageOrderChat.val().length>0?($messageOrderChat.val().length>1500?($("#addcomment-error").show(),$messageOrderButton.attr("disabled",!0)):($("#addcomment-error").hide(),$messageOrderButton.attr("disabled",!1)),$canSend2SignalR&&TypingNotification(!0)):($messageOrderButton.attr("disabled",!0),TypingNotification(!1));$canSend2SignalR||($typingTimer=setTimeout(StopTyping,$doneTypingInterval))});