function loadMoreCommentTask(n,t){$.ajax({url:"/Qbicles/LoadMoreActivityPosts",type:"POST",data:{activityKey:n,size:postDisplayedCount*t},dataType:"html",success:function(n){n.result?($("#list-comments-task").append(n.msg),postDisplayedCount=postDisplayedCount+t,n.actionVal<=postDisplayedCount&&$("#btn-load-more-comment-task").hide()):cleanBookNotification.error(_L("ERROR_MSG_58"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function loadMoreMediaTask(n){$.ajax({url:"/TransactionMatching/LoadMoreMedia",data:{pageSize:mediaDisplayedCount+n},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(t){if(t===""){$("#btnLoadMedias").remove();return}$("#list-medias").append(t).hide().fadeIn(250);mediaDisplayedCount=mediaDisplayedCount+n},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function MethodCheck(n,t){switch(t){case"chkManyToMany":$ManyToMany=n.checked;break;case"chkReferenceAndDate":$ReferenceAndDate=n.checked;$("#ReferenceAndDateGroup").toggle(this.checked);n.checked?($("#chkReferenceToReference1AndDate").prop("checked",!0),$("#chkReferenceToDescriptionAndDate").prop("checked",!0),$ReferenceToReference1AndDate=!0,$ReferenceToDescriptionAndDate=!0):($("#chkReferenceToReference1AndDate").prop("checked",!1),$("#chkReferenceToDescriptionAndDate").prop("checked",!1),$ReferenceToReference1AndDate=!1,$ReferenceToDescriptionAndDate=!1);break;case"chkReferenceToReference1AndDate":$ReferenceToReference1AndDate=n.checked;break;case"chkReferenceToDescriptionAndDate":$ReferenceToDescriptionAndDate=n.checked;break;case"chkReference":$Reference=n.checked;n.checked?$("#reference").css({display:"block"}):($("#reference").css({display:"none"}),$("#chkReferenceDate").prop("checked",!1));break;case"chkReferenceToReference1":$ReferenceToReference1=n.checked;break;case"chkReferenceToDescription":$ReferenceToDescription=n.checked;break;case"chkDescriptionAndDate":$DescriptionAndDate=n.checked;break;case"chkDescription":$Description=n.checked;n.checked?$("#description").css({display:"block"}):($("#description").css({display:"none"}),$("#chkDecriptionDate").prop("checked",!1));break;case"chkAmountAndDate":$AmountAndDate=n.checked;break;case"chkReversals":$Reversals=n.checked}}function RecalculatedUnmach(){$.ajax({type:"post",url:"/TransactionMatching/RecalculatedUnmach",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){n.result==!0?($("#manual_match").hide(),$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$sumDebitAmount.val(0),$sumCreditAmount.val(0),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$reconcileType="",$(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""),$progressMatching.empty(),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles")}})}function InitStartDate(){var n=null,t=null,i=new Date;t=i.getDate()+"/"+i.getMonth()+"/"+i.getFullYear();$.ajax({type:"post",url:"/TransactionMatching/CalculatingStartDate",dataType:"json",data:{accountIdA:$hidden_accountId,accountIdB:$hidden_accountId2,selectedDate:n,taskId:$hidden_TaskId},success:function(i){var r=$("#hddaterang").attr("dateFormat");n=i.Object?i.Object:t;$("#lblStartDate").text(n+" to");$("#hddaterang").attr("enddate",t);$("#hddaterang").attr("stardate",n)}})}function CalculateDateRange(n,t,i){var r=null,u=null;i===!0?(r=n.split("-")[0].replace(" ",""),u=n.split("-")[1].replace(" ","")):(r=t.startDate.format("MM/DD/YYYY"),u=t.endDate.format("MM/DD/YYYY"));$.ajax({type:"post",url:"/TransactionMatching/CalculatingStartDate",dataType:"json",data:{accountIdA:$hidden_accountId,accountIdB:$hidden_accountId2,selectedDate:u,taskId:$hidden_TaskId},success:function(n){var f=$("#hddaterang").attr("dateFormat");r=n.Object?n.Object:u;i===!0?($("#lblStartDate").text(r+" to"),$("#hddaterang").attr("enddate",u),$("#hddaterang").attr("stardate",r)):($("#hddaterang").attr("enddate",t.endDate.format(f)),$("#hddaterang").attr("stardate",r))}})}function Review_matches_record(n){$.LoadingOverlay("show");$.ajax({type:"post",url:"/TransactionMatching/ReviewMatches",dataType:"json",data:{TransactionanalysistaskId:$hidden_TransactionMatchingTaskId,matchedAuto:n,TransactionMatchingTypeId:$hidden_TransactionMatchingTypeId},success:function(t){var i,r;if(t.result==!0)if($("#manual_match").hide(),$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$sumDebitAmount.val(0),$sumCreditAmount.val(0),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$reconcileType="",$(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""),n)for($div_review_matches_auto.empty(),$div_review_matches_auto.append(t.retDivMatched),$modal_review_matches_Title.text($("input[name='modal_Automatically_title']").val()),i=0;i<t.tableCount;i++)$("#tableMatched_"+i).dataTable().fnDestroy(),r=$("#tableMatched_"+i).DataTable({responsive:!0,lengthChange:!1,pageLength:10,order:[]});else for($div_review_matches_manual.empty(),$div_review_matches_manual.append(t.retDivMatched),$modal_review_matches_Title.text($("input[name='modal_Manually_title']").val()),i=0;i<t.tableCount;i++)$("#tableMatched_"+i).dataTable().fnDestroy(),r=$("#tableMatched_"+i).DataTable({responsive:!0,lengthChange:!1,pageLength:10,order:[]});else cleanBookNotification.error(_L("ERROR_MSG_64"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_64"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ManualMatchClick(){$.ajax({type:"post",url:"/TransactionMatching/ShowUnmatch",dataType:"json",data:{TransactionanalysistaskId:$hidden_TransactionMatchingTaskId,matchingtype:$("#transactionMatchingTypeId").val()},success:function(n){var r,t,i;n.result==!0?(_transactionRecords=[],$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$sumDebitAmount.val(0),$sumCreditAmount.val(0),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$reconcileType="",$(".alert_matches").removeClass("active"),$("#manual_match").show(),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""),$(".clear-transaction").css({display:"block"}),r=$("#transactionMatchingTypeId").val(),n.table_creditA==""&&n.table_debitB==""?$("#creditAdebitB").hide():($("#creditAdebitB").show(),$table_creditA.find("tbody").find("tr").remove(),$table_creditA.find("tbody").append(n.table_creditA),n.table_creditA==""?$("#div_creditA").css("background-color","gainsboro"):$("#div_creditA").css("background-color","#fff"),$table_debitB.find("tbody").find("tr").remove(),$table_debitB.find("tbody").append(n.table_debitB),n.table_debitB==""?$("#div_debitB").css("background-color","gainsboro"):$("#div_debitB").css("background-color","#fff"),t=Math.max($("#div_creditA").height(),$("#div_debitB").height()),$("#div_creditA").height(t),$("#div_debitB").height(t),$("#Sum_CreditsA").html(n.Sum_CreditsA),$("#Sum_DebitB").html(n.Sum_DebitB)),n.table_debitA==""&&n.table_creditB==""?$("#debitAcreditB").hide():($("#debitAcreditB").show(),$table_debitA.find("tbody").find("tr").remove(),$table_debitA.find("tbody").append(n.table_debitA),n.table_debitA==""?$("#div_debitA").css("background-color","gainsboro"):$("#div_debitA").css("background-color","#fff"),$table_creditB.find("tbody").find("tr").remove(),$table_creditB.append(n.table_creditB),n.table_creditB==""?$("#div_creditB").css("background-color","gainsboro"):$("#div_creditB").css("background-color","#fff"),i=Math.max($("#div_debitA").height(),$("#div_creditB").height()),$("#div_debitA").height(i),$("#div_creditB").height(i),$("#Sum_CreditsB").html(n.Sum_CreditsB),$("#Sum_DebitA").html(n.Sum_DebitA)),(document.readyState==="interactive"||document.readyState==="complete")&&$("html, body").animate({scrollTop:350},2e3),r=="2"?($(".lblAccount1").html($("#lblaccountname1").html()+" - Unmatched Credits"),$(".lblAccount11").html($("#lblaccountname2").html()+" - Unmatched Credits"),$(".lblAccount2").html($("#lblaccountname1").html()+" - Unmatched Debits"),$(".lblAccount22").html($("#lblaccountname2").html()+" - Unmatched Debits"),$("#lblTitle1").html("Credit"),$("#lblTitle2").html("Debit")):($(".lblAccount1").html($("#lblaccountname1").html()+" - Unmatched Credits"),$(".lblAccount11").html($("#lblaccountname2").html()+" - Unmatched Debits"),$(".lblAccount2").html($("#lblaccountname1").html()+" - Unmatched Debits"),$(".lblAccount22").html($("#lblaccountname2").html()+" - Unmatched Credits"),$("#lblTitle1").html("Debit"),$("#lblTitle2").html("Credit"))):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_66"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_66"),"Qbicles")}})}function btnClearFillter(){ClearFillter();cleanBookNotification.success(_L("ERROR_MSG_352"),"Qbicles")}function ClearFillter(){BtnUnMatchRecordsClick(0,"Manual",!0)}function FindMatchrecord(n,t,i,r){$(r).parent().parent().parent().find("tr").removeClass("selected");$(r).closest("tr").toggleClass("selected");var u=$("#transactionMatchingTypeId").val();$.ajax({type:"post",url:"/TransactionMatching/FindMatchRecord",dataType:"json",data:{name:n,amount:t,TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId,matchingtype:u,date:i},success:function(t){t.result==!0?(u=="2"?n=="creditsA"?($table_debitB.find("tbody").find("tr").remove(),$table_debitB.find("tbody").append(t.table)):n=="debitB"?($table_debitA.find("tbody").find("tr").remove(),$table_debitA.find("tbody").append(t.table)):n=="debitA"?($table_creditB.find("tbody").find("tr").remove(),$table_creditB.find("tbody").append(t.table)):($table_creditA.find("tbody").find("tr").remove(),$table_creditA.append(t.table)):n=="creditsA"?($table_debitB.find("tbody").find("tr").remove(),$table_debitB.find("tbody").append(t.table)):n=="debitB"?($table_creditA.find("tbody").find("tr").remove(),$table_creditA.find("tbody").append(t.table)):n=="debitA"?($table_creditB.find("tbody").find("tr").remove(),$table_creditB.find("tbody").append(t.table)):($table_debitA.find("tbody").find("tr").remove(),$table_debitA.append(t.table)),$("#clearfillter").removeAttr("disabled"),$("#panelClear").css({display:"block"})):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles")}})}function BtnUnMatchRecordsClick(n,t,i){$matchingGroupId=n;$srtMatch=t;$.ajax({type:"post",url:"/TransactionMatching/Unmatched",dataType:"json",data:{matchingGroupId:$matchingGroupId},success:function(t){if(t.result==!0){$("#matchedGroup_"+$srtMatch+"_"+$matchingGroupId).fadeOut(360).attr("style","background-color: red !important");$("#matchedGroup_"+$srtMatch+"_"+$matchingGroupId).fadeTo("slow",.01,function(){$(this).slideUp("slow",function(){$(this).remove()})});n==0&&$.ajax({type:"post",url:"/TransactionMatching/RecalculatedUnmach",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){n.result==!0?($progressMatching.empty(),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles")}});i&&ManualMatchClick();var r=".btnremove"+n,u=$(".modal-content").find(r);u.parent().remove();$("#clearfillter").attr("disabled","disabled");$("#panelClear").css({display:"none"});cleanBookNotification.clearmessage();i||cleanBookNotification.success(_L("ERROR_MSG_660"),"Qbicles")}else cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles")},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles")}})}function CheckMatchs(n){var t=$(n).attr("name"),f=$("#transactionMatchingTypeId").val(),i=parseFloat($(n).attr("debitAmount")),r=parseFloat($(n).attr("creditAmount")),u;$(n).is(":checked")?f=="2"?(_transactionRecords.push($(n).attr("value")),$(n).closest("tr").toggleClass("selected"),t=="creditsA"?($selectedCreditsA++,$Sum_selectedCreditsA=(parseFloat($Sum_selectedCreditsA)+r).toFixed($decimalPlace),$sumCreditAmountSelected+=r):t=="debitB"?($selectedDebitB++,$Sum_selectedDebitB=(parseFloat($Sum_selectedDebitB)+i).toFixed($decimalPlace),$sumDebitAmountSelected+=i):t=="debitA"?($selectedDebitA++,$Sum_selectedDebitA=(parseFloat($Sum_selectedDebitA)+i).toFixed($decimalPlace),$sumCreditAmountSelected+=i):t=="creditsB"&&($selectedCreditsB++,$Sum_selectedCreditsB=(parseFloat($Sum_selectedCreditsB)+r).toFixed($decimalPlace),$sumDebitAmountSelected+=r)):(_transactionRecords.push($(n).attr("value")),$(n).closest("tr").toggleClass("selected"),t=="creditsA"?($selectedCreditsA++,$Sum_selectedCreditsA=(parseFloat($Sum_selectedCreditsA)+r).toFixed($decimalPlace)):t=="debitB"?($selectedDebitB++,$Sum_selectedDebitB=(parseFloat($Sum_selectedDebitB)+i).toFixed($decimalPlace)):t=="debitA"?($selectedDebitA++,$Sum_selectedDebitA=(parseFloat($Sum_selectedDebitA)+i).toFixed($decimalPlace)):t=="creditsB"&&($selectedCreditsB++,$Sum_selectedCreditsB=(parseFloat($Sum_selectedCreditsB)+r).toFixed($decimalPlace)),$sumDebitAmountSelected+=i,$sumCreditAmountSelected+=r):(u=_transactionRecords.indexOf($(n).attr("value")),u>-1&&_transactionRecords.splice(u,1),$(n).closest("tr").removeClass("selected"),t=="creditsA"?($selectedCreditsA--,$Sum_selectedCreditsA=(parseFloat($Sum_selectedCreditsA)-r).toFixed($decimalPlace)):t=="debitB"?($selectedDebitB--,$Sum_selectedDebitB=(parseFloat($Sum_selectedDebitB)-i).toFixed($decimalPlace)):t=="debitA"?($selectedDebitA--,$Sum_selectedDebitA=(parseFloat($Sum_selectedDebitA)-i).toFixed($decimalPlace)):t=="creditsB"&&($selectedCreditsB--,$Sum_selectedCreditsB=(parseFloat($Sum_selectedCreditsB)-r).toFixed($decimalPlace)),$sumDebitAmountSelected-=i,$sumCreditAmountSelected-=r);$sumDebitAmount.val($sumDebitAmountSelected.toFixed($decimalPlace));$sumCreditAmount.val($sumCreditAmountSelected.toFixed($decimalPlace));Manage_selected()}function Manage_selected(){$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB==0&&$selectedDebitB==0?($(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled","")):$selectedCreditsA==1&&$selectedDebitA==1&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB==1&&$selectedDebitB==1?($(".alert_matches p").html("Selected <\/span>1 Reversal<\/span>"),$("#reconcile_button").text("Reversal Match"),$(".alert_matches").addClass("active"),$("#finish_button2").attr("disabled",""),$("#finish_button1").attr("disabled",""),$reconcileType="reversal",$sumDebitAmount.val()==$sumCreditAmount.val()?$("#reconcile_button").removeAttr("disabled",""):($("#reconcile_button").attr("title","Can not Reversal because Credit not equals Debit"),$("#reconcile_button").attr("disabled",""))):$selectedCreditsA>0&&$selectedDebitA==0&&($selectedCreditsB>0||$selectedDebitB>0)||$selectedCreditsA==0&&$selectedDebitA>0&&($selectedCreditsB>0||$selectedDebitB>0)||($selectedCreditsA>0||$selectedDebitA>0)&&$selectedCreditsB>0&&$selectedDebitB==0||($selectedCreditsA>0||$selectedDebitA>0)&&$selectedCreditsB==0&&$selectedDebitB>0||$selectedCreditsA>0&&$selectedDebitA>0&&$selectedCreditsB>0&&$selectedDebitB>0?($sumDebitAmount.val()==$sumCreditAmount.val()?$("#reconcile_button").removeAttr("disabled",""):($("#reconcile_button").attr("title","Can not Match because Credit not equals Debit"),$("#reconcile_button").attr("disabled","")),$reconcileType="manual",$(".alert_matches p").html("Selected <span>"+($selectedCreditsA+$selectedDebitA)+"<\/span> against <span>"+($selectedCreditsB+$selectedDebitB)+"<\/span>"),$("#reconcile_button").text("Manual Match"),$(".alert_matches").addClass("active"),$("#finish_button2").attr("disabled",""),$("#finish_button1").attr("disabled","")):$selectedCreditsA+$selectedDebitA+$selectedCreditsB+$selectedDebitB==1?($(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled","")):$selectedCreditsA>0&&$selectedDebitA>0&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA>0&&$selectedDebitA==0&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA>0&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB>0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB==0&&$selectedDebitB>0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB>0&&$selectedDebitB>0?($(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled","")):($selectedCreditsA>2&&$selectedDebitA==0&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA>2&&$selectedCreditsB==0&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB>2&&$selectedDebitB==0||$selectedCreditsA==0&&$selectedDebitA==0&&$selectedCreditsB==0&&$selectedDebitB>2)&&($(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""))}function ReconcileNow(){$.ajax({url:"/TransactionMatching/ReconcileNow",type:"post",dataType:"json",data:{TransactionRecordList:JSON.stringify(_transactionRecords),transACount:$selectedCreditsA+$selectedDebitA,transBCount:$selectedCreditsB+$selectedDebitB,reconcileType:$reconcileType}}).done(function(n){var t,i,r,u,f,e;if(n.result==!0){for($(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#clearfillter").removeAttr("disabled",""),t=0;t<_transactionRecords.length;t++)i="trRemoveId-"+_transactionRecords[t],$("#"+i).css("background-color","#FF3700"),$("#"+i).fadeOut(1500,function(){$("#"+i).remove()});r=(parseFloat($("#Sum_CreditsA").text().replace(/,/g,""))-$Sum_selectedCreditsA).toFixed($decimalPlace).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");$("#Sum_CreditsA").html(r);u=(parseFloat($("#Sum_DebitB").text().replace(/,/g,""))-$Sum_selectedDebitB).toFixed($decimalPlace).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");$("#Sum_DebitB").html(u);f=(parseFloat($("#Sum_DebitA").text().replace(/,/g,""))-$Sum_selectedDebitA).toFixed($decimalPlace).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");$("#Sum_DebitA").html(f);e=(parseFloat($("#Sum_CreditsB").text().replace(/,/g,""))-$Sum_selectedCreditsB).toFixed($decimalPlace).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");$("#Sum_CreditsB").html(e);$Sum_selectedCreditsA=0;$Sum_selectedCreditsB=0;$Sum_selectedDebitA=0;$Sum_selectedDebitB=0;_transactionRecords=[];$selectedCreditsA=0;$selectedDebitB=0;$selectedDebitA=0;$selectedCreditsB=0;$.ajax({type:"post",url:"/TransactionMatching/RecalculatedUnmach",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){n.result==!0?($progressMatching.empty(),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles")}});ClearFillter();cleanBookNotification.clearmessage();cleanBookNotification.success(_L("ERROR_MSG_353"),"Qbicles")}else{cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles");return}}).error(function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_65"),"Qbicles");return})}function FinishRemaining(){Loading("Finish Remaining");$.ajax({type:"post",url:"/TransactionMatching/FinishRemaining_Alerts",dataType:"json",data:{taskInstanceId:$hidden_TaskInstanceId,taskName:$("#lbltaskname").html(),account1:$("#lblaccountname1").html(),account2:$("#lblaccountname2").html()}});var n=$("#TaskId").val(),t=$("#lbltaskname").html(),s=$("#TaskInstanceId").val(),i=$("#accountId").val(),r=$("#lblaccountname1").html(),u=$("#accountId2").val(),f=$("#lblaccountname2").html(),e=$("#transactionMatchingTypeId").val(),o=$("#transMatchingTaskId").val();$.ajax({type:"post",url:"/TransactionMatching/FinishRemaining",dataType:"json",data:{accountName:r,accountId:i,accountName2:f,accountId2:u,taskid:n,taskname:t,transactionMatchingTypeId:e,transactionmatchingtaskId:o,taskInstanceId:$hidden_TaskInstanceId},success:function(n){n.taskid>0?(cleanBookNotification.clearmessage(),cleanBookNotification.success(_L("ERROR_MSG_354"),"Qbicles"),EndLoading(),ViewTransactionMatchingReport(n.accountName,n.accountId,n.accountName2,n.accountId2,n.taskid,n.taskName,n.transactionMatchingTypeId,n.transactionmatchingTaskId,n.taskInstanceId,n.userName,n.date,n.time,n.countTransactionsMatched,n.countTransactionsManual,n.countTransactionsUnMatched)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_67"),"Qbicles"));EndLoading()},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_67"),"Qbicles");EndLoading()}})}function DeleteMatch(){$("#manual_match").css({display:"none"});Loading();$.ajax({type:"post",url:"/TransactionMatching/Revise",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){if(n.result==!0){var t=$("#hddaterang").attr("stardate")+"-"+$("#hddaterang").attr("enddate");CalculateDateRange(t,!0,!0);$("#button_RunTask").show();$("#button_ViewRules").show();$("#button_RunTask").attr("disabled","");cleanBookNotification.clearmessage();cleanBookNotification.success(_L("ERROR_MSG_68"),"Qbicles");$("#task_output").css({display:"none"});$("#run_task").css({display:"block"});$("#manual_match").css({display:"none"});$("#panelClear").css({display:"none"});document.body.style.cursor="auto";$("#transactionMatchingRecords").css("pointer-events","auto");$("#variance_2").val($("#hdvariance_2").val()).change();$("#variance_1").val($("#hdvariance_1").val()).change();$("#Datevariance").val($("#hdDatevariance").val()).change();$("#hddaterang").attr("enddate","");$("#hddaterang").attr("stardate","");$("#hdContinute").val(0)}else cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_69"),"Qbicles");EndLoading()},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_69"),"Qbicles");EndLoading()}})}function Revise(){$("#task_output").css({display:"none"});$("#run_task").css({display:"block"});$("#manual_match").css({display:"none"});$("#hdContinute").val(1);$("#hddaterang").attr("enddate","");$("#hddaterang").attr("stardate","");$("#drp_autogen0").html("");$("#drp_autogen0").append('Select end date for analysis <span class="ui-button-icon-space"> <\/span><span class="ui-button-icon ui-icon ui-icon-triangle-1-s" style="float: right;"><\/span>')}function SaveAndContinue(){cleanBookNotification.success(_L("ERROR_MSG_70"),"Qbicles");setTimeout(function(){window.location.href="/Apps/Tasks"},2e3)}function ViewTransactionMatchingReport(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){$.LoadingOverlay("show");$.ajax({type:"post",url:"/Tasks/RedirectTransactionMatchingReport",dataType:"json",data:{accountName:n,accountId:t,accountName2:i,accountId2:r,taskid:u,taskname:f,transactionMatchingTypeId:e,transactionmatchingTaskId:o,taskInstanceId:s,userName:h,date:c,time:l,countTransactionsMatched:a,countTransactionsManual:v,countTransactionsUnMatched:y},success:function(n){n===!0&&(window.location.href="/TransactionMatching/TransactionMatchingReport")}}).always(function(){LoadingOverlayEnd()})}var postDisplayedCount=0,mediaDisplayedCount=0,$ManyToMany=!0,$ReferenceAndDate=!0,$ReferenceToReference1AndDate=!0,$ReferenceToDescriptionAndDate=!0,$Reference=!0,$ReferenceToReference1=!0,$ReferenceToDescription=!0,$DescriptionAndDate=!0,$Description=!0,$AmountAndDate=!0,$Reversals=!0,$input_daterange=$("input[name='daterange']"),$dateRangeGroup=$("#dateRangeGroup"),$button_RunTask=$("#button_RunTask"),$button_ViewRules=$("#button_ViewRules"),$hidden_TaskId=$("#TaskId").val(),$hidden_TaskInstanceId=$("#TaskInstanceId").val(),$hidden_TransactionMatchingTaskId=0,$hidden_accountId=$("#accountId").val(),$hidden_accountId2=$("#accountId2").val(),$hidden_TransactionMatchingTypeId=$("#transactionMatchingTypeId").val(),$modal_rules_view=$("#modal-rules-view"),$progressMatching=$("#progressMatching"),$tableReconciled=$("#table_Reconciled"),$task_automatic=$("#task_automatic"),$task_manual=$("#task_manual"),$task_unmatched=$("#task_unmatched"),$div_review_matches_auto=$("#div_review_matches_auto"),$div_review_matches_manual=$("#div_review_matches_manual"),$modal_review_matches_auto=$("#review_matches_auto"),$modal_review_matches_manual=$("#review_matches_manual"),$modal_unmatch=$("#modal-unmatch"),$matchingGroupId=0,$srtMatch="",$table_creditA=$("#table_creditA"),$table_debitB=$("#table_debitB"),$table_debitA=$("#table_debitA"),$table_creditB=$("#table_creditB"),$sumDebitAmount=$("#sumDebitAmount"),$sumCreditAmount=$("#sumCreditAmount"),$btnrules=$("#btnrules"),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$Sum_selectedCreditsA=0,$Sum_selectedDebitB=0,$Sum_selectedDebitA=0,$Sum_selectedCreditsB=0,$reconcileType="",_transactionRecords=[],$tdDelete=null,$trDelete=null,$modal_review_matches_Title=$("#review_matches_manual [class='modal-title']");$(document).ready(function(){$("#panelClear").css({display:"none"});InitStartDate();$("#button_RunTask").show();$("#button_ViewRules").show();$(".singledate").on("apply.daterangepicker",function(n,t){CalculateDateRange(this,t,!1);$("#button_RunTask").show();$("#button_ViewRules").show();$("#variance_2").val($("#hdvariance_2").val()).change();$("#variance_1").val($("#hdvariance_1").val()).change();$("#Datevariance").val($("#hdDatevariance").val()).change()});$("#variance_2").val($("#hdvariance_2").val()).change();$("#variance_1").val($("#hdvariance_1").val()).change();$("#Datevariance").val($("#hdDatevariance").val()).change();$("#transMatchingTaskId").val()>0&&($hidden_TransactionMatchingTaskId=$("#transMatchingTaskId").val(),$("#task_output").show(),_transactionRecords=[],RecalculatedUnmach());$(".clear-transaction").css({display:"none"});$("#button_RunTask").attr("disabled","");$modal_rules_view.on("hidden.bs.modal",function(){$("#button_RunTask").removeAttr("disabled","disabled")});$modal_review_matches_auto.on("hidden.bs.modal",function(){_transactionRecords=[];$.ajax({type:"post",url:"/TransactionMatching/recalculatedUnmach",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){n.result==!0?($("#manual_match").hide(),$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$sumDebitAmount.val(0),$sumCreditAmount.val(0),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$reconcileType="",$(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""),$progressMatching.empty(),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles")}})});$modal_review_matches_manual.on("hidden.bs.modal",function(){_transactionRecords=[];$.ajax({type:"post",url:"/TransactionMatching/RecalculatedUnmach",dataType:"json",data:{TransactionMatchingTaskId:$hidden_TransactionMatchingTaskId},success:function(n){n.result==!0?($("#manual_match").hide(),$selectedCreditsA=0,$selectedDebitB=0,$selectedDebitA=0,$selectedCreditsB=0,$sumDebitAmount.val(0),$sumCreditAmount.val(0),$sumDebitAmountSelected=0,$sumCreditAmountSelected=0,$reconcileType="",$(".alert_matches").removeClass("active"),$("#finish_button2").removeAttr("disabled",""),$("#finish_button1").removeAttr("disabled",""),$progressMatching.empty(),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled)):(cleanBookNotification.clearmessage(),cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles"))},error:function(){cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_60"),"Qbicles")}})});$button_RunTask.on("click",function(){var o,e,s;Loading();document.body.style.cursor="wait";$("#transactionMatchingRecords").css("pointer-events","none");cleanBookNotification.success(_L("ERROR_MSG_61"),"Qbicles");var h=$("#chkManyToMany").is(":checked")?1:0,t,i,r,u,f,n=$("#chkReference").is(":checked")?1:0,c=$("#chkReferenceDate").is(":checked")?1:0;n==1&&c==1?(t=1,u=1,f=1,i=0,r=0,n=0):n==1?(t=0,u=0,f=0,i=1,r=1,n=1):(t=0,u=0,f=0,i=0,r=0,n=0);e=$("#chkDescription").is(":checked")?1:0;s=$("#chkDecriptionDate").is(":checked")?1:0;e==1&&s==1?(o=1,e=0):o=0;var l=$("#chkAmountAndDate").is(":checked")?1:0,a=$("#chkReversals").is(":checked")?1:0,v=$("#Datevariance :selected").val(),y=$("#variance_1 :selected").val(),p=$("#variance_2 :selected").val(),w=$("#variance_name").val(),b=$("#hdrulerId").val(),k={TaskId:$hidden_TaskId,IsManyToMany_Set:h,IsOneToOne_Set:null,IsReferenceAndDate_Set:t,IsRefAndDate_RefToRef1_Set:u,IsRefAndDate_RefToDesc_Set:f,IsReference_Set:n,IsRef_RefToRef1_Set:i,IsRef_RefToDesc_Set:r,IsDescriptionAndDate_Set:o,IsDescription_Set:e,IsAmountAndDate_Set:l,IsReversals_Set:a,DateVarianceValue:v,Amount1VarianceValue:y,Amount2VarianceValue:p,VarianceName:w,Id:b};$.ajax({type:"post",url:"/TransactionMatching/SaveTransactionMatching",dataType:"json",data:{date:$input_daterange.val(),taskId:$hidden_TaskId,accountId:$hidden_accountId,accountId2:$hidden_accountId2,transactionMatchingTypeId:$hidden_TransactionMatchingTypeId,ConfigureRules:k,Datevariance:$("#Datevariance :selected").val(),taskInstanceId:$("#hdContinute").val()=="1"?$("#TaskInstanceId").val():"0"},success:function(n){n.result==!0?($hidden_TaskInstanceId=n.instanceId,$("#TaskInstanceId").val(n.instanceId),$hidden_TransactionMatchingTaskId=n.transactionMatchingTaskId,cleanBookNotification.clearmessage(),cleanBookNotification.success(n.message,"Qbicles"),$("#task_output").show(),$("#run_task").hide(),document.body.style.cursor="auto",$("#transactionMatchingRecords").css("pointer-events","auto"),$progressMatching.append(n.percentagesProgressBar),$tableReconciled.empty(),$tableReconciled.append(n.tableReconciled),RecalculatedUnmach()):($("#task_output").css({display:"none"}),$("#run_task").show(),document.body.style.cursor="auto",$("#transactionMatchingRecords").css("pointer-events","auto"),cleanBookNotification.clearmessage(),cleanBookNotification.warning(_L("ERROR_MSG_62"),"Qbicles"));EndLoading()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");document.body.style.cursor="auto";$("#transactionMatchingRecords").css("pointer-events","auto");cleanBookNotification.clearmessage();cleanBookNotification.error(_L("ERROR_MSG_63"),"Qbicles");EndLoading()}})})});