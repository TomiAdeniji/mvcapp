function loadBudgetScenariosContents(){$("#budget-scenarios").LoadingOverlay("show");$("#budget-scenarios").empty();$("#budget-scenarios").load("/TraderBudget/BudgetScenariosContent",function(){$("#budget-scenarios").LoadingOverlay("hide")})}function budgetScenariosSearch(){loadBudgetScenariosItem()}function loadBudgetScenariosItem(){var n=$("#budget_scenarios_search_key").val(),t=$("#budget_scenarios_orderby_filter").val();$("#budget_scenarions_Items").LoadingOverlay("show");$("#budget_scenarions_Items").empty();$("#budget_scenarions_Items").load("/TraderBudget/BudgetScenariosItems?key="+n+"&sortBy="+t,function(){$("#budget_scenarions_Items").LoadingOverlay("hide")})}function budgetScenatioAddEdit(n){$("#app-trader-budgetscenario-add").LoadingOverlay("show");$("#app-trader-budgetscenario-add").empty();$("#app-trader-budgetscenario-add").load("/TraderBudget/BudgetScenarioAddEditModal?id="+n,function(){$("#app-trader-budgetscenario-add").LoadingOverlay("hide")})}function ChangeImageItem(n){$.LoadingOverlay("show");UploadMediaS3ClientSide("budgetscenario_featuredimage").then(function(t){if(LoadingOverlayEnd(),n.files&&n.files.length>0?($("#preview").css("display","block"),readURLImage(n,"preview")):$("#preview").css("display","none"),$("#budgetscenario_featuredimage_value").val(t.objectKey),t.objectKey==="no_image"||t.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}})}function getMonths(n,t){var i=0,f=new Date(n).getMonth(),e=new Date(t).getMonth(),r=new Date(n).getFullYear(),u=new Date(t).getFullYear();return r===u?i=e-f:u-r==1?i=12-f+e:u-r>1&&(i=12-f+e+(u-r-1)*12),i}function onPeriodChange(n){var t=$("#budgetscenario_fiscalstart").val(),i=$("#budgetscenario_fiscalend").val();if(t!==""&&i!==""){if(t===i||new Date(t).getTime()>=new Date(i).getTime()){$("#"+n).val("");return}var r=getMonths(t,i);r>6?$("#budgetscenario_reportingperiod option[value='Weekly']").remove():($("#budgetscenario_reportingperiod option[value='Weekly']").remove(),$("#budgetscenario_reportingperiod").append('<option value="Weekly">Weekly<\/option>'));r%3==0&&[0,3,6,9].indexOf(new Date(t).getMonth())!==-1&&[0,3,6,9].indexOf(new Date(i).getMonth())!==-1?($("#budgetscenario_reportingperiod option[value='Quarterly']").remove(),$("#budgetscenario_reportingperiod").append('<option value="Quarterly">Quarterly<\/option>')):$("#budgetscenario_reportingperiod option[value='Quarterly']").remove()}$("#budgetscenario_reportingperiod").select2()}function smalllestClick(){var r=$("#budgetscenario_reportingperiod").val(),n=$("#budgetscenario_fiscalstart").val(),t=$("#budgetscenario_fiscalend").val();if(n!==""&&t!==""){var i=getMonths(n,t);i>6?$("#budgetscenario_reportingperiod option[value='Weekly']").remove():($("#budgetscenario_reportingperiod option[value='Weekly']").remove(),$("#budgetscenario_reportingperiod").append('<option value="Weekly">Weekly<\/option>'));i%3==0&&[0,3,6,9].indexOf(new Date(n).getMonth())!==-1&&[0,3,6,9].indexOf(new Date(t).getMonth())!==-1?($("#budgetscenario_reportingperiod option[value='Quarterly']").remove(),$("#budgetscenario_reportingperiod").append('<option value="Quarterly">Quarterly<\/option>')):$("#budgetscenario_reportingperiod option[value='Quarterly']").remove()}$("#budgetscenario_reportingperiod").val(r);$("#budgetscenario_reportingperiod").select2()}function validateBudgetScenario(){var n=!0;return $("#budgetscenario_title").val()===""&&($("#budgetScenario_addedit").validate().showErrors({scenario_title:"Title is required."}),n=!1),($("#budgetscenario_featuredimage_value").val()===""||$("#budgetscenario_featuredimage_value").val()===null)&&($("#budgetScenario_addedit").validate().showErrors({featuredimg:"Featured image is required."}),n=!1),$("#budgetscenario_fiscalstart").val()===""&&($("#budgetScenario_addedit").validate().showErrors({budgetscenario_fiscalstart:"Fiscal start period is required."}),n=!1),$("#budgetscenario_fiscalend").val()===""&&($("#budgetScenario_addedit").validate().showErrors({budgetscenario_fiscalend:"Fiscal end period is required."}),n=!1),(!$("#budgetscenario_reportingperiod").val()||$("#budgetscenario_reportingperiod").val()&&$("#budgetscenario_reportingperiod").val()==="")&&($("#budgetScenario_addedit").validate().showErrors({smallest:"Smallest reporting period is required."}),n=!1),n}function checkExistsTitle(){var n=new $.Deferred;return $.ajax({type:"get",url:"/TraderBudget/CheckExistsTitle?title="+$("#budgetscenario_title").val()+"&id="+$("#budget_scenarios_id").val(),"async":!1,contentType:!1,processData:!1,dataType:"json",success:function(t){t.actionVal===1?n.resolve(t.result):t.actionVal===3&&(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),n.resolve(t.result))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");n.resolve(!1)}}),n.promise()}function getDateString(n){var t=new Date(n);return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}function saveBudgetScenario(){checkExistsTitle().then(function(n){var r,t,i;if(!n){$("#budgetScenario_addedit").validate().showErrors({scenario_title:"Title  must be unique at a Location."});cleanBookNotification.error(_L("ERROR_MSG_250"),"Qbicles");return}if(validateBudgetScenario()){if(r={Id:$("#budget_scenarios_id").val(),Title:$("#budgetscenario_title").val(),Description:$("#budgetscenario_description").val(),FeaturedImage:$("#budgetscenario_featuredimage_value").val(),FiscalStartPeriod:getDateString($("#budgetscenario_fiscalstart").val()),FiscalEndPeriod:getDateString($("#budgetscenario_fiscalend").val()),ReportingPeriod:$("#budgetscenario_reportingperiod").val(),BudgetGroups:[]},t=$("#budgetscenario_budgetgroup").val(),t!==null&&t.length>0)for(i=0;i<t.length;i++)r.BudgetGroups.push({Id:t[i]});$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderBudget/SaveBudgetScenario?startdate="+getDateString($("#budgetscenario_fiscalstart").val())+"&enddate="+getDateString($("#budgetscenario_fiscalend").val()),data:{budgetScenaio:r},dataType:"json",success:function(n){$.LoadingOverlay("hide");n.actionVal===1?(cleanBookNotification.createSuccess(),$("#app-trader-budgetscenario-add").modal("toggle"),loadBudgetScenariosItem()):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#app-trader-budgetscenario-add").modal("toggle"),loadBudgetScenariosItem()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_267"),"Qbicles")}})}})}function setActive(n){$.LoadingOverlay("show");$.ajax({type:"get",url:"/TraderBudget/setActive?id="+n,dataType:"json",success:function(n){$.LoadingOverlay("hide");n.actionVal===1?loadBudgetScenariosItem():n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}$(function(){});