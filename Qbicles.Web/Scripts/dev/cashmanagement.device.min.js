function SaveSafe(){var i,t,n;if($("#form_safe_add").valid()){if(i={Id:$("#cashmanagement_safe-id").val(),Name:$("#safe-name").val()},t=$("#safe-bank-account").val(),t.toLowerCase()==="please select"){$("#select2-safe-bank-account-container").parent().append("<label id='PosDevices-error' class='error' for='PosDevices'>No Cash and Bank Account selected.<\/label>").attr("onclick","(function(){$('#PosDevices-error').remove()})()");return}$.LoadingOverlay("show");_url="/CashManagement/SaveSafe?traderCashAccountId="+t;n=$("#isReloadPageNeeded").val();$.ajax({type:"post",url:_url,data:{safe:i},dataType:"json",success:function(t){t.result==!0?(cleanBookNotification.success("Save Safe successfully.","Qbicles"),n==="false"?FilterCMDeviceTab():location.reload(),$("#app-trader-pos-cash-safe-edit").modal("toggle")):($("#form_safe_add").validate().showErrors({Name:t.msg}),n==="false"?FilterCMDeviceTab():location.reload())},error:function(t){cleanBookNotification.error(t,"Qicles");n==="false"?FilterCMDeviceTab():location.reload()}})}}function SaveTill(){var t,i,n;if($("#form_till_add").valid()){if(t={Id:$("#till-id").val(),Name:$("#till-name").val()},$("#PosDevices").val()==null){$(".multiselect-native-select .btn-group").append("<label id='PosDevices-error' class='error' for='PosDevices'>No POS Devies selected.<\/label>").attr("onclick","(function(){$('#PosDevices-error').remove()})()");return}i=$("#PosDevices").val().join();$.LoadingOverlay("show");_url="/CashManagement/SaveTill";n=$("#isReloadPageNeeded").val();$.ajax({type:"post",url:_url,data:{till:t,listPosDeviceString:i},dataType:"json",success:function(t){t.result==!0?(cleanBookNotification.success("Save Till Successfully.","Qbicles"),n==="false"?FilterCMDeviceTab():location.reload(),$("#app-trader-pos-cash-device-add").modal("toggle")):($("#form_till_add").validate().showErrors({Name:t.msg}),n==="false"?FilterCMDeviceTab():location.reload())},error:function(t){cleanBookNotification.error(t.msg,"Qbicles");n==="false"?FilterCMDeviceTab():location.reload()}})}}function SaveTillPayInReview(){SaveTillPayment("PendingReview","PayIn")}function SaveTillPayOutReview(){SaveTillPayment("PendingReview","PayOut")}function SaveTillPayment(n,t){$.LoadingOverlay("show");var r=$("#payment-workgroup-select").val(),u=$("#associated-till-id").val(),f=$("#associated-safe-id").val(),e={Id:r},o={Id:u},s={Id:f},h={AssociatedTill:o,AssociatedSafe:s,WorkGroup:e,Amount:$("#amount-payment").val()},i="/CashManagement/SaveTillPayment?type=payin";t==="PayOut"&&(i="/CashManagement/SaveTillPayment?type=payout");$.ajax({type:"post",url:i,dataType:"json",data:{tillPayment:h},success:function(n){n.result?(cleanBookNotification.success("Save Till Payment Successfully.","Qbicles"),callBackDataTableReload("till-transaction-list-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ShowTillDetailTable(n){var i,t,r;$.LoadingOverlay("show");i=$("#search_dt").val();t="";$("#till-transaction-input-datetimerange")!=null&&(t=$("#till-transaction-input-datetimerange").val());r={Key:i,DateRange:t};$("#till-detail-table-content").load("/CashManagement/TillDetailTable?tillId="+n,r,function(){var t="/CashManagement/TillLeftPanelPartial?tillId="+n+"&unapproved=''";$("#till-left-panel").load(t,function(){$.LoadingOverlay("hide")})})}function ShowCashManagementDiscussion(){}function ShowSafeDetailTable(n){var i,t,r;$.LoadingOverlay("show");i=$("#search_dt").val();t="";$("#safe-transaction-input-datetimerange")!=null&&(t=$("#safe-transaction-input-datetimerange").val());r={Key:i,DateRange:t};$("#safe-detail-table-content").empty();$("#safe-detail-table-content").load("/CashManagement/SafeDetailTable?safeId="+n,r,function(){});$.LoadingOverlay("hide")}function callBackDataTableReload(n){$("#"+n).DataTable().ajax.reload()}function ChangeWorkGroup(){SetDisabledSubmit();$workgroupId=$("#payment-workgroup-select").val();$workgroupId!==""?($.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderTransfers/getworkgroup?id="+$workgroupId,dataType:"json",success:function(n){$(".preview-workgroup").show();LoadingOverlayEnd();n.result?($(".preview-workgroup table tr td.location_name").text(n.Object.Location),$(".preview-workgroup table tr td.workgroup_process").text(n.Object.Process),$(".preview-workgroup table tr td.workgroup_qbicle").text(n.Object.Qbicle),$(".preview-workgroup table tr td.workgroup_member span").text(n.Object.Members)):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""));$("#transfer-workgroup-select-error").remove()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):(LoadingOverlayEnd(),$(".preview-workgroup").attr("style","display: none;"))}function ShowGroupMember(){$("#app-trader-workgroup-preview").empty();$("#app-trader-workgroup-preview").load("/TraderTransfers/ShowListMemberForWorkGroup?wgId="+$workgroupId);$("#app-trader-workgroup-preview").modal("toggle")}function SetDisabledSubmit(){var r=$("#payment-workgroup-select").val(),t=_.toNumber($("#amount-payment").val()),u=_.toNumber($("#till-last-balance").val()),i=!1,n=!1;r!==""&&(i=!0);$("#till-last-balance-error").hide();t>0&&(n=!0);$("#pay-type").val()==="payout"&&t>u&&($("#till-last-balance-error").show(),n=!1);i&&n?$("#tillpayment-submit-btn").removeAttr("disabled"):$("#tillpayment-submit-btn").attr("disabled","true")}function searchOnTableTillDetail(){callBackDataTableReload("till-transaction-list-table")}function onKeySearchChanged(n){filter.Key=$(n).val();setTimeout(function(){searchOnTableTillDetail()},200)}function searchOnTableSafeDetail(){var i=[],n=$("#search_dt").val(),t;if($("#search_dt").val()!==""&&$("#search_dt").val()!==null&&n&&n.length>0)for(n=n.split(" "),t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#safe-transaction-list-table").DataTable().search(i.join("|"),!0,!1,!0).draw()}function onKeySearchChangedSafeDetail(n){filter.Key=$(n).val();setTimeout(function(){searchOnTableSafeDetail()},200)}ShowTabCashManagement=function(n){var i=getTabTrader().TraderTab,t;$('a[href="#'+n+'"]').tab("show");setTabLevel(3,n);t="/PointOfSale/PointOfSaleContent?value="+n;n==="subGeneral"?t="/CashManagement/CMGeneralContent":n==="subDevices"&&(t="/CashManagement/CMDevicesContent?isSafe=true&&isTill=true");$("#cm-content").LoadingOverlay("show");$("#cm-content").empty();$("#cm-content").load(t,function(){$("#cm-content").LoadingOverlay("hide")});$("#cm-content").LoadingOverlay("hide")};FilterCMDeviceTab=function(){var r;LoadingOverlay();var n=$("#show-type").val(),t=!0,i=!0;n==1?i=!1:n==2&&(t=!1);r=$("#key-search").val();ajaxUri="/CashManagement/CMDevicesContent?isSafe="+t+"&&isTill="+i+"&&key="+r;$("#cm-content").load(ajaxUri,function(){LoadingOverlayEnd()});LoadingOverlayEnd()};SafeAddEdit=function(){AjaxElementShowModal("/CashManagement/CashMangementSafeAddEdit","app-trader-pos-cash-safe-edit")};TillAddEdit=function(n){var i="/CashManagement/CashManagementTillAddEdit?tillId="+n,t="app-trader-pos-cash-device-add";$.LoadingOverlay("show");$("#"+t).empty();$("#"+t).load(i,function(){$(".checkmulti").multiselect({includeSelectAllOption:!0,selectAllJustVisible:!0,includeResetOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0});LoadingOverlayEnd();$("#"+t).modal("show")})};TillDelete=function(n){var t="/CashManagement/DeleteTill?tillId="+n;$.LoadingOverlay("show");$.ajax({type:"post",url:t,dataType:"json",success:function(n){n.result==!0?(cleanBookNotification.removeSuccess(),FilterCMDeviceTab()):(cleanBookNotification.error("Delete Till failed.","Qbicles"),FilterCMDeviceTab())},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");FilterCMDeviceTab()}})};SaveTillCheckpoint=function(n){$.LoadingOverlay("show");var t={Id:n},i={Id:$("#workgroup-select").val()},r={WorkGroup:i,VirtualTill:t,Amount:$("#till-checkpoint-amount").val(),CheckpointDate:$("#checkpoint-date").val()};$.ajax({type:"post",url:"/CashManagement/SaveCheckpoint",dataType:"json",data:{Checkpoint:r},success:function(n){n.result?(cleanBookNotification.success("Save Till Checkpoint Successfully.","Qbicles"),callBackDataTableReload("till-transaction-list-table")):cleanBookNotification.error(n.msg,"Create Till Checkpoint failed.")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})};SaveSafeCheckpoint=function(n){$.LoadingOverlay("show");var t={Id:n},i={Id:$("#workgroup-select").val()},r={WorkGroup:i,VirtualSafe:t,Amount:$("#safe-checkpoint-amount").val(),CheckpointDate:$("#checkpoint-date").val()};$.ajax({type:"post",url:"/CashManagement/SaveCheckpoint",dataType:"json",data:{Checkpoint:r},success:function(t){t.result?(cleanBookNotification.success("Save Safe Checkpoint Successfully.","Qbicles"),ShowSafeDetailTable(n)):cleanBookNotification.error(t.msg,"Create Safe Checkpoint failed.")},error:function(n){cleanBookNotification.error(n,"Create Safe Checkpoint failed.")}}).always(function(){LoadingOverlayEnd()})};$(document).on("blur","#amount-payment",function(){SetDisabledSubmit()});