function UploadQbiclesMedia(n){$("#form_media_addedit").LoadingOverlay("show");var t=document.getElementById(n).files;t&&UploadMediaS3ClientSide(n).then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#propertyType-table").LoadingOverlay("hide",!0);cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");$("#form_media_addedit").LoadingOverlay("hide",!0);return}SubmitQbicleMedia(n)})}function SubmitQbicleMedia(n){var t={Name:$("#mediaTitle").val(),Description:$("#mediaDescription").val(),Topic:{Id:$("#media-topic-selected").val()}},i={FileKey:n.objectKey,FileName:n.fileName,FileType:n.fileType,FileSize:n.fileSize};$.ajax({type:"post",cache:!1,url:"/QbicleFiles/SaveMedia",data:{media:t,s3ObjectUpload:i,mediaFolderId:parseInt($("#add-media-select-media-folder").val()),qbicleId:$("#mediaQbicleId").val(),isMediaOntab:$("#add-media-on-tab").val()},beforeSend:function(){},success:function(n){n.result?($("#dashboard-page-display").length>0?isDisplayFlicker(!0):isPlaceholder(!0,"#list-medias"),n.msg!=""&&(htmlActivityRender(n.msg,0),$("#list-medias").prepend(n.msg),isDisplayFlicker(!1)),$("#create-media").modal("hide"),ClearMediaInputModalAddEdit(),$("#block-media-list").length&&$("#select-list-mediaFolder").val($("#add-media-select-media-folder").val()).change(),$("ul.subapps-nav li.active a.link-media").length>0&&$("#media-folder-qbicle").val($("#add-media-select-media-folder").val()).trigger("change")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");isDisplayFlicker(!1)}}).always(function(){$("#propertyType-table").LoadingOverlay("hide",!0);$("#form_media_addedit").LoadingOverlay("hide",!0)})}function SaveMedia(){var n=$("#form_media_addedit");n.valid()&&($("#form_media_addedit").LoadingOverlay("show"),$.ajax({url:"/Medias/DuplicateMediaNameCheck",data:{qbicleId:$("#mediaQbicleId").val(),mediaId:$mediaId,MediaName:$("#mediaTitle").val()},type:"GET",dataType:"json"}).done(function(t){if(t.result)n.validate().showErrors({Name:"Name of Media already exists in the current Qbicle."}),$("#form_media_addedit").LoadingOverlay("hide",!0);else if($("#mediaAttachments").val()){var i=checkfile($("#mediaAttachments").val());i.stt?UploadQbiclesMedia("mediaAttachments"):($("#form_media_addedit").LoadingOverlay("hide",!0),n.validate().showErrors({mediaAttachments:i.err}))}}).fail(function(){n.validate().showErrors({Name:"Error checking existing name of Media in the current Qbicle"})}))}function AddNewFileClick(){ClearMediaInputModalAddEdit()}function ClearMediaInputModalAddEdit(){$("#mediaTitle").val("");$("#mediaAttachments").val("");$("#mediaDescription").val("");ClearError()}