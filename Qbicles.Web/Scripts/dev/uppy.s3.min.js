$(function(){function o(n){var r=new $.Deferred,u,t,i;AWS.config.update({region:$s3BucketRegion,credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:$s3IdentityPoolId})});u=new AWS.S3;t="";t=n.metadata.name===""?n.filename:n.metadata.name;i="";i=n.metadata.caption?n.metadata.caption:"";const f={Metadata:{"file-name":t,caption:i,"file-type":n.contenttype,"upload-date-utc":Date(),"file-extension":t.split(".").pop()},Bucket:$s3BucketName,Key:n.id,ContentType:n.contenttype,ACL:"bucket-owner-full-control"};return u.getSignedUrl("putObject",f,(n,t)=>{r.resolve({method:"put",url:t,fields:{},headers:{caption:i}})}),r.promise()}var i=Uppy.AwsS3,r=$("#drag-drop-area"),u=$("#drag-drop-area-1"),f=r.data("allowedfiletypes"),e=u.data("allowedfiletypes"),n,t;if(r.length>0){n=Uppy.Core({id:"uppyUpload",autoProceed:!1,restrictions:{maxFileSize:1048576,maxNumberOfFiles:20,minNumberOfFiles:null,allowedFileTypes:f?f.split(","):null},logger:Uppy.debugLogger}).use(Uppy.Dashboard,{trigger:".UppyModalOpenerBtn",inline:!0,closeModalOnClickOutside:!0,showLinkToFileUploadResult:!1,target:"#drag-drop-area",replaceTargetContent:!1,showProgressDetails:!0,proudlyDisplayPoweredByUppy:!0,height:470,metaFields:[{id:"name",name:"Name",placeholder:"You can rename the file here"},{id:"caption",name:"Caption",placeholder:"Briefly describe what the file contains"}],browserBackButtonClose:!0}).on("file-added",t=>{n.setFileMeta(t.id,{id:GenerateUUID()})}).use(i,{fields:[],getUploadParameters:function(n){var t={id:n.meta.id,filename:n.name,contenttype:n.type,metadata:{name:n.meta.name,caption:n.meta.caption}};return o(t).then(function(n){return n})}});n.on("complete",n=>{n.successful?addItemsGallary(n.successful):console.log("Upload error: ",n.failed)})}if(u.length>0){t=Uppy.Core({id:"uppyUpload",autoProceed:!1,restrictions:{maxFileSize:1048576,maxNumberOfFiles:20,minNumberOfFiles:null,allowedFileTypes:e?e.split(","):null},logger:Uppy.debugLogger}).use(Uppy.Dashboard,{trigger:".UppyModalOpenerBtn",inline:!0,closeModalOnClickOutside:!0,showLinkToFileUploadResult:!1,target:"#drag-drop-area-1",replaceTargetContent:!1,showProgressDetails:!0,proudlyDisplayPoweredByUppy:!0,height:470,metaFields:[{id:"name",name:"Name",placeholder:"You can rename the file here"},{id:"caption",name:"Caption",placeholder:"Briefly describe what the file contains"}],browserBackButtonClose:!0}).on("file-added",n=>{t.setFileMeta(n.id,{id:GenerateUUID()})}).use(i,{fields:[],getUploadParameters:function(n){var t={id:n.meta.id,filename:n.name,contenttype:n.type,metadata:{name:n.meta.name,caption:n.meta.caption}};return o(t).then(function(n){return n})}});t.on("complete",n=>{n.successful?addItemsMasonryGallary(n.successful):console.log("Upload error: ",n.failed)})}$("#btnResetUppy").click(function(){n&&n.reset();t&&t.reset()})});