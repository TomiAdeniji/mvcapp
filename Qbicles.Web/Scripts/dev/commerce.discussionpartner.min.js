function initPlugins(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#contact-finder input[name=search]").keyup(delay(function(){searchTop10TraderContact()},1e3));$("#frm-confirm-b2bcontact").validate({ignore:"",rules:{group:{required:!0},workgroup:{required:!0}}})}function settingsPartnership(n,t,i){var r=$("#slTeams"+t+n+" option:selected").map(function(){return this.value}).get(),u=$("#slMenus"+t+n).val(),f=$("#slAccount"+t+n).val(),e=$("#chkParnership"+n).prop("checked");$.post("/Commerce/SettingsPartnership",{partnershipId:n,members:r?r:[],menus:u?u:[],accountId:f,type:t,status:e},function(n){n.result?($(i).attr("disabled",!0),cleanBookNotification.updateSuccess(),loadPartnershipsContent($("#hdfRelationshipId").val())):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function haltAll(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Commerce",message:_L("CONFIRM_MSG_HALTALL",["all partnerships"]),callback:function(t){if(t){$.post("/Commerce/HaltAllPartnerships",{relationshipId:n},function(n){n.result?($("#logistics").css("cursor","not-allowed"),$("#logistics").css("pointer-events","none"),location.reload()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")});return}}})}function halt(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Commerce",message:_L("CONFIRM_MSG_HALTALL",["a partnership"]),callback:function(t){if(t){$.post("/Commerce/HaltPartnership",{partnershipId:n},function(t){t.result?(loadPartnershipsContent($("#hdfRelationshipId").val()),$("#chkParnership"+n).bootstrapToggle("off"),t.Object&&t.Object.isLogistics&&($("#logistics").css("cursor","not-allowed"),$("#logistics").css("pointer-events","none"))):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")});return}}})}function validateAddComment(){var n=$("#txt-comment-link").val();n.length>1500?$("#addcomment-error").show():$("#addcomment-error").hide()}function addCommentToDiscussion(n){if(!busycomment){var t=$("#txt-comment-link");t.val()&&!$("#addcomment-error").is(":visible")&&(isPlaceholder(!0,"#list-comments-discussion"),busycomment=!0,$.ajax({url:"/QbicleComments/AddCommentB2BDiscussion",data:{message:t.val(),disKey:n},type:"POST",success:function(n){n&&(t.val(""),n.msg!=""&&($("#list-comments-discussion").prepend(n.msg),isDisplayFlicker(!1)));busycomment=!1},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce");isPlaceholder(!1,"");busycomment=!1}}))}}function loadMorePostsDiscussion(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityPosts",data:{activityKey:n,size:countPost*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadPosts").remove();return}$("#"+i).append(n).fadeIn(250);countPost=countPost+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function loadMoreMediasDiscussion(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityMedias",data:{activityId:n,size:countMedia*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadMedias").remove();return}$("#"+i).append(n).fadeIn(250);countMedia=countMedia+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function loadPartnershipsContent(n){setTimeout(function(){$("ul.nav li.active a[href=#tab0]").length>0&&$("#tab0").LoadingOverlay("show");$("#tab0").load("/Commerce/LoadPartnershipsContent",{rlid:n},function(){$("#tab0").LoadingOverlay("hide")})},700)}function loadLogisticsPartnershipContent(n,t){if(n>0){var i=$("#logs-draft").data("draftagreementid");setTimeout(function(){$("ul.nav li.active a[href=#tab2]").length>0&&$("#tab2").LoadingOverlay("show");$("#tab2").load("/Commerce/LoadLogisticsPartnershipContent",{pid:n},function(){var r,u;initPlugins();loadLogisticsModals(n);r=$("#hdfIsExistLogisticsAgreement").val();r==1&&($("#logistics").css("cursor",""),$("#logistics").css("pointer-events",""));u=$("#logs-draft").data("draftagreementid");(t||i>0&&i!=u)&&($("#activetab").show(),$("#activetab a[href=#logs-active]").click());$("#tab2").LoadingOverlay("hide")})},500)}}function loadLogisticsModals(n){$("#logictismodals").load("/Commerce/LogisticsPartnershipModals",{pid:n},function(){$("#logictismodals select.select2").select2({placeholder:"Please select"});$('#logictismodals input[data-toggle="toggle"]').bootstrapToggle()})}function loadProviderPriceList(n){$(".provider-pricelist").load("/Commerce/ProviderPriceList",{pid:n},function(){})}function loadLogisticsPartnershipButton(n){$(".action_button").load("/Commerce/LogisticsPartnershipButton",{pid:n},function(){})}function loadActiveContent(n){var t=$("#logs-active .qbicles-dash-grid");setTimeout(function(){$("ul.nav li.active a[href=#logs-active]").length>0&&t.LoadingOverlay("show");t.load("/Commerce/LoadActiveContent",{pid:n},function(){t.LoadingOverlay("hide")})},500)}function loadArchiveContent(n){var t=$("#logs-archive .qbicles-dash-grid");setTimeout(function(){$("ul.nav li.active a[href=#logs-archive]").length>0&&t.LoadingOverlay("show");t.load("/Commerce/LoadArchiveContent",{pid:n},function(){t.LoadingOverlay("hide")})},500)}function loadChargeListModal(n){$("#b2b-archive-delivery-charge-list").load("/Commerce/ChargeListModal",{logisticsAgreementId:n},function(){})}function tabActive(n,t){n==="tradepartner"?$("#tradepartner").trigger("click"):n=="logistics"&&$.post("/Commerce/CheckLogisticsAgreement",{relationshipId:$("#hdfRelationshipId").val(),partnershipId:t},function(n){n?cleanBookNotification.warning(_L("WARNING_MSG_EXISTAGREEMENT"),"Commerce"):($("#logistics").trigger("click"),loadLogisticsPartnershipContent(t,!1))})}function updateLocations(n,t){clearTimeout(wto);wto=setTimeout(function(){var i=$(t).val();i.length!==0&&$.post("/Commerce/UpdateLocationsPartnership",{partnershipId:n,locids:i?i:[]},function(t){t.result?(loadProviderPriceList(n),cleanBookNotification.updateSuccess(),loadPartnershipsContent($("#hdfRelationshipId").val())):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})},1500)}function addPriceListLogisticsAgreement(n){var t=$("#slPriceList").val();$("#frmProviderPriceList").validate();$("#frmProviderPriceList").valid()&&$.post("/Commerce/AddPriceListLogisticsAgreement",{partnershipId:n,priceListId:t},function(t){t.result?(cleanBookNotification.updateSuccess(),loadProviderPriceList(n),loadLogisticsModals(n),$("#b2b-choose-prices").modal("hide")):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function deletePriceListLogisticsAgreement(n){$.post("/Commerce/DeletePriceListLogisticsAgreement",{partnershipId:n},function(t){t.result?(cleanBookNotification.updateSuccess(),loadProviderPriceList(n),loadLogisticsModals(n)):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function updateProviderChargeFrameworks(n){var t=[];$("#b2b-delivery-charge-mgmt article").each(function(){var n=$(this),i={Id:n.data("id"),IsActive:n.find("input[name=IsActive]").prop("checked"),DistanceTravelPerKm:n.find("input[name=DistanceTravelPerKm]").val(),DistanceTravelledFlatFee:n.find("input[name=DistanceTravelledFlatFee]").val(),TimeTakenFlatFee:n.find("input[name=TimeTakenFlatFee]").val(),TimeTakenPerSecond:n.find("input[name=TimeTakenPerSecond]").val(),ValueOfDeliveryFlatFee:n.find("input[name=ValueOfDeliveryFlatFee]").val(),ValueOfDeliveryPercentTotal:n.find("input[name=ValueOfDeliveryPercentTotal]").val()};t.push(i)});$.post("/Commerce/UpdateProviderChargeFrameworks",{partnershipId:n,chargeFrameworks:t},function(n){n.result?(cleanBookNotification.updateSuccess(),$("#b2b-delivery-charge-mgmt").modal("hide")):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function loadPriceListsByLocationId(n){$(".plist").fadeIn();var t=$("#slPriceList");$.get("/Commerce/GetPriceLists?lid="+$(n).val(),function(n){t.select2("destroy");t.empty();t.select2({placeholder:"Please select",data:n})})}function agreeTerms(n){$.post("/Commerce/AgreeTerms",{partnershipId:n},function(n){if(n.result){cleanBookNotification.updateSuccess();var i=$(".provider-name").text(),t=$("#agreeterms");t.removeClass("btn-success");t.attr("disabled",!0);t.removeAttr("onclick");t.addClass("btn-info");t.text(i+" reviewing")}else!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function finaliseAgreement(n){$.post("/Commerce/FinaliseAgreement",{partnershipId:n},function(t){t.result?(cleanBookNotification.updateSuccess(),loadLogisticsPartnershipContent(n,!0),$("#logs-draft button").attr("disabled",!0),loadPartnershipsContent($("#hdfRelationshipId").val())):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})}function refreshLogisticsView(){var n=$("#hdfParnershipId").val();n&&loadLogisticsPartnershipContent(n,!1);loadPartnershipsContent($("#hdfRelationshipId").val())}function moveModalIntoBody(n){var t=$(n);t.length>0&&($("body "+n).remove(),t.appendTo("body"))}function searchTop10TraderContact(){var n=$("#contact-finder .widget-contacts");n.LoadingOverlay("show");n.load("/TraderContact/SearchTop10ContactContent",{keyword:$("#contact-finder input[name=search]").val()},function(){n.LoadingOverlay("hide",!0)})}function loadContactDetail(n){var t=$("#contact-finder .welcome-info");$("#contact-finder .contact").fadeIn();$("#contact-finder .contact-list").hide();t.LoadingOverlay("show");t.load("/TraderContact/TradingContactInfoContent",{contactId:n},function(){t.LoadingOverlay("hide",!0)})}function chooseContact(){var n=JSON.parse($("#hdfContactJsonInfo").val());$("#contact-id").val(n.Id);$(".contact-name").text(n.Name);$("a.contact-email").attr("href","mailto:"+n.Email);$("a.contact-email").text(n.Email);$(".contact-tel").text(n.Phone);$(".contact-address").text(n.Address);$(".contact-avatar").css("background-image","url('"+n.AvartarUri+"')");$("#contact-finder").modal("hide");$("#btnConfirmContact").show();$("#btnConfirmNewContact").hide()}function setcontact(){if($("#frm-confirm-b2bcontact").valid()){var n={relationshipId:$("#hdfRelationshipId").val(),contactId:$("#contact-id").val(),groupId:$("#frm-confirm-b2bcontact select[name=group]").val(),workgroupId:$("#frm-confirm-b2bcontact select[name=workgroup]").val()};$.LoadingOverlay("show");$.post("/Commerce/SetContactForB2BRelationship",n,function(n){n.result?($("#confirm-approval-modal").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Commerce"),$("ul.app_main_nav a").removeClass("depend"),$(".contactopts").remove()):!n.result&&n.msg?cleanBookNotification.error(_L(data.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce");LoadingOverlayEnd()})}}function setExistContact(){var n=$("#contact-id").val(),t;if(n=="0"||!n){cleanBookNotification.error("Please choose a Contact.","Qbicles");return}t={relationshipId:$("#hdfRelationshipId").val(),contactId:n,groupId:0,workgroupId:0};$.LoadingOverlay("show");$.post("/Commerce/SetContactForB2BRelationship",t,function(n){n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"),$("ul.app_main_nav a").removeClass("depend"),$(".contactopts").remove()):!n.result&&n.msg?cleanBookNotification.error(_L(data.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");LoadingOverlayEnd()})}function savecontactgroup(n){var t=$("#contact-group-edit-name").val()+"";if(t.trim()===""){cleanBookNotification.error(_L("ERROR_MSG_374"),"Qbicles");return}$.ajax({type:"post",url:"/TraderConfiguration/SaveContactGroup",data:{group:{Id:0,Name:t,saleChannelGroup:n}},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?(cleanBookNotification.createSuccess(),reloadContactGroup(t),$("#add-contact-group").modal("hide")):n.actionVal===2?(cleanBookNotification.updateSuccess(),reloadContactGroup(t),$("#add-contact-group").modal("hide")):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_375"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){})}function reloadContactGroup(n){var t=null;$.get("/TraderContact/GetContactGroups",function(i){t=i.find(t=>t.text===n);t?$("#contact-groups-select").select2({data:i}).val(t.id).trigger("change"):$("#contact-groups-select").select2({data:i})})}var countPost=1,countMedia=1,busycomment=!1,wto;$(document).ready(function(){initPlugins()});