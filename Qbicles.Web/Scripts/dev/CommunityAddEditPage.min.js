function getTagsValue(){tagsOrigin=$.parseJSON($("#tagsValue").val())}function SaveProcessd(n){Validtion()&&(LoadingOverlay(),setTimeout(function(){SaveCreate(n);$.LoadingOverlay("hide")},2e3))}function Validtion(){var n=!0,t=!0,i=!0;return($("#new_ImageCaption").val()===""&&(cleanBookNotification.error(_L("ERROR_MSG_488"),"Qbicles"),n=!1),$("#tags_selected").val()===null&&(cleanBookNotification.error(_L("ERROR_MSG_489"),"Qbicles"),t=!1),$("#form-community-page").valid()||(i=!1),!n||!t||!i)?!1:!0}function SelectedTagsChange(){var t=$("#tags_selected").val(),n,i,r;if(t===null&&(t=[]),$("#form_keyword").empty(),tagsOrigin.length>0)for(n=0;n<tagsOrigin.length;n++)if(t&&t.indexOf(tagsOrigin[n].Id.toString())!==-1){for(i="",r=0;r<tagsOrigin[n].ListKeyWord.length;r++)i+='<a href="javascript:void(0);" class="topic-label">',i+='<span style="margin-bottom:5px; margin-right:5px;" class="label label-info">'+tagsOrigin[n].ListKeyWord[r].Name+"<\/span><\/a>";$("#form_keyword").append(i)}$("select").not(".multi-select").select2()}function previewPage(){$(".previewPage").removeClass("hidden");$(".editPage").addClass("hidden");previewArticles();$("#preview_id_bodyText").empty();$("#preview_id_bodyText").append($("#edit_page_bodytext").val().replace(/(\r\n|\n)/g,"<br/>"));$("#preview-contact-email").text($("#contact-email").val().replace(/(\r\n|\n)/g,"<br/>"));$("#edit_status_alerts").val()==0?$("#app_main_nav_alerts").addClass("a-btn-disabled"):$("#app_main_nav_alerts").removeClass("a-btn-disabled");$("#edit_status_post").val()==0?$("#app_main_nav_post").addClass("a-btn-disabled"):$("#app_main_nav_post").removeClass("a-btn-disabled");$("#edit_status_file").val()==0?$("#app_main_nav_files").addClass("a-btn-disabled"):$("#app_main_nav_files").removeClass("a-btn-disabled");$("#edit_status_event").val()==0?$("#app_main_nav_events").addClass("a-btn-disabled"):$("#app_main_nav_events").removeClass("a-btn-disabled")}function returnEdit(){$(".editPage").removeClass("hidden");$(".previewPage").addClass("hidden")}function changeFeatureImage(n){if(ValidateFileImage(n)){var t=$("#file_feature_image");reader.onload=function(n){$("#show_featureimage").attr("src",n.target.result)};reader.readAsDataURL(t[0].files[0])}}function ValidtionUpdate(){var n=!0,t=!0;return($("#tags_selected").val()===null&&(cleanBookNotification.error(_L("ERROR_MSG_489"),"Qbicles"),n=!1),$("#form-community-page").valid()||(t=!1),!n||!t)?!1:!0}function updatePage(){ValidtionUpdate()&&(LoadingOverlay(),setTimeout(function(){SaveUpdate();$.LoadingOverlay("hide")},2e3))}function addArticles(){var i=!0,e=new RegExp(/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/),u,t,f,r,n;if($("#form_articles_name").val()===""&&(i=!1,$("#form-add-artile").validate().showErrors({article_title:"This field is required."})),$("#form_articles_source").val()===""&&(i=!1,$("#form-add-artile").validate().showErrors({article_source:"This field is required."})),$("#form_articles_image").val()!==""||isUpdate||(i=!1,$("#form-add-artile").validate().showErrors({article_image:"This field is required."})),$("#form_articles_url").val()===""?(i=!1,$("#form-add-artile").validate().showErrors({article_link:"This field is required."})):e.test($("#form_articles_url").val())||(i=!1,$("#form-add-artile").validate().showErrors({article_link:"This entry is not a web address."})),!i)return!1;u=$("#form_articles_url").val();isUpdate?($("#form_articles_image").clone(!0)[0].files.length>0&&($("tr#manage_articles_"+idBuild+" input.arrow_articles_file")[0].files=$("#form_articles_image").clone(!0)[0].files,$("tr#manage_articles_"+idBuild+" img.img-responsive").attr("src",imageStr)),$("tr#manage_articles_"+idBuild+" input.arrow_articles_title").val($("#form_articles_name").val()),$($("#manage_articles_"+idBuild+" td")[2]).find("span").text($("#form_articles_name").val()),$("tr#manage_articles_"+idBuild+" input.arrow_articles_url").val(u),$($("#manage_articles_"+idBuild+" td")[3]).find("a").attr("href","http://"+u),$("tr#manage_articles_"+idBuild+" input.arrow_articles_source").val($("#form_articles_source").val()),$($("#manage_articles_"+idBuild+" td")[3]).find("a").text($("#form_articles_source").val())):(t={Title:$("#form_articles_name").val(),Image:imageStr,file:$("#form_articles_image").clone(!0),url:u,isDisplay:!0,source:$("#form_articles_source").val()},idBuild=UniqueId(),f=$("tbody.body_table"),r=$("tbody.body_table tr"),r.length==1&&$("tbody.body_table tr.odd td").length===1&&(f.empty(),r=$("tbody.body_table tr")),n="",n+='<tr id="manage_articles_'+idBuild+'"> <td> <input type="hidden" class="savetrid" value="manage_articles_'+idBuild+'"/>',n+=" "+(r.length+1)+'<input type="hidden" class="arrow_displayorder" value="'+(r.length+1)+'"/> <input type="hidden" class="arrow_articles_id" value="0" />',n+='<\/td> <td> <img src="'+t.Image+'" class="img-responsive"> <input type="hidden" class="arrow_articles_image" value="" />',n+='<input type="file" class="arrow_articles_file hidden" /> <\/td> <td> <span style="font-size: 13px"> '+t.Title+' <\/span> <input type="hidden" class="arrow_articles_title" value="'+t.Title+'" />',n+='<\/td> <td> <input type="hidden" class="arrow_articles_url" value="'+t.url+'" /> ',n+='<input type="hidden" class="arrow_articles_source" value="'+t.source+'" />',n+=t.url.indexOf("http://")==0||t.url.indexOf("https://")==0?'<a href="'+t.url+'" target="_blank">'+t.source+"<\/a> <\/td> <td>  "+(new Date).toDateString()+" <\/td> <td>":'<a href="http://'+t.url+'" target="_blank">'+t.source+"<\/a> <\/td> <td>  "+(new Date).toDateString()+" <\/td> <td>",n+='<input type="checkbox" class="isDisabled_articles hidden" value="'+t.isDisplay+'" />',n+='<span class="label label-success unpublish label-lg">Active<\/span>  <span class="label label-danger public hidden label-lg">Hidden<\/span> <\/td> ',n+='<td class="text-right"> <div class="btn-group options">',n+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',n+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button> <ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',n+='<li><a href="javascript:void(0);" data-toggle="modal" onclick="editArticles(\''+idBuild+'\')" data-target="#app-community-article-add">Edit<\/a><\/li>',n+='<li class="unpublish"><a href="#" data-toggle="modal" onclick="unpublishArticles(\''+idBuild+'\', false)" data-target="#">Unpublish<\/a><\/li>',n+='<li class="public hidden"><a href="#" data-toggle="modal" onclick="unpublishArticles(\''+idBuild+'\', true)" data-target="#">Publish<\/a><\/li>',n+='<li><a href="javascript:void(0);" data-toggle="modal" id="confirmDelete(\''+idBuild+'\')" data-target="#">Delete<\/a><\/li> <\/ul> <\/div> <\/td> <\/tr>',f.append(n),$("tr#manage_articles_"+idBuild+" input.arrow_articles_file")[0].files=t.file[0].files,idBuild="");resetForm();imageStr=null;$("#app-community-article-add").modal("toggle")}function resetForm(){$("#form_articles_name").val("");$("#form_articles_url").val("");$("#form_articles_source").val("");$("#form_articles_image").val(null)}function changeImage(n){if(ValidateFileImage(n)){var t=$("#form_articles_image");reader.onload=function(n){imageStr=n.target.result};reader.readAsDataURL(t[0].files[0])}}function editArticles(n){resetForm();$("#form_articles_name").val($("#manage_articles_"+n+" input.arrow_articles_title").val());$("#form_articles_url").val($("#manage_articles_"+n+" input.arrow_articles_url").val());$("#form_articles_source").val($("#manage_articles_"+n+" input.arrow_articles_source").val());isUpdate=!0;idBuild=n;$("#app-community-article-add h5.title_articles").text("Edit an article");$("#app-community-article-add button.btn-success").text("Update")}function unpublishArticles(n,t){$("tr#manage_articles_"+n+" input.isDisabled_articles").val(t);t==!1?($("tr#manage_articles_"+n+" li.unpublish").addClass("hidden"),$("tr#manage_articles_"+n+" li.public").removeClass("hidden"),$("tr#manage_articles_"+n+" span.unpublish").addClass("hidden"),$("tr#manage_articles_"+n+" span.public").removeClass("hidden")):($("tr#manage_articles_"+n+" li.public").addClass("hidden"),$("tr#manage_articles_"+n+" li.unpublish").removeClass("hidden"),$("tr#manage_articles_"+n+" span.public").addClass("hidden"),$("tr#manage_articles_"+n+" span.unpublish").removeClass("hidden"))}function confirmDelete(n){idBuild=n}function cancelConfirm(){idBuild=""}function deleteArticles(){idBuild.length>0&&$("tr#manage_articles_"+idBuild).remove();$("#confirm-delete").modal("toggle")}function addNewArticles(){resetForm();isUpdate=!1;idBuild=""}function titleChange(){$("h4.title_preview").text($("#edit_page_title").val())}function changeCaption(){$("#preview_caption").text($("#edit_page_caption").val())}function previewArticles(){var i,n,t,f,r,u;for($("#listItem_articles").empty(),i=$("tbody.body_table tr"),n=[],t=0;t<i.length;t++)f={Title:$(i[t]).find("td input.arrow_articles_title").val(),Image:$(i[t]).find("td img.img-responsive").attr("src"),URL:$(i[t]).find("td input.arrow_articles_url").val(),DisplayOrder:$(i[t]).find("td input.arrow_displayorder").val(),IsDisplayed:$(i[t]).find("td input.isDisabled_articles").val()},f&&f.length>0&&f.IsDisplayed.toLowerCase()=="true"&&n.push(f);if(n.length>0){for(r='<div class="list_item">',u=0;u<n.length;u++)r+='<div class="item"> <div class="community-card"> <a href="javascript:void(0);">',r+='<div class="upper" style="background-image: url(\''+n[u].Image+"');\">&nbsp;<\/div>",r+='<\/a> <section class="info"> <a href="'+n[u].URL+'"> <h2>'+n[u].Title+"<\/h2>",r+="<span>"+n[u].DisplayOrder+"<\/span>  <\/a> <\/section> <\/div> <\/div>";r+="<\/div>";$("#listItem_articles").append(r);$("#listItem_articles .list_item").owlCarousel({responsive:{0:{items:1},480:{items:2},978:{items:1},1200:{items:2}},margin:30,nav:!1,dots:!0,loop:!0,autoplay:!0,autplayHoverPause:!0,autoplayTimeout:3e3})}}var tagsOrigin=null,reader=new FileReader,table=null;SaveCreate=function(n){var f={Id:$("#form_id").val(),Title:$("#new_title").val(),BodyText:$("#new_bodyText").val().trim(),FeaturedImageCaption:$("#new_ImageCaption").val(),FeaturedImage:$("#new_page_featureimage").val(),Qbicle:{Id:$("#new_qbicle_id").val()},AlertsDisplayStatus:$("#new_page_alerts").val(),FilesDisplayStatus:$("#new_page_files").val(),EventsDisplayStatus:$("#new_page_events").val(),PostsDisplayStatus:$("#new_page_postscomments").val(),ArticlesDisplayStatus:$("#new_page_articles").val(),PublicContactEmail:$("#contact-email").val()},h=[],e=$("#tags_selected").val(),o,t,i,r,s,u;if(e===null&&(e=[]),o=$("#keyword_selected").val(),tagsOrigin)for(t=0;t<tagsOrigin.length;t++){if(i={Id:0,AssociatedKeyWords:[]},e.indexOf(tagsOrigin[t].Id.toString())!==-1&&(i.Id=tagsOrigin[t].Id),tagsOrigin[t].ListKeyWord&&tagsOrigin[t].ListKeyWord.length>0)for(r=0;r<tagsOrigin[t].ListKeyWord.length;r++)o&&o.indexOf(tagsOrigin[t].ListKeyWord[r].Id.toString())!==-1&&i.AssociatedKeyWords.push({Id:tagsOrigin[t].ListKeyWord[r].Id});i.Id>0&&h.push(i)}f.Tags=h;s=new FormData;u=$("#new_featured_image");s.append("featureimage",u[0].files[0]);u.length>0&&u[0].files.length>0&&$.ajax({type:"post",url:"/CommunityAddEdit/UpdateFeature",data:s,contentType:!1,processData:!1,dataType:"json",success:function(t){t.actionVal==1?(f.FeaturedImage=t.Object,$("#new_page_featureimage").val(t.Object),$.ajax({type:"post",url:"/CommunityAddEdit/SaveProceed",data:{page:f},dataType:"json",success:function(t){t.actionVal===1?(cleanBookNotification.createSuccess(),$("#form_id").val(t.Object),n||(window.location="/Community/EditPage?edit="+t.Object)):t.actionVal==2?(cleanBookNotification.updateSuccess(),n||(window.location="/Community/EditPage?edit="+t.Object)):t.actionVal==3&&cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})):(t.actionVal==3||t.actionVal==2)&&cleanBookNotification.error(t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};SaveUpdate=function(){var i={Id:$("#form_id").val(),Title:$("#edit_page_title").val(),BodyText:$("#edit_page_bodytext").val().trim(),FeaturedImageCaption:$("#edit_page_caption").val(),FeaturedImage:$("#edit_page_featureimage").val(),Qbicle:{Id:$("#qbicles_page").val()},AlertsDisplayStatus:$("#edit_status_alerts").val(),FilesDisplayStatus:$("#edit_status_file").val(),EventsDisplayStatus:$("#edit_status_event").val(),PostsDisplayStatus:$("#edit_status_post").val(),ArticlesDisplayStatus:$("#edit_status_articles").val(),PublicContactEmail:$("#contact-email").val()},l=[],o=$("#tags_selected").val(),s,u,f,r,t,n,c,e;if(o===null&&(o=[]),s=$("#keyword_selected").val(),tagsOrigin)for(n=0;n<tagsOrigin.length;n++){if(u={Id:0,AssociatedKeyWords:[]},o.indexOf(tagsOrigin[n].Id.toString())!==-1&&(u.Id=tagsOrigin[n].Id),tagsOrigin[n].ListKeyWord&&tagsOrigin[n].ListKeyWord.length>0)for(f=0;f<tagsOrigin[n].ListKeyWord.length;f++)s&&s.indexOf(tagsOrigin[n].ListKeyWord[f].Id.toString())!==-1&&u.AssociatedKeyWords.push({Id:tagsOrigin[n].ListKeyWord[f].Id});u.Id>0&&l.push(u)}if(i.Tags=l,r=$("#edit_page_followers").val(),r&&r.length>0)for(t=0;t<r.length;t++)t===0?i.Follower_1={Id:r[t]}:t===1?i.Follower_2={Id:r[t]}:t===2?i.Follower_3={Id:r[t]}:t===3?i.Follower_4={Id:r[t]}:t===4&&(i.Follower_5={Id:r[t]});var a=$("tbody.body_table tr td").find("input.savetrid"),v=$("tbody.body_table tr td").find("input.arrow_articles_file"),h=new FormData;for(n=0;n<a.length;n++)v[n].files.length>0&&h.append($(a[n]).val(),v[n].files[0]);c=new FormData;e=$("#file_feature_image");c.append("featureImage",e[0].files[0]);e.length>0&&e[0].files.length>0?$.ajax({type:"post",url:"/CommunityAddEdit/UpdateFeature",data:c,contentType:!1,processData:!1,dataType:"json",success:function(n){n.actionVal===1?(i.FeaturedImage=n.Object,$("#edit_page_featureimage").val(n.Object),$.ajax({type:"post",url:"/CommunityAddEdit/UpdateImage",data:h,contentType:!1,processData:!1,dataType:"json",success:function(n){var f,u,r,e,t,o;if(n.actionVal===1){for(f=n.Object==null?[]:n.Object,u=0;u<f.length;u++)$("#"+f[u].Id+" input.arrow_articles_image").val(f[u].Image);for(r=$("tbody.body_table tr"),e=[],t=0;t<r.length;t++)o={Id:$(r[t]).find("td input.arrow_articles_id").val(),Title:$(r[t]).find("td input.arrow_articles_title").val(),Image:$(r[t]).find("td input.arrow_articles_image").val(),Source:$(r[t]).find("td input.arrow_articles_source").val(),IsDisplayed:$(r[t]).find("td input.isDisabled_articles").val(),URL:$(r[t]).find("td input.arrow_articles_url").val(),DisplayOrder:$(r[t]).find("td input.arrow_displayorder").val()},e.push(o);i.Articles=e;$.ajax({type:"post",url:"/CommunityAddEdit/SaveProceed",data:{page:i},dataType:"json",success:function(n){n.actionVal==2?(cleanBookNotification.updateSuccess(),window.location="/Community/CommunityPage?id="+n.msgId):n.actionVal==3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}else(n.actionVal==3||n.actionVal==2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):(n.actionVal==3||n.actionVal==2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}):$.ajax({type:"post",url:"/CommunityAddEdit/UpdateImage",data:h,contentType:!1,processData:!1,dataType:"json",success:function(n){var f,u,r,e,t,o;if(n.actionVal===1){for(f=n.Object==null?[]:n.Object,u=0;u<f.length;u++)$("#"+f[u].Id+" input.arrow_articles_image").val(f[u].Image);for(r=$("tbody.body_table tr"),e=[],t=0;t<r.length;t++)o={Id:$(r[t]).find("td input.arrow_articles_id").val(),Title:$(r[t]).find("td input.arrow_articles_title").val(),Image:$(r[t]).find("td input.arrow_articles_image").val(),Source:$(r[t]).find("td input.arrow_articles_source").val(),IsDisplayed:$(r[t]).find("td input.isDisabled_articles").val(),URL:$(r[t]).find("td input.arrow_articles_url").val(),DisplayOrder:$(r[t]).find("td input.arrow_displayorder").val()},e.push(o);i.Articles=e;$.ajax({type:"post",url:"/CommunityAddEdit/SaveProceed",data:{page:i},dataType:"json",success:function(n){n.actionVal==2?(cleanBookNotification.updateSuccess(),window.location="/Community/CommunityPage?id="+n.msgId):n.actionVal==3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}else(n.actionVal==3||n.actionVal==2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};var imageStr=null,idBuild="",isUpdate=!1;