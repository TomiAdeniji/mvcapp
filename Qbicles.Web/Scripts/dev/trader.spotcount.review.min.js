function UpdateStatusApproval(n){var t=$("#action_approval_default").val();$.LoadingOverlay("show");CheckStatusApproval(n).then(function(i){if(LoadingOverlayEnd(),i.result&&i.Object.toLocaleLowerCase()==t.toLocaleLowerCase()){$("#approval-button div.loading-approval").removeClass("hidden");$("#approval-button div.general-approval").addClass("hidden");$("#approval-button").addClass("animated shake disabled");$("#spot-count-item-tbody").addClass("disabled");var r=$("#action_approval").val();LoadingOverlay();$.ajax({url:"/Qbicles/SetRequestStatusForApprovalRequest",type:"GET",dataType:"json",data:{appKey:n,status:r},success:function(n){LoadingOverlayEnd();n.actionVal>0&&RenderContentUpdated(!0)},error:function(){$("#spot-count-item-tbody").removeClass("disabled");$("#approval-button div.loading-approval").addClass("hidden");$("#approval-button div.general-approval").removeClass("hidden");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");LoadingOverlayEnd()}})}else cleanBookNotification.error(_L("ERROR_MSG_247"),"Qbicles"),setTimeout(function(){RenderContentUpdated()},1500)})}function RenderContentUpdated(n){$.LoadingOverlay("show");$("#sport_content").empty();$("#sport_content").load("/TraderSpotCount/UpdateSpotCountContent?id="+$traderSpotCountId,function(){LoadingOverlayEnd();n&&setTimeout(function(){cleanBookNotification.updateSuccess()},400)})}function UpdateItems(n){$.LoadingOverlay("show");CheckStatus($traderSpotCountId,"SportCount").then(function(t){var u,i,r,e;if(LoadingOverlayEnd(),t.result&&t.Object!="StockAdjusted"){if($.LoadingOverlay("show"),u=[],i=$("#tb_form_item tbody tr"),i.length>0)for(r=0;r<i.length;r++){var f=parseInt($($(i[r]).find("td.row_id input")).val()),o=$($(i[r]).find("td.row_unit select")).val().split("|"),s={Id:isNaN(f)?0:f,CountUnit:{Id:o[1]},Adjustment:parseFloat($($(i[r]).find("td.row_adjustment input")).val()),SpotCountValue:parseFloat($($(i[r]).find("td.row_spotcountvalue input")).val()),SavedInventoryCount:parseFloat($($(i[r]).find("td.row_savedinventorycount input")).val()),Notes:$($(i[r]).find("td.row_spotcountnote input")).val()};u.push(s)}e={Id:$traderSpotCountId,ProductList:u};$.ajax({type:"post",url:"/TraderSpotCount/UpdateSportCountItems",data:{spotCount:e},dataType:"json",success:function(t){LoadingOverlayEnd();t.actionVal===2?n&&cleanBookNotification.updateSuccess():t.actionVal===3&&cleanBookNotification.error(t.msg,"Qbicles")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}else t.result&&t.Object=="StockAdjusted"?cleanBookNotification.error(_L("ERROR_MSG_272"),"Qbicles"):t.result==!1&&cleanBookNotification.error(_L("ERROR_MSG_380",[t.msg]),"Qbicles")})}function SelectedChangeBu(){disable===""&&UpdateItems(!0)}function OnFocusOutControl(n){strValueChanged=n;strValueChanged!==strValueOld&&UpdateDescription()}function OnFocusControl(n){strValueOld=n}function UpdateDescription(){$.LoadingOverlay("show");var n={Id:$traderSpotCountId,Description:strValueChanged};$.ajax({type:"post",url:"/TraderSpotCount/UpdateDescription",data:{spotCount:n},dataType:"json",success:function(n){LoadingOverlayEnd();n.actionVal===2?cleanBookNotification.updateSuccess():n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}var $traderSpotCountId=$("#trader-spot-count-id").val(),disable="",strValueOld,strValueChanged;$(function(){$("textarea").each(function(){$(this).val($(this).val().trim())})});$traderSpotCountId=$("#trader-spot-count-id").val();strValueOld="";strValueChanged="";