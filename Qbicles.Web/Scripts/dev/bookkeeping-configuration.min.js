function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");BKAccount={Id:t,Name:i};closeSelected();$("#app-bookkeeping-treeview").modal("toggle")}function BKResetForm(n){ClearError();$("#"+n)[0].reset();$("#"+n).validate().resetForm()}function clickAddDimension(){BKResetForm("form_dimension_add")}function EditDimension(n){BKResetForm("form_dimension_edit");$.ajax({type:"get",url:"/Bookkeeping/GetEditDimensionById",data:{id:n},dataType:"json",success:function(n){$("#dimension-edit-id").val(n.Id);$("#dimension-edit-name").val(n.Name);$("#dimension-edit-createby").val(n.CreateBy);$("#dimension-edit-createdate").val(n.CreateDate)},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function addDimension(){$("#form_dimension_add").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveDimension",data:{Name:$("#addnew-dimension-name").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?(cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-dimensions").load("/Bookkeeping/DimensionPartial")},500),$("#app-dimension-add").modal("toggle")):n.actionVal===2?(cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-dimensions").load("/Bookkeeping/DimensionPartial")},500),$("#app-dimension-edit").modal("toggle")):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){BKResetForm()})}function updateDimension(){$("#form_dimension_edit").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveDimension",data:{Id:$("#dimension-edit-id").val(),Name:$("#dimension-edit-name").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?($("#app-dimension-add").modal("toggle"),cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-dimensions").load("/Bookkeeping/DimensionPartial")},500)):n.actionVal===2?($("#app-dimension-edit").modal("toggle"),cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-dimensions").load("/Bookkeeping/DimensionPartial")},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){BKResetForm()})}function ConfirmDeleteDimension(n,t){$("#label-confirm-dimension").text("Do you want delete dimension: "+t);$("#id-itemdimension-delete").val(n)}function deleteDimension(){$.ajax({type:"delete",url:"/Bookkeeping/DeleteDimension",data:{id:$("#id-itemdimension-delete").val()},dataType:"json",success:function(n){n==="OK"?(cleanBookNotification.removeSuccess(),setTimeout(function(){$("#tab-dimensions").load("/Bookkeeping/DimensionPartial")},500)):n==="Fail"&&cleanBookNotification.removeFail()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$(".modal-cancel").click()}})}function addGroup(){BKResetForm("form_group_add")}function editJournalGroup(n){BKResetForm("form_group_edit");$.ajax({type:"get",url:"/Bookkeeping/GetEditJournalGroupById",data:{id:n},dataType:"json",success:function(n){var t,i;if(!n)return!1;t=n;$("#subgroup-edit-id").val(t.Id);$("#subgroup-edit-name").val(t.Name);i=eval(("new "+t.CreatedDate).replace(/\//g,""));$("#subgroup-edit-createby").val(t.CreatedBy);$("#subgroup-edit-createdate").val(moment(i).format("YYYY-MM-DD"))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function addJournalGroup(){$("#form_group_add").submit(function(n){n.preventDefault();$("#form_group_add").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveJournalGroup",data:{Name:$("#journalgroup-name").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?($("#app-coa-subgroup-add").modal("toggle"),cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-groups").load("/Bookkeeping/JournalGroupPartial",function(){addJournalGroup()})},500)):n.actionVal===2?($("#app-coa-subgroup-edit").modal("toggle"),cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-groups").load("/Bookkeeping/JournalGroupPartial",function(){addJournalGroup()})},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})})}function updateJournalGroup(){$("#form_group_edit").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveJournalGroup",data:{Id:$("#subgroup-edit-id").val(),Name:$("#subgroup-edit-name").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?($("#app-coa-subgroup-add").modal("toggle"),cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-groups").load("/Bookkeeping/JournalGroupPartial")},500)):n.actionVal===2?($("#app-coa-subgroup-edit").modal("toggle"),cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-groups").load("/Bookkeeping/JournalGroupPartial")},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function confirmDeleteJournalGroup(n,t){$("#label-confirm-journalgroup").text("Do you want delete journal group : "+t);$("#id-itemjournalgroup-delete").val(n)}function deleteJournalGroup(){$.ajax({type:"delete",url:"/Bookkeeping/DeleteJournalGroup",data:{id:$("#id-itemjournalgroup-delete").val()},dataType:"json",success:function(n){n==="OK"?(cleanBookNotification.removeSuccess(),setTimeout(function(){$("#tab-groups").load("/Bookkeeping/JournalGroupPartial")},500)):n==="Fail"&&cleanBookNotification.removeFail()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function addClickTemplate(){BKResetForm("form_template_add")}function addTemplate(){$("#form_template_add").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveTemplate",data:{Name:$("#add-template-name").val(),Description:$("#add-template-description").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?($("#app-template-add").modal("toggle"),cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-templates").load("/Bookkeeping/TemplatePartial")},500)):n.actionVal===2?($("#app-template-add").modal("toggle"),cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-templates").load("/Bookkeeping/TemplatePartial")},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function editTemplate(n){BKResetForm("form_template_edit");$.ajax({type:"get",url:"/Bookkeeping/GetEditTemplateById",data:{id:n},dataType:"json",success:function(n){$("#edit-template-id").val(n.Id);$("#edit-template-name").val(n.Name);$("#edit-template-description").val(n.Description)},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function updateTemplate(){$("#form_template_edit").valid()&&$.ajax({type:"post",url:"/Bookkeeping/SaveTemplate",data:{Id:$("#edit-template-id").val(),Name:$("#edit-template-name").val(),Description:$("#edit-template-description").val()},dataType:"json",success:function(n){n.result===!0?n.actionVal===1?($("#app-template-edit").modal("toggle"),cleanBookNotification.createSuccess(),setTimeout(function(){$("#tab-templates").load("/Bookkeeping/TemplatePartial")},500)):n.actionVal===2?($("#app-template-edit").modal("toggle"),cleanBookNotification.updateSuccess(),setTimeout(function(){$("#tab-templates").load("/Bookkeeping/TemplatePartial")},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function confirmDeleteTemplate(n,t){$("#label-confirm-template").text("Do you want delete template : "+t);$("#id-template-delete").val(n)}function deleteTemplate(){$.ajax({type:"delete",url:"/Bookkeeping/DeleteTemplate",data:{id:$("#id-template-delete").val()},dataType:"json",success:function(n){n==="OK"?(cleanBookNotification.removeSuccess(),$("#tab-templates").load("/Bookkeeping/TemplatePartial")):n==="Fail"&&cleanBookNotification.removeFail()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function loadManageTemplate(){$("#modal-content-repconfig").LoadingOverlay("show");$("#modal-content-repconfig").load("/Bookkeeping/ConfigReportIncome",function(){$("select.select2").select2({placeholder:"Please select"});$("#modal-content-repconfig").LoadingOverlay("hide",!0)})}function saveConfigTemplate(){if(BKReportConfiguration.length==0){$("#report-usage-income").modal("hide");return}$.LoadingOverlay("show");$.ajax({method:"POST",url:"/Bookkeeping/SaveConfigReportIncome",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(BKReportConfiguration)}).done(function(n){$.LoadingOverlay("hide",!0);n.result?($("#report-usage-income").modal("hide"),BKReportConfiguration=[],cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Bookkeeping")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Bookkeeping")})}function addRevenue(n,t,i){var u=$(t),r;u.validate({ignore:[],rules:{title:{required:!0,maxlength:150,minlength:3}}});u.valid()&&(r=$.grep(BKReportConfiguration,function(n){return n.revId==i}),r.length>0?(r.title=$(t+' input[name="title"]').val(),r.expId=$(t+' select[name="expId"]').val(),r.action="Add"):(r={title:$(t+' input[name="title"]').val(),expId:$(t+' select[name="expId"]').val(),revId:i,action:"Add"},BKReportConfiguration.push(r)),$(n).parent().parent().parent().parent().hide(),$("#success_expense_"+i).text(" - "+$(t+' select[name="expId"] option:selected').text()),$("#success_subtitle_"+i).text(" "+r.title),$("#calcfirstitem_"+i).show(),$(".exp_"+r.expId).remove(),$("select.select2").select2({placeholder:"Please select"}))}function removeSubtotal(n,t){$("#modal-content-repconfig").LoadingOverlay("show");var i=$.grep(BKReportConfiguration,function(n){return n.revId==t});i.length>0?(i.expId=n,i.action="Remove"):(i={title:"",expId:n,revId:t,action:"Remove"},BKReportConfiguration.push(i));$.ajax({method:"POST",url:"/Bookkeeping/SaveConfigReportIncome",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(BKReportConfiguration)}).done(function(n){n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Bookkeeping"),loadManageTemplate()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Bookkeeping")})}function initCurrency(){$("#frmCurrencyConfiguration").submit(function(n){n.preventDefault();var t=$("select[name=CurrencySymbol]").val(),i=$("select[name=SymbolDisplay]").val(),r=$("select[name=DecimalPlace]").val();$.ajax({type:"post",url:this.action,data:{CurrencySymbol:t,SymbolDisplay:i,DecimalPlace:r},dataType:"json",success:function(n){if(n.result){cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles");var u="resetSettings('"+t+"','"+i+"','"+r+"')";$("#btnCurrencyReset").attr("onclick",u)}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})})}function resetSettings(n,t,i){$("select[name=CurrencySymbol]").val(n).trigger("change");$("select[name=SymbolDisplay]").val(t).trigger("change");$("select[name=DecimalPlace]").val(i).trigger("change")}var BKReportConfiguration=[];$(document).ready(function(){$("#approval_process_attachment_qbicles").change(function(){$("#approval_process_attachment_qbicles").val()>0?$.ajax({type:"get",url:"/Bookkeeping/GetTopicsByQbicleId",data:{qbicleId:$("#approval_process_attachment_qbicles").val()},dataType:"json",success:function(n){$("#journal_topic_attachment").empty().append('<option selected value="0">Select topic<\/option>');$("#select2-journal_topic_attachment-container").text("Select topic");$.each(n,function(n,t){$("#journal_topic_attachment").append($("<option><\/option>",{value:t.Id,text:t.Name}))})},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}):($("#journal_topic_attachment").empty().append('<option selected value="0">Select topic<\/option>'),$("#select2-journal_topic_attachment-container").text("Select topic"))});$("#defaultsavesettings").click(function(){var n={Id:$("#bkappsettingHiden").val(),AttachmentQbicle:{Id:$("#approval_process_attachment_qbicles").val()},AttachmentDefaultTopic:{Id:$("#journal_topic_attachment").val()}};if(n.AttachmentQbicle.Id==="0"){cleanBookNotification.error("Default Qbicle to assign attachments is required!","Qbicles");return}if(n.AttachmentDefaultTopic.Id==="0"){cleanBookNotification.error("Default topic to assign attachments is required!","Qbicles");return}$.LoadingOverlay("show");$.ajax({type:"post",url:"/Bookkeeping/DefaultSaveSetting",data:n,dataType:"json",success:function(n){n.result===!0?n.actionVal===1?cleanBookNotification.createSuccess():n.actionVal===2&&cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})});initCurrency();addJournalGroup()});