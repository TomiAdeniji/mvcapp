function LoadApps(){cleanBookNotification.clearmessage();$.ajax({url:"/Approvals/LoadApproval/",cache:!1,type:"POST",success:function(n){n.length!==0&&$(n.ModelString).insertAfter("#app-content").hide().fadeIn(1e3)},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function SaveApprovalAppGroup(){$("#form-approval-group").valid()&&$.ajax({url:"/ApprovalApps/DuplicateApprovalGroupNameCheck",data:{groupId:$input_group_id.val(),groupName:$("#approval-group-name-input").val()},type:"GET",dataType:"json"}).done(function(n){n.result?$("#form-approval-group").validate().showErrors({name:"Approval Group name already in use."}):$("#form-approval-group").trigger("submit")}).fail(function(){$("form-approval-group").validate().showErrors({name:_L("ERROR_MSG_84")})})}function EditGroup(n){$("#button_edit_group_grid-"+n).hasClass("isDisabled")||(ClearError(),n&&n>0&&$.ajax({type:"GET",url:"/ApprovalApps/GetApprovalGroup",datatype:"json",data:{groupId:n},success:function(n){n.result?($("#form-approval-group").validate().resetForm(),$input_group_id.val(n.msgId),$input_group_name.val(n.msg),$modal_group_title.text("Edit Group"),$("#save-group").text("Confirm"),$modal_group.modal("toggle")):cleanBookNotification.error(_L("ERROR_MSG_85"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}))}function EditProcessApp(n,t,i){i.className.indexOf("isDisabled")!==0&&(ClearError(),ResetApprovalAppForm(),$("#approval-title").text("Edit Approval Request Process"),$approvalAppId=n,$approvalAppsGroupId.val(t),GetApprovalApps($approvalAppId).done(function(n){var t,i,r;n.Id&&($approvalAppId=n.Id,$approvalAppsGroupId.val(n.GroupId),$("#processImageUrl").val(n.ProcessImage),$("#approvalPicture").attr("src",n.ProcessImage),$("#approval_type").val(n.Type),n.Type===4?$("#initiates").hide():$("#initiates").show(),$("#approval_group").val(n.GroupId).trigger("change"),$("#approval_title").val(n.Name),$("#approval_description").val(n.Description),t=n.Initiate.split(","),$("#approval_Initiate").select2().val(t).change(),i=n.Reviewer.split(","),$("#approval_Reviewer").select2().val(i).change(),r=n.Approval.split(","),$("#approval_Approver").select2().val(r).change(),$("#pro-document-tr").append(n.DocumentHtml).hide().fadeIn(1e3),$modal_app.modal("toggle"))}))}function GetApprovalApps(n){return $.ajax({url:"/ApprovalApps/GetApprovalApp",type:"GET",dataType:"json",data:{approvalAppId:n}})}function approvalPictureChange(n){readURL(n,"approvalPicture")}function ValidApprovalTab(){$("#form_approval_app_addedit").valid()?NextTab(2):NextTab(-1)}function AddNewApprovalApp(n){ResetApprovalAppForm();n===0?$approvalAppsGroupId.val($("#approval_group option:first").val()):$approvalAppsGroupId.val(n);$("#approval-title").text("Create a Request Process");$modal_app.modal("toggle")}function ResetApprovalAppForm(){ClearApprovalAppForm();ClearDocumentForm();ClearRolesForm();ClearError();$(document).find(".active").removeClass("active");$(".toggleable").hide();$("#approval_related option:first").attr("selected","selected");$("#pro-document-tr").empty();$("#tab1").addClass("in active");$("#tab1-li").addClass("in active");$("#related_items").empty();$("#initiates").show()}function ClearApprovalAppForm(){document.getElementById("form_approval_app_addedit").reset();ClearApprovalAppPicture();$approvalAppId=0}function ClearApprovalAppPicture(){$("#approvalPictureId").val("");$("#approvalPicture").attr("src","https://www.placehold.it/300x250/EFEFEF/AAAAAA&text=no+image+selected")}function ClearRolesForm(){document.getElementById("form_approval_role_addedit").reset();$("#approval_Initiate").select2("val","");$("#approval_Reviewer").select2("val","");$("#approval_Approver").select2("val","")}function ApprovalFinishAndSave(){$(".approval-app-form input").each(function(){if($.trim($(this).val()).length===0){$(document).find(".active").removeClass("active");$("#tab1").addClass("in active");$("#tab1-li").addClass("in active");$("#form_process_addedit").trigger("submit");return}});var t=$(".pro-document-tr").map(function(){var n=$(this).attr("id");return{Document:$(this).find("#document-"+n).html(),DocumentImage:$(this).find("#documentImage-"+n).attr("data-url"),FileTypeId:$(this).find("#filetypeId-"+n).html()}}).get(),i=JSON.stringify(t),r=JSON.stringify($("#approval_Initiate").val()),u=JSON.stringify($("#approval_Reviewer").val()),f=JSON.stringify($("#approval_Approver").val()),e={Id:$approvalAppId,Name:$("#approval_title").val(),Description:$("#approval_description").val(),GroupId:$approvalAppsGroupId.val(),Initiate:r,Reviewer:u,Approval:f,ProcessImage:$("#processImageUrl").val(),Type:$("#approval_type").val()},o=$("#related_items .item"),n=[];o.each(function(t,i){n.push(i.id.split("-")[1])});$.ajax({type:"post",url:"/ApprovalApps/FinishAndSaveApproval",dataType:"json",data:{approvalApp:e,documents:i,formRelatedIds:n},success:function(n){n.result?($("#app-page-display").empty(),$("#app-page-display").html("<div id='app-content'><\/div>"),LoadApps(),$modal_app.modal("toggle"),$approvalAppId===0?cleanBookNotification.createSuccess():cleanBookNotification.updateSuccess()):($(document).find(".active").removeClass("active"),$("#tab1").addClass("in active"),$("#tab1-li").addClass("in active"),$("#form_approval_app_addedit").validate().showErrors({Title:n.msg}))}})}function ClearError(){$("label.error").hide();$(".error").removeClass("error");$("label.valid").hide();$(".valid").removeClass("valid")}function DeleteApproval(n,t,i){i.className.indexOf("isDisabled")>=0||n<=0||($liDelete=$("#approval-"+n),$appIdDelete=n,$("#confirm-del-app").show(),$("#app-name-confirm").text(t),$modal_app_remove.modal("toggle"))}function ApprovalDelete(){$appIdDelete<=0||$.ajax({type:"post",url:"/ApprovalApps/DeleteApprovalRequest",dataType:"json",data:{id:$appIdDelete},success:function(n){n.status?($modal_app_remove.modal("toggle"),$($liDelete).css("background-color","#FF3700"),$($liDelete).fadeOut(1500,function(){$($liDelete).remove()}),$appIdDelete=0,cleanBookNotification.removeSuccess()):cleanBookNotification.error(_L("ERROR_MSG_86"),"Qbicles")}})}function ViewProcessApp(n){ClearError();GetApprovalApps(n).done(function(n){n.Id&&($("#approval_group_view").val(n.GroupName),$("#approval_title_view").val(n.Name),$("#approval_description_view").val(n.Description),$("#approvalPictureView").attr("src",n.ProcessImage),$("#approval_type_view").val(n.TypeName),$("#approval_initiate_view").val(n.InitiateName),$("#approval_review_view").val(n.ReviewerName),$("#approval_approve_view").val(n.ApprovalName),$(document).find(".active").removeClass("active"),$("#tab1_view").addClass("in active"),$("#tab1-li_view").addClass("in active"),$("#view-trader-approval").modal("toggle"))})}var $button_add_group=$("#button_add_group"),$approvalAppsGroupId=$("#approval_group"),$approvalAppId=0,$appIdDelete=0,$liDelete=null,$modal_group=$("#modal_group"),$modal_group_title=$("#modal_group [class='modal-title']"),$input_group_id=$("#input_group_id"),$input_group_name=$("#approval-group-name-input"),$modal_app=$("#create-approval-type"),$modal_app_remove=$("#modal-delete-app");$(document).ready(function(){LoadApps();$button_add_group.bind("click",function(n){if(this.classList.contains("isDisabled")){n.preventDefault();return}ClearError();$input_group_id.val(0);$input_group_name.val("");$modal_group_title.text("Create a group");$modal_group.modal("toggle");$("#save-group").text("Add now")})});$("#form-approval-group").submit(function(n){n.preventDefault();$.ajax({type:this.method,url:this.action,data:{groupId:$input_group_id.val(),groupName:$("#approval-group-name-input").val()},dataType:"json",success:function(n){n.result?($("#app-page-display").empty(),$("#app-page-display").html("<div id='app-content'><\/div>"),LoadApps(),$modal_group.modal("toggle"),$input_group_id.val()==="0"?(cleanBookNotification.createSuccess(),$("#approval_group").prepend("<option value='"+n.msgId+"'>"+n.msgName+"<\/option>")):(cleanBookNotification.updateSuccess(),$('#approval_group [value="'+n.msgId+'"]').text(n.msgName))):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})});$("#form_approval_app_addedit").submit(function(n){n.preventDefault()});NextView=function(){$(document).find(".active").removeClass("active");$("#tab2_view").addClass("in active");$("#tab2-li_view").addClass("in active")};PreviousView=function(){$(document).find(".active").removeClass("active");$("#tab1_view").addClass("in active");$("#tab1-li_view").addClass("in active")};