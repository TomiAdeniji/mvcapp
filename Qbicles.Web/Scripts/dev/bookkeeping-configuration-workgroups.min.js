function RemoveRowTableMemberAdd(n){var t="add",f,i,r,u;for($wgId>0&&(t="edit"),f=$("#wg-table-members-"+t).DataTable(),f.destroy(),$("#wg-table-members-"+t+" tbody tr#tr_"+t+"_user_"+n).remove(),$("#wg-table-members-"+t).DataTable().draw(),i=$_approvers.length;i--;)$_approvers[i].Id===n&&$_approvers.splice(i,1);for(r=$_reviewers.length;r--;)$_reviewers[r].Id===n&&$_reviewers.splice(r,1);for(u=$_members.length;u--;)$_members[u].Id===n&&$_members.splice(u,1)}function CreateRowTable(n){var i="add",f,t;$wgId>0&&(i="edit");var r="",u="",e=$_approvers.filter(t=>t.Id===n.Id);return e.length>0&&(r="checked"),f=$_reviewers.filter(t=>t.Id===n.Id),f.length>0&&(u="checked"),t='<tr id="tr_'+i+"_user_"+n.Id+'">',t+='<td><div class="table-avatar mini" style="background-image: url(\''+n.Pic+"');\">&nbsp;<\/div><\/td>",t+="<td>"+n.Name+'<span id="span-approval-add-'+n.Id+"\" class='hidden'><\/span><span id=\"span-review-add-"+n.Id+"\" class='hidden'><\/span><\/td>",t+="<td><input "+r+" onchange=\"AddUsersApprovers(this.checked,'"+n.Id+'\',\'span-approval-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><input "+u+" onchange=\"AddUsersToReviewers(this.checked,'"+n.Id+'\',\'span-review-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><button class='btn btn-danger' onclick=\"RemoveRowTableMemberAdd('"+n.Id+"')\"><i class='fa fa-trash'><\/i><\/button><\/td>",t+"<\/tr>"}function CreateWorkgroupData(n){var t="add";n>0&&(t="edit");var u={Id:$("#wg-qbicle-"+t).val()},f={Id:$("#wg-topic-"+t).val()},r=[],i=$("#wg-process-"+t).val();return i!==null&&i.length>0&&(i=i.toString().split(","),$.each(i,function(n,t){var i={Id:t};r.push(i)})),{Id:n,Name:$("#wg-name-"+t).val(),Processes:r,Qbicle:u,Topic:f,Members:$_members,Reviewers:$_reviewers,Approvers:$_approvers}}function ConfirmDeleteWg(n){$wgIdDelete=n;$("#name-delete").text($("#wg-name-main-"+$wgIdDelete).text());$("#confirm-delete").modal("show")}function CancelDelete(){$("#confirm-delete").modal("hide")}function DeleteWG(){$.LoadingOverlay("show");$.ajax({type:"delete",url:"/BkWorkGroups/Delete",datatype:"json",data:{id:$wgIdDelete},success:function(n){if(n.result){$("#confirm-delete").modal("hide");var t=$("#wg-table").DataTable();t.destroy();$("#wg-table tbody tr#tr_workgroup_user_"+$wgIdDelete).remove();$("#wg-table").DataTable().draw();cleanBookNotification.removeSuccess()}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}var $_members=[],$_reviewers=[],$_approvers=[],$wgId=0,addTable,allTable,$wgIdDelete;$(".check-right").bootstrapToggle();$(".chosen-multiple").select2({multiple:!0});$("#wg-qbicle-add").on("change",function(){var n=$(this).val();InitTopic(n,"wg-topic-add")});InitTopic=function(n,t){if(n===null){console.error("qbicle Id is null.");return}$.ajax({type:"post",url:"/Topics/GetTopic2SelectByQbicle",datatype:"json",data:{qbicleId:n},success:function(n){n.result&&($("#"+t).empty().append(n.Object),$("#"+t).select2())},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})};ClearForm=function(n){var t,i;$_members=[];$_approvers=[];$_reviewers=[];$wgId=0;ReInitUsersEdit(0);ResetFormControl(n);t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active")[0].id==="step_2_add"&&$(t).find(".app_subnav .active").prev("li").find("a").trigger("click");i=$("#wg-table-members-add").DataTable();i.clear();i.destroy();$("#wg-process-add").val("").trigger("change");$("#app-trader-group-add").modal("show")};PreviousAdd=function(){var n=$(".btnNextAdd").closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")};$(".btnPreviousAdd").click(function(){var n=$(this).closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")});$(".btnNextAdd").click(function(){var n={Id:0,Name:$("#wg-name-add").val()};$("#form-wg-add").valid()&&$.ajax({url:"/BkWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});else{var t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click")}}).fail(function(n){$("#form-wg-add").validate().showErrors({wgNameAdd:"Error"+n})})});addTable=$("#wg-table-members-add");$("#search-right-add").on("change",function(){var n=$(this).val();addTable.DataTable().search(n,!0,!1,!0).draw()});$("#search-member-add").keyup(function(){addTable.DataTable().search($(this).val(),!0,!1,!0).draw()});allTable=$("#user-list");$("#search-right-all").on("change",function(){var n=$(this).val();n===null&&(n="");allTable.DataTable().search(n,!0,!1,!0).draw()});$("#search-member-all").keyup(function(){allTable.DataTable().search($(this).val(),!0,!1,!0).draw()});AddUsersToMembers=function(n,t,i,r){var f={Id:t,Name:i,Pic:r},u;if(n===!0)$_members.push(f);else for(u=$_members.length;u--;)$_members[u].Id===f.Id&&$_members.splice(u,1)};AddUsersToReviewers=function(n,t,i){var u={Id:t},r;if(n===!0)$_reviewers.push(u),$("#"+i+t).text("Reviewers");else for(r=$_reviewers.length;r--;)$_reviewers[r].Id===u.Id&&($_reviewers.splice(r,1),$("#"+i+t).text(""))};AddUsersApprovers=function(n,t,i){var u={Id:t},r;if(n===!0)$_approvers.push(u),$("#"+i+t).text("Approvers");else for(r=$_approvers.length;r--;)$_approvers[r].Id===u.Id&&($_approvers.splice(r,1),$("#"+i+t).text(""))};AddMemberToWorkgroup=function(){var n,t;$_members.length>0&&(n="add",$wgId>0&&(n="edit"),t=$("#wg-table-members-"+n).DataTable(),t.clear(),t.destroy(),$.each($_members,function(t,i){$("table#wg-table-members-"+n+" > tbody").prepend(CreateRowTable(i))}),$(".check-right").bootstrapToggle(),$("#wg-table-members-"+n).DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#wg-table-members-"+n).show())};CreateWorkgroup=function(){if(!$("#form-wg-add").valid()){PreviousAdd();return}if($("#wg-process-add").val()===null||$("#wg-process-add").val()===""){PreviousAdd();cleanBookNotification.error(_L("ERROR_MSG_454"),"Qbicles");return}$.LoadingOverlay("show");var n={Id:$wgId,Name:$("#wg-name-add").val()};$.ajax({url:"/BkWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result){$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});PreviousAdd();return}var t=CreateWorkgroupData(0);$.ajax({type:"post",url:"/BkWorkGroups/Create",datatype:"json",data:{wg:t},success:function(n){n.result?(cleanBookNotification.createSuccess(),$("#app-trader-group-add").modal("hide"),ReloadWorkgroup()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}).fail(function(n){$("#form-wg-add").validate().showErrors({wgNameAdd:"Error"+n});cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}).always(function(){LoadingOverlayEnd()})};ReloadWorkgroup=function(){var n="/Bookkeeping/WorkGroupPartial";$("#tab-workgroups").empty();$("#tab-workgroups").load(n,function(){n="/BKWorkGroups/BookkeepingNavigatePartial";$("#bk-navigate").load(n,function(){$(".modal-backdrop").remove()})})};QbicleEditChange=function(n){var t=$(n).val();InitTopic(t,"wg-topic-edit")};NextEdit=function(){var n={Id:$wgId,Name:$("#wg-name-edit").val()};$("#form-wg-edit").valid()&&$.ajax({url:"/BkWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-edit").validate().showErrors({wgNameEdit:"Name of Workgroup already exists."});else{var t=$(".btnNextEdit").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click");$("#step_1_edit").removeClass("active");$("#edit-specifics").removeClass("in active");$("#step_2_edit").addClass("active");$("#edit-members").addClass("in active")}}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n})})};PreviousEdit=function(){$("#step_2_edit").removeClass("active");$("#edit-members").removeClass("in active");$("#step_1_edit").addClass("active");$("#edit-specifics").addClass("in active")};Edit=function(n){$.LoadingOverlay("show");$("#workgroup-content-edit").empty();$_members=[];$_approvers=[];$_reviewers=[];PreviousEdit();$wgId=n;$("#search-right-all").val("").trigger("change");$.ajax({type:"post",url:"/BkWorkGroups/GetWorkGroupUser",datatype:"json",data:{id:n},success:function(n){$_members=n.Members;$_approvers=n.Approvers;$_reviewers=n.Reviewers},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}});ReInitUsersEdit(n);$("#workgroup-content-edit").empty();$("#workgroup-content-edit").load("/BkWorkGroups/Edit?id="+n,function(){LoadingOverlayEnd();$("#app-trader-group-edit").modal("show")})};ReInitUsersEdit=function(n){var t=$("#user-list").DataTable();t.clear();t.destroy();$.ajax({type:"post",url:"/BkWorkGroups/ReInitUsersEdit",datatype:"json",data:{id:n},success:function(n){n?($("table#user-list > tbody").prepend(n),$(".check-right").bootstrapToggle(),$("#user-list").DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#user-list").show()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})};UpdateWorkgroup=function(){if(!$("#form-wg-edit").valid()){PreviousAdd();PreviousEdit();return}if($("#wg-process-edit").val()===null||$("#wg-process-edit").val()===""){PreviousAdd();PreviousEdit();cleanBookNotification.error(_L("ERROR_MSG_454"),"Qbicles");return}$.LoadingOverlay("show");var n={Id:$wgId,Name:$("#wg-name-edit").val()};$.ajax({url:"/BkWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Name of Workgroup already exists."});PreviousEdit();return}var t=CreateWorkgroupData($wgId);$.ajax({type:"post",url:"/BkWorkGroups/Update",datatype:"json",data:{wg:t},success:function(n){n.result?(ReloadWorkgroup(),$("#app-trader-group-edit").modal("hide"),$(".modal-backdrop").remove(),cleanBookNotification.updateSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n});cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}).always(function(){LoadingOverlayEnd()})};$wgIdDelete=0;