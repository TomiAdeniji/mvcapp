function onSelectWorkgroup(n){filter.Workgroup=$(n).val();CallBackFilterDataTransferServeSide()}function onKeySearchChanged(n){filter.Key=$(n).val();CallBackFilterDataTransferServeSide()}function searchOnTableTransfer(){var i=[],n,t;if($("#filter-group").val()!==""&&$("#filter-group").val()!==null&&i.push($("#filter-group").val()),n=$("#search_transfer").val().split(" "),$("#search_transfer").val()!==""&&$("#search_transfer").val()!==null&&n.length>0)for(t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#trader-transfer-list").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#trader-transfer-list").val("")}function WorkGroupSelectedChange(){$(".preview-workgroup").show();$workgroupId=$("#transfer-workgroup-select").val();$workgroupId!==""?($.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderTransfers/getworkgroup?id="+$workgroupId,dataType:"json",success:function(n){LoadingOverlayEnd();n.result?($(".preview-workgroup table tr td.location_name").text(n.Object.Location),$(".preview-workgroup table tr td.workgroup_process").text(n.Object.Process),$(".preview-workgroup table tr td.workgroup_qbicle").text(n.Object.Qbicle),$(".preview-workgroup table tr td.workgroup_member span").text(n.Object.Members)):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""));EnableNextButton()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):(DisableNextButton(),$(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""))}function ShowGroupMember(){$("#app-trader-workgroup-preview").empty();$("#app-trader-workgroup-preview").load("/TraderTransfers/ShowListMemberForWorkGroup?wgId="+$workgroupId);$("#app-trader-workgroup-preview").modal("show")}function AddTransferAll(){$("#app-trader-purchase-transfer").empty();$("#app-trader-sale-transfer").empty();$.LoadingOverlay("show");$("#app-trader-transfer-modal").empty();$("#app-trader-transfer-modal").load("/TraderTransfers/TraderTransferAddEditPartial?id=0",function(){$("#app-trader-transfer-modal").modal("show");initSaleTransfer();initPurchaseTransfer();LoadingOverlayEnd()})}function tableSaleLoad(){var n=$("#sale-list-table");$.fn.DataTable.isDataTable("#sale-list-table")&&n.DataTable().destroy();n.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$.LoadingOverlay("show"):$.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[2,"desc"]],ajax:{url:"/TraderTransfers/GetByLocationPagination",data:function(n){return $.extend({},n,{daterange:$("#search_date_range").val()})}},columns:[{title:"#",data:"FullRef",searchable:!0,orderable:!0},{title:"Workgroup",data:"WorkgroupName",searchable:!0,orderable:!0,className:"workgroup"},{title:"Created date",data:"CreatedDate",searchable:!0,orderable:!0,className:"createdDate"},{title:"Contact",data:"Contact",searchable:!0,orderable:!0,className:"contact"},{title:"Dimensions",data:"Dimensions",searchable:!1,orderable:!1,className:"dimension"},{data:"SaleTotal",searchable:!0,orderable:!1,className:"total"},{title:"Active transfers",data:"TransferCount",searchable:!0,orderable:!1,className:"count"},{title:"Use",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:0,data:"FullRef",render:function(n,t,i){return'#<span class="saleid hidden">'+i.Id+'<\/span><span class="salekey hidden">'+i.Key+"<\/span><span>"+n+"<\/span>"}},{targets:3,data:"Contact",render:function(n){return'<a href="/Trader/AppTrader" onclick="setTabTrader("contacts")">'+n+"<\/a>"}},{targets:7,data:"Key",render:function(n,t,i){return'<button class="btn btn-success" onclick="SelectSale(\''+i.Key+'\');"><i class="fa fa-check"><\/i><\/button>'}}],rowId:function(n){return"tr_sale_"+n.Key}});$("#sale-table_filter").hide()}function tablePurchaseLoad(){var n=$("#purchase-list-table");$.fn.DataTable.isDataTable("#purchase-list-table")&&n.DataTable().destroy();n.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$.LoadingOverlay("show"):$.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[2,"desc"]],ajax:{url:"/TraderTransfers/GetByLocationPurchasePagination",data:function(n){return $.extend({},n,{daterange:$("#search_purchase_date_range").val()})}},columns:[{title:"#",data:"FullRef",searchable:!0,orderable:!0},{title:"Workgroup",data:"WorkgroupName",searchable:!0,orderable:!0,className:"workgroup"},{title:"Created date",data:"CreatedDate",searchable:!0,orderable:!0,className:"createdDate"},{title:"Contact",data:"Contact",searchable:!0,orderable:!0,className:"contact"},{title:"Dimensions",data:"Dimensions",searchable:!1,orderable:!1,className:"dimension"},{data:"SaleTotal",searchable:!0,orderable:!1,className:"total"},{title:"Active transfers",data:"TransferCount",searchable:!0,orderable:!1,className:"count"},{title:"Use",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:0,data:"FullRef",render:function(n,t,i){return'#<span class="purchaseid hidden">'+i.Id+"<\/span><span>"+n+"<\/span>"}},{targets:3,data:"Contact",render:function(n){return'<a href="/Trader/AppTrader" onclick="setTabTrader("contacts")">'+n+"<\/a>"}},{targets:7,data:"Id",render:function(n){return'<button class="btn btn-success" onclick="SelectPurchase('+n+');"><i class="fa fa-check"><\/i><\/button>'}}],rowId:function(n){return"tr_purchase_"+n.Id}});$("#purchase-table_filter").hide()}function TransferAddEditPointToPointSpecificsTab(){var n="/TraderTransfers/TransferAddEditPointToPointSpecificsTab?locationId="+$("#local-manage-select").val();$.LoadingOverlay("show");$("#point-to-point").load(n,function(){LoadingOverlayEnd()})}function NextToItemsTab(){var n,t,i;if($.LoadingOverlay("show"),$("#route_p2p").empty(),$("#route_goods").empty(),!$("#transfer-workgroup-select").val())return setTimeout(function(){$("#form_transferadd").validate().showErrors({workgourptransfer:"Workgroup is required"});$('.admintabs a[href="#transfer-specifics"]').tab("show");LoadingOverlayEnd()},500),!1;n="";$pointToPointId>0?(t=0,i=$("#transfer_type_add").val(),t=i==="#inbound"?$("#in-out-location").val():$("#local-manage-select").val(),n="/TraderTransfers/TransferAddEditPointToPointItemsTab?id="+t):$purchaseId>0?n="/TraderTransfers/TransferAddEditPurchaseItemsTab?purchaseId="+$purchaseId:$saleKey!=""&&(n="/TraderTransfers/TransferAddEditSaleItemsTab?saleKey="+$saleKey);$("#route_items").load(n,function(){LoadingOverlayEnd()})}function nextToItemsTransfer(){setTimeout(function(){$("#form_add_transaction")[0].reset();$("#form_add_transaction select").not(".multi-select").select2({placeholder:"Please select"});InitTransferItemSelect2Ajax("item-select",$("#trader-group-select").val(),$("#originating-location-select").val())},100)}function ChangeSelectedUnit(){if($("#item-select").val()===null||$("#item-select").val()===""){resetFormTransfer();return}$("#item_selected").empty();$("#item_selected").load("/TraderTransfers/UnitsSelectByItem?idLocation="+$("#local-manage-select").val()+"&idTraderItem="+$("#item-select").val().split(":")[0])}function removeRowItem(n){$("#tb_form_item tbody tr.tr_id_"+n).remove();validateItemsInTable()}function addRowTransferItem(){var r,u,t,n,f,i,e;$("#form_add_transaction").valid()&&(r=UniqueId(),u=$("#item_selected select").val(),checkQuantityTransItem($("#form_item_quantity")),t={Id:r,TraderItem:{Id:$("#item-select").val().split(":")[0],ImageUri:$("#item-select option:selected").attr("itemimage"),Name:$("#item-select option:selected").text()},Quantity:parseFloat($("#form_item_quantity").val()),Fee:parseFloat($("#item_fee").val())},n=$("#tb_form_template tbody tr").clone(),$(n).addClass("tr_id_"+t.Id),$($(n).find("td.row_image div")).attr("style","background-image: url('"+$("#api_url").val()+t.TraderItem.ImageUri+"&size=T');"),$($(n).find("td.row_name")).text(t.TraderItem.Name),$($(n).find("td.row_unit")).empty(),f=$("#item_selected select").clone(),$($(n).find("td.row_unit")).append(f),$($(n).find("td.row_unit select")).val(u),i=$($(n).find("td.row_quantity input")),i.val(t.Quantity),i.attr("onchange","checkQuantityTransItem(this,"+t.TraderItem.Id+")"),e=$($(n).find("td.row_fee input")),e.val(t.Fee),$($(n).find("td.row_button button")).attr("onclick","removeRowItem('"+t.Id+"')"),$($(n).find("td.row_button input.traderItem")).val($("#item-select").val()),$($(n).find("td.row_button input.row_id")).val(t.Id),$($(n).find("td select")).not(".multi-select").select2(),$("#tb_form_item tbody").append(n),validateItemsInTable(),resetFormTransfer(),$("#item-select").val("").trigger("change"))}function checkQuantityTransItem(n,t){var r=$("#transfer_type_add").val();if(r==="#outbound"){var u=$("#local-manage-select").val(),f=$(n).val(),i=$("#item-select").val();i=i&&!t?i.split(":")[0]:t;$.ajax({type:"post",url:"/TraderTransfers/GetCurrentInventory",data:{locationId:u,itemId:i},dataType:"json","async":!1,success:function(t){if(t&&t.currentInventory<f)return cleanBookNotification.error(_L("ERROR_MSG_382",[t.currentInventory]),"Qbicles"),$(n).val(t.currentInventory),$(n).focus(),LoadingOverlayEnd(),!1}}).always(function(){LoadingOverlayEnd()})}}function nextToConfirmP2PEdit(){$("#tranfer_form_id").val()==="0"?$("#transfer_type_add").val()==="#outbound"?($("#span-from").text($("#local-manage-select option:selected").text()),$("#span-to").text($("#in-out-location option:selected").text())):$("#transfer_type_add").val()==="#inbound"&&($("#span-to").text($("#local-manage-select option:selected").text()),$("#span-from").text($("#in-out-location option:selected").text())):($("#span-from").text($("#originating-location-select option:selected").text()),$("#span-to").text($("#destination-location-select option:selected").text()));$("#p-confirm-message").removeClass("hidden");$("#div-confirm").empty();ConfirmPointToPointTab();InitTableJs();return}function nextToConfirm(){$("#div-confirm").empty();InitMessageLocation();loadDataTableConfirm()}function loadDataTableConfirm(){$transferRequirement==="p2p"||$editMode!==""?ConfirmPointToPointTab():$transferRequirement==="goods_in"?ConfirmPurchaseTab():$transferRequirement==="goods_out"&&ConfirmSaleTab();InitTableJs()}function resetPurchaseForm(){$("#cpu").attr("disabled","true");$("#addNowForm").attr("disabled",!0)}function SendToPickup(n){var r={},t,f,e;if(r={Id:$("#transfer-workgroup-select").val()},r.Id===""||r.Id===null)return cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles"),!1;var o={Id:$("#sale-reference_id").val(),NumericPart:parseFloat($("#sale-refedit").text()),Type:$("#sale-reference_type").val(),Prefix:$("#sale-reference_prefix").val(),Suffix:$("#sale-reference_suffix").val(),Delimeter:$("#sale-reference_delimeter").val(),FullRef:$("#sale-reference_fullref").val()},u={Id:$("#transfer_model_id").val(),Status:n,Sale:{Key:$("#sale_model_key").val()},TransferItems:[],Workgroup:r,Reference:o},i=$("#transfer_sale_table tbody tr"),s=$("#transfer_sale_table tbody tr td");if(i.length>0&&s.length>1)for(t=0;t<i.length;t++)f=$($(i[t]).find("select.transfer_td_tran_unit")).val().split("|"),e={Id:$($(i[t]).find("input.transfer_td_id")).val(),TraderItem:{Id:$($(i[t]).find("input.saleitem_td_traderitem_id")).val()},Unit:{Id:f[1]},QuantityAtPickup:$($(i[t]).find("td.transfer_td_tran_quan input")).val(),TransactionItem:{Id:$($(i[t]).find("input.saleitem_td_id")).val()}},u.TransferItems.push(e);$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderTransfers/SaveTransfer",data:{transfer:u},dataType:"json",success:function(n){LoadingOverlayEnd();$("#app-trader-sale-transfer").modal("hide");n.actionVal===2?($("#app-trader-purchase-transfer").modal("hide"),cleanBookNotification.updateSuccess(),ShowTableTransferValue(!0)):n.actionVal===1&&(cleanBookNotification.createSuccess(),ShowTableTransferValue(!0))},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function SaveTransfer(n){var c,o,t,i,s,u,r,l,a,v,h,p;if($purchaseId>0){SavePurchaseTransfer(n);return}if($saleKey!=""){SaveSaleTransfer(n);return}if(c={Id:$("#reference_id").val(),NumericPart:parseFloat($("#refedit").text()),Type:$("#reference_type").val(),Prefix:$("#reference_prefix").val(),Suffix:$("#reference_suffix").val(),Delimeter:$("#reference_delimeter").val(),FullRef:$("#reference_fullref").val()},$.LoadingOverlay("show"),o=[],t=$("#tb_form_item tbody tr"),t===null||t.length===0){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_654"),"Qbicles");$('.admintabs a[href="#transfer-item-tab"]').tab("show");return}if(t.length>0)for(i=0;i<t.length;i++){if(s=parseInt($($(t[i]).find("td.row_button input.row_id")).val()),u={Id:0},$($(t[i]).find("td.row_button input.traderItem")).val().split(":").length>=1?u.Id=$($(t[i]).find("td.row_button input.traderItem")).val().split(":")[0]:u=null,r=$(t[i]).find("td.row_quantity input"),l=$(r).val(),checkQuantityTransItem(r,u.Id),l!==$(r).val()){$(r).focus();$('.admintabs a[href="#transfer-2"]').tab("show");return}a=$($(t[i]).find("td.row_unit select")).val().split("|");v={Id:isNaN(s)?0:s,TraderItem:u,QuantityAtPickup:$(r).val(),Unit:{Id:a[1]}};o.push(v)}var y={},f={},e={};y={Id:$workgroupId};h=$("#tranfer_form_id").val();h==="0"?$("#transfer_type_add").val()==="#outbound"?(f={Id:$("#local-manage-select").val()},e={Id:$("#in-out-location").val()}):$("#transfer_type_add").val()==="#inbound"&&(e={Id:$("#local-manage-select").val()},f={Id:$("#in-out-location").val()}):(e={Id:$("#destination-location-select").val()},f={Id:$("#originating-location-select").val()});p={Id:h,TransferItems:o,Status:n,OriginatingLocation:f,DestinationLocation:e,Workgroup:y,Reference:c};$.ajax({type:"post",url:"/TraderTransfers/SaveTransfer",data:{transfer:p},dataType:"json",success:function(n){LoadingOverlayEnd();n.actionVal===1?($("#app-trader-transfer-modal").modal("hide"),cleanBookNotification.createSuccess(),$("#div-confirm").empty(),ShowTableTransferValue(!0)):n.actionVal===2?($("#app-trader-transfer-modal").modal("hide"),cleanBookNotification.updateSuccess(),$("#div-confirm").empty(),ShowTableTransferValue(!0)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){LoadingOverlayEnd();cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function EditTransfer(n){$("#app-trader-purchase-transfer").empty();$("#app-trader-sale-transfer").empty();$("#app-trader-transfer-modal").empty();$("#app-trader-transfer-modal").load("/TraderTransfers/TraderTransferAddEdit?locationId="+$("#local-manage-select").val()+"&id="+n);$("#app-trader-transfer-modal").modal("show")}function ShowEditSaleTransfer(n,t){$.LoadingOverlay("show");$("#app-trader-purchase-transfer").empty();$("#app-trader-sale-transfer").empty();$("#app-trader-transfer-modal").empty();$("#div-confirm").empty();$editMode="Sale";$("#app-trader-sale-transfer").load("/TraderTransfers/EditSaleTransfer?id="+n+"&keySale="+t,function(){LoadingOverlayEnd();$("#app-trader-sale-transfer").modal("show")})}function ShowEditPurchaseTransfer(n,t){$.LoadingOverlay("show");$("#app-trader-purchase-transfer").empty();$("#app-trader-sale-transfer").empty();$("#app-trader-transfer-modal").empty();$editMode="Purchase";$("#app-trader-purchase-transfer").load("/TraderTransfers/EditPurchaseTransfer?id="+n+"&idPurchase="+t,function(){LoadingOverlayEnd();$("#app-trader-purchase-transfer").modal("show")})}function SaveSaleTransfer(n){var r,t,f,e;if($.LoadingOverlay("show"),r={Id:$workgroupId},r.Id===""||r.Id===null)return cleanBookNotification.error("Work group is required","Qbicles"),!1;var o={Id:$("#reference_id").val(),NumericPart:parseFloat($("#refedit").text()),Type:$("#reference_type").val(),Prefix:$("#reference_prefix").val(),Suffix:$("#reference_suffix").val(),Delimeter:$("#reference_delimeter").val(),FullRef:$("#reference_fullref").val()},u={Id:$("#transfer_model_id").val(),Status:n,Sale:{Key:$("#sale_model_key").val()},TransferItems:[],Workgroup:r,Reference:o},i=$("#transfer_sale_table tbody tr"),s=$("#transfer_sale_table tbody tr td");if(i.length>0&&s.length>1)for(t=0;t<i.length;t++)f=$($(i[t]).find("select.transfer_td_tran_unit")).val().split("|"),e={Id:$($(i[t]).find("input.transfer_td_id")).val(),TraderItem:{Id:$($(i[t]).find("input.saleitem_td_traderitem_id")).val()},Unit:{Id:f[1]},QuantityAtPickup:$($(i[t]).find("td.transfer_td_tran_quan input")).val(),TransactionItem:{Id:$($(i[t]).find("input.saleitem_td_id")).val()}},u.TransferItems.push(e);return $.ajax({type:"post",url:"/TraderTransfers/SaveTransfer",data:{transfer:u},dataType:"json",success:function(n){LoadingOverlayEnd();$("#app-trader-transfer-modal").modal("hide");n.actionVal===1&&cleanBookNotification.createSuccess();n.actionVal===2&&cleanBookNotification.updateSuccess();ShowTableTransferValue(!0)},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}),!1}function SavePurchaseTransfer(n){var r,t,f,e;if($.LoadingOverlay("show"),r={Id:$workgroupId},r.Id===""||r.Id===null)return cleanBookNotification.error("Work group is required","Qbicles"),!1;var o={Id:$("#purchase-reference_id").val(),NumericPart:parseFloat($("#purchase-refedit").text()),Type:$("#purchase-reference_type").val(),Prefix:$("#purchase-reference_prefix").val(),Suffix:$("#purchase-reference_suffix").val(),Delimeter:$("#purchase-reference_delimeter").val(),FullRef:$("#purchase-reference_fullref").val()},u={Id:$("#transfer_model_id").val(),Status:n,Purchase:{Id:$("#purchase_model_id").val()},TransferItems:[],Workgroup:r,Reference:o},i=$("#transfer_purchase_table tbody tr"),s=$("#transfer_purchase_table tbody tr td");if(i.length>0&&s.length>1)for(t=0;t<i.length;t++)f=$($(i[t]).find("select.transfer_td_tran_unit")).val().split("|"),e={Id:$($(i[t]).find("input.transfer_td_id")).val(),TraderItem:{Id:$($(i[t]).find("input.purchaseitem_td_traderitem_id")).val()},Unit:{Id:f[1]},QuantityAtPickup:$($(i[t]).find("td.transfer_td_tran_quan input")).val(),TransactionItem:{Id:$($(i[t]).find("input.purchaseitem_td_id")).val()}},u.TransferItems.push(e);return $.ajax({type:"post",url:"/TraderTransfers/SaveTransfer",data:{transfer:u},dataType:"json",success:function(n){$("#app-trader-transfer-modal").modal("hide");LoadingOverlayEnd();n.actionVal===1&&cleanBookNotification.createSuccess();n.actionVal===2&&cleanBookNotification.updateSuccess();ShowTableTransferValue(!0)},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}),!1}function clickAddNew(n){ResetFormControl(n)}function ConfirmDeleteTransfer(n){$("#id-transfer-delete").val(n)}function ShowTableTransferValue(n){n||$("#transfers-content").LoadingOverlay("show");$("#transfers-content").load("/TraderTransfers/ShowTransfersContent",function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#transfers-content table").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#transfers-content").LoadingOverlay("hide")})}function LoadTableDataTransfer(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:"",processing:loadingoverlay_value},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keysearch:$("#search_transfer").val(),route:$("#subfilter_route").val(),groupid:$("#filter-group").val(),date:$("#filter_daterange").val()})}},columns:i,order:[[r,"desc"]]})}function FilterDataTransferByServerSide(){var n=[{name:"FullRef",data:"FullRef",orderable:!1},{name:"WorkGroupName",data:"WorkGroupName",width:"150px",orderable:!0},{name:"Route",data:"Route",orderable:!1,render:function(n,t,i){var r="";switch(i.Route){case"InBound":r+='<span class="label label-lg label-primary">Inbound<\/span>';break;case"OutBound":r+='<span class="label label-lg label-info">Outbound<\/span>';break;default:r+='<span class="label label-lg label-info">'+i.Route+"<\/span>"}return r}},{name:"From",data:"From",width:"200px",orderable:!1},{name:"To",data:"To",width:"200px",orderable:!1},{name:"Date",data:"Date",width:"150px",orderable:!0},{name:"Reason",data:"Reason",width:"150px",orderable:!0},{name:"Status",data:null,orderable:!1,render:function(n,t,i){var r="";switch(i.Status){case"Initiated":r+='<span class="label label-lg label-info">Initiated<\/span>';break;case"PendingPickup":r+='<span class="label label-lg label-primary">Pending Pickup<\/span>';break;case"PickedUp":r+='<span class="label label-lg label-success">Picked up<\/span>';break;case"Delivered":r+='<span class="label label-lg label-success">Delivered<\/span>';break;case"Draft":r+='<span class="label label-lg label-primary">Draft<\/span>';break;case"Denied":r+='<span class="label label-lg label-danger">Denied<\/span>';break;case"Discarded":r+='<span class="label label-lg label-danger">Discarded<\/span>'}return r}},{data:null,orderable:!1,render:function(n,t,i){var r="",u;return i.Status==="Draft"?(u=" hidden",i.AllowEdit&&(u=""),i.Sale||i.Purchase?i.Sale&&!i.Purchase?r+='<button class="btn btn-info'+u+'" onclick="ShowEditSaleTransfer('+i.Id+", '"+i.Sale.Key+'\')"><i class="fa fa-calculator"><\/i> &nbsp; Continue<\/button>':!i.Sale&&i.Purchase&&(r+='<button class="btn btn-info'+u+'" onclick="ShowEditPurchaseTransfer('+i.Id+", "+i.Purchase.Id+')"><i class="fa fa-calculator"><\/i> &nbsp; Continue<\/button>'):r+='<button class="btn btn-info'+u+'" onclick="EditTransfer('+i.Id+')"><i class="fa fa-truck"><\/i> &nbsp; Continue<\/button>'):r+='<button class="btn btn-primary" onclick="window.location.href=\'/TraderTransfers/TransferMaster?key='+i.Key+'\';"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>',r}}];LoadTableDataTransfer("trader-transfer-list","/TraderTransfers/GetTransfersContent",n,5);CallBackFilterDataTransferServeSide()}function CallBackFilterDataTransferServeSide(){$("#trader-transfer-list").DataTable().ajax.reload()}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||500)}}function initSaleTransfer(){var n=$dateFormatByUser.toUpperCase();$("#search_date_range").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:n}});$("#search_date_range").change(function(){$("#sale-list-table").DataTable().ajax.reload()});$("#search_date_range").on("apply.daterangepicker",function(t,i){$(this).val(i.startDate.format(n)+" - "+i.endDate.format(n));$("#search_date_range").html(i.startDate.format(n)+" - "+i.endDate.format(n));$("#sale-list-table").DataTable().ajax.reload()});$("#search_date_range").on("cancel.daterangepicker",function(){$(this).val(null);$("#search_date_range").html("full history");$("#sale-list-table").DataTable().ajax.reload()});$(".search_transfer-sale").keyup(searchThrottle(function(){$("#sale-list-table").DataTable().search($(this).val()).draw()}))}function initPurchaseTransfer(){var n=$dateFormatByUser.toUpperCase();$("#search_purchase_date_range").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:n}});$("#search_purchase_date_range").change(function(){$("#purchase-list-table").DataTable().draw()});$("#search_purchase_date_range").on("apply.daterangepicker",function(t,i){$(this).val(i.startDate.format(n)+" - "+i.endDate.format(n));$("#search_purchase_date_range").html(i.startDate.format(n)+" - "+i.endDate.format(n));$("#purchase-list-table").DataTable().draw()});$("#search_purchase_date_range").on("cancel.daterangepicker",function(){$(this).val(null);$("#search_purchase_date_range").html("full history");$("#purchase-list-table").DataTable().draw()});$(".search_transfer-purchase").keyup(searchThrottle(function(){$("#purchase-list-table").DataTable().search($(this).val()).draw()}))}function InitTransferItemSelect2Ajax(n,t,i=0){var r;t==null&&(t=$("select[name=workgroup]").val());t==null&&(t=0);var f="/Select2Data/GetPoint2PointTransferItemsByWorkgroup?workGroupId="+t+"&locationId="+i,e=$("#"+n+" option:not([selected])"),u=[];e.each(function(){var n=$(this);u.push({id:n.attr("value"),text:n.text()})});r={};$("#"+n).not(".multi-select").select2({ajax:{url:f,dataType:"json",delay:250,data:function(n){return r.keySearch=n.term,r},cache:!0,processResults:function(n){var t=[];return t=t.concat(n.Object),n.Object.forEach(function(n){t.push({text:n.Name,itemId:n.Id,itemName:n.Name,itemImage:n.ImageUri,taxName:n.TaxRateName,taxRate:n.TaxRateValue,costUnit:n.CostUnit,value:n.Id,id:n.Id,newTag:!0})}),{results:t}}},defaultResults:u}).on("select2:selecting",function(t){var i=t.params.args.data,r="<option itemId='"+i.itemId+"' selected value='"+i.itemId+"' itemName='"+i.itemName+"' itemImage='"+i.itemImage+"' itemUnit=''>"+i.text+"<\/option>";$("#"+n).html(r);t.preventDefault();$("#"+n).select2("close").trigger("change")}).val(0).trigger("change")}function EditTransferChangeGroup(){InitTransferItemSelect2Ajax("item-select",$("#trader-group-select").val(),$("#originating-location-select").val())}var $locationManage=$("#local-manage-select").val(),$transferRequirement="",$workgroupId=0,$editMode="",$pointToPointId=0,$saleKey="",$purchaseId=0,filter={Workgroup:"",Key:""};EnableNextButton=function(){$workgroupId!==""&&($saleKey!=""||$purchaseId>0||$pointToPointId>0)&&$(".btnNext").removeAttr("Disabled")};DisableNextButton=function(){$(".btnNext").attr("Disabled","Disabled")};ChangeTransferRequest=function(){var n=$("#transfer_request").val();$transferRequirement=n;$saleKey="";$purchaseId=0;$pointToPointId=0;$("#point-to-point").empty();$("#point-to-point-type").hide();DisableNextButton();n==="p2p"&&($("#sale-transfer").hide(),$("#purchase-transfer").hide(),$saleKey="",$purchaseId=0,$pointToPointId=1,$("#point-to-point-type").show(),TransferAddEditPointToPointSpecificsTab(),EnableNextButton());n==="goods_in"&&($("#sale-transfer").hide(),$("#purchase-transfer").show(),$(".search_transfer-purchase").val(""),tablePurchaseLoad());n==="goods_out"&&($("#sale-transfer").show(),$("#purchase-transfer").hide(),$(".search_transfer-sale").val(""),tableSaleLoad())};TransferTypeChange=function(){var n=$("#transfer_type_add").val();$("#inbound").hide();$("#outbound").hide();$(n).toggle();InitMessageLocation()};LocationInOuChange=function(){$("#location-in-out-selected").empty();var n=$("#in-out-location").val();n&&n>0&&$.ajax({type:"post",url:"/TraderTransfers/LocationSelectToHtml",data:{id:n},dataType:"json",success:function(n){$("#location-in-out-selected").append(n.msg)},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){})};InitMessageLocation=function(){$transferRequirement==="p2p"||$editMode!==""?($("#confirm-tranfer-type").text($("#transfer_type_add :selected").text()),$("#confirm-for").text("Point to Point")):$transferRequirement==="goods_in"?($("#confirm-tranfer-type").text("Purchase"),$("#confirm-for").text("Purchase #"+$purchaseId)):$transferRequirement==="goods_out"&&($("#confirm-tranfer-type").text("Sale"),$("#confirm-for").text("Sale #"+$saleKey));$("#confirm-tranfer-requirement").text($transferRequirement.replace("p2p","Transfer Point to point").replace("goods_in","Purchase transfer").replace("goods_out","Sale transfer"));$("#contact-source").empty();$("#contact-destination").empty();$transferRequirement==="p2p"||$editMode!==""?$("#transfer_type_add").val()==="#inbound"?($("#source-destination-manage").text("Destination"),$("#source-destination-select").text("Source"),$("#location-in-out-selected").clone().removeAttr("id").appendTo("#contact-source"),$("#location-manage-confirm").clone().removeAttr("id").appendTo("#contact-destination")):$("#transfer_type_add").val()==="#outbound"&&($("#source-destination-manage").text("Source"),$("#source-destination-select").text("Destination"),$("#location-in-out-selected").clone().removeAttr("id").appendTo("#contact-destination"),$("#location-manage-confirm").clone().removeAttr("id").appendTo("#contact-source")):$transferRequirement==="goods_in"?($("#source-destination-manage").text("Destination"),$("#location-manage-confirm").clone().appendTo("#contact-destination"),$("#contact-confirm").clone().appendTo("#contact-source")):$transferRequirement==="goods_out"&&($("#source-destination-manage").text("Source"),$("#location-manage-confirm").clone().appendTo("#contact-source"),$("#contact-confirm").clone().appendTo("#contact-destination"))};SelectPurchase=function(n){$saleKey="";$purchaseId=n;$pointToPointId=0;$("#purchase_model_id").val(n);$("#p_transfer_id").text($("#tr_purchase_"+n+" td span.purchaseid").text());$(".p_workgroup").text($("#tr_purchase_"+n+" td.workgroup").text());$(".p_createdDate").text($("#tr_purchase_"+n+" td.createdDate").text());$(".p_contact").empty();$(".p_contact").append($("#tr_purchase_"+n+" td.contact a").clone());$(".p_dimension").text($(".tr_purchase_"+n+" td.dimension").text());$(".p_total").text($("#tr_purchase_"+n+" td.total").text());$(".p_tranfer").text($("#tr_purchase_"+n+" td.count").text());$(".purchase-select").hide();$(".selected-purchase").show();EnableNextButton()};UnSelectPurchase=function(){$("#purchase_model_id").val(0);$saleKey="";$purchaseId=0;$pointToPointId=0;$(".selected-purchase").hide();$(".purchase-select").show();DisableNextButton()};SelectSale=function(n){$saleKey=n;$purchaseId=0;$pointToPointId=0;$("#sale_model_key").val(n);$("#s_sale_id").text($("#tr_sale_"+n+" td span.saleid").text());$(".s_workgroup").text($("#tr_sale_"+n+" td.workgroup").text());$(".s_createdDate").text($("#tr_purchase_"+n+" td.createdDate").text());$(".s_contact").empty();$(".s_contact").append($("#tr_sale_"+n+" td.contact a").clone());$(".s_dimension").text($("#tr_sale_"+n+" td.dimension").text());$(".s_total").text($("#tr_sale_"+n+" td.total").text());$(".s_tranfer").text($("#tr_sale_"+n+" td.count").text());$(".sale-select").hide();$(".selected-sale").show();EnableNextButton()};UnSelectSale=function(){$("#sale_model_key").val("");$saleKey="";$purchaseId=0;$pointToPointId=0;$(".selected-sale").hide();$(".sale-select").show();DisableNextButton()};validateItemsInTable=function(){var n=$("#tb_form_item tbody tr");n===null||n.length===0?$(".btnNextConfirm").attr("Disabled","Disabled"):$(".btnNextConfirm").removeAttr("Disabled")};ConfirmPointToPointTab=function(){var n="<table id='tb_confirm' class='datatable table-hover' style='width: 100%; background: #fff;' data-order='[[1, \"asc\"]]'>",t,r,i;if(n+="<thead><tr><th data-orderable='false'><\/th><th>Name<\/th><th>Unit<\/th><th>Quantity<\/th><\/tr><\/thead><tbody>",t=$("#tb_form_item tbody tr"),r=$("#tb_form_item tbody tr td"),t.length!==1||r.length!==1){for(i=0;i<t.length;i++)n+="<tr> <td>"+$($(t[i]).find("td.row_image")).html()+"<\/td>",n+="<td>"+$($(t[i]).find("td.row_name")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.row_unit select option:selected")).text()+"<\/td>",n+=" <td>"+$($(t[i]).find("td.row_quantity input")).val()+"<\/td> ",n+="<\/tr>";n+="<\/tbody><\/table>";$("#div-confirm").append(n)}};ConfirmSaleTab=function(){var n="<table id='tb_confirm' class='datatable table-hover' style='width: 100%; background: #fff;' data-order='[[1, \"asc\"]]'>",t,r,i;if(n+="<thead><tr><th data-orderable='false'><\/th><th>Name<\/th><th>Unit<\/th><th>Qty<\/th><th>Transfer unit<\/th><th>Transfer qty<\/th><th>Remaining<\/th><\/tr><\/thead><tbody>",t=$("#transfer_sale_table tbody tr"),r=$("#transfer_sale_table tbody tr td"),t.length!==1||r.length!==1){for(i=0;i<t.length;i++)n+="<tr> <td>"+$($(t[i]).find("td.row_image")).html()+"<\/td>",n+="<td>"+$($(t[i]).find("td.row_name")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.transfer_td_sale_unit_name")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.transfer_td_sale_quan")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.row_unit select option:selected")).text()+"<\/td>",n+=" <td>"+$($(t[i]).find("td.transfer_td_tran_quan input")).val()+"<\/td> ",n+=" <td>"+$($(t[i]).find("td.remainder span")).text()+"<\/td> ",n+="<\/tr>";n+="<\/tbody><\/table>";$("#div-confirm").append(n)}};ConfirmPurchaseTab=function(){var n="<table id='tb_confirm' class='datatable table-hover tb_confirm' style='width: 100%; background: #fff;' data-order='[[1, \"asc\"]]'>",t,r,i;if(n+="<thead><tr><th data-orderable='false'><\/th><th>Name<\/th><th>Unit<\/th><th>Qty<\/th><th>Transfer unit<\/th><th>Transfer qty<\/th><th>Remaining<\/th><\/tr><\/thead><tbody>",t=$("#transfer_purchase_table tbody tr"),r=$("#transfer_purchase_table tbody tr td"),t.length!==1||r.length!==1){for(i=0;i<t.length;i++)n+="<tr> <td>"+$($(t[i]).find("td.row_image")).html()+"<\/td>",n+="<td>"+$($(t[i]).find("td.row_name")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.transfer_td_sale_unit_name")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.transfer_td_sale_quan")).text()+"<\/td> ",n+="<td>"+$($(t[i]).find("td.row_unit select option:selected")).text()+"<\/td>",n+=" <td>"+$($(t[i]).find("td.transfer_td_tran_quan input")).val()+"<\/td> ",n+=" <td>"+$($(t[i]).find("td.remainder span")).text()+"<\/td> ",n+="<\/tr>";n+="<\/tbody><\/table>";$("#div-confirm").append(n)}};InitTableJs=function(){$("#tb_confirm").DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]})};DeleteTransfer=function(){$.LoadingOverlay("show");$.ajax({type:"delete",url:"/TraderTransfers/DeleteTransfer",data:{id:$("#id-transfer-delete").val()},dataType:"json",success:function(n){n==="OK"?setTimeout(function(){$("#transfers-content").load("/TraderTransfers/LoadTransfersLocation?locationId="+$("#local-manage-select").val());LoadingOverlayEnd();cleanBookNotification.removeSuccess()},2e3):n==="Fail"&&(LoadingOverlayEnd(),cleanBookNotification.removeFail())},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})};$(function(){ShowTableTransferValue()});