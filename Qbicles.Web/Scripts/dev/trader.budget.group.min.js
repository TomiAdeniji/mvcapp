function loadBudgetGroupContents(){$("#budget-groups").LoadingOverlay("show");$("#budget-groups").empty();$("#budget-groups").load("/TraderBudget/BudgetGroupContent",function(){$("#budget-groups").LoadingOverlay("hide")})}function searchBudgetGroup(){var u=[],t=$("#budget-group-search").val(),i,r,n;if($("#budget-group-search").val()!==""&&$("#budget-group-search").val()!==null&&t.length>0)for(t=t.split(" "),i=0;i<t.length;i++)t[i]!==""&&u.push(t[i]);r=$("#bgroup_order_filter").val();n=$("#budget-table").DataTable();n.search(u.join("|"),!0,!1,!0);r==="0"?n.order([1,"asc"]):r==="1"&&n.order([1,"desc"]);r==="2"&&n.order([0,"asc"]);r==="3"&&n.order([0,"desc"]);n.draw()}function searchTableTraderItem(){var i=[],n,t;if($("#search_traderItem_byGroup").val()!==""&&$("#search_traderItem_byGroup").val()!==null&&i.push($("#search_traderItem_byGroup").val()),n=$("#search_traderitem").val(),$("#search_traderitem").val()!==""&&$("#search_traderitem").val()!==null&&n.length>0)for(n=n.split(" "),t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#list-traderitem").DataTable().search(i.join("|"),!0,!1,!0).draw()}function loadDataTableBudgetGroup(){$("#showdata-budgetgroup").LoadingOverlay("show");$("#showdata-budgetgroup").empty();$("#showdata-budgetgroup").load("/TraderBudget/BudgetGroupItems",function(){$("#showdata-budgetgroup").LoadingOverlay("hide")})}function loadDialogItemProductBudgetGroup(n){$("#app-trader-budget-group-items").LoadingOverlay("show");$("#app-trader-budget-group-items").empty();$("#app-trader-budget-group-items").load("/TraderBudget/BudgetGroupItemProductsDialog?idBudget="+n,function(){$("#app-trader-budget-group-items").LoadingOverlay("hide")})}function addEditBudgetGroup(n){traderGroups=[];$("#app-trader-budget-group-add").LoadingOverlay("show");$("#app-trader-budget-group-add").empty();$("#app-trader-budget-group-add").load("/TraderBudget/BudgetGroupAddEditModal?id="+n,function(){$("#app-trader-budget-group-add").LoadingOverlay("hide")})}function onBudgetTypeChange(n){$(n).val()==="Expenditure"?($("#budget_productgroup_Ex").removeClass("hidden"),$("#budget_productgroup_Re").addClass("hidden")):($("#budget_productgroup_Re").removeClass("hidden"),$("#budget_productgroup_Ex").addClass("hidden"))}function addEditNextTab(){var u,o,h,r,t,f,s,n,e,c,i;if(validateFormAddBudget())$(".btnNext").click();else return!1;if(destroyTableById("list-traderitem"),u=[],o=$("#budget_type").val(),u=o==="Expenditure"?$("#budget_productgroup_Ex select").val():$("#budget_productgroup_Re select").val(),h=$("#list-traderitem tbody"),r=[],h.empty(),t="",u&&u.length>0)for(i=0;i<traderGroups.length;i++)if(f=traderGroups[i],u.indexOf(f.Id.toString())!=-1&&f.Items.length>0)for(s=0;s<f.Items.length;s++)n=f.Items[s],r.indexOf(n.GroupName)===-1&&r.push(n.GroupName),o==="Expenditure"&&n.IsBought?(t+="<tr><td>",t+='<div class="table-avatar min" style="background-image: url(\''+n.ImageUri+"');\"><\/div><\/td>",t+="<td>"+n.Name+"<\/td>",t+="<td>"+n.SKU+"<\/td>",t+="<td>"+n.GroupName+"<\/td><\/tr >"):o!=="Expenditure"&&n.IsSold&&(t+="<tr><td>",t+='<div class="table-avatar min" style="background-image: url(\''+n.ImageUri+"');\"><\/div><\/td>",t+="<td>"+n.Name+"<\/td>",t+="<td>"+n.SKU+"<\/td>",t+="<td>"+n.GroupName+"<\/td><\/tr >");if(h.append(t),searchTableTraderItem(),r.length>0){for(e=$("#search_traderItem_byGroup"),e.select2("destroy"),e.empty(),c='<option value="">Show all<\/option>',i=0;i<r.length;i++)c+='<option value="'+r[i]+'">'+r[i]+"<\/option>";e.append(c);e.select2()}}function validateFormAddBudget(){var n=!0;return $("#budget_title").val()===""&&($("#form_addedit_budget").validate().showErrors({budget_title:"Title is required."}),n=!1),(!$("#budget_payment").val()||$("#budget_payment").val()&&$("#budget_payment").val()==="")&&($("#form_addedit_budget").validate().showErrors({terms:"Payment is required."}),n=!1),(!$("#budget_type").val()||$("#budget_type").val()&&$("#budget_type").val()==="")&&($("#form_addedit_budget").validate().showErrors({budget_type:"Type is required."}),n=!1),n}function saveBudget(){var i={Id:$("#budget_id").val(),Title:$("#budget_title").val(),Description:$("#budget_description").val(),ExpenditureGroups:[],RevenueGroups:[],Type:$("#budget_type").val(),PaymentTerms:{Id:$("#budget_payment").val()}},n=[],r=$("#budget_type").val(),t;if(r==="Expenditure"){if(n=$("#budget_productgroup_Ex select").val(),n&&n.length>0)for(t=0;t<n.length;t++)i.ExpenditureGroups.push({Id:n[t]})}else if(n=$("#budget_productgroup_Re select").val(),n&&n.length>0)for(t=0;t<n.length;t++)i.RevenueGroups.push({Id:n[t]});$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderBudget/SaveBudgetGroup",data:{budgetGroup:i},dataType:"json",success:function(n){$.LoadingOverlay("hide");var t=$("#budget_master_id").val();n.actionVal===1?(cleanBookNotification.createSuccess(),$("#app-trader-budget-group-add").modal("toggle"),setTimeout(function(){t?loadMasterPageContent():loadDataTableBudgetGroup()},500)):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#app-trader-budget-group-add").modal("toggle"),setTimeout(function(){t?loadMasterPageContent():loadDataTableBudgetGroup()},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function deleteBudgetGroup(n){var t=confirm("Do you want to delete this budget group?");if(t==!1)return!1;$.ajax({type:"delete",url:"/TraderBudget/DeleteBudgetGroup?id="+n,dataType:"json",success:function(n){n.result?(cleanBookNotification.removeSuccess(),setTimeout(function(){loadDataTableBudgetGroup()},500)):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function loadMasterPageContent(){var n=$("#budget_master_id").val(),t="/TraderBudget/BudgetGroupMasterContent?id="+n;$("#content_master").LoadingOverlay("show");$("#content_master").empty();$("#content_master").load(t,function(){$("#content_master").LoadingOverlay("hide")})}function masterSearchTableTraderItem(){var i=[],n,t;if($("#search_traderItem_byGroup_master").val()!==""&&$("#search_traderItem_byGroup_master").val()!==null&&i.push($("#search_traderItem_byGroup_master").val()),n=$("#search_traderitem_master").val(),$("#search_traderitem_master").val()!==""&&$("#search_traderitem_master").val()!==null&&n.length>0)for(n=n.split(" "),t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#master-list-traderitem").DataTable().search(i.join("|"),!0,!1,!0).draw()}var traderGroups=[];