function getCurrencySettings(){$.ajax({url:"/Qbicles/GetCurrencySettings",type:"get","async":!1,success:function(n){currencySetting=n?n:{CurrencySymbol:"",SymbolDisplay:0,DecimalPlace:2}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function SaleChannelChange(){var n="/TraderPriceBooks/ProductGroupByChannel?id="+$priceBookId+"&channel="+$("#price-book-sale-channel").val();$.LoadingOverlay("show");$("#product-group-channel").empty();$("#product-group-channel").load(n,function(){LoadingOverlayEnd()})}function CreatePriceBook(n){GetCookieAsync("CurrentLocationManage").then(function(t){var r=[],i=$("#price-book-product-group").val();return i!==null&&i.length>0&&(i=i.toString().split(","),$.each(i,function(n,t){var i={Id:t};r.push(i)})),priceBook={Id:n,Name:$("#price-book-name").val(),SalesChannel:$("#price-book-sale-channel").val(),Location:{Id:t},AssociatedProductGroups:r,Description:$("#price-book-description").val()}})}var $isEditVersionName=!1,$priceBookId=$("#pricebook-id").val(),$priceBookInfoId=0,$groupId=0,$instanceId=0;$(document).ready(function(){currencySetting||getCurrencySettings();$priceBookId>0&&($("#versions-tab").show(),$("#versioning").show())});SavePriceBook=function(){if($("#form-pricebook").valid()){var n=$("#price-book-product-group").val();if(n===null||n.length===0){cleanBookNotification.error(_L("ERROR_MSG_634"),"Qbicle");return}$.ajax({url:"/TraderPriceBooks/CheckExistName",data:{priceBookId:$priceBookId,priceBookName:$("#price-book-name").val()},type:"GET",dataType:"json"}).done(function(n){if(n.result){$("#form-pricebook").validate().showErrors({pricebookname:_L("ERROR_MSG_283")});return}$.ajax({type:"POST",url:"/Commons/GetCookie",data:{key:"CurrentLocationManage"},dataType:"json",success:function(n){var i,t,r;locationId=n.Object;i=[];t=$("#price-book-product-group").val();t!==null&&t.length>0&&(t=t.toString().split(","),$.each(t,function(n,t){var r={Id:t};i.push(r)}));r={Id:$priceBookId,Name:$("#price-book-name").val(),SalesChannel:$("#price-book-sale-channel").val(),Location:{Id:locationId},AssociatedProductGroups:i,Description:$("#price-book-description").val()};$.ajax({type:"post",url:"/TraderPriceBooks/SavePriceBook",data:{priceBook:r},datatype:"json",success:function(n){if(n.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}n.actionVal===1?(cleanBookNotification.createSuccess(),$priceBookId=n.msgId):n.actionVal===2&&cleanBookNotification.updateSuccess();$("#versions-tab").show();$("#versioning").show()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}).fail(function(){$("#form-pricebook").validate().showErrors({pricebookname:_L("ERROR_MSG_284")});return})}};GoToVersionTab=function(n){var t="/TraderPriceBooks/PriceBookVersion?pricebookId="+$priceBookId;$.LoadingOverlay("show");$("#pb-ver").empty();$("#title-pricebook").text("Edit");$("#pb-ver").load(t,function(){LoadingOverlayEnd()});n==="button"&&$('[href="#pb-ver"]').tab("show")};ShowAddPricebookVersion=function(){ClearError();$("#version-name").val("");$("#app-trader-pricebook-version-add").modal("toggle")};SavePricebookVersion=function(){if($("#form-add-version").valid()){var n={VersionName:$("#version-name").val(),ParentPriceBook:{Id:$priceBookId}};$.ajax({type:"post",url:"/TraderPriceBooks/SavePricebookVersion",data:{version:n},dataType:"json",success:function(n){if(n.actionVal===1){$("#app-trader-pricebook-version-add").modal("hide");$("body").removeClass("modal-open");$(".modal-backdrop").remove();cleanBookNotification.createSuccess();$.LoadingOverlay("show");var t="/TraderPriceBooks/PriceBookVersion?pricebookId="+$priceBookId;$("#pb-ver").empty();$("#title-pricebook").text("Edit");$("#pb-ver").load(t,function(){LoadingOverlayEnd()})}else if(n.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[n.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}};EditVersionManagement=function(){$.LoadingOverlay("show");var n="/TraderPriceBooks/PricebookVersionsManagement?pricebookId="+$priceBookId;$("#price-book-version-panel").empty();$("#price-book-version-panel").load(n,function(){LoadingOverlayEnd()})};EditPricesInfo=function(n){$.LoadingOverlay("show");var t="/TraderPriceBooks/PricebookVersionsSummerPrices?instanceId="+n;$("#price-book-version-panel").empty();$("#price-book-version-panel").load(t,function(){$("#versions-help").hide();$("#manage").show();LoadingOverlayEnd()})};CopyPricesInfo=function(n){$.LoadingOverlay("show");var t="/TraderPriceBooks/CopyPricebookVersion?instanceId="+n;$("#price-book-version-panel").empty();$("#price-book-version-panel").load(t,function(){$("#versions-help").hide();$("#manage").show();LoadingOverlayEnd()})};SearchItemOnTable=function(n){var t=$("#input-search-table-info-"+n).val();$("#table-info-"+n).DataTable().search(t).draw()};ProductGroupsDefault=function(n,t,i,r){$.LoadingOverlay("show");$("#group-name-info").text(t);$priceBookInfoId=n;$groupId=i;$instanceId=r;$.ajax({type:"GET",url:"/TraderPriceBooks/GetProductGroupPriceDefaultId",data:{id:n},dataType:"json",success:function(n){if(n.actionVal===1)$("#info-markup-type").text(n.Object.MarkupPercentage),$("#info-discount-type").text(n.Object.DiscountPercentage),$("#info-markup").val(n.Object.MarkUp),$("#info-discount").val(n.Object.Discount);else if(n.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[n.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};GroupTabClick=function(){};ApplyMarkupDiscount=function(n){if($("#form-pricebook-info").valid()){var t={Id:$priceBookInfoId,MarkupPercentage:$("#info-markup-type").text(),MarkUp:$("#info-markup").val(),DiscountPercentage:$("#info-discount-type").text(),Discount:$("#info-discount").val(),ApplyType:n};$.ajax({type:"post",url:"/TraderPriceBooks/ApplyMarkupDiscount",data:{markupDiscount:t},dataType:"json",success:function(n){if(n.actionVal===1){var i=currencySetting.CurrencySymbol+" markup",r=currencySetting.CurrencySymbol+" discount";t.MarkupPercentage==="%"&&(i="markup %");t.DiscountPercentage==="%"&&(r="discount %");$("#defaul-markup-info-"+$priceBookInfoId).text(i.replace("markup",t.MarkUp));$("#defaul-discount-info-"+$priceBookInfoId).text(r.replace("discount",t.Discount));cleanBookNotification.updateSuccess();RenderTablePriceBookPrices()}else if(n.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[n.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){ClearError()})}};RenderTablePriceBookPrices=function(){$.LoadingOverlay("show");var n="/TraderPriceBooks/RenderTablePriceBookPricesByInstance?instanceId="+$instanceId+"&groupId="+$groupId;$("#table-price-book-prices-"+$priceBookInfoId).empty();$("#table-price-book-prices-"+$priceBookInfoId).load(n,function(){LoadingOverlayEnd();$("#app-trader-pricebook-modifiers").modal("hide")})};RecalculatePrices=function(n,t,i,r){$.LoadingOverlay("show");$groupId=t;$instanceId=i;$priceBookInfoId=n;var u="/TraderPriceBooks/RecalculatePrices?instanceId="+$instanceId+"&groupId="+$groupId+"&type="+r;$("#table-price-book-prices-"+$priceBookInfoId).empty();$("#table-price-book-prices-"+$priceBookInfoId).load(u,function(){LoadingOverlayEnd()})};EditVersonNameKeyUp=function(n){var t=$("#input-version-name-edit").val();$isEditVersionName=t===n?!1:!0};SavePriceBookPrices=function(n){var t=$("#group-ids").val().split(";"),i,r;if(t.length===0){cleanBookNotification.warning(_L("ERROR_MSG_285"),"Qbicles");return}if(i=[],t.forEach(function(n){for(var u,f,r=$("#table-info-"+n+" tbody tr"),t=0;t<r.length;t++)u=$($(r[t]).find("td input.price-book-price-id")).val(),u&&(f={Id:$($(r[t]).find("td input.price-book-price-id")).val(),MarkUp:$($(r[t]).find("td input.markup-value")).val(),IsMarkupPercentage:$($(r[t]).find("td span.markup-percentage"))[0].innerText.trim()==="%"?!0:!1,Discount:$($(r[t]).find("td input.discount-value")).val(),IsDiscountPercentage:$($(r[t]).find("td span.discount-percentage"))[0].innerText.trim()==="%"?!0:!1,Price:$($(r[t]).find("td input.price-value")).val()},i.push(f))}),t.length===0){cleanBookNotification.warning("Not existed Product item","Qbicles");return}r="";r=$isEditVersionName?"/TraderPriceBooks/SavePriceBookPrices?status="+n+"&versionName ='"+$("#input-version-name-edit").val()+"'":"/TraderPriceBooks/SavePriceBookPrices?status="+n+"&versionName =";$.ajax({type:"post",url:r,data:{prices:i},dataType:"json",success:function(t){if(t.actionVal===1)$isEditVersionName=!1,cleanBookNotification.updateSuccess(),n==="Apply"&&EditVersionManagement();else if(t.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[t.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){ClearError()})};ShowHistoryModal=function(n){$.LoadingOverlay("show");var t="/TraderPriceBooks/ShowHistoryModal?versionId="+n;$("#app-trader-pricebook-history-table").empty();$("#app-trader-pricebook-history-table").load(t,function(){LoadingOverlayEnd()})};DiscountTableChange=function(n,t){$("#info-discount-item-"+t).html(n);ReCalculatePriceRow(t)};MarkUpTableChange=function(n,t){$("#info-markup-item-"+t).html(n);ReCalculatePriceRow(t)};ReCalculatePriceRow=function(n,t){var i,r,u;$.LoadingOverlay("show");i=!1;r=!1;$("#info-markup-item-"+n).text().includes("%")&&(i=!0);$("#info-discount-item-"+n).text().includes("%")&&(r=!0);u={id:n,MarkUp:$("#markup-value-"+n).val(),Discount:$("#discount-value-"+n).val(),Price:$("#price-value-"+n).val(),IsMarkupPercentage:i,IsDiscountPercentage:r,FullPrice:t?$("#full-price-"+n).val():0};$.ajax({type:"post",url:"/TraderPriceBooks/ReCalculatePriceRow",data:{priceBookPrice:u},dataType:"json",success:function(i){if(i.actionVal===1)cleanBookNotification.updateSuccess(),$("#calculated-price-"+n).html(i.Object.CalculatedPrice),$("#full-price-"+n).val(toCurrencyDecimalPlace(i.Object.FullPrice)),$("#price-tax-"+n).html(i.Object.TaxValue),t&&$("#price-value-"+n).val(toCurrencyDecimalPlace(i.Object.Price));else if(i.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[i.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};ApplyPriceBookPrices=function(n){var i,t;if($.LoadingOverlay("show"),i=$("#group-ids").val().split(";"),i.length===0){cleanBookNotification.warning(_L("ERROR_MSG_285"),"Qbicles");return}t="";$isEditVersionName&&(t=$("#input-version-name-edit").val()+"'");$.ajax({type:"post",url:"/TraderPriceBooks/ApplyPriceBookPrices",data:{instanceId:n,versionName:t},dataType:"json",success:function(n){if(n.actionVal===1)$isEditVersionName=!1,cleanBookNotification.updateSuccess(),EditVersionManagement();else if(n.actionVal===3){cleanBookNotification.error(_L("ERROR_MSG_380",[n.msg]),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){ClearError();LoadingOverlayEnd()})};