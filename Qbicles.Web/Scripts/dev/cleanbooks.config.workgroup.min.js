function processChange(n){$(n).val()!=null&&$("#wg-process-add + label.error")&&$("#wg-process-add + label.error").remove()}function CreateRowTable(n){var i="add",f,t;$wgId>0&&(i="edit");var r="",u="",e=$_approvers.filter(t=>t.Id===n.Id);return e.length>0&&(r="checked"),f=$_reviewers.filter(t=>t.Id===n.Id),f.length>0&&(u="checked"),t='<tr id="tr_'+i+"_user_"+n.Id+'">',t+='<td><div class="table-avatar mini" style="background-image: url(\''+n.Pic+"');\">&nbsp;<\/div><\/td>",t+="<td>"+n.Name+'<span id="span-approval-add-'+n.Id+"\" class='hidden'><\/span><span id=\"span-review-add-"+n.Id+"\" class='hidden'><\/span><\/td>",t+="<td><input "+r+" onchange=\"AddUsersApprovers(this.checked,'"+n.Id+'\',\'span-approval-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><input "+u+" onchange=\"AddUsersToReviewers(this.checked,'"+n.Id+'\',\'span-review-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><button class='btn btn-danger' onclick=\"RemoveRowTableMemberAdd('"+n.Id+"')\"><i class='fa fa-trash'><\/i><\/button><\/td>",t+"<\/tr>"}function qbicleChange(n){var t=$(n).val();topicValue=$('#"wg-topic-add"').val();$.ajax({type:"post",url:"/Topics/GetTopic2SelectByQbicle",datatype:"json",data:{qbicleId:t},success:function(n){n.result&&($("#wg-topic-add").empty().append(n.Object),topicValue>0&&$("#wg-topic-add").val(topicValue),$("#wg-topic-add").select2())},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function showCBSetting(n,t){setCookie("cb_config_tab",n);var i="/Apps/CleanBookConfig?value="+n;LoadingOverlay();$("#tab-content-config").empty();$("#tab-content-config").load(i,function(){LoadingOverlayEnd();$('a[href="#'+n+'"]').tab("show");t&&t()})}function CreateWorkgroupData(n){var u="add",o={Id:$("#wg-qbicle-"+u).val()},s={Id:$("#wg-topic-"+u).val()},e=[],i=$("#wg-process-"+u).val(),t,f,r,n;if(i!==null&&i.length>0&&(i=i.toString().split(","),$.each(i,function(n,t){var i={Id:t};e.push(i)})),t=$(".wg-user-member"),f=[],t&&t.length)for(r=0;r<t.length;r++)$(t[r]).val()==="true"&&(n=$(t[r]).attr("userid"),f.push({Id:n}));return{Id:$("#cbwgid").val(),Name:$("#wg-name-"+u).val(),Processes:e,Qbicle:o,Topic:s,Members:f}}function Delete(n,t){$.ajax({type:"delete",url:"/Apps/Delete",datatype:"json",data:{id:t},success:function(n){n.result?(ReloadWorkgroup(),reloadMenu(),cleanBookNotification.removeSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function addMembers(n,t){$(t).toggle();$(".contact"+n+"-remove").toggle();$(".wg-member-"+n).val(!0);checkLatestItem()}function removeMembers(n){$(".contact"+n+"-remove").hide();$(".contact"+n+"-add").toggle();$(".wg-member-"+n).val(!1);checkLatestItem()}function addEditWg(n){var t="/Apps/CleanBookWorkGroupAddEdit?id="+n;$.LoadingOverlay("show");$("#app-trader-group-add").empty();$("#app-trader-group-add").load(t,function(){LoadingOverlayEnd()})}function checkLatestItem(){var t=$(".wg-user-member"),r=0,n,i;if(t&&t.length){for(n=0;n<t.length;n++)$(t[n]).val()==="true"&&r++;if(r===1)for(n=0;n<t.length;n++)$(t[n]).val()==="true"&&(i=$(t[n]).attr("userid"),$(".contact"+i+"-remove").addClass("disabled"));else for(n=0;n<t.length;n++)$(t[n]).val()==="true"&&(i=$(t[n]).attr("userid"),$(".contact"+i+"-remove").removeClass("disabled"))}}function FilterMembers(){try{var n=$("#smkeyword").val(),t=$("#slShow").val();n?$("#wgMembers li").each(function(){var i=$(this),r=i.attr("fullname");t=="1"?i.hasClass("ismember")&&r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide():r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide()}):t=="1"?($("ul.widget-contacts li.ismember").show(),$("ul.widget-contacts li:not(.ismember)").hide()):$("ul.widget-contacts li").show()}catch(i){return}}function reloadMenu(){$.LoadingOverlay("show");$("#navigationcleanBook").load("/Apps/NavigationCleanBooksPartial?tab=config",function(){LoadingOverlayEnd()})}var addTable,topicValue;ClearForm=function(n){var t,i;$_members=[];$_approvers=[];$_reviewers=[];$wgId=0;ReInitUsersEdit(0);ResetFormControl(n);$('a[href="#add-specifics"]').tab("show");t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active")[0].id==="step_1_add"&&$(t).find(".app_subnav .active").prev("li").find("a").trigger("click");$("#wg-process-add").val(null);$(".chosen-multiple").select2({multiple:!0});i=$("#wg-table-members-add").DataTable();i.clear();i.destroy();$("#wg-group-add").val("").trigger("change")};addTable=$("#wg-table-members-add");$("#search-right-add").on("change",function(){var n=$(this).val();addTable.DataTable().search(n).draw()});$("#search-member-add").keyup(function(){addTable.DataTable().search($(this).val()).draw()});ReInitUsersEdit=function(n){var t=$("#user-list").DataTable();t.clear();t.destroy();$.ajax({type:"post",url:"/Apps/ReInitUsersEdit",datatype:"json",data:{id:n},success:function(n){n?($("table#user-list > tbody").prepend(n),$(".check-right").bootstrapToggle(),$("#user-list").DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#user-list").show()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})};AddMemberToWorkgroup=function(){var n,t;$_members.length>0&&(n="add",$wgId>0&&(n="edit"),t=$("#wg-table-members-"+n).DataTable(),t.clear(),t.destroy(),$.each($_members,function(t,i){$("table#wg-table-members-"+n+" > tbody").prepend(CreateRowTable(i))}),$(".check-right").bootstrapToggle(),$("#wg-table-members-"+n).DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#wg-table-members-"+n).show())};AddUsersToMembers=function(n,t,i,r){var f={Id:t,Name:i,Pic:r},u;if(n===!0)$_members.push(f);else for(u=$_members.length;u--;)$_members[u].Id===f.Id&&$_members.splice(u,1)};AddUsersToReviewers=function(n,t,i){var u={Id:t},r;if(n===!0)$_reviewers.push(u),$("#"+i+t).text("Reviewers");else for(r=$_reviewers.length;r--;)$_reviewers[r].Id===u.Id&&($_reviewers.splice(r,1),$("#"+i+t).text(""))};AddUsersApprovers=function(n,t,i){var u={Id:t},r;if(n===!0)$_approvers.push(u),$("#"+i+t).text("Approvers");else for(r=$_approvers.length;r--;)$_approvers[r].Id===u.Id&&($_approvers.splice(r,1),$("#"+i+t).text(""))};topicValue=0;$(".btnPreviousAdd").click(function(){var n=$(this).closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")});$(".btnNextAdd").click(function(){var n={Id:$("#cbwgid").val(),Name:$("#wg-name-add").val()};$("#form-wg-add").valid()&&$.ajax({url:"/Apps/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});else{var t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click")}}).fail(function(n){$("#form-wg-add").validate().showErrors({wgNameAdd:"Error"+n})})});PreviousAdd=function(){var n=$(".btnNextAdd").closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")};PreviousEdit=function(){$("#step_2_edit").removeClass("active");$("#edit-members").removeClass("in active");$("#step_1_edit").addClass("active");$("#edit-specifics").addClass("in active")};NextEdit=function(){var n={Id:$wgId,Name:$("#wg-name-edit").val()};$("#form-wg-edit").valid()&&$.ajax({url:"/Apps/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-edit").validate().showErrors({wgNameEdit:"Name of Workgroup already exists."});else{var t=$(".btnNextEdit").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click");$("#step_1_edit").removeClass("active");$("#edit-specifics").removeClass("in active");$("#step_2_edit").addClass("active");$("#edit-members").addClass("in active")}}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n})})};Edit=function(n){$("#workgroup-content-edit").empty();$_members=[];$_approvers=[];$_reviewers=[];PreviousEdit();$wgId=n;$("#search-right-all").val("").trigger("change");$.LoadingOverlay("show");$.ajax({type:"post",url:"/Apps/GetWorkGroupUser",datatype:"json",data:{id:n},success:function(n){$_members=n.Members;$_approvers=n.Approvers;$_reviewers=n.Reviewers},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}});ReInitUsersEdit(n);setTimeout(function(){$("#workgroup-content-edit").load("/Apps/Edit?id="+n);$.LoadingOverlay("hide")},2e3)};SaveWorkgroup=function(){if(ValidateWorkgroupForm("add")!==!1){var n={Id:$("#cbwgid").val(),Name:$("#wg-name-add").val()};$("#form-wg-add").valid()&&$.ajax({url:"/Apps/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(t){if(t.result){$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});PreviousAdd();return}$("#app-trader-group-add").modal("hide");var i=CreateWorkgroupData(0);$.ajax({type:"post",url:"/Apps/SaveWorkgroup",datatype:"json",data:{wg:i},success:function(t){t.result?(n.Id=="0"?cleanBookNotification.createSuccess():cleanBookNotification.updateSuccess(),ReloadWorkgroup(),reloadMenu()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n})})}};ReloadWorkgroup=function(){showCBSetting("workgroup")};ValidateWorkgroupForm=function(n){var t=!0,i;return $("#wg-name-"+n).val()===""&&(n==="add"?$("#form-wg-"+n).validate().showErrors({wgNameAdd:"This field is required."}):$("#form-wg-"+n).validate().showErrors({wgNameEdit:"This field is required."}),t=!1),i=$("#wg-process-"+n).val(),(i===null||i.length===0)&&(cleanBookNotification.error(_L("ERROR_MSG_377"),"Qbicles"),t=!1),t===!1?(n==="add"?PreviousAdd():PreviousEdit(),t):t};