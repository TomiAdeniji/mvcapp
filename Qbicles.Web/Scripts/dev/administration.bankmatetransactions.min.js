function initBankmatetransTab(){var n=$dateFormatByUser.toUpperCase();$("#administration-content .select2").select2();$(".daterange").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:n}});$(".daterange").on("apply.daterangepicker",function(t,i){$(this).val(i.startDate.format(n)+" - "+i.endDate.format(n));reloadTblHistoryBankmatetrans()});$(".daterange").on("cancel.daterangepicker",function(){$(this).val(null);reloadTblHistoryBankmatetrans()});$("#tblPendingBankmateTransactions").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblPendingBankmateTransactions").LoadingOverlay("show"):$("#tblPendingBankmateTransactions").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,responsive:!0,paging:!0,searching:!1,deferLoading:30,order:[[3,"desc"]],ajax:{url:"/Bankmate/GetBankmateTransactions",data:function(n){return $.extend({},n,{userId:$("#slcreator").val(),cashAccountId:$("#sldestination").val(),keyword:$("#txtSearch").val()})}},columns:[{data:"Id",orderable:!1,render:function(){return'<input type="checkbox" class="trackInput" style="position: relative; top: 0;">'}},{data:"Domain",orderable:!0},{data:"CreatorName",orderable:!0,render:function(n,t,i){var r='<a href="#"><div class="table-avatar mini pull-left" style="background-image: url(\''+i.CreatorUri+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+fixQuoteCode(n)+"<\/div>",r+'<div class="clearfix"><\/div><\/a>'}},{data:"CreateDate",orderable:!0},{data:"Type",orderable:!0,render:function(n){var t="Funds in";return n==2&&(t="Funds out"),t}},{data:"ExternalAccountName",orderable:!1,render:function(n,t,i){var r='<a href=""><div class="table-avatar mini pull-left" style="background-image: url(\''+i.ExternalAccountUri+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; padding-left: 15px;">',r+='<div style="padding: 5px 0 3px 0; font-weight: 500;">'+fixQuoteCode(n)+"<\/div>",i.ExternalNUBAN&&i.ExternalIBAN&&(r+=i.ExternalNUBAN+" &nbsp; / &nbsp; "+i.ExternalIBAN),r+'<\/div><div class="clearfix"><\/div><\/a>'}},{data:"Amount",orderable:!0},{data:"Attachments",orderable:!1,render:function(n){var t=[];return n.forEach(function(n){t.push('<a href="'+n.Value+'">'+fixQuoteCode(n.Key)+"<\/a>")}),t.join("<br/>")}},{data:"Id",orderable:!1,render:function(n){var t='<div class="btn-group"><button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';return t+='Actions &nbsp; <i class="fa fa-angle-down"><\/i><\/button><ul class="dropdown-menu">',t+='<li><a href="javascript:loadBankmateTransfersModal('+n+')">Approve<\/a><\/li>',t+='<li><a href="javascript:rejectBankmateTrans('+n+')">Reject<\/a><\/li>',t+"<\/ul><\/div>"}}],drawCallback:function(){$("#tblPendingBankmateTransactions").DataTable().columns.adjust().responsive.recalc();$("#tblPendingBankmateTransactions .trackInput").on("change",function(){var r=$(this),o=r.parents("tr"),u=$("#tblPendingBankmateTransactions").DataTable(),f=u.row(o).data(),t,i,n,e;for(f&&(f.isChecked=r.prop("checked")),t=!1,i=u.rows().data(),n=0;n<i.length;n++)if(e=i[n],e.isChecked){t=!0;break}t?$(".withselected").fadeIn():$(".withselected").fadeOut()})}});$("#tblHistoryBankmateTransactions").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblHistoryBankmateTransactions").LoadingOverlay("show"):$("#tblHistoryBankmateTransactions").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,responsive:!0,paging:!0,searching:!1,deferLoading:30,order:[[2,"desc"]],ajax:{url:"/Bankmate/GetBankmateTransactions",data:function(n){return $.extend({},n,{userId:$("#slHistoryCreator").val(),cashAccountId:$("#slHistoryDestination").val(),keyword:$("#txthistorySearch").val(),daterange:$("#txtHistoryDaterange").val(),isPendingStatus:!1})}},columns:[{data:"Domain",orderable:!0},{data:"CreatorName",orderable:!0,render:function(n,t,i){var r='<a href="#"><div class="table-avatar mini pull-left" style="background-image: url(\''+i.CreatorUri+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+fixQuoteCode(n)+"<\/div>",r+'<div class="clearfix"><\/div><\/a>'}},{data:"CreateDate",orderable:!0},{data:"Type",orderable:!0,render:function(n){var t="Funds in";return n==2&&(t="Funds out"),t}},{data:"ExternalAccountName",orderable:!1,render:function(n,t,i){var r='<a href=""><div class="table-avatar mini pull-left" style="background-image: url(\''+i.ExternalAccountUri+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; padding-left: 15px;">',r+='<div style="padding: 5px 0 3px 0; font-weight: 500;">'+fixQuoteCode(n)+"<\/div>",i.ExternalNUBAN&&i.ExternalIBAN&&(r+=i.ExternalNUBAN+" &nbsp; / &nbsp; "+i.ExternalIBAN),r+'<\/div><div class="clearfix"><\/div><\/a>'}},{data:"Amount",orderable:!0},{data:"Attachments",orderable:!1,render:function(n){var t=[];return n.forEach(function(n){t.push('<a href="#">'+fixQuoteCode(n.Key)+"<\/a>")}),t.join("<br/>")}},{data:"Status",orderable:!0,render:function(n){return n==4?'<label class="label label-success label-lg">Approved<\/label>':'<label class="label label-danger label-lg">Denied<\/label>'}},],drawCallback:function(){$("#tblHistoryBankmateTransactions").DataTable().columns.adjust().responsive.recalc()}})}function reloadTblPendingBankmatetrans(){$.fn.DataTable.isDataTable("#tblPendingBankmateTransactions")?$("#tblPendingBankmateTransactions").DataTable().ajax.reload():setTimeout(function(){$("#tblPendingBankmateTransactions").DataTable().ajax.reload()},1e3)}function reloadTblHistoryBankmatetrans(){$.fn.DataTable.isDataTable("#tblHistoryBankmateTransactions")?$("#tblHistoryBankmateTransactions").DataTable().ajax.reload():setTimeout(function(){$("#tblHistoryBankmateTransactions").DataTable().ajax.reload()},1e3)}function initSearch(){$("#txtSearch").keyup(delay(function(){reloadTblPendingBankmatetrans()},500));$("#slcreator").change(function(){reloadTblPendingBankmatetrans()});$("#sldestination").change(function(){reloadTblPendingBankmatetrans()});$("#txthistorySearch").keyup(delay(function(){reloadTblHistoryBankmatetrans()},500));$("#slHistoryCreator").change(function(){reloadTblHistoryBankmatetrans()});$("#slHistoryDestination").change(function(){reloadTblHistoryBankmatetrans()})}function loadBankmateTransfersModal(n){$("#app-mbm-admin-transfers").empty();$("#app-mbm-admin-transfers").modal("show");$("#app-mbm-admin-transfers").load("/Bankmate/ConfirmBankmateTransferModal?transactionId="+(n?n:0),function(){$("#app-mbm-admin-transfers .select2").select2()})}function confirmApprove(n,t,i){$.LoadingOverlay("show");var r=[];r.push(n);$.post("/Bankmate/ApproveCashBankAccountTransactions",{ids:r,status:"PaymentApproved",externalBankAccountId:$(t).val(),type:i},function(n){n.result?($("#app-mbm-admin-transfers").modal("hide"),cleanBookNotification.updateSuccess(),reloadTblPendingBankmatetrans()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$.LoadingOverlay("hide")})}function rejectBankmateTrans(n){var t=[];t.push(n);bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Qbicles",message:_L("CONFIRM_MSG_REJECT"),callback:function(n){if(n){$.post("/Bankmate/RejectCashBankAccountTransactions",{ids:t,status:"PaymentDenied"},function(n){n.result?(cleanBookNotification.updateSuccess(),reloadTblPendingBankmatetrans()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")});return}}})}function onChangeExternalBankInfo(n){var t=$(n);$("#app-mbm-admin-transfers textarea[name=BankAddress]").val(t.find(":selected").data("address"));$("#app-mbm-admin-transfers input[name=PhoneNumber]").val(t.find(":selected").data("phonenumber"));$("#app-mbm-admin-transfers input[name=AccountName]").val(t.find(":selected").data("accountname"));$("#app-mbm-admin-transfers input[name=IBAN]").val(t.find(":selected").data("iban"));$("#app-mbm-admin-transfers input[name=NUBAN]").val(t.find(":selected").data("nuban"))}function bulkApprove(){var n=[];($("#tblPendingBankmateTransactions").DataTable().rows().every(function(){var t=$(this.node()),r=$("#tblPendingBankmateTransactions").DataTable(),i=r.row(t).data(),u=$(t).find("input[type=checkbox]");i.isChecked&&n.push(i.Id)}),n.length!=0)&&bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Qbicles",message:_L("CONFIRM_MSG_BULKAPPROVE"),callback:function(t){if(t){$.post("/Bankmate/RejectCashBankAccountTransactions",{ids:n,status:"PaymentApproved",externalBankAccountId:0,type:0},function(n){n.result?(cleanBookNotification.updateSuccess(),reloadTblPendingBankmatetrans()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")});return}}})}function bulkReject(){var n=[];($("#tblPendingBankmateTransactions").DataTable().rows().every(function(){var i=$(this.node()),r=$("#tblPendingBankmateTransactions").DataTable(),t=r.row(i).data();t.isChecked&&n.push(t.Id)}),n.length!=0)&&bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Qbicles",message:_L("CONFIRM_MSG_BULKREJECT"),callback:function(t){if(t){$.post("/Bankmate/RejectCashBankAccountTransactions",{ids:n,status:"PaymentDenied"},function(n){n.result?(cleanBookNotification.updateSuccess(),reloadTblPendingBankmatetrans()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")});return}}})}$(document).ready(function(){initBankmatetransTab();reloadTblPendingBankmatetrans();initSearch()});