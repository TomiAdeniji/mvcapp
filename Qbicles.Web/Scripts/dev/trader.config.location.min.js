function clickAddlocation(){$("#app-location-add").load("/TraderConfiguration/LocationAddEdit")}function saveLocation(){var n,t,i,r;if($("#location-edit-name").val()=="")return $("#location_form").validate().showErrors({Name:"This field is required."}),!1;if(n=parseFloat($("#Longitude").val()),$("#Longitude").val()!=""&&(n<-180||n>180))return $("#location_form").validate().showErrors({Longitude:"Longitude value as a decimal value between -180 and 180"}),!1;if(t=parseFloat($("#Latitude").val()),$("#Latitude").val()!=""&&(t<-90||t>90))return $("#location_form").validate().showErrors({Latitude:"Latitude value as a decimal value between -90 and 90"}),!1;i=$("#CountryName").val();r={Id:$("#location-id").val(),Name:$("#location-edit-name").val(),Address:{Id:$("#location-address-id").val(),AddressLine1:$("#AddressLine1").val(),AddressLine2:$("#AddressLine2").val(),City:$("#City").val(),State:$("#State").val(),PostCode:$("#PostCode").val(),Email:$("#Email").val(),Phone:$("#Phone").val(),Longitude:n.toFixed(7),Latitude:t.toFixed(7)}};$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderConfiguration/Savelocation?country="+i,data:{location:r},dataType:"json",success:function(n){LoadingOverlayEnd();n.result===!0?n.actionVal===1?($("#tbllocations").DataTable().ajax.reload(),$("#app-location-add").modal("toggle"),cleanBookNotification.createSuccess()):n.actionVal===2?($("#tbllocations").DataTable().ajax.reload(),$("#app-location-add").modal("toggle"),cleanBookNotification.updateSuccess()):n.actionVal===3&&$("#location_form").validate().showErrors({Name:n.msg}):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function Editlocation(n){$("#app-location-add").load("/TraderConfiguration/LocationAddEdit?id="+n)}function ConfirmDeletelocation(n,t){$("#label-confirm-location").text("Do you want delete location: "+t);$("#id-itemlocation-delete").val(n)}function deletelocation(){$.ajax({type:"delete",url:"/TraderConfiguration/Deletelocation",data:{id:$("#id-itemlocation-delete").val()},dataType:"json",success:function(n){n==="OK"?(cleanBookNotification.removeSuccess(),$("#tbllocations").DataTable().ajax.reload()):n==="Fail"&&cleanBookNotification.removeFail()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$(".modal-cancel").click()}})}function reloadLocation(){$("#comfig-content").load("/TraderConfiguration/TraderConfigurationContent?value=location")}function setDefaultAddress(n){$.post("/Commerce/SetDefaultAddress",{locationId:$(n).val()},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function InitLocationDataTable(){var t=$("#location-tab-key-search"),n=$("#location-tab-geolocated");$("#tbllocations").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tbllocations").LoadingOverlay("show"):$("#tbllocations").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[5,10,20,50,100]],pageLength:10,language:{lengthMenu:"_MENU_ &nbsp; per page"},ajax:{url:"/Commerce/GetLocationTableData",type:"POST",data:function(i){return keySearch="",geoLocated=null,t.length>0&&(keySearch=t.val()),n.length>0&&(n.val()==1?geoLocated=!0:n.val()==2&&(geoLocated=!1)),$.extend({},i,{keySearch:keySearch,isGeoLocated:geoLocated})}},columns:[{data:"Name",orderable:!0},{data:"Address",orderable:!0},{data:"Lat",orderable:!0},{data:"Long",orderable:!0},{data:"GeoText",orderable:!0,render:function(n,t,i){return""+('<i class="'+i.GeoClass+'"><\/i><span hidden>'+i.GeoText+"<\/span>")}},{data:"Creator",orderable:!0},{data:"Id",orderable:!1,render:function(n,t,i){return""+('<input type="radio" name="DefaultAddress" onchange="setDefaultAddress(this);" '+i.DefaultAddressClass+' value="'+i.Id+'">')}},{data:"Id",orderable:!1,render:function(n,t,i){var r="";return r+='<button class="btn btn-warning" onclick="Editlocation('+i.Id+')" data-toggle="modal" data-target="#app-location-add"><i class="fa fa-pencil"><\/i><\/button> ',r+("<button "+i.CanDelText+' class="btn btn-danger" data-toggle="modal" data-target="#app-location-confirm" onclick="ConfirmDeletelocation('+i.Id+", '"+i.Name+'\')"><i class="fa fa-trash"><\/i><\/button>')}}],drawCallback:function(){var n=delay(function(){var i,t,r;$("#recalculatebtn").removeAttr("disabled");var u=$(this),f=u.parents("tr"),e=$("#order-list").DataTable(),n=$(f).find("input[type=number]").attr("itemId");$("#taxes"+n).parent().addClass("taxItem"+n);i=$("#tradeorderid").val();t=$("#itemdiscount"+n).val();t=t?t:0;t<0?(cleanBookNotification.error("The discount must be greater or equal to 0.","Qbicles"),t=0,$("#itemdiscount"+n).val(0)):t>100&&(cleanBookNotification.error("The discount must be less than or equal to 100.","Qbicles"),t=0,$("#itemdiscount"+n).val(0));r=$("#taxes"+n);r!=null?(LoadingOverlay(),$.ajax({method:"POST",dataType:"JSON",url:"/B2C/ReCalculateTax",data:{tradeOrderId:i,discount:t,itemId:n},success:function(t){t.result?UpdateOrderItemInfo(n):(LoadingOverlayEnd(),cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){LoadingOverlayEnd();cleanBookNotification(n.msg,"Qbicles")}})):e.cell(".taxItem"+n).data("--")},1e3),t=delay(function(){$("#recalculatebtn").removeAttr("disabled");var r=$(this),u=r.parents("tr"),f=$("#order-list").DataTable(),n=$(u).find("input[type=number]").attr("itemId");$("#itemdiscount"+n).parent().addClass("discountContainer"+n);var o=parseFloat($("#pureprice"+n).val()),i=parseFloat($("#totalprice"+n).val()),e=parseFloat($("#itemprice"+n).val()),t=parseFloat(100-e/i*100);t<0?(cleanBookNotification.error("The updated price must not cause the discount to be less than 0.","Qbicles"),t=0,$("#itemprice"+n).val(i)):t>100&&(cleanBookNotification.error("The updated price must not cause the discount to be greater than 100.","Qbicles"),t=0,$("#itemprice"+n).val(i));f.cell(".discountContainer"+n).data(t);LoadingOverlay();UpdateOrderItemInfo(n)},1e3);$(".itemdiscount").on("change",n);$(".price").on("change",t)}})}$(document).ready(function(){InitLocationDataTable();$("#location-tab-geolocated").select2();$("#location-tab-key-search").keyup(delay(function(){$("#tbllocations").DataTable().ajax.reload()},500));$("#location-tab-geolocated").change(delay(function(){$("#tbllocations").DataTable().ajax.reload()},500))});