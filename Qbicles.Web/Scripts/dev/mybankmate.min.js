function initModalAddBankMate(){var n=$("#frmaddbankmate");n.validate({rules:{bankId:{required:!0},address:{required:!0},countryCode:{required:!0},phone:{required:!0},accountName:{required:!0}}});n.submit(function(t){(t.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?($("#app-mbm-account-add").modal("hide"),LoadingOverlayEnd(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"MyBankMate"),location.reload()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"MyBankMate"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"MyBankMate");LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"MyBankMate");LoadingOverlayEnd()}}))})}function initSelect2avatar(){$(".select2avatar-delivery").select2({placeholder:"Please select",templateResult:formatOptions2,templateSelection:formatSelected2})}function formatOptions2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function formatSelected2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function addFundModalShow(n){LoadingOverlay();var t="/Bankmate/AddFundModalShow?accountId="+n;$("#app-mbm-funds-in").empty();$("#app-mbm-funds-in").load(t,function(){$("#payment-accounts").select2();$("#app-mbm-funds-in").modal("show");LoadingOverlayEnd()})}function addWithdrawFundModalShow(n){var t="/Bankmate/WithdrawFundModalShow?accountId="+n;$("#app-mbm-funds-out").empty();$("#app-mbm-funds-out").load(t,function(){$("#app-mbm-funds-out").modal("show");$("#receiving-accounts").select2();LoadingOverlayEnd()})}function transactionDetailModalShow(n,t){var i="/Bankmate/TransactionDetailModalShow?transactionId="+n+"&associatedAccountId="+t;LoadingOverlay();$("#mbm-statement-detail").empty();$("#mbm-statement-detail").load(i);$("#mbm-statement-detail").modal("show");LoadingOverlayEnd()}function addFund(n){var u=$("#transaction-amount").val(),e=$("#payment-accounts").find("option:selected").val(),f=$("#transaction-reference").val(),t=$("#add-fund_form"),i,r;t.validate({rules:{transactionAmount:{required:!0},assignee:{required:!0},transactionReference:{required:!0}}});i={Id:e};r={Id:n};t.submit(function(e){if((e.preventDefault(),!isBusy)&&t.valid()){var o=document.getElementById("link-upload-file").files;o&&o.length>0?UploadMediaS3ClientSide("link-upload-file").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}SaveDomainBankmateAccountTransfer(n,u,i,r,f,"fund","app-mbm-funds-in",t)}):SaveDomainBankmateAccountTransfer(n,u,i,r,f,"fund","app-mbm-funds-in",null)}})}function addWithdraw(n){var u=$("#transaction-amount").val(),e=$("#receiving-accounts").find("option:selected").val(),f=$("#transaction-reference").val(),t=$("#addWithdrawFrm"),i,r;t.validate({rules:{transactionAmount:{required:!0},assignee:{required:!0},transactionReference:{required:!0}}});i={Id:e};r={Id:n};t.submit(function(e){if((e.preventDefault(),!isBusy)&&t.valid()){var o=document.getElementById("link-upload-file").files;o&&o.length>0?UploadMediaS3ClientSide("link-upload-file").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}SaveDomainBankmateAccountTransfer(n,u,r,i,f,"withdraw","app-mbm-funds-out",t)}):SaveDomainBankmateAccountTransfer(n,u,r,i,f,"withdraw","app-mbm-funds-out",null)}})}function SaveDomainBankmateAccountTransfer(n,t,i,r,u,f,e,o){var s,h;LoadingOverlay();s=null;o!=null&&(s={FileKey:o.objectKey,FileName:o.fileName,FileType:o.fileType,FileSize:o.fileSize});h="/Bankmate/SaveBankmateTransaction";$.ajax({method:"POST",dataType:"JSON",url:h,beforeSend:function(){isBusy=!0},data:{amount:t,originalAccount:i,destinationAccount:r,reference:u,type:f,s3ObjectUpload:s},success:function(t){isBusy=!1;t.result?(cleanBookNotification.createSuccess(),ListDomainBMTransactionsShow(n),$("#"+e).modal("toggle")):cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){isBusy=!1;cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}function ListDomainBMTransactionsShow(n){var u,t;$("#list-transactions").LoadingOverlay("show");u=$("#searchkey").val();t="";$("#seachbankId").val()!=null&&(t=$("#seachbankId").val().toString());var f=$("#transactiontypeId").val(),i=$("#searchDateRange").val(),r=i.split(" - ");r.length>=2&&(i=r[0]+"-"+r[1]);var e="/Bankmate/DomainBMTransactionsListShow?accountId="+n+"&daterangeString="+i+"&keysearch="+u+"&searchBankIdList="+t+"&showTypeId="+f+"&takeNumber=20";$("#list-transactions").empty();$("#list-transactions").load(e);$("#list-transactions").LoadingOverlay("hide")}function LoadMoreTransaction(n,t){var e,i;$("#list-transactions").LoadingOverlay("show");e=$("#searchkey").val();i="";$("#seachbankId").val()!=null&&(i=$("#seachbankId").val().toString());var o=$("#transactiontypeId").val(),r=$("#searchDateRange").val(),u=r.split(" - ");u.length>=2&&(r=u[0]+"-"+u[1]);var f=$(t).attr("takeNum"),s=Number(f)+20;$.ajax({method:"POST",dataType:"JSON",url:"/Bankmate/LoadMoreDomainBMAccountTransaction",data:{accountId:n,daterangeString:r,keysearch:e,searchBankIdList:i,showTypeId:o,takeNumber:f},"async":!1,beforeSend:function(){isServerBusy=!0},success:function(n){$("#approvedList").html("");$("#approvedList").append(n.ModelString);n.ModelCount<=f?$("#load-more-approved-btn").hide():$("#load-more-approved-btn").attr("takeNum",s)}});$("#list-transactions").LoadingOverlay("hide")}var isBusy=!1;$(document).ready(function(){initSelect2avatar();initModalAddBankMate()});