function BudgetGroupTypeSelected(n,t){$budgetScenarioItemGroupId=0;$budgetScenarioId=t;DisplayBudgetItemInput(n);$(".unitextra").hide();$("#budget-item-table > tbody").html("");$("#dynamic-budget-add-item").show();$(".dynamic-budget-item-table").hide();$("#budget-ready").hide();$("#budget-draft").hide()}function DisplayBudgetItemInput(n){var t="/TraderBudget/BudgetAddEditChoseItem?budgetScenarioItemGroupId="+$budgetScenarioItemGroupId+"&itemGroupType="+n+"&budgetScenarioId="+$budgetScenarioId;AjaxElementLoad(t,"dynamic-budget-add-item")}function ItemSelected(){var n=$("#item-select").find(":selected");if(n.val()===""){$(".unitextra").hide();itemSelect.Id="";itemSelect.Name="";itemSelect.Image="";itemSelect.Unit="";return}itemSelect.Id=n.attr("itemId");itemSelect.Name=n.attr("itemName");itemSelect.Image=n.attr("itemImage");itemSelect.Unit=n.attr("itemUnit");$("#item-unit-name").text(itemSelect.Unit);$(".unitextra").show()}function RemoveRowItem(){$.LoadingOverlay("show");$.ajax({type:"get",url:"/TraderBudget/RemoveBudgetScenarioItem?budgetScenarioGroupId="+$budgetScenarioItemGroupId+"&itemId="+$rowRemoveId,dataType:"json",success:function(n){if(n.result)$("#confirm-delete").modal("hide"),$("#budget-item-table #tr_id_"+$rowRemoveId).remove(),$("#budget-item-table-approval #tr_id_"+$rowRemoveId).remove(),ResetBudgetItemSelected("budget-item-table","item-select");else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ConfirmRemoveRowItem(n){$rowRemoveId=n}function CancelDelete(){$("#confirm-delete").modal("hide")}function BudgetItemAddNow(n){if($workgroupId===0||$workgroupId===""){cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles");return}if(itemSelect.Id===0||itemSelect.Id===""){cleanBookNotification.error(_L("ERROR_MSG_617"),"Qbicles");return}SaveItem(n).then(function(t){AddItemToTableList(t.actionVal,n)})}function PeriodBreakdownItem(n,t){if($workgroupId===0||$workgroupId===""){cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles");return}if(itemSelect.Id===0||itemSelect.Id===""){cleanBookNotification.error(_L("ERROR_MSG_617"),"Qbicles");return}SaveItem(t).then(function(i){var r=i.actionVal;n>0&&(r=n);PeriodBreakdownItemShow(t,r)})}function PeriodBreakdownItemOnTable(n,t){PeriodBreakdownItemShow(t,n)}function SaveItem(n){$.LoadingOverlay("show");var t=new $.Deferred,i=[{Item:{Id:itemSelect.Id},SaleQuantity:$("#item-sale-quantity").val(),AverageSalePrice:$("#item-sale-average-price").val(),PurchaseQuantity:$("#item-purchase-quantity").val(),AveragePurchaseCost:$("#item-purchase-average-cost").val()}],r={Id:$budgetScenarioItemGroupId,BudgetScenario:{Id:$budgetScenarioId},WorkGroup:{Id:$("#budget-workgroup-select").val()},Status:1,Type:n,BudgetScenarioItems:i};return $.ajax({"async":!1,type:"post",url:"/TraderBudget/AddBudgetScenarioItem",data:{budgetScenarioGroup:r},dataType:"json",success:function(n){if(n.msgId>0)$budgetScenarioItemGroupId=n.msgId,t.resolve(n);else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");t.resolve(n);return}},error:function(){t.resolve("");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()}),t.promise()}function UpdateStatusApproval(n){var t=$("#action_approval_default").val();$.LoadingOverlay("show");CheckStatusApproval(n).then(function(i){if(LoadingOverlayEnd(),i.result&&i.Object.toLocaleLowerCase()===t.toLocaleLowerCase()){var r=$("#action_approval").val();$.LoadingOverlay("show");$.ajax({url:"/Qbicles/SetRequestStatusForApprovalRequest",type:"GET",dataType:"json",data:{appKey:n,status:r},success:function(n){var t="/TraderBudget/ReloadBudgetStatusApproval?id="+$("#budget-group-item-id").val();$("#manager-approval").load(t,function(){r!=="Pending"?$("#edit-budget").hide():$("#edit-budget").show();$("#status-css").removeClass().addClass("label").addClass(n.msgName);$("#status-name").text(n.msg);LoadingOverlayEnd();cleanBookNotification.updateSuccess()})},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){})}else LoadingOverlayEnd(),cleanBookNotification.error(_L("ERROR_MSG_247"),"Qbicles")})}function HideApprovalAndMediaCommen(){$(".approval-action").addClass("hidden");$(".manager-action").removeClass("hidden")}function ShowApprovalAndMediaCommen(){$(".manager-action").addClass("hidden");$(".approval-action").removeClass("hidden")}var itemSelect,$rowRemoveId,$quantityTotal;$(function(){var n=$("#group-type").val();n==="ItemsIBuy"?($(".sale-col-qty").hide(),$(".sale-col-price").hide(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show()):n==="ItemsISell"?($(".purchase-col-qty").hide(),$(".purchase-col-cost").hide(),$(".sale-col-qty").show(),$(".sale-col-price").show()):($(".sale-col-qty").show(),$(".sale-col-price").show(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show())});var $workgroupId=0,$budgetScenarioItemGroupId=0,$budgetScenarioId=0;BudgetAddEditItem=function(n,t,i){$budgetScenarioItemGroupId=n;$budgetScenarioId=t;var r="/TraderBudget/BudgetAddEditItem?budgetScenarioItemGroupId="+n+"&budgetScenarioId="+$budgetScenarioId+"&oView="+i;AjaxElementShowModal(r,"app-trader-budget-item-add-edit")};itemSelect={Id:"",Name:"",Image:"",Unit:""};ValuePurchaseOnChange=function(){var n=$("#item-purchase-quantity").val(),t=$("#item-purchase-average-cost").val();$("#item-purchase-amount").val(n*t)};ValueSaleOnChange=function(){var n=$("#item-sale-quantity").val(),t=$("#item-sale-average-price").val();$("#item-sale-amount").val(n*t)};$rowRemoveId=0;AddItemToTableList=function(n,t){var i,r,u,f;if(t===1?($(".sale-col-qty").hide(),$(".sale-col-price").hide(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show()):t===2?($(".purchase-col-qty").hide(),$(".purchase-col-cost").hide(),$(".sale-col-qty").show(),$(".sale-col-price").show()):($(".sale-col-qty").show(),$(".sale-col-price").show(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show()),$(".dynamic-budget-item-table").show(),$("#budget-ready").show(),$("#budget-draft").show(),i=$("#tb_form_template tbody tr").clone(),$(i).attr("id","tr_id_"+itemSelect.Id),$($(i).find("td.row_image div")).attr("style","background-image: url('"+itemSelect.Image+"');"),$($(i).find("td.row_name")).text(itemSelect.Name),$($(i).find("td.row_unit")).text(itemSelect.Unit),$($(i).find("td.row_button input.traderItem")).val(itemSelect.Id),$($(i).find("td.purchase-col-qty")).text(numberString($("#item-purchase-quantity").val(),"")),$($(i).find("td.purchase-col-cost")).text(toCurrencySymbol($("#item-purchase-average-cost").val())),$($(i).find("td.sale-col-qty")).text(numberString($("#item-sale-quantity").val(),"")),$($(i).find("td.sale-col-price")).text(toCurrencySymbol($("#item-sale-average-price").val())),r=0,t===1)r=$("#item-purchase-amount").val();else if(t===2)r=$("#item-sale-amount").val();else{var e=$("#item-purchase-quantity").val(),o=$("#item-purchase-average-cost").val(),s=$("#item-sale-quantity").val(),h=$("#item-sale-average-price").val();r=e*o+s*h}$($(i).find("td.row_total")).text(toCurrencySymbol(r));$($(i).find("td.row_button button.remove")).attr("onclick","ConfirmRemoveRowItem('"+itemSelect.Id+"')");$($(i).find("td.row_button button.period")).attr("onclick","PeriodBreakdownItemOnTable("+n+","+t+")");u=$("#budget-item-table tbody tr#tr_id_"+itemSelect.Id);u.length===0?($("#budget-item-table tbody").append(i),f=$("#budget-item-table #tr_id_"+itemSelect.Id).clone(),$("#budget-item-table-approval tbody").append(f),$("#budget-item-table-approval td.row_button").attr("hidden",!0)):cleanBookNotification.error(_L("ERROR_MSG_373"),"Qbicles");ResetBudgetItemSelected("budget-item-table","item-select");itemSelect.Id="";$("#dynamic-budget-add-item input").val("0")};PeriodBreakdownItemShow=function(n,t){var i="/TraderBudget/PeriodBreakdownItemManagement?budgetScenarioItemId="+t+"&type="+n;AjaxElementShowModal(i,"app-trader-budget-item-breakdown-buysell")};$quantityTotal=$("#qty-total").val();SaveDraft=function(){$.LoadingOverlay("show");$("#app-trader-budget-item-add-edit").modal("hide");LoadingOverlayEnd()};SendToReview=function(){$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderBudget/SendToReviewBudgetScenario",data:{budgetScenarioGroupId:$budgetScenarioItemGroupId},dataType:"json",success:function(n){if(n.result)cleanBookNotification.updateSuccess(),$("#app-trader-budget-item-add-edit").modal("hide");else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};