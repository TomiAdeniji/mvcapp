function initConsumerDiscussionPage(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#orer-item-search-text").keyup(delay(function(){initOrderItemsShow(!0)},500));$("#orer-item-search-categories").change(function(){initOrderItemsShow(!0)});initOrderItemsShow(!0);initBuyOrderItemsTable();$("input[name=AmountSeller],input[name=AmountBuyer]").change(delay(function(){updateExchangeRate()},1e3))}function initProviderDiscussionPage(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#orer-item-search-text").keyup(delay(function(){initOrderItemsShow(!1)},500));$("#orer-item-search-categories").change(function(){initOrderItemsShow(!1)});initSellOrderItemsTable();initOrderItemsShow(!1)}function loadProductMoreContent(n){var t=$orderUI.$hdfOrderKey.val(),i="/Commerce/LoadProductMoreContent?itemId="+n+"&orderKey="+t;LoadingOverlay();$("#product-more-b2border").empty();$("#product-more-b2border").modal("show");$("#product-more-b2border").load(i,function(){var t=$("#item-associated").select2({placeholder:"Please select",ajax:{url:"/Commerce/GetListTraderItem",delay:250,data:function(n){return{search:n.term}},cache:!0,processResults:function(n){return{results:n.Object}}},minimumInputLength:1}),n=$("#unit-associated");n.select2({placeholder:"Please select"});t.on("select2:select",function(t){var i=t.params.data;n.empty();i.units.length==0?n.attr("disabled",!0):n.attr("disabled",!1);n.select2({placeholder:"Please select",data:i.units?i.units:[]});b2bMatchTaxes()});$("#primary-vendor").bootstrapToggle();showAmountConverted("input[name=showpriceconverted]");LoadingOverlayEnd()})}function loadProductMoreContentInProvider(n){var t=$orderUI.$hdfOrderKey.val(),i="/Commerce/LoadProductMoreContent?itemId="+n+"&orderKey="+t;LoadingOverlay();$("#b2b-seller-add-item").empty();$("#b2b-seller-add-item").modal("show");$("#b2b-seller-add-item").load(i,function(){LoadingOverlayEnd()})}function itemTemplateToProvider(n){var t='<div class="col"><a href="#product-more-menu" data-toggle="modal" onclick="loadProductMoreContentInProvider('+n.Id+')">';return t+='<div class="productimg" style="background-image: url(\''+n.ImageUri+"');\"><\/div>",t+='<div class="priceblock">',t+="<p>"+n.Name+"<\/p>",t+='<label class="label label-lg label-soft">'+n.CategoryName+"<\/label> &nbsp; <span>"+n.Price+"<\/div>",t+"<\/a><\/div>"}function initOrderItemsShow(n){var t=$("#items-container"),i=$("#pagiation-items");i.pagination({dataSource:"/Commerce/SearchB2bOrderItems",locator:"items",totalNumberLocator:function(n){return t.LoadingOverlay("hide"),n.totalNumber},pageSize:6,ajax:{data:{scatids:JSON.stringify($("#orer-item-search-categories").val()),keyword:$("#orer-item-search-text").val(),bdomainKey:$("#providerDomainKey").val()},beforeSend:function(){t.LoadingOverlay("show")}},callback:function(i){var f=i.length,e=(f%3==0?0:3)-f%3,r="",u;for(n?$.each(i,function(n,t){r+=itemTemplate(t)}):$.each(i,function(n,t){r+=itemTemplateToProvider(t)}),u=0;u<e;u++)r+='<div class="col">&nbsp;<\/div>';t.html(r)}})}function itemTemplate(n){var t='<div class="col"><a href="#product-more-menu" data-toggle="modal" onclick="loadProductMoreContent('+n.Id+')">';return t+='<div class="productimg" style="background-image: url(\''+n.ImageUri+"');\"><\/div>",t+='<div class="priceblock">',t+="<p>"+n.Name+"<\/p>",t+='<label class="label label-lg label-soft">'+n.CategoryName+"<\/label> &nbsp; <span>"+n.Price+"<\/span>"+calPriceByExchangeRate(n.PriceVal)+"<\/div>",t+"<\/a><\/div>"}function addItemToB2BOrder(n){var i,r;if($("#frmAddItemB2bOrder").valid()){var u=$("#item-variant option:selected").attr("variant-id"),f=parseFloat($("#item-variant option:selected").val()),e={Id:u,Price:f},t=[],o=$("#item-extras div label div input");_.forEach(o,function(n){if($("#"+n.id).prop("checked")){var i=$("#"+n.id).attr("extra-id"),r=parseFloat($("#"+n.id).val()),u={Id:i,Price:r};t.push(u)}});i=parseInt($("#item-quantity").val());r=parseFloat($("#order-total-prices").attr("value"));LoadingOverlay();$.ajax({type:"POST",url:"/Commerce/AddItemToB2BOrder",data:{DisKey:$orderUI.$discussionKey.val(),OrderKey:$orderUI.$hdfOrderKey.val(),Variant:e,Extras:t,Quantity:i,IncludedTaxAmount:r,ItemId:n,AssociatedItemId:$("#item-associated").val(),AssociatedUnitId:$("#unit-associated").val(),PrimaryVendor:$("#primary-vendor").prop("checked")},datatype:"JSON",success:function(n){$("#product-more-b2border").modal("hide");$("#b2b-seller-add-item").modal("hide");LoadingOverlayEnd();n.result?(reloadOrderStatus(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):!n.result&&n.msg?cleanBookNotification.error(data.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}}function reloadDataTable(){$("#order-list").DataTable().ajax.reload(function(n){$("#totalpricestr-buyer").empty();$("#totalpricestr").empty();n.data[0]!=null?($("#totalpricestr-buyer").append(currencySetting.BuyingCurrencySymbol+(n.data[0].TotalPrice*parseFloat($orderUI.$amountBuyer.data("exchangerateval"))).toFixed(currencySetting.DecimalPlace)),$("#totalpricestr").append(currencySetting.CurrencySymbol+n.data[0].TotalPrice.toFixed(currencySetting.DecimalPlace))):($("#totalpricestr").append(currencySetting.CurrencySymbol+Number(0).toFixed(currencySetting.DecimalPlace)),$("#totalpricestr-buyer").append(currencySetting.BuyingCurrencySymbol+Number(0).toFixed(currencySetting.DecimalPlace)))})}function initBuyOrderItemsTable(){var n=$("#showPriceConverted").prop("checked"),t=$("#order-list").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#order-list").LoadingOverlay("show"):$("#order-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[5,10,20,50,100],[5,10,20,50,100]],pageLength:5,ajax:{url:"/Commerce/LoadB2BOrderItems",type:"POST",data:function(n){return $.extend({},n,{orderKey:$orderUI.$hdfOrderKey.val(),searchKey:$("#order-search-key").val(),catIds:$("#order-search-categories").val(),isViewBuy:!0})},dataSrc:function(n){var t=$("#item-count"),i=$("#totalpricestr"),r=$("#totalpricestrconverted");return i.empty(),r.empty(),n.recordsTotal>0?(i.append(currencySetting.CurrencySymbol+n.data[0].TotalPrice.toFixed(currencySetting.DecimalPlace)),r.append(" / "+currencySetting.BuyingCurrencySymbol+(n.data[0].TotalPrice*parseFloat($orderUI.$amountBuyer.data("exchangerateval"))).toFixed(currencySetting.DecimalPlace)),t.show(),t.text(n.recordsTotal),t.removeClass("animated bounce"),t.addClass("animated bounce"),$("#cart-empty").hide(),$("#cart").show()):(t.hide(),$("#cart-empty").show(),$("#cart").hide()),n.data}},columns:[{data:"ItemName",orderable:!0,render:function(n,t,i){var r="",u;if(i.SourceName!=""){if(r+=i.ItemName,r+=" <i class='fa fa-info-circle blue' data-tooltip='Source item: "+i.SourceName+"'><\/i>",r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',r+='<div class="col-xs-6">',r+="<h6>"+i.Variant.Name+"<\/h6>",r+="<\/div>",r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Variant.AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>",i.Extras!=null)for(u=0;u<i.Extras.length;u++)r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',r+='<div class="col-xs-6">',r+="<h6> + "+i.Extras[u].Name+"<\/h6>",r+="<\/div>",r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Extras[u].AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>"}else r+=i.ItemName;return r}},{data:"CategoryName",orderable:!1},{data:"Quantity",orderable:!0,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<input style=\"width: 80px;\" type='number' itemId='"+i.ItemId+"' "+r+"  id='itemquantity"+i.ItemId+"' class='form-control itemquantity' value='"+i.Quantity+'\' oninput="validity.valid||(value=\'0\')"; min="0">'}},{data:"ItemInitialPrice",orderable:!1,render:function(n,t,i){return i.ItemInitialPrice.toFixed(currencySetting.DecimalPlace)}},{data:"Discount",orderable:!1},{data:"TaxInfo",orderable:!1},{data:"Price",orderable:!1,render:function(n,t,i){return i.Price.toFixed(currencySetting.DecimalPlace)}},{data:"Price",orderable:!1,visible:n,render:function(n,t,i){let r=i.Price*parseFloat($orderUI.$amountBuyer.data("exchangerateval"));var u='<span class="red">'+r.toFixed(currencySetting.DecimalPlace);return u}},{orderable:!1,render:function(n,t,i){var u=UniqueId(5),f=i.IsAllowEdit?"":"disabled",r='<div class="input-group"><select name="item-associated" '+f+' id="item-associated'+u+'" data-unitidref="'+u+'" class="form-control select2 item-associated" style="width: 200px;">';return i.AssociatedItem&&(r+='<option value="'+i.AssociatedItem.id+'">'+i.AssociatedItem.text+"<\/option>"),r+="<\/select>",r+='<span class="input-group-btn">',r+="<select "+f+" onchange=\"updateAssociatedItem('"+u+"',"+i.Variant.TraderId+')" id="unit-associated'+u+'" data-unitidref="'+u+'" name="unit-associated" class="form-control select2 unit-associated" style="width: 100px;">',r+='<option value=""><\/option>',i.AssociatedUnits!=null&&i.AssociatedUnits.length>0&&i.AssociatedUnits.forEach(n=>{r+='<option value="'+n.id+'" '+(n.selected?"selected":"")+">"+n.text+"<\/option>"}),r+="<\/select><\/span>",r+="<\/div>"}},{data:"ItemId",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<button "+r+' class="btn btn-default cartb2b-remove-item" onclick="removeItemFromOrder('+i.ItemId+')"><i class="fa fa-trash"><\/i><\/button>'}}],drawCallback:function(){var n=delay(function(){var n=$(this),t={Id:n.attr("itemId"),Quantity:n.val()};updateQuantityOrderItem(t)},1e3);$(".itemquantity").on("change",n)}});$("#order-list").on("draw.dt",function(){$(document).ready(function(){setTimeout(function(){$("#order-list select.item-associated").select2({placeholder:"Please select",ajax:{url:"/Commerce/GetListTraderItem",delay:250,data:function(n){return{search:n.term}},cache:!0,processResults:function(n){return{results:n.Object}}},minimumInputLength:1});$("#order-list select.unit-associated").select2({placeholder:"Please select"});$("#order-list select.item-associated").on("select2:select",function(n){var i=n.params.data,r=$(this).data("unitidref"),t=$("#unit-associated"+r);t.empty();t.select2({placeholder:"Please select",data:i.units?i.units:[]});t.trigger("change")})},100)})})}function initSellOrderItemsTable(){$("#order-list").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#order-list").LoadingOverlay("show"):$("#order-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[5,10,20,50,100],[5,10,20,50,100]],pageLength:5,ajax:{url:"/Commerce/LoadB2BOrderItems",type:"POST",data:function(n){return $.extend({},n,{orderKey:$orderUI.$hdfOrderKey.val(),searchKey:$("#order-search-key").val(),catIds:$("#order-search-categories").val(),isViewBuy:!1})},dataSrc:function(n){var t=$("#totalpricestr");return n.recordsTotal>0?(t.text(currencySetting.CurrencySymbol+n.data[0].TotalPrice.toFixed(currencySetting.DecimalPlace)),$("#cart-empty").hide(),$("#cart").show()):($("#cart-empty").show(),$("#cart").hide()),n.data}},columns:[{data:"ItemName",orderable:!0,render:function(n,t,i){var r="",u;if(i.SourceName!=""){if(r+=i.ItemName,r+=" <i class='fa fa-info-circle blue' data-tooltip='Source item: "+i.SourceName+"'><\/i>",r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',r+='<div class="col-xs-6">',r+="<h6>"+i.Variant.Name+"<\/h6>",r+="<\/div>",r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Variant.AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>",i.Extras!=null)for(u=0;u<i.Extras.length;u++)r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',r+='<div class="col-xs-6">',r+="<h6> + "+i.Extras[u].Name+"<\/h6>",r+="<\/div>",r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Extras[u].AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>"}else r+=i.ItemName;return r}},{data:"CategoryName",orderable:!1},{data:"Quantity",orderable:!0,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<input style=\"width: 80px;\" type='number' itemId='"+i.ItemId+"' "+r+"  id='itemquantity"+i.ItemId+"' class='form-control itemquantity' value='"+i.Quantity+'\' oninput="validity.valid||(value=\'0\')"; min="0">'}},{data:"ItemInitialPrice",orderable:!1,render:function(n,t,i){return i.ItemInitialPrice.toFixed(currencySetting.DecimalPlace)}},{data:"Discount",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<input type='number' itemId='"+i.ItemId+"' "+r+"  id='itemdiscount"+i.ItemId+"' class='form-control itemdiscount' real-discount-value='"+i.Discount+"' value='"+i.Discount+'\' oninput="validity.valid || (value = \'0\')" min="0" max= "100" step="0.001">'}},{data:"TaxInfo",orderable:!1},{data:"PriceString",orderable:!1,className:"price"},{data:"ItemId",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<button "+r+' class="btn btn-default cartb2b-remove-item" onclick="removeItemFromOrder('+i.ItemId+')"><i class="fa fa-trash"><\/i><\/button>'}}],drawCallback:function(){var n=delay(function(){var n=$(this),t=n.parents("tr"),i=$(t).find("input[type=number]").attr("itemId");n.attr("real-discount-value",n.val());updateDiscountOrderItem(i)},1e3),t=delay(function(){var f=$(this),e=f.parents("tr"),u=$("#order-list").DataTable(),n=$(e).find("input[type=number]").attr("itemId"),t,i,r;$("#itemdiscount"+n).parent().addClass("discountContainer"+n);t=parseFloat($("#pureprice"+n).val());i=parseFloat($("#itemprice"+n).val());i>t?u.cell(".discountContainer"+n).data(0):(r=(1-i/t)*100,u.cell(".discountContainer"+n).data(r.toFixed(currencySetting.DecimalPlace)),$("#itemdiscount"+n).attr("real-discount-value",r));updateDiscountOrderItem(n)},1e3),i=delay(function(){var n=$(this),t={Id:n.attr("itemId"),Quantity:n.val()};updateQuantityOrderItem(t)},1e3);$(".itemquantity").on("change",i);$(".itemdiscount").on("change",n);$(".price").on("change",t)}});$("#order-list").on("draw.dt",function(){$("#order-list .select2").select2({placeholder:"Please select"})})}function updateDiscountOrderItem(n){var t={Id:n,Variant:{Discount:parseFloat($("#itemdiscount"+n).attr("real-discount-value"))}};$("#order-list").LoadingOverlay("show");$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/UpdateDiscountOrderItem",data:JSON.stringify({disKey:$orderUI.$discussionKey.val(),orderKey:$orderUI.$hdfOrderKey.val(),updatedItem:t}),contentType:"application/json",success:function(n){n.result?reloadOrderStatus():cleanBookNotification.error(n.msg);$("#order-list").LoadingOverlay("hide",!0)},error:function(n){cleanBookNotification.error(n.msg);$("#order-list").LoadingOverlay("hide",!0)}})}function updateTotalOrder(){var r={MoneyCurrency:$("#currencySymbol").val(),MoneyDecimalPlaces:$("#currencyDecimalPlace").val()},u=parseFloat($("#item-quantity").val()),f=parseFloat($("#item-variant").val()),e=$("#item-extras div label div input"),t=0,n,i;_.forEach(e,function(n){$("#"+n.id).prop("checked")&&(t+=parseFloat(n.value))});n=u*(f+t);i=calPriceByExchangeRate(n,!0);$("#order-total-prices").empty().append(n.toFixed(r.MoneyDecimalPlaces));$(".total-price-buyer-currency").text(i);$("#order-total-prices").attr("value",n)}function updateQuantityOrderItem(n){$("#order-list").LoadingOverlay("show");$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/UpdateQuantityOrderItem",data:JSON.stringify({disKey:$orderUI.$discussionKey.val(),orderKey:$orderUI.$hdfOrderKey.val(),updatedItem:n}),contentType:"application/json",success:function(n){n.result?reloadOrderStatus():cleanBookNotification.error(n.msg);$("#order-list").LoadingOverlay("hide",!0)},error:function(n){cleanBookNotification.error(n.msg);$("#order-list").LoadingOverlay("hide",!0)}})}function removeItemFromOrder(n){if(confirm("Do you want to completely remove this item from the cart?")){$("#order-list").LoadingOverlay("show",!0);var t=$orderUI.$discussionKey.val(),i="/Commerce/RemoveItemFromB2BOrder?disKey="+t+"&itemId="+n;$.ajax({method:"POST",dataType:"JSON",url:i,success:function(n){n.result?reloadDataTable():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")},always:function(){$("#order-list").LoadingOverlay("hide",!0)}})}}function updateAssociatedItem(n,t){$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/UpdateAssociatedItem",data:{orderKey:$orderUI.$hdfOrderKey.val(),itemId:$("#item-associated"+n).val(),unitId:$("#unit-associated"+n).val(),variantId:t},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}})}function getDeliveryDetail(n){$.get("/Commerce/GetDeliveryDetail?locationId="+n,function(n){$(".delivery-detail").fadeIn();$(".location-name").html("<strong>"+n.locationName+"<\/strong>");$(".address-text").html(n.address)})}function sellingDomainSubmitProposal(){LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/SellingDomainSubmitProposal",data:{disKey:$orderUI.$discussionKey.val()},success:function(n){n.result?(reloadOrderButtonSubmit(),reloadDataTable(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function reloadOrderButtonSubmit(){$(".btn-block-submit").load("/Commerce/LoadOrderSubmit?orderKey="+$orderUI.$hdfOrderKey.val())}function sellingChooseWGModal(){$orderUI.$choosewg.find(".modal-body").load("/Commerce/SellingChooseWGModal?orderKey="+$orderUI.$hdfOrderKey.val(),function(){$("#choose-wg .select2").select2();initSellingOrderProcessingForm()})}function buyingChooseWGModal(){$("#frmBuyingSubmmitProposal").valid()&&($orderUI.$choosewg.modal("show"),$orderUI.$choosewg.find(".modal-body").load("/Commerce/BuyingChooseWGModal?orderKey="+$orderUI.$hdfOrderKey.val()+"&locationId="+$orderUI.$slDeliveryTo.val(),function(){$("#choose-wg .select2").select2();initBuyingOrderProcessingForm()}))}function initSellingOrderProcessingForm(){var n=$("#orderprocessing-frm");n.validate({rule:{paymentacc:{required:!0},salewg:{required:!0},invoicewg:{required:!0},paymentwg:{required:!0},transferwg:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){var i=$("#paymentacc").val(),r=$("#salewg").val(),u=$("#invoicewg").val(),f=$("#paymentwg").val(),e=$("#transferwg").val();LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/ProcessB2BOrder",data:{orderKey:$orderUI.$hdfOrderKey.val(),paymentAccId:i,disKey:$orderUI.$discussionKey.val(),saleWGId:r,invoiceWGId:u,paymentWGId:f,transferWGId:e},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#choose-wg").modal("hide"),reloadOrderButtonSubmit(),reloadDataTable()):cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}})}function initBuyingOrderProcessingForm(){var n=$("#orderprocessing-frm");n.validate({rule:{paymentacc:{required:!0},purchasewg:{required:!0},invoicewg:{required:!0},paymentwg:{required:!0},transferwg:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){var i=$("#paymentacc").val(),r=$("#purchasewg").val(),u=$("#invoicewg").val(),f=$("#paymentwg").val(),e=$("#transferwg").val();LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/BuyingDomainSubmitProposal",data:{orderKey:$orderUI.$hdfOrderKey.val(),paymentAccId:i,disKey:$orderUI.$discussionKey.val(),purchaseWGId:r,invoiceWGId:u,paymentWGId:f,transferWGId:e,destinationLocationId:$orderUI.$slDeliveryTo.val()},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$("#choose-wg").modal("hide"),reloadOrderButtonSubmit(),reloadDataTable()):cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}})}function checkForSellingSubmitAbility(){var n=$("#paymentacc").val(),t=$("#salewg").val(),i=$("#invoicewg").val(),r=$("#paymentwg").val(),u=$("#transferwg").val();n!=""&&t!=""&&i!=""&&r!=""&&u!=""?$("#orderprocessing-frm").find("button[type=submit]").removeAttr("disabled"):$("#orderprocessing-frm").find("button[type=submit]").attr("disabled","disabled")}function checkForBuyingSubmitAbility(){var n=$("#paymentacc").val(),t=$("#purchasewg").val(),i=$("#invoicewg").val(),r=$("#paymentwg").val(),u=$("#transferwg").val();n!=""&&t!=""&&i!=""&&r!=""&&u!=""?$("#orderprocessing-frm").find("button[type=submit]").removeAttr("disabled"):$("#orderprocessing-frm").find("button[type=submit]").attr("disabled","disabled")}function loadMorePostsDiscussion(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityPosts",data:{activityKey:n,size:CountPost*t,isDiscussionOrder:!0},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadPosts").remove();return}$("#"+i).append(n).fadeIn(250);CountPost=CountPost+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function reloadOrderStatus(){reloadDataTable();reloadOrderButtonSubmit()}function updateExchangeRate(){var n={id:$orderUI.$amountBuyer.data("id"),amountSeller:$("input[name=AmountSeller]").val(),amountBuyer:$orderUI.$amountBuyer.val()};$.post("/Commerce/UpdateExchangeRateById",n,function(n){n.result?($orderUI.$amountBuyer.data("exchangerateval",n.Object),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"),initOrderItemsShow(),reloadDataTable()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function showAmountConverted(n){var i=$("#order-list").DataTable(),t=i.column(7);$(n).prop("checked")?($(".converted").fadeIn(),t.visible(!0)):($(".converted").fadeOut(),t.visible(!1))}function calPriceByExchangeRate(n,t){var i;return $orderUI.$amountBuyer.length>0&&(i=n*parseFloat($orderUI.$amountBuyer.data("exchangerateval")),i=t?"/"+i.toFixed(currencySetting.DecimalPlace)+$orderUI.$amountBuyer.data("currency"):'<span class="converted" '+($("input[name=showpriceconverted]").prop("checked")?"":'style = "display: none;"')+">/"+i.toFixed(currencySetting.DecimalPlace)+$orderUI.$amountBuyer.data("currency")+"<\/span>"),i}function UpdateB2BOrderStatus(){var n=$("#b2b-order-status"),t=$("#discussionKey").val();$.ajax({type:"GET",url:"/Commerce/CheckStatusB2BOrders",data:{DiscussionOrderKey:t},success:function(t){t.result&&(n.text(t.Object.statusOrder),n.attr("class",t.Object.labelOrder))}})}var CountPost=1,$orderUI={$discussionKey:$("#discussionKey"),$hdfOrderKey:$("#hdfOrderKey"),$providerDomainKey:$("#providerDomainKey"),$choosewg:$("#choose-wg"),$slDeliveryTo:$("#slDeliveryTo"),$amountBuyer:$("input[name=AmountBuyer]")};