function initProductTab(){tabItemproduct=getTabTrader().TraderTab;activeTab=getTabTrader().SubTraderTab;activeTab==="pricebook-tab"?(SelectPriceBookTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="items-import"?(SelectItemsImportTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="adjuststock-tab"?(SelectAdjustStockTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="inventory-tab"?(selectInventoryTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="resource-tab"?(selectResourceTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="waste-report-tab"?($('a[href="#adjuststock-tab"]').tab("show"),SelectAdjustStockWasteTab()):activeTab==="inventoryaudit-tab"?(SelectInventoryAuditTab(),$('a[href="#'+activeTab+'"]').tab("show")):activeTab==="movement-tab"?(SelectMovementTab(),$('a[href="#'+activeTab+'"]').tab("show")):(isChangeItem=!0,selectTraderItemsTab())}function setDefauleInputSearchItem(){filter.Item.Key&&$("#search_dt").val(filter.Item.Key)}function onItemKeySearchChanged(n){filter.Item.Key=$(n).val();setTimeout(function(){searchOnTableItems()},200)}function searchOnTableItems(){var i=[],t=$("#search_dt").val().split(" "),n;if($("#search_dt").val()!==""&&$("#search_dt").val()!==null&&t.length>0)for(n=0;n<t.length;n++)t[n]!==""&&i.push(t[n]);$("#tb_trader_items").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#tb_trader_items").val("")}function setDefauleInputSearchPriceB(){$("#subfilter-group-price").val(filter.PriceBook.Product);$("#search_priceb").val(filter.PriceBook.Key)}function onPriceBKeySearchChanged(n){filter.PriceBook.Key=$(n).val();setTimeout(function(){searchOnTablePriceBs()},200)}function onSelectWorkgroupPriceB(n){filter.PriceBook.Product=$(n).val();setTimeout(function(){searchOnTablePriceBs()},200)}function searchOnTablePriceBs(){var i=[],n,t;if($("#subfilter-group-price").val()!==" "&&$("#subfilter-group-price").val()!==""&&$("#subfilter-group-price").val()!==null&&i.push($("#ssubfilter-group-price").val()),n=$("#search_priceb").val().split(" "),$("#search_priceb").val()!==""&&$("#search_priceb").val()!==null&&n.length>0)for(t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#tb_pricebooks").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#tb_pricebooks").val("")}function setType(n,t){if(LoadingOverlay(),curentTab=t,$("#local-manage-select").val()===null||$("#local-manage-select").val()===""||$("#local-manage-select").val()==="0")return cleanBookNotification.error(_L("ERROR_MSG_622"),"Qbicles"),!1;var i=$("#local-manage-select").val();$("#app-trader-inventory-item-add").empty();$("#app-trader-inventory-item-add").load("/Trader/AddTraderItem?locationId="+(i?i:0)+"&type="+n+"&callback=true");$("#app-trader-inventory-item-add").modal("toggle");LoadingOverlayEnd()}function editTraderItem(n,t,i){LoadingOverlay();curentTab=i;$("#wizard-add-item #theform").empty();var r=$("#local-manage-select").val();$("#form_inventory #local-manage-select").length>0&&(r=0);$("#app-trader-inventory-item-add").empty();$("#app-trader-inventory-item-add").load("/Trader/AddTraderItem?locationId="+(r?r:0)+"&traderItemId="+t+"&type="+n+"&callback=true");$("#app-trader-inventory-item-add").modal("toggle");LoadingOverlayEnd()}function LoadAccountsTree(n){LoadingOverlay();n==null&&(n=0);$("#app-bookkeeping-treeview").html("");$("#app-bookkeeping-treeview").load("/Bookkeeping/TreeViewAccountByNodeIdPartial?id=0&number=0&linkedId="+n,function(){initJsTree();$(".jstree").on("select_node.jstree",function(n,t){$("#content").html("<div class='text-center' style='margin-top: 50px;'><img src='/Content/DesignStyle/img/loading.gif' class='loader'><\/div>");var i=t.node.data.node,r=t.node.data.value;selectedNode=t.node.data;typeof selectedNode.parent=="number"?lstParent.push(selectedNode.parent):typeof selectedNode.parent=="string"&&(lstParent=selectedNode.parent.split(","));$(document).width()<978&&$("html, body").animate({scrollTop:$("#content").offset().top-120},"slow")});LoadingOverlayEnd()})}function activeLocation(){$("#form_specifics_active_in_all").html()==="Applied"&&changelocationAll();$(".bookkeeping-connected").toggle();$(".no-bookkeeping").toggle()}function getUnitsOnServer(n){var t=new $.Deferred;return $.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderItem/GetUnitByTraderItem?itemId="+n,dataType:"json",success:function(n){$.LoadingOverlay("hide");t.resolve(n)},error:function(){$.LoadingOverlay("hide")}}),t.promise()}function getIngredientOnServer(n){var t=new $.Deferred;return LoadingOverlay(),$.ajax({type:"post",url:"/TraderItem/GetListIngredient",data:{lstIng:n},dataType:"json",success:function(n){$.LoadingOverlay("hide");t.resolve(n)},error:function(){$.LoadingOverlay("hide")}}),t.promise()}function getIngredientOnServer3(n){$.ajax({type:"post",url:"/TraderItem/GetListIngredient",data:{lstIng:n.Ingredients,currentLocationId:$("#slLocation_items").val()},dataType:"json",success:function(t){test3(n,t)},error:function(){$.LoadingOverlay("hide")}})}function selectAccount(n,t){var r=$(".accountid-"+t).data("name"),i;$("#"+idAccount).val(t);i=selectedNode.name;r!==null&&r!==""&&(i=r);idAccount==="form_purchase"?($("#btn_addpurchase_account").addClass("hidden"),$("#btn_editpurchase_account").removeClass("hidden"),$("#form_purchase_account p").text(i)):idAccount==="form_salesaccount"?($("#btn_addsales_account").addClass("hidden"),$("#btn_editsales_account").removeClass("hidden"),$("#form_sales_account p").text(i)):idAccount==="form_inventoryaccount"?($("#btn_addinventory_account").addClass("hidden"),$("#btn_editinventory_account").removeClass("hidden"),$("#form_inventory_account p").text(i)):idAccount==="form_traderitem_contact_account"&&($("#btn_addcontact_account").addClass("hidden"),$("#btn_editcontact_account").removeClass("hidden"),$("#form_trader_account p").text(i));$("#app-bookkeeping-treeview").modal("toggle")}function checkBookkeepingConnected(){var n=new $.Deferred;return $.ajax({type:"get",url:"/TraderItem/CheckBookkeepingConnected",dataType:"json",success:function(t){n.resolve(t.result)},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");n.resolve(!1)}}),n.promise()}function validFormAdd(){}function checknumber(n,t){var i=t.which;(i!==8||i===32)&&(i<48||i>57)&&t.preventDefault()}function test3(n,t){var l,i,o,f,s,u,a,e,h,r,c;for(n.Ingredients=t,l=n.Ingredients.length-1,i=0;i<n.Ingredients.length;i++){if($("#template-options-select tr.new_row_recipe2 td.item_selected").empty(),$("#template-options-select tr.new_row_recipe2 td.item_selected").append('<select class="form-control select2" style="width: 100%;"  data-placeholder="Choose an unit"><\/select>'),o=$("#template-options-select tr.new_row_recipe2 td.item_selected select"),n.Ingredients[i].Units.length>0){for(f=[],s='<option value=""><\/option> ',u=0;u<n.Ingredients[i].Units.length;u++)f.push(parseFloat(n.Ingredients[i].Units.find(t=>t.Id==n.Ingredients[i].Units[u].Id).QuantityOfBaseunit)),s+='<option value="'+n.Ingredients[i].Units[u].Id+'" quantityOfBaseunit = "'+f[u]+'">'+n.Ingredients[i].Units[u].Name+"<\/option> ";o.append(s)}else a='<option value=""><\/option> ',o.append(a);n.Ingredients[i].SubItem||(n.Ingredients[i].SubItem={});n.Ingredients[i].SubItem.InventoryDetails.length>0&&(n.Ingredients[i].AverageCost=n.Ingredients[i].SubItem.InventoryDetails[0].AverageCost===0?"0":(n.Ingredients[i].SubItem.InventoryDetails[0].AverageCost*f[0]).toString(),n.Ingredients[i].LatestCost=n.Ingredients[i].SubItem.InventoryDetails[0].LatestCost===0?"0":(n.Ingredients[i].SubItem.InventoryDetails[0].LatestCost*f[0]).toString());e=$("#template-options-select tbody tr.new_row_recipe2").clone();$(e).addClass("gen"+i).attr("thPosition",i);$(e).find(".recipe-ingredient-add-mew").addClass("yeu-em-never-sai");$("#tb_edit_recipe tbody").append(e);h=$("#tb_edit_recipe tbody .gen"+i+"");l==i?initSelectOption2(n.Ingredients[i].SubItem.Id,h,!0):initSelectOption2(n.Ingredients[i].SubItem.Id,h,!1);r=$(".new_row_recipe2.gen"+i+"");$($(r).find("td.item_name input")).val(n.Ingredients[i].Id);$($(r).find("td.item_quantity input")).val(n.Ingredients[i].Quantity);$($(r).find(".item_averagecost")).val(n.Ingredients[i].SubItem.InventoryDetails[0].AverageCost);$($(r).find(".item_latestcost")).val(n.Ingredients[i].SubItem.InventoryDetails[0].LatestCost);$($(r).find("td.item_selected select")).val(n.Ingredients[i].Unit.Id);c=n.Ingredients[i].Units.find(t=>t.Id==n.Ingredients[i].Unit.Id).QuantityOfBaseunit;$($(r).find(".item_averagecost span")).html(n.Ingredients[i].AverageCost*c);$($(r).find(".item_latestcost span")).html(n.Ingredients[i].LatestCost*c)}$("#tb_edit_recipe tr.new_row_recipe2 td.item_selected select").select2().on("select2:select",function(n){var t=1,i,r;$.each(n.params.data.element.attributes,function(n,i){i.name=="quantityofbaseunit"&&(t=parseFloat(i.value))});i=parseFloat($(n.currentTarget).parent().parent().children(".item_averagecost").val());r=parseFloat($(n.currentTarget).parent().parent().children(".item_latestcost").val());$(n.currentTarget).parent().parent().children(".item_averagecost").find("span").val(i*t).html(i*t);$(n.currentTarget).parent().parent().children(".item_latestcost").find("span").val(r*t).html(r*t)})}function validateSpecificsForm(){var n=!0;return $("#form_specifics_category").val()===""&&(n=!1,$("#tab_form_specifics").validate().showErrors({specifics_category:"Category is required."})),$("#form_specifics_name").val()===""?(n=!1,$("#tab_form_specifics").validate().showErrors({specifics_name:"Item name is required."})):($("#form_specifics_name").val().length<4||$("#form_specifics_name").val().length>50)&&(n=!1,$("#tab_form_specifics").validate().showErrors({specifics_name:_L("ERROR_MSG_261")})),$("#form_specifics_description").val()===""&&(n=!1,$("#tab_form_specifics").validate().showErrors({form_specifics_description:"Item description is required."})),$("#form_specifics_icon").val()===""&&$("#form_specifics_icon_text").val()===""&&$("#traderItem_id").val().toString()==="0"&&(n=!1,$("#product_image").val()==="1"?$("#tab_form_specifics").validate().showErrors({specifics_icon:"Item image is required."}):cleanBookNotification.error(_L("ERROR_MSG_378"),"Qbicles")),n}function validateInventoryForm(n){if(!n)return!0;var t=!0;return($("#form_inventory_unitcost").val()===""||$("#form_inventory_unitcost").val()==="0")&&(t=!1,$("#form_inventory").validate().showErrors({unitcost:"Unit cost is required."})),t}function nextStepSpecifics(){validateSpecificsForm()&&($("#a_next_item1").click(),inventoryTabSelected())}function inventoryTabSelected(){$("#item-2 table").removeClass("datatable");$("#item-2 table").addClass("datatable")}function validateUniqueSKUandBarcode(){var t=$("#form_inventory_SKU").val(),r=$("#form_inventory_barcode").val(),i=$("#frmvalidateSkuAndBarcode").validate(),n=!0;return t||(n=!1,i.showErrors({sku:"The Product SKU is required!"})),t&&$.ajax({method:"POST",data:{traderId:$("#traderItem_id").val(),SKU:t,Barcode:r},url:"/TraderItem/validateUniqueSKUandBarcode",dataType:"json","async":!1}).done(function(t){t.sku&&(n=!1,i.showErrors({sku:"The Product SKU already exists!"}));t.barcode&&(n=!1,i.showErrors({barcode:"The Product Barcode already exists!"}))}),n}function nextStepInventory(){validateUniqueSKUandBarcode()&&($("#form_inventory_checkbox")[0].checked===!0?validateInventoryForm($("#form_inventory_checkbox")[0].checked)&&$("#a_next_item2").click():$("#a_next_item2").click())}function changeName(){$("#form_inventory_name").text('"'+$("#form_specifics_name").val()+'" inventory specifics')}function getSelectedUnits(){var u=$("#unit_conversions td.row_name .unitName"),f=$("#unit_conversions td.row_name span"),t=$("#unit_conversions td.row_name .unitIds"),r=$("#td_add_units select"),i,n;if(t.length>0){for(r.empty(),i='<option value=""><\/option> ',n=0;n<t.length;n++)i+='<option value="'+$(t[n]).val()+"|"+$(f[n]).text()+'">'+$(u[n]).val()+"<\/option> ";r.append(i);$("#td_add_units select").not(".multi-select").select2()}}function addNewUnitConversion(){var t=!1,n;($("#unit_conversions tbody tr").length===0||$("#unit_conversions tbody tr").length===1&&$("#unit_conversions tbody tr td").length===1)&&($("#unit_conversions tbody").empty(),t=!0);n='<tr id="add-unit-row" style="display: none;">';n+='<td id="td_add_name"><input type="text" class="form-control" placeholder="e.g. \'Palette\'" style="width:100%"><\/td>';t?(n+='<td id="td_add_quantity"><input type="number" min="0" step=".001" value="1" style="display: none;" class="form-control" placeholder="Quantity" value="" style="width: 85px;">',n+='<\/td> <td id="td_add_units" style="max-width: 300px"> <select onchange="onSelectUnitChange(this)" data-placeholder="Please select" name="units" class="form-control select2" style="width: 100%;display: none;">',n+='<option value=""><\/option>  <\/select> <\/td>',n+='<td id="td_add_primary" style="display: none"><label> <input type="radio" checked class="form-control"><\/label><\/td>'):(n+='<td id="td_add_quantity"> <input type="number" min="0" step=".001" class="form-control" placeholder="Quantity" value="" style="width: 85px;">',n+='<\/td> <td id="td_add_units" style="max-width: 300px"> <select onchange="onSelectUnitChange(this)" data-placeholder="Please select" name="units" class="form-control select2" style="width: 100%;">',n+='<option value=""><\/option>  <\/select><\/td>',n+='<td id="td_add_primary" style="display: none"><label> <input type="radio" class="form-control"><\/label><\/td>');n+='<td id="td_add_active"><label><input type="checkbox" class="form-control" checked><\/label><\/td>';n+='<td style="width: 80px;"> <div class="pull-right">';n+=t?'<a href="#" class="btn btn-success" onclick="confirmNewRowUnits(this)"><i class="fa fa-check" style="color: #fff;"><\/i><\/a>':'<a href="#" class="btn btn-success " disabled onclick="confirmNewRowUnits(this)"><i class="fa fa-check" style="color: #fff;"><\/i><\/a>';n+='&nbsp;<a href="#" class="btn btn-danger" onclick="removeAddUnits()"><i class="fa fa-remove" style="color: #fff;"><\/i><\/a>';n+='<\/div> <div class="clearfix"><\/div> <\/td> <\/tr>';$("#unit_conversions tbody").append(n);getSelectedUnits();$("#add-unit-row").fadeIn();$("#btn_addNewUnitConversion").attr("disabled","")}function onSelectUnitChange(n){var i,t;if(!$(n).val()||$(n).val().split("|")[0]==="")return $($(n.parentElement.parentElement).find("td div.pull-right a.btn-success")[0]).attr("disabled"),!1;$($(n.parentElement.parentElement).find("td div.pull-right a.btn-success")[0]).removeAttr("disabled");i=$("#td_add_quantity input").val();(i===0||i==="")&&(t=$("tr.tr_units_"+$(n).val().split("|")[0]+" td.row_quantity").text(),t=parseFloat(t),$("#td_add_quantity input").val(t))}function validateUnitConversion(){var n=!0;return $("#td_add_name input").val().trim()===""&&(n=!1,cleanBookNotification.error(_L("ERROR_MSG_379"),"Qbicles")),n}function confirmNewRowUnits(n){var o,s,u,r,t,i,f,e;if($(n).attr("disabled"))return!1;for(o=$("#td_add_name input").val(),s=$("#td_add_units select option"),u=0;u<s.length;u++){if(o==""){$("#td_add_name input").attr("Name","InvalidUnitName");validateObj=$("#form-unit-table").validate();validateObj.showErrors({InvalidUnitName:"This field is required."});$("#td_add_name input").removeAttr("Name","InvalidUnitName");$("#td_add_name input").val("");return}if(o==$(s[u]).text()){$("#td_add_name input").attr("Name","InvalidUnitName");validateObj=$("#form-unit-table").validate();validateObj.showErrors({InvalidUnitName:"Unit name exsisted in the item."});$("#td_add_name input").removeAttr("Name","InvalidUnitName");$("#td_add_name input").val("");return}}if(validateUnitConversion()){if(r=UniqueId(),t={Id:r,IsBase:!1,Name:$("#td_add_name input").val(),Quantity:parseFloat($("#td_add_quantity input").val()),QuantityOfBaseunit:$("#td_add_quantity input").val(),ParentUnit:{Id:$("#td_add_units select").val().split("|")[0],Name:$("#td_add_units select option:selected").text(),QuantityOfBaseunit:parseFloat($("#td_add_units select").val().split("|")[1])},IsActive:$("#td_add_active input")[0].checked},t.ParentUnit===null||t.ParentUnit.Id===0||t.ParentUnit.Id===""?(t.IsBase=!0,t.QuantityOfBaseunit=1):(t.IsBase=!1,t.QuantityOfBaseunit=t.Quantity*t.ParentUnit.QuantityOfBaseunit),t.IsBase&&($("#form_inventory_name .unit-base-iv").length>0?$("#form_inventory_name .unit-base-iv").text(" (Inventory units: "+t.Name+")"):$("#form_inventory_name").append(' <span class="unit-base-iv">(Inventory units: '+t.Name+")<\/span>")),$("#add-unit-row").remove(),i='<tr class="tr_units_'+r+'"><td class="row_name"> <input class=\'unitIds\' value="'+r+'" type="hidden" />',i+="<input required type='text' onchange=\"changeUnitName('"+r+'\')" id="unit_'+r+"\" value='"+t.Name+'\' class=\'form-control unitName\' style="width: 100%"/> <span class="hidden">'+t.QuantityOfBaseunit+'<\/span><p class="hidden">'+t.IsBase+"<\/p> <\/td>",i+='<td class="row_quantity">'+t.Quantity.toFixed(3)+'<\/td> <td class="row_componentUnit">',i+="<p class='parent_"+t.ParentUnit.Id+" mod-css'>"+t.ParentUnit.Name+'<\/p> <input value="'+t.ParentUnit.Id+'" type="hidden" />',i+='<\/td> <td class="row_primary" style="display: none"> <label> ',i+=t.IsPrimary?'<input type="radio" name="primary[]" checked class="form-control">':'<input type="radio" name="primary[]" class="form-control">',i+='<\/label> <\/td> <td class="row_active"> <label> ',i+=t.IsActive?'<input type="checkbox" value="'+t.IsActive+'" checked class="form-control">':'<input type="checkbox" value="'+t.IsActive+'" class="form-control">',t.IsBase?i+="<\/label> <\/td> <td> <\/td>":(i+='<\/label> <\/td> <td class="row_delete"> <a href="#" onclick="deleteUnit(0, this)" class="btn btn-danger pull-right">',i+='<i class="fa fa-trash" style="color: #fff;"><\/i> <\/a>  <\/td> <\/tr>'),t.IsPrimary&&(f=$("#unit_conversions td.row_primary input"),f.length>0))for(e=0;e<f.length;e++)$(f[e])[0].checked=!1;(t.ParentUnit.Id===0||t.ParentUnit.Id==="")&&(t.ParentUnit=null);$("#unit_conversions tbody").append(i);$("#btn_addNewUnitConversion").removeAttr("disabled")}}function deleteUnit(n,t){isUnitABaseOfAnotherUnit(t)?cleanBookNotification.error("Delete failed. The unit is in use elsewhere.","Qbicles"):n>0?$.ajax({type:"get",url:"/TraderItem/DeleteUnitConversion?unitId="+n,dataType:"json",success:function(n){n.actionVal===1?(cleanBookNotification.removeSuccess(),$(t.parentElement.parentElement).remove(),getSelectedUnits()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}):($(t.parentElement.parentElement).remove(),getSelectedUnits())}function isUnitABaseOfAnotherUnit(n){var r=$(n).parent().parent().find(".unitName").val(),t=$(".row_componentUnit > p"),i;for(let n=0;n<t.length;n++)if(i=t[n].outerText,r.localeCompare(i)==0)return!0;return!1}function removeAddUnits(){if($("#add-unit-row").remove(),$("#btn_addNewUnitConversion").removeAttr("disabled"),$("#unit_conversions tbody tr").length===0)$("#unit_conversions tbody").append('<tr class="odd"><td valign="top" colspan="5" class="dataTables_empty">No data available in table<\/td><\/tr>')}function changelocationAll(){$("#form_specifics_active_in_all").html()==="Apply"?($("#form_specifics_active_in_all").html("Applied"),$("#form_specifics_active_in_current")[0].checked||($("#form_specifics_active_in_current")[0].checked=!0,$($("#form_specifics_active_in_current")[0].parentElement).removeClass("btn-default off"),$($("#form_specifics_active_in_current")[0].parentElement).addClass("btn-success"))):$("#form_specifics_active_in_all").html("Apply")}function changeCurrentLocation(n){$.ajax({type:"post",url:"/TraderItem/AddRemoveLocation",data:{locationId:$("#local-manage-select").val(),traderItemId:n},dataType:"json",success:function(n){n.Object&&(n.Object.IsActiveInAllLocations?$("#form_specifics_active_in_all").html("Applied"):$("#form_specifics_active_in_all").html("Apply"));isChangeItem=!0;curentTab==="item-tab"?CallBackFilterDataItemOverViewServeSide(!0):curentTab==="inventory-tab"?selectInventoryTab():curentTab==="resource-tab"?selectResourceTab():curentTab==="pricebook-tab"&&SelectPriceBookTab();n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function addRecipes(){var t=$("#tb_main_recipe tbody tr"),n;if(recipes.length===0&&!(t.length===1&&$("#tb_main_recipe tbody tr td").length===1)){for(n=0;n<t.length;n++)recipes.push({Id:$($(t[n]).find("td.row_recipes_name input")).val(),Name:$($(t[n]).find("td.row_recipes_name p")).text(),Ingredients:[],IsCurrent:$(t[n]).find("td.row_recipes_iscurrent input")[0].checked,IsActive:$(t[n]).find("td.row_recipes_active input")[0].checked});setDefaultIsCurrentRecipe()}$("#tb_add_recipe tbody").empty();$("#form_add_recipe_name").val("");$("#form_add_recipe_iscurrent")[0].checked=!1;addNewRowRecipe2("tb_add_recipe");$("#editrecipe").hide();$("#newrecipe").show()}function editRecipes(n){var i=null,r,t,u;if(recipes.length===0){for(r=$("#tb_main_recipe tbody tr"),t=0;t<r.length;t++)recipes.push({Id:$($(r[t]).find("td.row_recipes_name input")).val(),Name:$($(r[t]).find("td.row_recipes_name p")).text(),Ingredients:[],IsCurrent:$(r[t]).find("td.row_recipes_iscurrent input")[0].checked,IsActive:$(r[t]).find("td.row_recipes_active input")[0].checked});setDefaultIsCurrentRecipe()}for(u=0;u<recipes.length;u++)recipes[u].Id.toString()===n.toString()&&(i=recipes[u]);i?loadRecipeEdit6(i):i||n==="0"&&n===""||getRecipeById(n).then(function(n){i=n;loadRecipeEdit6(i)});$("#newrecipe").hide();$("#editrecipe").show()}function loadRecipeEdit(n){$("#edit_recipe_name").val(n.Name);$("#edit_recipe_form_id").val(n.Id);$("#edit_recipe_iscurrent")[0].checked=n.IsCurrent;$("#tb_edit_recipe tbody").empty();n.Ingredients&&n.Ingredients.length>0&&getIngredientOnServer(n.Ingredients).then(function(t){var i,f,e,u,o,r;for(n.Ingredients=t,i=0;i<n.Ingredients.length;i++){if($("#table_template tr.new_row_recipe td.item_selected").empty(),$("#table_template tr.new_row_recipe td.item_selected").append('<select class="form-control select2" style="width: 100%;"  data-placeholder="Choose an unit"><\/select>'),f=$("#table_template tr.new_row_recipe td.item_selected select"),f.empty(),n.Ingredients[i].Units.length>0){for(e='<option value=""><\/option> ',u=0;u<n.Ingredients[i].Units.length;u++)e+='<option value="'+n.Ingredients[i].Units[u].Id+'">'+n.Ingredients[i].Units[u].Name+"<\/option> ";f.append(e)}else o='<option value=""><\/option> ',f.append(o);n.Ingredients[i].SubItem||(n.Ingredients[i].SubItem={});n.Ingredients[i].SubItem.InventoryDetails.length>0&&(n.Ingredients[i].AverageCost=n.Ingredients[i].SubItem.InventoryDetails[0].AverageCost===0?"0":n.Ingredients[i].SubItem.InventoryDetails[0].AverageCost.toString(),n.Ingredients[i].LatestCost=n.Ingredients[i].SubItem.InventoryDetails[0].LatestCost===0?"0":n.Ingredients[i].SubItem.InventoryDetails[0].LatestCost.toString());r=$("#table_template tbody tr.new_row_recipe").clone();$($(r).find("td.item_name select")).addClass("form-control select2 ");$($(r).find("td.item_name select")).val(n.Ingredients[i].SubItem.Id);$($(r).find("td.item_name input")).val(n.Ingredients[i].Id);$($(r).find("td.item_quantity input")).val(n.Ingredients[i].Quantity);$($(r).find("td.item_selected select")).val(n.Ingredients[i].Unit.Id);$($(r).find("td.item_averagecost span")).text(n.Ingredients[i].AverageCost);$($(r).find("td.item_latestcost span")).text(n.Ingredients[i].LatestCost);$("#tb_edit_recipe tbody").append(r)}$("#tb_edit_recipe tbody tr.new_row_recipe td select").not(".multi-select").select2()})}function loadRecipeEdit6(n){$("#edit_recipe_name").val(n.Name);$("#edit_recipe_form_id").val(n.Id);$("#edit_recipe_iscurrent")[0].checked=n.IsCurrent;$("#tb_edit_recipe tbody").empty();$.LoadingOverlay("show");n.Ingredients&&n.Ingredients.length>0&&getIngredientOnServer3(n)}function validateAddRecipeForm(n){var t=!0,r,i,u,f,e;for(n==="tb_add_recipe"?$("#form_add_recipe_name").val().trim()===""&&(t=!1,$("#form_new_recipe").validate().showErrors({recipe_name:"Recipe name is required."})):$("#edit_recipe_name").val().trim()===""&&(t=!1,$("#form_edit_recipe").validate().showErrors({recipe_name_edit:"Recipe name is required."})),r=$("#"+n+" tr"),i=0;i<r.length;i++){if(u=$(r[i]).find("td.item_name select"),u.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_623"),"Recipe items");break}if(f=$(r[i]).find("td.item_quantity input"),f.val()<=0){t=!1;cleanBookNotification.error(_L("ERROR_MSG_624"),"Recipe items");break}if(e=$(r[i]).find("td.item_selected select"),e.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_625"),"Recipe items");break}}return t}function saveRecipe(n,t){var i=new $.Deferred;return t>0&&$.ajax({type:"post",url:"/TraderItem/saverecipe",dataType:"json",data:{recipe:n,traderItemId:t},success:function(n){i.resolve(n.Object);n.actionVal===3&&(cleanBookNotification.error(n.msg,"Qbicles"),i.resolve(null))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");i.resolve(null)}}),i.promise()}function getRecipeById(n){var t=new $.Deferred;return n>0&&!n.toString().startsWith("99999")&&$.ajax({type:"get",url:"/TraderItem/getrecipebyid?id="+n,dataType:"json",success:function(n){t.resolve(n.Object);n.actionVal===3&&(cleanBookNotification.error(n.msg,"Qbicles"),t.resolve(null))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");t.resolve(null)}}),t.promise()}function activeRecipe(n,t){var r=t.checked,i;if(n>0&&!n.toString().startsWith("99999"))$.ajax({type:"post",url:"/TraderItem/ChangeActiveRecipe",data:{recipeId:n,value:r},dataType:"json",success:function(t){for(var i=0;i<recipes.length;i++)recipes[i].Id===n&&(recipes[i].IsActive=r);t.actionVal===3&&cleanBookNotification.error(t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}});else if(n.toString().startsWith("99999"))for(i=0;i<recipes.length;i++)recipes[i].Id===n&&(recipes[i].IsActive=r)}function addNewRowRecipe(n){var t,r,i;$("#table_template tr.new_row_recipe td.item_selected").empty();$("#table_template tr.new_row_recipe td.item_selected").append('<select class="form-control select2" style="width: 100%;"  data-placeholder="Choose an unit"><\/select>');t=$("#table_template tr.new_row_recipe td.item_selected select");t.empty();r='<option value=""><\/option> ';i=$("#table_template tbody tr.new_row_recipe").clone();$($(i).find("td.item_name select")).addClass("form-control select2 ");$("#"+n+" tbody").append(i);t.append(r);$("#"+n+" select").not(".multi-select").select2()}function addNewRowRecipe2(n){var r=[],t,i,u;$.each($(".new_row_recipe2"),function(n,t){$(t).attr("thPosition")!=null&&r.push(parseInt($(t).attr("thPosition")))});t=Math.max.apply(null,r)+1;$("#template-options-select tr.new_row_recipe2 td.item_selected").empty();$("#template-options-select tr.new_row_recipe2 td.item_selected").append('<select class="form-control select2" style="width: 100%;"  data-placeholder="Choose an unit"><\/select>');i=$("#template-options-select tbody tr.new_row_recipe2").clone();$(i).addClass("gen"+t).attr("thPosition",t);$(i).find(".recipe-ingredient-add-mew").addClass("yeu-em-never-sai");$("#"+n+" tbody").append(i);u=$("#"+n+" tbody .gen"+t);$("#"+n+" tbody .gen"+t+" td.item_selected select").select2();initSelectOption2(null,u,!0)}function removeRowRecipe(n){$(n).remove()}function onSelectItem(n){$(n).val()!==""&&($($(n.parentElement.parentElement).find("td.item_averagecost span")).text($(n).find(":selected").attr("average-cost")),$($(n.parentElement.parentElement).find("td.item_latestcost span")).text($(n).find(":selected").attr("latest-cost")));$(n.parentElement.parentElement).find("td.item_selected").empty();$(n.parentElement.parentElement).find("td.item_selected").append('<select class="form-control select2" style="width: 100%;" data-placeholder="Choose an unit"><\/select>');var t=$(n.parentElement.parentElement).find("td.item_selected select");getUnitsOnServer($(n).val()).then(function(n){var r,i,u;if(lstUnits=n,lstUnits.length>0){for(r='<option value=""><\/option> ',i=0;i<lstUnits.length;i++)r+='<option value="'+lstUnits[i].Id+'">'+lstUnits[i].Name+"<\/option> ";t.append(r)}else u='<option value=""><\/option> ',t.append(u);t.not(".multi-select").select2()})}function changeQuantity(n){var t=0,i=0;isNaN(parseFloat($("#form_inventory_unitcost").val().toString()))||(t=parseFloat($("#form_inventory_unitcost").val().toString()));isNaN(parseFloat($($(n).find("td.item_quantity input")).val().toString()))||(i=parseFloat($($(n).find("td.item_quantity input")).val().toString()));$($(n).find("td.item_cost span")).text(t*i)}function saveNewRecipe(n,t){var o,i,r;if(validateAddRecipeForm(t)){var u="",f=0,e=!1;if(t==="tb_add_recipe"?(u=$("#form_add_recipe_name").val(),f=int,e=$("#form_add_recipe_iscurrent")[0].checked,int--):t==="tb_edit_recipe"&&(u=$("#edit_recipe_name").val(),f=$("#edit_recipe_form_id").val(),e=$("#edit_recipe_iscurrent")[0].checked),o={Id:f,Name:u,Ingredients:[],IsActive:!0,IsCurrent:e},i=$("#"+t+" tbody tr"),i.length>0)for(r=0;r<i.length;r++)$($(i[r]).find("td.item_name select")).val()||$($(i[r]).find("td.item_name select")).val(""),o.Ingredients.push({Id:$($(i[r]).find("td.item_name input")).val(),SubItem:{Id:$($(i[r]).find("td.item_name select")).val().split("|")[0]},Quantity:$($(i[r]).find("td.item_quantity input")).val(),Unit:{Id:$($(i[r]).find("td.item_selected select")).val()},AverageCost:$($(i[r]).find("td.item_averagecost span")).text(),LatestCost:$($(i[r]).find("td.item_latestcost span")).text()});addObjectToRecipeTable(o);$("#newrecipe").hide();$("#editrecipe").hide()}}function addObjectToRecipeTable(n){var o,s,f,r,u,i,t,h,e,c;for($("#tb_main_recipe tbody tr").length===1&&$("#tb_main_recipe tbody tr td").length===1&&$("#tb_main_recipe tbody").empty(),o=!1,s=!1,f=0;f<recipes.length;f++)recipes[f].IsCurrent===!0&&(s=!0);for(s||(n.IsCurrent=!0),r=0;r<recipes.length;r++)recipes[r].Id.toString()===n.Id.toString()&&(o=!0,recipes[r]=n,n.IsCurrent===!0&&changeIsCurrentRecipe(n.Id));if(n.Id>0&&!n.Id.toString().startsWith("99999")&&$("#tb_main_recipe tbody tr").length>=1&&$("#tb_main_recipe tbody tr td").length>1)for($("#tb_main_id_"+n.Id).val(n.Id),$($($("#tb_main_id_"+n.Id)[0].parentElement).find("p")).text(n.Name),u=0;u<recipes.length;u++)n.Id===recipes[u].Id&&(recipes[u]=n);else o?(i=$("#tb_main_id_"+n.Id)[0].parentElement.parentElement,$($(i).find("td.row_recipes_name p")).text(n.Name),$($(i).find("td.row_recipes_name input")).val(n.Id),$($(i).find("td.row_recipes_name input")).attr("id","tb_main_id_"+n.Id),$($(i).find("td.row_recipes_iscurrent input"))[0].checked=n.IsCurrent,$($(i).find("td.row_recipes_iscurrent input")).attr("onchange","changeIsCurrentRecipe("+n.Id+")"),$($(i).find("td.row_recipes_active input")).attr("onchange","activeRecipe("+n.Id+", this)"),$($(i).find("td button.btn-warning")).attr("onclick","editRecipes("+n.Id+")")):(t='<tr> <td class="row_recipes_name" colspan="1"> <p>'+n.Name+"<\/p>",t+='<input type="hidden"  id="tb_main_id_'+n.Id+'" value="'+n.Id+'"/> <\/td>',t+='<td class="row_recipes_active"> <label>',t+=n.IsActive?'<input type="checkbox" onchange="activeRecipe('+n.Id+', this)" value="'+n.IsActive+'" checked class="form-control"> ':'<input type="checkbox" onchange="activeRecipe('+n.Id+', this)" value="'+n.IsActive+'" class="form-control"> ',t+="<\/label> <\/td>",t+='<td class="row_recipes_iscurrent"> <label>',t+=n.IsCurrent?'<input type="radio" name="primaryRecipe[]" checked onchange="changeIsCurrentRecipe('+n.Id+')">':'<input type="radio" name="primaryRecipe[]" onchange="changeIsCurrentRecipe('+n.Id+')">',t+="<\/label> <\/td>",t+='<td><button type="button" class="btn btn-warning" onclick="editRecipes('+n.Id+')"><i class="fa fa-pencil"><\/i> &nbsp; Edit<\/button><\/td> <\/tr>',$("#tb_main_recipe tbody").append(t),recipes.push(n),n.IsCurrent===!0&&changeIsCurrentRecipe(n.Id));for(h=$("td.row_recipes_iscurrent input"),e=0;e<h.count;e++)h[e][0].checked=!1;c=$("#tb_main_id_"+n.Id)[0].parentElement.parentElement;$($(c).find("td.row_recipes_iscurrent input"))[0].checked=n.IsCurrent}function changeIsCurrentRecipe(n){setDefaultIsCurrentRecipe();for(var t=0;t<recipes.length;t++)recipes[t].IsCurrent=!1,recipes[t].Id.toString()===n.toString()&&(recipes[t].IsCurrent=!0)}function setDefaultIsCurrentRecipe(){var t,n;if(recipes&&recipes.length>0){for(t=!1,n=0;n<recipes.length;n++)recipes[n].IsCurrent===!0&&(t=!0);t||(recipes[0].IsCurrent=!0)}}function closeSelected(){}function initSelectedAccount(){}function initInventoryCreateModal(){var n,t,i;if($(".iv-item-name").text($("#form_specifics_name").val()),n=$("#unit_conversions tr td.row_name p:contains('true')"),n.text().startsWith("true"))if(t=n.closest("tr").find("td.row_name .unitName").val(),t)$(".iv-unit-base-name").text(t);else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}i=$("#local-manage-select option:selected").text();$(".iv-locations").text(i);$("#frmCreateInventory").validate({rules:{ivquantity:{required:!0,min:0},ivunitcost:{required:!0,min:0}}});$("#frmCreateInventory").submit(function(n){if(n.preventDefault(),$("#frmCreateInventory").valid()){var t=parseFloat($("#ivquantity").val())+parseFloat($("#hdfCurrentInventory").val());$("#form_inventory_instock").val(t);$("#app-trader-inventory-create").modal("hide")}else $("#ivquantity").val(0),$("#ivunitcost").val(0)});$("#app-trader-inventory-create").modal("show")}function save(){var n,v,g,d,y,p,t,w,h,c,b,r,i,u,k,nt,l,f,tt,e,a,o,s;if(!validateUniqueSKUandBarcode()){$("#theform .admintabs a[href=#item-2]").click();return}if(!validateInventoryForm($("#form_inventory_checkbox")[0].checked)||!validateSpecificsForm()){cleanBookNotification.error(_L("ERROR_MSG_626"),"Qbicles");return}if(!$("#item_protags").val()){valid=!1;$("#additional-form").validate().showErrors({extratags:"This field is required."});$("#additional-tab a").trigger("click");return}if($.LoadingOverlay("show"),n={Id:$("#traderItem_id").val(),Group:{Id:$("#form_specifics_category").val()},Name:$("#form_specifics_name").val(),Description:$("#form_specifics_description").text(),DescriptionText:$("#form_specifics_description_text").val(),ImageUri:"no-image",Locations:[],Units:[],Barcode:$("#form_inventory_barcode").val(),SKU:$("#form_inventory_SKU").val(),IsCompoundProduct:$("#form_showrecipes")[0].checked,PrimaryVendors:[],InventoryDetails:[],ResourceDocuments:[],AdditionalInfos:[],AssociatedRecipes:[],VendorsPerLocation:getVenDorLocationObj(),PurchaseAccount:{Id:$("#form_purchase").val()},SalesAccount:{Id:$("#form_salesaccount").val()},TaxRates:[],InventoryAccount:{Id:$("#form_inventoryaccount").val()},IsCommunityProduct:!1,IsBought:$("#form_specifics_isSold")[0].checked,IsSold:!$("#form_specifics_isSold")[0].checked,IsActiveInAllLocations:$("#form_specifics_active_in_all").text().toLocaleLowerCase()==="applied"?!0:!1,GalleryItems:GetGalleryItems()},$("#form_specifics_isell")[0]&&(n.IsSold=$("#form_specifics_isell")[0].checked),recipes.length>0)for(t=0;t<recipes.length;t++)n.AssociatedRecipes.push(recipes[t]);if(n.IsCompoundProduct&&n.AssociatedRecipes.length===0)return cleanBookNotification.error(_L("ERROR_MSG_628"),"Qbicles"),$.LoadingOverlay("hide"),!1;if($("#item_brand").val()!==""&&$("#item_brand").val()!==null&&n.AdditionalInfos.push({Id:$("#item_brand").val(),Type:1}),$("#item_quality").val()!==""&&$("#item_quality").val()!==null&&n.AdditionalInfos.push({Id:$("#item_quality").val(),Type:3}),$("#item_need").val())for(v=0;v<$("#item_need").val().length;v++)n.AdditionalInfos.push({Id:$("#item_need").val()[v],Type:2});if($("#item_protags").val())for(g=$("#item_protags").val(),d=JSON.parse(g),t=0;t<d.length;t++)n.AdditionalInfos.push({Id:0,Name:d[t].value,Type:4});if(y=$("#form_taxrate_select").val(),y)for(t=0;t<y.length;t++)n.TaxRates.push({Id:y[t]});if(p=$("#form_taxrate_select_sale").val(),p)for(t=0;t<p.length;t++)n.TaxRates.push({Id:p[t]});if($("#value_resource_document").val()&&$("#value_resource_document").val().length>0)for(w=$("#value_resource_document").val().split(","),h=0;h<w.length;h++)w[h].trim().length>0&&n.ResourceDocuments.push({Id:w[h].trim()});if(c=$("#form_specifics_contacts").val(),c&&c.length>0)for(b=0;b<c.length;b++)n.PrimaryVendors.push({Id:c[b]});if($("#unit_conversions tbody tr#add-unit-row").length>0&&$("#unit_conversions tbody tr#add-unit-row").remove(),$("#unit_conversions tbody tr").length>0&&$("#unit_conversions tbody tr td").length>1&&(r=$("#unit_conversions tbody tr"),r.length>0)){for(i=[],u=0;u<r.length;u++)k=$($(r[u]).find("td.row_componentUnit input")).val(),nt={Id:$($(r[u]).find("td.row_name .unitIds")).val(),Name:$($(r[u]).find("td.row_name .unitName")).val(),IsBase:$($(r[u]).find("td.row_name p")).text()==="true"?!0:!1,MeasurementType:$("#item_measure_type").val(),Quantity:$($(r[u]).find("td.row_quantity")).text(),QuantityOfBaseunit:$($(r[u]).find("td.row_name span")).text(),IsActive:$(r[u]).find("td.row_active input")[0].checked,ParentUnit:k&&k!==""?{Id:k}:null},i.push(nt);if(i.length>0){for(l=0;l<i.length;l++)i[l].ParentUnit=selectedChild(i[l],i);for(f=0;f<i.length;f++)if(tt=i[f].Id.toString(),isNaN(parseInt(i[f].Id.toString()))){if(n.AssociatedRecipes&&n.AssociatedRecipes.length>0)for(e=0;e<n.AssociatedRecipes.length;e++)if(n.AssociatedRecipes[e].Ingredients&&n.AssociatedRecipes[e].Ingredients.length>0)for(a=0;a<n.AssociatedRecipes[e].Ingredients.length;a++)n.AssociatedRecipes[e].Ingredients[a].Unit.Id===i[f].Id&&(n.AssociatedRecipes[e].Ingredients[a].Unit.Id=int);for(i[f].Id=int,o=0;o<i.length;o++)f!==o&&i[o].Id===tt&&(i[o].Id=int);int--}n.Units=i}}s=$("#local-manage-select").val();$("#form_inventory_checkbox")[0].checked===!0&&s&&n.InventoryDetails.push({Location:{Id:s},MinInventorylLevel:$("#form_inventory_mininv").val().replace(/\,/g,""),MaxInventoryLevel:$("#form_inventory_maxinv").val().replace(/\,/g,""),CurrentInventoryLevel:$("#hdfCurrentInventory").val().replace(/\,/g,"")});$("#form_inventory #local-manage-select").length>0&&(s=0);var it=$("#form_specifics_active_in_current")[0].checked,rt=$("#ivquantity").val(),ut=$("#ivunitcost").val(),ft={LocationId:$("#local-manage-select").val(),Quantity:rt?rt:0,Unitcost:ut?ut:0};$("#form_specifics_icon").val()!==""?UploadMediaS3ClientSide("form_specifics_icon").then(function(t){n.ImageUri=t.objectKey;$("#form_specifics_icon_text").val(t.objectKey);ItemProductSubmit(n,ft,s,it)}):(n.ImageUri=$("#form_specifics_icon_text").val(),ItemProductSubmit(n,ft,s,it))}function selectedChild(n,t){for(var i=0;i<t.length;i++)if(n&&n.ParentUnit&&n.ParentUnit.Id===t[i].Id)return t[i];return null}function selectTraderItemsTab(){var n=$("#item_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/Trader/ListTraderItem?locationId="+$("#local-manage-select").val()+"&callback=true";$("#item-tab").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#item-tab").load(t,function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#tb_trader_items").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#item-tab").LoadingOverlay("hide");setDefauleInputSearchItem();searchOnTableItems()})}function selectResourceTab(){var n=$("#resource_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/TraderResource/ListResource";$("#resource-tab").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#resource-tab").load(t,function(){$("#resource-tab").LoadingOverlay("hide")})}function selectInventoryTab(){var n=$("#inventory_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/Trader/ListInventory?locationId="+$("#local-manage-select").val()+"&callback=true";$("#inventory-tab").LoadingOverlay("show");setTimeout(function(){cleanItemAndProductSubTabs();$("#inventory-tab").load(t,function(){$("#inventory-tab").LoadingOverlay("hide")})},1e3)}function SelectPriceBookTab(){var t="/TraderPriceBooks/ListPriceBook?locationId="+$("#local-manage-select").val()+"&callback=true",n=$("#pricebook_tab").attr("href");activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);$("#pricebook-tab").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#pricebook-tab").load(t,function(){$('.manage-columns.pricebook input[type="checkbox"]').on("change",function(){var t=$("#tb_pricebooks").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#pricebook-tab").LoadingOverlay("hide");setDefauleInputSearchPriceB();searchOnTablePriceBs()})}function SelectItemsImportTab(){var n=$("#items_import").attr("href");activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);$("#items-import").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#items-import").load("/Commerce/LoadBusinessProfileTab?tab=items-import&reload=false",function(){$("#items-import").LoadingOverlay("hide")})}function selectLocationVendorContact(n,t){var r=$("#"+t).val(),i;if(!validateContact(r)){var u=UniqueId(),f=$("#local-manage-select").val(),e=$("#"+t+" option:selected").text();r!==""&&(i='<tr class="vendor_location_'+u+'"><td class="location_name" >',i+="<p>"+e+'<\/p> <input type="hidden" value="0" />',i+='<\/td ><td class="vendor_location_primary"><label>',i+=validateItemVendor()?'<input type="radio" name="itemvendor[]">':'<input type="radio" name="itemvendor[]" checked>',i+='<\/label><\/td> <td class="vendor_button"><input class="location_id" type="hidden" value="'+f+'"/>',i+='<input class="vendor_id" type="hidden" value="'+r+'" /><button class="btn btn-danger" onclick="deleteItemVenDor(\''+u+"',"+n+')"><i class="fa fa-trash"><\/i><\/button><\/td><\/tr>',$("#tb_location_contact tbody").append(i),setDefaultPrimaryVendor())}}function getVenDorLocationObj(){var i=[],t=$("#tb_location_contact tbody tr"),n;if(t.length>0)for(n=0;n<t.length;n++){var r=$($(t[n]).find("td.location_name input")).val(),u=$($(t[n]).find("td.vendor_button input.location_id")).val(),f=$($(t[n]).find("td.vendor_button input.vendor_id")).val();parseInt(r)===0&&i.push({Id:0,Vendor:{Id:f},Location:{Id:u},IsPrimaryVendor:$(t[n]).find("td.vendor_location_primary input")[0].checked})}return i}function validateContact(n){var r,t,i,u,f;if(isNaN(n)&&(n="0"),r=$("#local-manage-select").val(),t=$("#tb_location_contact tbody tr"),t.length>0)for(i=0;i<t.length;i++)if(u=$($(t[i]).find("td.vendor_button input.vendor_id")).val(),f=$($(t[i]).find("td.vendor_button input.location_id")).val(),parseInt(n)===parseInt(u)&&parseInt(r)===parseInt(f))return!0;return!1}function changeLocationVendorPrimary(n,t){$.ajax({type:"get",url:"/TraderItem/LocationVendorPrimaryChange",data:{traderItemId:n,locationvendorId:t},dataType:"json",success:function(n){n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function deleteItemVenDor(n,t){isNaN(parseInt(n))?($("#tb_location_contact tbody tr.vendor_location_"+n).remove(),setDefaultPrimaryVendor()):$.ajax({type:"post",url:"/TraderItem/RemoveLocationVendor",data:{vendorId:$("#tb_location_contact tbody tr.vendor_location_"+n+" td.location_name input").val(),traderItemId:t},dataType:"json",success:function(t){t.actionVal===3?cleanBookNotification.error(t.msg,"Qbicles"):($("#tb_location_contact tbody tr.vendor_location_"+n).remove(),setDefaultPrimaryVendor())},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function validateItemVendor(){var t=!0,i=$("#tb_location_contact tbody tr td.vendor_location_primary input"),n;if(i.length>0){for(n=0;n<i.length;n++)if(i[n].checked===!0)return!0;t=!1}else t=!0;return t}function setDefaultPrimaryVendor(){var n=$("#tb_location_contact tbody tr"),r=$("#tb_location_contact tbody tr td"),i,t;if(n.length>0&&r.length>1){for(i=!1,t=0;t<n.length;t++)$(n[t]).find("td.vendor_location_primary label input")[0].checked&&(i=!0);i||($(n[0]).find("td.vendor_location_primary label input")[0].checked=!0)}}function nextLocationVendor(){validateItemVendor()?$("#a_next_itemvendor").click():cleanBookNotification.warning("A primary vendor is required.","Qbicles")}function editContact(n){var t=$("#local-manage-select").val();$("#app-trader-add-contact").empty();$("#app-trader-add-contact").load("/Trader/AddContactInTraderItem?locationId="+(t?t:0)+"&traderItemId="+$("#traderItem_id").val()+"&callback=true&contactid="+n);$("#app-trader-add-contact").modal("toggle")}function jumtoconfig(n){$(n).modal("hide");$("#menu_traderapp a[href=#Config]").click()}function validAddContact(){var n=!0;return $("#form_traderitem_contact_name").val()===""&&(n=!1,$("#form_add_contact_traderItem").validate().showErrors({name:"Name is required."})),isNaN(parseInt($("#form_traderitem_contact_phone").val().replace(/ /g,"").replace(/\+/g,"")))&&(n=!1,$("#form_add_contact_traderItem").validate().showErrors({phone:"Phone is required number."})),$("#form_traderitem_contact_email").val()===""&&(n=!1,$("#form_add_contact_traderItem").validate().showErrors({email:"Email is required."})),n}function addContactbutton(){editContact(0)}function loadContact(){$("#table_contact").removeClass("hidden");$("#table_contact").empty();$("#table_contact").load("/Trader/ListContactTraderItem")}function removeContact(n){$.LoadingOverlay("show");$.ajax({type:"delete",url:"/TraderItem/DeleteVendorContact?id="+n,dataType:"json",success:function(n){$.LoadingOverlay("hide");n.actionVal===1?(cleanBookNotification.removeSuccess(),$("#a_process").attr("disabled",!1),loadContact()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles");n.result===!1&&$("#a_process").attr("disabled",!0)},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles");$.LoadingOverlay("hide")}})}function AddContact(){if(validAddContact()){var n={Id:$("#form_traderitem_contact_id").val(),Name:$("#form_traderitem_contact_name").val(),AvatarUri:$("#form_traderitem_contact_avataruri").val(),CompanyName:$("#form_traderitem_contact_company").val(),JobTitle:$("#form_traderitem_contact_jpbtitle").val(),Address:{Id:$("#form_traderitem_contact_address_id").val(),AddressLine1:$("#form_traderitem_contact_address1").val(),AddressLine2:$("#form_traderitem_contact_address2").val(),City:$("#form_traderitem_contact_city").val(),State:$("#form_traderitem_contact_state").val(),PostCode:$("#form_traderitem_contact_postcode").val(),Country:{CommonName:$("#form_traderitem_contact_country").val()}},PhoneNumber:$("#form_traderitem_contact_phone").val(),CustomerAccount:{Id:$("#form_traderitem_contact_account").val()},Email:$("#form_traderitem_contact_email").val(),ContactGroup:{Id:$("#form_traderitem_contact_group").val()}};$("#form_traderitem_contact_avataruri_file").val()!==""?UploadMediaS3ClientSide("form_traderitem_contact_avataruri_file").then(function(t){t.objectKey===null||t.objectKey==="no-image"?cleanBookNotification.error(_L("ERROR_MSG_629"),"Qbicles"):(n.AvatarUri=response,$("#form_traderitem_contact_avataruri").val(t.objectKey),SubmitItemProductContact(n))}):(n.AvatarUri=$("#form_traderitem_contact_avataruri").val(),SubmitItemProductContact(n))}}function cancelContact(){$("#app-trader-add-contact").modal("toggle");$("#form_add_contact_traderItem")[0].reset()}function showBookkeepingTreeView(){$("#app-bookkeeping-treeview").modal("toggle")}function cleanItemAndProductSubTabs(){$("#item-tab").empty();$("#items-import").empty();$("#resource-tab").empty();$("#inventory-tab").empty();$("#pricebook-tab").empty();$("#movement-tab").empty();$("#adjuststock-tab").empty();$("#inventoryaudit-tab").empty()}function SelectAdjustStockTab(){var n=$("#adjuststock_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/TraderItem/AdjustStockTab";$("#adjuststock-tab").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#adjuststock-tab").load(t.trim().replace(/\s/g,""),function(){$("#adjuststock-tab").LoadingOverlay("hide");SelectSpotCountTab()})}function SelectSpotCountTab(){$("#spot-count-tab").LoadingOverlay("show");$("#spot-count-tab").empty();$("#waste-report-tab").empty();$("#spot-count-tab").load("/TraderSpotCount/TraderItemSpotCountContent",function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#spotList").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#spot-count-tab").LoadingOverlay("hide")})}function SelectWasteReportTab(n){n||$("#waste-report-tab").LoadingOverlay("show");$("#spot-count-tab").empty();$("#waste-report-tab").empty();$("#waste-report-tab").load("/TraderWasteReport/TraderItemWasteReportContent",function(){n||$("#waste-report-tab").LoadingOverlay("hide")})}function SelectAdjustStockWasteTab(){$("#adjuststock-tab").LoadingOverlay("show");$("#adjuststock-tab").empty();$("#adjuststock-tab").load("/TraderItem/AdjustStockTab".trim().replace(/\s/g,""),function(){$('a[href="#waste-report-tab"]').tab("show");SelectWasteReportTab();$("#adjuststock-tab").LoadingOverlay("hide")})}function SelectInventoryAuditTab(){var n=$("#inventoryaudit_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/TraderStockAudits/InventoryAuditTab?locationId="+$("#local-manage-select").val();$("#inventoryaudit-tab").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#inventoryaudit-tab").load(t.trim().replace(/\s/g,""),function(){$("#inventoryaudit-tab").LoadingOverlay("hide")})}function showStockAuditTable(){$("#stockaudit-table").on("processing.dt",function(n,t,i){i?$("#stockaudit-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#stockaudit-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/TraderStockAudits/ListStockAudit",type:"POST",dataType:"json",data:function(n){return $.extend({},n,{keyword:$("#search_stockaudit").val(),workgroupId:$("#stockaudit-workgroup-filter").val()})}},columns:[{name:"Name",data:"Name",orderable:!0},{name:"Workgroup",data:"Workgroup",orderable:!0},{name:"StartedDate",data:"StartedDate",orderable:!0},{name:"FinishedDate",data:"FinishedDate",orderable:!0},{name:"Items",data:"Items",orderable:!0},{name:null,data:null,orderable:!0,render:function(n,t,i){switch(i.Status){case 0:return"<span class='label label-lg label-primary'>"+i.StatusName+"<\/span>";case 1:return"<span class='label label-lg label-info'>"+i.StatusName+"<\/span>";case 2:return"<span class='label label-lg label-primary'>"+i.StatusName+"<\/span>";case 3:return"<span class='label label-lg label-success'>"+i.StatusName+"<\/span>";case 4:return"<span class='label label-lg label-danger'>"+i.StatusName+"<\/span>";case 5:return"<span class='label label-lg label-warning'>"+i.StatusName+"<\/span>"}}},{name:null,data:null,orderable:!1,width:"100px",render:function(n,t,i){return i.Status==0?"<button class='btn btn-info' data-toggle='modal' onclick='addStockAudit("+i.Id+")' data-target='#app-trader-inventory-stock-audit'><i class='fa fa-pencil'><\/i> &nbsp; Continue<\/button>":"<button class='btn btn-primary' onclick='location = \"/TraderStockAudits/ShiftAuditMaster?id="+i.Id+"\"'><i class='fa fa-eye'><\/i> &nbsp; Manage<\/button>"}}],drawCallback:function(){$.getScript("/Content/DesignStyle/js/html5tooltips.js")},order:[[2,"desc"]]})}function SelectMovementTab(){var n=$("#movement_tab").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/Trader/TraderMovementTabShow?locationId="+$("#local-manage-select").val()+"&callback=true";$("#movement-tab").LoadingOverlay("show");setTimeout(function(){cleanItemAndProductSubTabs();$("#movement-tab").load(t,function(){$("#movement-tab").LoadingOverlay("hide")})},1e3)}function changedisplayunit(n,t){$("#app-trader-change-unit").LoadingOverlay("show");$("#app-trader-change-unit").empty();$("#app-trader-change-unit").load("/Trader/ShowProductUnitByItem?itemId="+n+"&unitId="+t,function(){$("#app-trader-change-unit").LoadingOverlay("hide")})}function inventoryBatchConfirmChangeUnit(n){var t=$("#batchchangeunit").val().split("|")[0];$.getJSON("/Trader/ChangeUnitItemInMovement",{traderItemId:n,unitId:t,stringdate:$("#movement_daterange").val()},function(t){var r=$("#movement_table").DataTable(),i=r.row("#tr_movementitem_"+n).data();t&&(i.BaseUnitId=t.BaseUnitId,i.In=t.In,i.Out=t.Out,i.Difference=t.Difference,r.row("#tr_movementitem_"+n).data(i))})}function clearTrendDate(){viewTrendData={Chart:{Label:[],QuantityIn:[],QuantityOut:[],QuantityDeff:[]},ChartValue:{LabelValue:[],QuantityInValue:[],QuantityOutValue:[],QuantityDeffValue:[]}}}function loadingChartViewTrend(n){clearTrendDate();$.ajax({type:"POST",data:{itemId:n,datestring:$("#movement_daterange").val(),isGenSystem:$("#systemgen").val()&&$("#systemgen").val()!=""?!0:!1,locationId:$("#local-manage-select").val(),unitId:$("#viewtrend_product").val()},url:"/Trader/ShowChartViewTrendServer",beforeSend:function(n){clearTrendDate();doesLoadingChartViewTrendFinish==0||doesLoadingChartViewTrendFinish==2?(doesLoadingChartViewTrendFinish=2,n.abort()):doesLoadingChartViewTrendFinish=0},success:function(n){Object.keys(n).length==1&&(viewTrendData.Chart.QuantityIn.push(0),viewTrendData.ChartValue.QuantityInValue.push(0),viewTrendData.Chart.QuantityOut.push(0),viewTrendData.ChartValue.QuantityOutValue.push(0),viewTrendData.Chart.QuantityDeff.push(0),viewTrendData.ChartValue.QuantityDeffValue.push(0),viewTrendData.Chart.Label.push(0),viewTrendData.ChartValue.LabelValue.push(0));n.forEach(n=>{viewTrendData.Chart.QuantityIn.push(n.AvgInQuantity),viewTrendData.ChartValue.QuantityInValue.push(n.AvgIn),viewTrendData.Chart.QuantityOut.push(n.AvgOutQuantity),viewTrendData.ChartValue.QuantityOutValue.push(n.AvgOut),viewTrendData.Chart.QuantityDeff.push(n.DeffQuantity),viewTrendData.ChartValue.QuantityDeffValue.push(n.Deff),label=n.DateByMonth+"."+n.DateByYear,n.DateByWeek?label=n.DateByMonth+"."+n.DateByYear+", W"+n.DateByWeek:n.DateByDay&&(label=n.DateByDay+"."+n.DateByMonth+"."+n.DateByYear),viewTrendData.Chart.Label.push(label),viewTrendData.ChartValue.LabelValue.push(label)});mychart!=""&&updateChartData(mychart,mychart2)},complete:function(){doesLoadingChartViewTrendFinish==2?(doesLoadingChartViewTrendFinish=1,loadingChartViewTrend(n)):doesLoadingChartViewTrendFinish=1}})}function updateChartData(n,t){n.data.labels=viewTrendData.ChartValue.LabelValue;t.data.labels=viewTrendData.ChartValue.LabelValue;n.data.datasets.forEach(n=>{switch(n.label){case"Quantity in":n.data=viewTrendData.Chart.QuantityIn;break;case"Quantity out":n.data=viewTrendData.Chart.QuantityOut;break;case"Absolute quantity difference":n.data=viewTrendData.Chart.QuantityDeff}});t.data.datasets.forEach(n=>{switch(n.label){case"Value in":n.data=viewTrendData.ChartValue.QuantityInValue;break;case"Value out":n.data=viewTrendData.ChartValue.QuantityOutValue;break;case"Absolute value difference":n.data=viewTrendData.ChartValue.QuantityDeffValue}});n.update();t.update()}function viewtrend(n,t){$.LoadingOverlay("show");$("#app-trader-item-movement").load("/Trader/ShowTraderItemTrend",{itemId:n,unitId:t,locationId:$("#local-manage-select").val(),datestring:$("#movement_daterange").val()},function(){});loadingChartViewTrend(n)}function templateViewTrend(){return""+`<div class="modal-xl modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            <h5 class="modal-title"></h5>
        </div>
        <div class="modal-body">
            <dl class="breakitdown inamodal cx-25">
                <dt>Date time range</dt>
                <dd></dd>
                <dt>Item name</dt>
                <dd></dd>
                <dt>Product group</dt>
                <dd></dd>
                <dt>SKU</dt>
                <dd></dd>
                <dt>Latest cost ()</dt>
                <dd></dd>
                <dt>On-hand inventory</dt>
                <dd id="onHandInventory"></dd>
            </dl>

            <div class="well custom rounded" style="min-width: 300px; padding: 20px 20px 5px 20px;">
                <div class="row">
                    <div class="col-xs-12 col-sm-4 col-lg-3">
                        <div class="form-group">
                            <label for="unit">Change display unit</label>
                            <select name="unit" id="viewtrend_product" class="form-control select2 select2-hidden-accessible" style="width: 100%;" tabindex="-1" aria-hidden="true">
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 100%;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-viewtrend_product-container"><span class="select2-selection__rendered" id="select2-viewtrend_product-container" title="The whole thing"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-lg-3">
                        <div class="form-group">
                            <label>Display format</label>
                            <select name="format" class="form-control select2 select2-hidden-accessible" style="width: 100%;" id="format" tabindex="-1" aria-hidden="true">
                                <option value="0" selected="">Quantity</option>
                                <option value="1">Value</option>
                            </select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 100%;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-format-container"><span class="select2-selection__rendered" id="select2-format-container" title="Quantity"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-lg-3">
                        <label>Display system generated movements</label>
                        <div class="checkbox toggle">
                            <label>
                                <div id="systemgen" class="toggle btn off" data-toggle="toggle" style="width: 0px; height: 0px;">
                                    <div class="toggle-group">
                                        <label class="btn btn-success toggle-on" onclick="toggleDisplaySystemGen()">On</label>
                                        <label class="btn btn-default active toggle-off" onclick="toggleDisplaySystemGen()">Off</label>
                                        <span class="toggle-handle btn btn-default"></span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <br><br>
            <div class="tab-content">
                <div class="tab-pane fade in active" id="movement-viewtrend-table">
                <div id="viewtrend-table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap"><div class="row"><div class="col-sm-6"><div class="dataTables_length" id="viewtrend-table_length"><label>Show <select name="viewtrend-table_length" aria-controls="viewtrend-table" class="form-control input-sm"><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select> entries</label></div></div><div class="col-sm-6"></div></div><div class="row"><div class="col-sm-12"><table id="viewtrend-table" class="datatable table-striped table-hover community-list dataTable dtr-inline" style="width: 100%; background: rgb(255, 255, 255);" role="grid" aria-describedby="viewtrend-table_info">
                    <thead>
                        <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="viewtrend-table" rowspan="1" colspan="1" aria-label="Date &amp;amp; time: activate to sort column descending" style="width: 255px;" aria-sort="ascending">Date &amp; time</th><th class="sorting" tabindex="0" aria-controls="viewtrend-table" rowspan="1" colspan="1" aria-label="Trigger: activate to sort column ascending" style="width: 184px;">Trigger</th><th class="qty sorting" tabindex="0" aria-controls="viewtrend-table" rowspan="1" colspan="1" aria-label="Qty In: activate to sort column ascending" style="width: 162px;">Qty In</th><th class="qty sorting" tabindex="0" aria-controls="viewtrend-table" rowspan="1" colspan="1" aria-label="Qty Out: activate to sort column ascending" style="width: 190px;">Qty Out</th><th class="qty sorting" tabindex="0" aria-controls="viewtrend-table" rowspan="1" colspan="1" aria-label="Absolute Qty Difference: activate to sort column ascending" style="width: 448px;">Absolute Qty Difference</th></tr>
                    </thead>
                    <tbody>

                    <tr role="row" class="odd"><td class="sorting_1" tabindex="0"></td><td></td><td></td><td></td><td></td></tr><tr role="row" class="even"><td class="sorting_1" tabindex="0"></td><td></td><td></td><td></td><td></td></tr></tbody>
                    <tfoot style="background: #fff;">
                        <tr><td style="border-top: 1px solid rgba(0, 0, 0, 0.3);" rowspan="1" colspan="1"><strong>Totals</strong></td><td style="border-top: 1px solid rgba(0, 0, 0, 0.3);" rowspan="1" colspan="1"></td><td style="border-top: 1px solid rgba(0, 0, 0, 0.3);" class="qty" rowspan="1" colspan="1"></td><td style="border-top: 1px solid rgba(0, 0, 0, 0.3);" class="qty" rowspan="1" colspan="1"></td><td style="border-top: 1px solid rgba(0, 0, 0, 0.3);" class="qty" rowspan="1" colspan="1"></td></tr>
                    </tfoot>
                </table></div></div><div class="row"><div class="col-sm-5"><div class="dataTables_info" id="viewtrend-table_info" role="status" aria-live="polite">Showing 1 to 1 of 1 entries</div></div><div class="col-sm-7"><div class="dataTables_paginate paging_simple_numbers" id="viewtrend-table_paginate"><ul class="pagination"><li class="paginate_button previous disabled" id="viewtrend-table_previous"><a href="#" aria-controls="viewtrend-table" data-dt-idx="0" tabindex="0">Previous</a></li><li class="paginate_button active"><a href="#" aria-controls="viewtrend-table" data-dt-idx="1" tabindex="0">1</a></li><li class="paginate_button next disabled" id="viewtrend-table_next"><a href="#" aria-controls="viewtrend-table" data-dt-idx="2" tabindex="0">Next</a></li></ul></div></div></div></div>
                </div>
            </div>
        </div>
        </div>
    </div>`}function viewtrendTest(n){var t=$("#app-trader-item-movement #movement-viewtrend-table #viewtrend-table");t.DataTable().clear().draw();t.DataTable({destroy:!0,serverSide:!0,paging:!0,pagingTag:"button",searching:!1,responsive:{details:{type:"none"}},columnDefs:[{responsivePriority:-1,targets:0},{responsivePriority:-1,targets:2},{responsivePriority:-1,targets:3},{responsivePriority:-1,targets:4},{responsivePriority:-1,targets:5},{responsivePriority:-1,targets:6},{responsivePriority:-1,targets:7},],lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/Trader/ShowTableViewTrendServer",type:"POST",data:function(t){return $.LoadingOverlay("show"),$.extend({},t,{itemId:n,unitId:$("#viewtrend_product").val(),locationId:$("#local-manage-select").val(),isGenSystem:$("#systemgen").val()&&$("#systemgen").val()!=""?!0:!1,datestring:$("#movement_daterange").val()})},complete:function(){LoadingOverlayEnd();LoadingOverlayEnd()}},columns:[{data:"date"},{data:null,render:function(n,t,i){var r="/";switch(i.trigger){case"Sale":r=i.saleKey!="#"?"/TraderSales/SaleMaster?key="+i.saleKey:"/TraderTransfers/TransferMaster?key="+i.transferKey;break;case"Purchase":r=i.purchaseKey!="#"?"/TraderPurchases/PurchaseReviewForMovenmentTrend?key="+i.purchaseKey:"/TraderTransfers/TransferMaster?key="+i.transferKey;break;case"Waste Report Adjustment":r=i.wasteKey!="#"?"/TraderWasteReport/WasteReportMasterForMovenmentTrend?key="+i.wasteKey:"/TraderTransfers/TransferMaster?key="+i.transferKey;break;case"Spot Count Adjustment":r=i.spotKey!="#"?"/TraderSpotCount/SpotCountMasterForMovenmentTrend?key="+i.spotKey:"/TraderTransfers/TransferMaster?key="+i.transferKey;break;case"Manufacturing Job Adjustment":if(i.manufacturingKey!="#"){r="/Manufacturing/ManufacturingMasterForMovenmentTrend?key="+i.manufacturingKey;break}case"Point To Point":case"Inventory Creation":r="/TraderTransfers/TransferMaster?key="+i.transferKey;break;case"System Generated":default:return i.trigger}return i.transferKey!="#"?'<a href="'+r+'" target="_blank">'+i.trigger+"<\/a>":i.trigger}},{data:"quantityIn"},{data:"quantityOut"},{data:"absoluteQuantity"},{data:"valueIn"},{data:"valueOut"},{data:"absoluteValue"}],footerCallback:function(n,t){var i=this.api(),r=function(n){return typeof n=="string"?n.replace(/[\$,]/g,"")*1:typeof n=="number"?n:0},u;u=t[0]===undefined?1:t[0].decimalPlace;quantityIn=i.column(2,{page:"current"}).data().reduce(function(n,t){return r(n)+r(t)},0).toFixed(u);$(i.column(2).footer()).html(quantityIn);quantityOut=i.column(3,{page:"current"}).data().reduce(function(n,t){return r(n)+r(t)},0).toFixed(u);$(i.column(3).footer()).html(quantityOut);absoluteQuantity=i.column(4,{page:"current"}).data().reduce(function(){return Math.abs(quantityIn-quantityOut)},0);$(i.column(4).footer()).html(absoluteQuantity);valueIn=i.column(5,{page:"current"}).data().reduce(function(n,t){return r(n)+r(t)},0).toFixed(u);$(i.column(5).footer()).html(valueIn);valueOut=i.column(6,{page:"current"}).data().reduce(function(n,t){return r(n)+r(t)},0).toFixed(u);$(i.column(6).footer()).html(valueOut);absoluteValue=i.column(7,{page:"current"}).data().reduce(function(){return Math.abs(valueIn-valueOut)},0).toFixed(u);$(i.column(7).footer()).html(absoluteValue)},initComplete:function(){changeValueOnHandInventoryDetails(n,$("#local-manage-select").val(),$("#viewtrend_product").val());LoadingOverlayEnd();isHideValue($("#format").val())}})}function changeValueOnHandInventoryDetails(n,t,i){$.LoadingOverlay("show");$.ajax({type:"post",url:"/Trader/GetCurrentOnHandInventoryDetails",data:{traderItem:n,locationId:t,unitId:i},dataType:"json",success:function(n){$("#onHandInventory").text(n);LoadingOverlayEnd()},error:function(n){console.log("OnHandInventory "+n);LoadingOverlayEnd()}})}function isHideValue(n){var t=$("#app-trader-item-movement #movement-viewtrend-table #viewtrend-table").DataTable();n==0?(t.columns([2,3,4]).visible(!0),t.columns([5,6,7]).visible(!1)):(t.columns([2,3,4]).visible(!1),t.columns([5,6,7]).visible(!0))}function getResourceImage(){$("#app-trader-resources-image-select").empty();$("#app-trader-resources-image-select").load("/TraderItem/GetListRreourceImage",function(){})}function getResourceDocument(){$("#app-trader-resources-docs-select").empty();$("#app-trader-resources-docs-select").load("/TraderItem/GetListRreourceDocument",function(){})}function selectResourceImage(n,t,i){$("#image_resource_select").text(t+"."+i);$("#form_specifics_icon_text").val(n);$("#app-trader-resources-image-select").modal("toggle")}function selectedChangeDocument(n){for(var t=0;t<dataDocument.length;t++)dataDocument[t].Id===n&&(dataDocument[t].selected=!dataDocument[t].selected)}function selectedDocumentResource(){var t,i,r,n;for($("#app-trader-resources-docs-select").modal("toggle"),t="",i="",r=0;r<dataDocument.length;r++)n=dataDocument[r],n.selected&&(t+=t===""?n.Id:","+n.Id,i+='<li> <span class="btn btn-danger delete_item" onclick="deleteDocument(this,'+n.Id+')"><i class="fa fa-trash"><\/i><\/span>',i+='<a href="'+apiDoc+n.ImageUri+'"><img src="'+n.Type.IconPath+'" style="max-width: 60px; height: auto; padding-right: 10px;">'+n.Name+"<\/a> <\/li>");$(".buy-doc-attachments ul").empty();$(".buy-doc-attachments ul").append(i);$("#value_resource_document").val(t);$(".buy-doc-attachments").show()}function deleteDocument(n,t){$(n).parent().remove();var i=$("#value_resource_document").val();i=i.replace(t,"").replace(/\,\,/g,",");$("#value_resource_document").val(i);$(".buy-doc-attachments ul li").length===0&&$(".buy-doc-attachments").hide()}function SearchInventoryBatch(n,t){var i="/Trader/ListItemInventoryBatch?locationId="+$("#local-manage-select").val()+"&callback=true&datestring="+(n+"").trim().replace(/\s/g,"");$("#movement-table").LoadingOverlay("show");$("#movement-table").empty();$("#movement-table").load(i,function(){$("#movement_table").DataTable().draw();t&&$("#movement_table").DataTable().search(t).draw();$("#movement-table").LoadingOverlay("hide")})}function LoadTableDataMovement(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r&&$(".loadingoverlay").length===0?$("#"+n).LoadingOverlay("show",{minSize:"70x60px"}):$("#"+n).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:""},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,pageLength:12,lengthMenu:[[10,20,50,100],[10,20,50,100]],ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keysearch:$("#movement_search_dt").val(),stringdate:$("#movement_daterange").val()})}},columns:i,order:[[r,"asc"]],rowId:function(n){return"tr_movementitem_"+n.Id}})}function FilterDataByServerSide(){var n=[{data:"ImageUri",orderable:!1,render:function(n,t,i){return""+('<div class="table-avatar" style="background-image: url('+apiDoc+i.ImageUri+');"><\/div>')}},{name:"ItemName",data:"ItemName",orderable:!0},{name:"In",data:"In",orderable:!1},{name:"Out",data:"Out",orderable:!1},{name:"Difference",data:"Difference",orderable:!1},{data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="";return r+='<div class="btn-group options"> <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options<\/button> <ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a href="#" data-toggle="modal" onclick="changedisplayunit('+i.Id+", "+i.BaseUnitId+')" data-target="#app-trader-change-unit">Change display unit<\/a><\/li>',r+('<li><a href="#" data-toggle="modal" onclick="viewtrend('+i.Id+", "+i.BaseUnitId+')" data-target="#app-trader-item-movement">View trend<\/a><\/li><\/ul><\/div>')}}];LoadTableDataMovement("movement_table","/Trader/GetDataItemInventoryBatch",n);CallBackFilterDataMoventoryServeSide()}function CallBackFilterDataMoventoryServeSide(){$("#movement_table").DataTable().ajax.reload()}function showTraderItemAdditional(n){var t="/TraderItem/GetTraderItem?id="+n;$("#app-trader-item-additional").LoadingOverlay("show");$("#app-trader-item-additional").empty();$("#app-trader-item-additional").load(t,function(){$("#app-trader-item-additional").LoadingOverlay("hide")})}function showTraderItemDescription(n){$("#app-trader-item-description").empty();$("#app-trader-item-description").LoadingOverlay("show");var t="/TraderItem/GetTraderItemDescription?id="+n;$("#app-trader-item-description").load(t,function(){$("#app-trader-item-description").LoadingOverlay("hide")})}function applyItemOverviewFilter(){applyFilter=!0;itemOverViewFilter.GroupIds=$("#itemoverview-filter-group").val();itemOverViewFilter.Types=$("#itemoverview-filter-type").val();itemOverViewFilter.Brands=$("#itemoverview-filter-brand").val();itemOverViewFilter.Needs=$("#itemoverview-filter-need").val();itemOverViewFilter.Rating=$("#itemoverview-filter-rating").val();itemOverViewFilter.Tags=$("#itemoverview-filter-tag").val();itemOverViewFilter.ActiveInLocation=$("#itemoverview-filter-activeinlocation").val();$(".itemOverviewFilterRemove").show();CallBackFilterDataItemOverViewServeSide(!1)}function setDefaultFilter(n){n||(itemOverViewFilter={GroupIds:null,Types:null,Brands:null,Needs:null,Rating:null,Tags:null,ActiveInLocation:1});$("#itemoverview-filter-group").val(itemOverViewFilter.GroupIds);$("#itemoverview-filter-type").val(itemOverViewFilter.Types);$("#itemoverview-filter-brand").val(itemOverViewFilter.Brands);$("#itemoverview-filter-need").val(itemOverViewFilter.Needs);$("#itemoverview-filter-rating").val(itemOverViewFilter.Rating);$("#itemoverview-filter-tag").val(itemOverViewFilter.Tags);$("#itemoverview-filter-activeinlocation").val(itemOverViewFilter.ActiveInLocation);n||applyItemOverviewFilter();$(".itemOverviewFilterRemove").hide()}function removeFilter(){applyFilter=!1;setDefaultFilter(applyFilter)}function LoadTableDataItemOverView(n,t,i,r){r||(r=1);$.fn.DataTable.isDataTable("#"+n)&&$("#"+n).DataTable().destroy();$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,pageLength:10,lengthMenu:[[10,20,50,100],[10,20,50,100]],ajax:{url:t,type:"POST",dataType:"json",data:function(n){var t=$("#slLocation_items").val();return $.extend({},n,{keysearch:$("#search_dt").val(),groups:itemOverViewFilter.GroupIds===null?[]:itemOverViewFilter.GroupIds,types:itemOverViewFilter.Types===null?[]:itemOverViewFilter.Types,bands:itemOverViewFilter.Brands===null?[]:itemOverViewFilter.Brands,needs:itemOverViewFilter.Needs===null?[]:itemOverViewFilter.Needs,rating:itemOverViewFilter.Rating===null?[]:itemOverViewFilter.Rating,tags:itemOverViewFilter.Tags===null?[]:itemOverViewFilter.Tags,activeInLocation:itemOverViewFilter.ActiveInLocation,clid:t?t:null})}},columns:i,order:[[r,"asc"]]})}function FilterDataItemOverViewByServerSide(){var n=[{data:"ImageUri",orderable:!1,render:function(n,t,i){return""+('<a href="'+apiDoc+i.ImageUri+'" class="table-avatar image-pop" rel="resources" style="display: block; background-image: url(\''+apiDoc+i.ImageUri+"&size=T');\">&nbsp;<\/a>")}},{name:"ItemName",data:"ItemName",orderable:!0,render:function(n,t,i){return i.ItemName}},{name:"SKU",data:"SKU",orderable:!0},{name:"Barcode",data:"Barcode",orderable:!0},{orderable:!1,render:function(n,t,i){var r="";return i.IsBought&&(r+='<span class="label label-lg label-warning">Item I buy<\/span> '),i.IsSold&&(r+='<span class="label label-lg label-success">Item I sell<\/span> '),i.IsCompoundProduct&&(r+='<span class="label label-lg label-primary">Compound<\/span> '),r}},{name:"GroupName",data:"GroupName",orderable:!0},{name:"Description",render:function(n,t,i){return'<a data-toggle="modal" href="#app-trader-item-description" onclick="showTraderItemDescription(\''+i.Id+"')\">"+i.Description+"<\/a>"},orderable:!0},{name:"Vendor",data:"Vendor",orderable:!1},{orderable:!1,render:function(n,t,i){return""+('<button class="btn btn-info" data-toggle="modal" onclick="showTraderItemAdditional(\''+i.Id+'\')" data-target="#app-trader-item-additional"><i class="fa fa-list"><\/i> &nbsp; View<\/button>')}},{name:"IsActive",data:"IsActive",orderable:!0,render:function(n,t,i){return""+(i.IsActive?'<label><i class="fa fa-check green" style="width: 15px;"><\/i> &nbsp; Active<\/label>':'<label><i class="fa fa-remove red" style="width: 15px;"><\/i> &nbsp; Inactive<\/label>')}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="";return r+='<div class="btn-group options">',r+='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+=i.IsActive?'<li><a href="javascript:void(0)" onclick="showMenusInLocations('+i.Id+","+!i.IsActive+', true)">Deactivate in this location<\/a><\/li>':'<li><a href="javascript:void(0)" onclick="setIsActiveByLocations('+i.Id+', true, true)">Active in this location<\/a><\/li>',r+(i.IsBought?'<li><a href="javascript:void(0)" onclick="editTraderItem(1, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>":'<li><a href="javascript:void(0)" onclick="editTraderItem(2, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>")}}];LoadTableDataItemOverView("tb_trader_items","/Trader/GetDataItemOverView",n);CallBackFilterDataItemOverViewServeSide(!1)}function CallBackFilterDataItemOverViewServeSide(n){applyFilter||setDefaultFilter(!1);setTimeout(function(){n?$("#tb_trader_items").DataTable().ajax.reload(null,!1):$("#tb_trader_items").DataTable().ajax.reload()},500)}function ShowSaleTaxRates(n){$(n).prop("checked")?$("#TaxRates-Sell").show():$("#TaxRates-Sell").hide()}function showMenusInLocations(n,t,i){var r=[];r.push($("#local-manage-select").val());$.ajax({type:"post",url:"/Trader/GetPosMenusByLocationIds",data:{locationIds:r,itemId:n},dataType:"json",success:function(r){if($("#confirm-menus ul").html(""),r.result)if(r.Object.length>0){for(var u=0;u<r.Object.length;u++)$("#confirm-menus ul").append("<li>"+r.Object[u]+"<\/li>");$("#confirm-menus").modal("show");$("#btn-confirm-deactive").data("itemid",n);$("#btn-confirm-deactive").data("isactive",t);$("#btn-confirm-deactive").data("isreload",i)}else setIsActiveByLocations(n,t,i);else cleanBookNotification.error(r.msg,"Qbicles")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function setIsActiveByLocations(n,t,i){if(i){var r=[];r.push($("#local-manage-select").val());$.ajax({type:"post",url:"/Trader/setIsActiveByLocations",data:{itemId:n,isActive:t,locationIds:r},dataType:"json",success:function(n){n.result?i!=undefined&&i!=null&&CallBackFilterDataItemOverViewServeSide(!0):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.error,"Qbicles")}})}}function changeUnitName(n){var t=$("tr.tr_units_"+n+" td.row_name .unitName").val(),r,i,u;if(t==""){$("#unit_"+n).attr("Name","InvalidUnitName");u=$("#form-unit-table").validate();u.showErrors({InvalidUnitName:"The Unit Name is required!"});$("#unit_"+n).removeAttr("Name","InvalidUnitName");return}if(LoadingOverlay(),typeof n=="number")$.ajax({type:"post",dataType:"json",url:"/TraderItem/ChangeUnitName",data:{unitId:n,unitNewName:t},success:function(i){if(i.result)$("td.row_componentUnit .parent_"+n).text(t),$("#unit_"+n).attr("value",t);else{$("tr.tr_units_"+n+" td.row_name .unitName").attr("Name","InvalidUnitName");var r=$("#form-unit-table").validate();r.showErrors({InvalidUnitName:i.msg});$("tr.tr_units_"+n+" td.row_name .unitName").removeAttr("Name","InvalidUnitName");$("#unit_"+n).val($("#unit_"+n).attr("value"))}},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});else{for(r=$(".row_name .unitName"),i=0;i<r.length;i++)if($(r[i]).attr("id")!="unit_"+n&&$(r[i]).val()==t){$("#unit_"+n).attr("Name","InvalidUnitName");u=$("#form-unit-table").validate();$("#form-unit-table").validate().showErrors({InvalidUnitName:"Unit Name exsisted in the item."});$("#unit_"+n).removeAttr("Name","InvalidUnitName");$("#unit_"+n).val("");LoadingOverlayEnd();return}$("td.row_componentUnit .parent_"+n).text(t)}LoadingOverlayEnd()}function checkInventoryChoose(n){var t=$(n).val();t?($(".iv-locations").text($(n).find(":selected").text()),$(".btnaddinventory").prop("disabled",!1),getInventoryByLocationId()):$(".btnaddinventory").prop("disabled",!0)}function getInventoryByLocationId(){$.get("/TraderItem/GetCurrentInventory",{locationId:$("#local-manage-select").val(),itemId:$("#traderItem_id").val()}).done(function(n){n&&($("#hdfCurrentInventory").val(n.currentInventory),$("#form_inventory_instock").val(n.currentInventory),$("#form_inventory_mininv").val(n.minInventorylLevel),$("#form_inventory_maxinv").val(n.maxInventoryLevel),$(".lblavgcost").text(n.averageCost),$(".lbllatestcost").text(n.latestCost))})}function GetGalleryItems(){var t=$("#itemgalerylist figure"),i=[],n,r,u;if(t.length>0)for(n=0;n<t.length;n++)r=$($(t[n]).find("span.image_row")).text(),u={FileUri:r,Order:n},i.push(u);return i}function ItemGaleryDelete(n){var i=confirm("Are you sure you want to delete this image?"),t;i&&($("#figure-"+n).remove(),t=$("#itemgalerylist figure"),t.length<=0&&($(".gallerynone").show(),$(".gallerystart").hide()))}function changeOrderGalery(n){console.log(n)}function AddImageGalery(){$("#theform").LoadingOverlay("show");UploadMediaS3ClientSide("image-galery-input").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#theform").LoadingOverlay("hide",!0);return}var t="<figure id='figure-"+n.objectKey+"'>";t+="<div class='flex-contain' id='"+n.objectKey+"'>";t+="<div class='col img'>";t+="<div style=\"background-image: url('"+apiDoc+n.objectKey+"')\"><\/div>";t+="<\/div>";t+="<div class='col options'>";t+='<span class="image_row" style="display:none">'+n.objectKey+"<\/span>";t+="<div class='dropdown contactoptside'>";t+="<button class='btn btn-primary dropdown-toggle' type='button' data-toggle='dropdown'>";t+="<i class='fa fa-ellipsis-h'><\/i>";t+="<\/button>";t+="<ul class='dropdown-menu dropdown-menu-right'>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryEdit('"+n.objectKey+"')\">Edit<\/a><\/li>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryDelete('"+n.objectKey+"')\">Delete<\/a><\/li>";t+="<\/ul><\/div><\/div><\/div>";$("#itemgalerylist").append(t);$(".gallerynone").hide();$(".gallerystart").show();$("#theform").LoadingOverlay("hide",!0)})}function ItemGaleryEdit(n){$imageChanged=n;$("#image-galery-edit").trigger("click")}function AddImage(){$("#image-galery-input").trigger("click")}function ChangeImageGalery(){$("#theform").LoadingOverlay("show");UploadMediaS3ClientSide("image-galery-edit").then(function(n){var t,i;if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#theform").LoadingOverlay("hide",!0);return}$("#"+$imageChanged).remove();t="<div class='flex-contain' id='"+n.objectKey+"'>";t+="<div class='col img'>";t+="<div style=\"background-image: url('"+apiDoc+n.objectKey+"')\"><\/div>";t+="<\/div>";t+="<div class='col options'>";t+='<span class="image_row" style="display:none">'+n.objectKey+"<\/span>";t+="<div class='dropdown contactoptside'>";t+="<button class='btn btn-primary dropdown-toggle' type='button' data-toggle='dropdown'>";t+="<i class='fa fa-ellipsis-h'><\/i>";t+="<\/button>";t+="<ul class='dropdown-menu dropdown-menu-right'>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryEdit('"+n.objectKey+"')\">Edit<\/a><\/li>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryDelete('"+n.objectKey+"')\">Delete<\/a><\/li>";t+="<\/ul><\/div><\/div>";$("#figure-"+$imageChanged).append(t);i=document.getElementById("figure-"+$imageChanged);i.setAttribute("id","figure-"+n.objectKey);$("#theform").LoadingOverlay("hide",!0)})}function initSelectOption(n){var r=15,u=$("#traderItem_id").attr("value"),t,i;n==null&&(n="");t=$("#slLocation_items").val();i="/trader/GetTraderItemsCustomModel";$(".yeu-em-never-sai").select2({placeholder:"Test",ajax:{url:i,dataType:"json",delay:250,data:function(n){return{search:n.term,page:n.page||0,numberResult:r,traderItemId:u,locationId:t?t:0}},processResults:function(n,t){t.page=t.page||0;const i=n.items.map(n=>({id:n.Id,text:n.Name}));return{results:i,pagination:{more:t.page*10<n.totalItem}}},cache:!0}})}function initSelectOption2(n,t,i){var o=30,s=$("#traderItem_id").attr("value"),f,e=$(t).find(".recipe-ingredient-add-mew"),r,u;n==null&&(n=0);r=$("#local-manage-select").val();u="/trader/GetTraderItemsCustomModel";$(e).select2({ajax:{url:u,dataType:"json",delay:250,data:function(n){return{search:n.term,page:n.page||0,numberResult:o,traderItemId:s,locationId:r?r:0}},processResults:function(n,t){t.page=t.page||0;const i=n.items.map(n=>({id:n.Id,text:n.Name,averageCost:n.AverageCost,latestCost:n.LatestCost}));return{results:i,pagination:{more:t.page*10<n.totalItem}}},cache:!0},initSelection:function(t,o){var s="none";$.ajax({url:u,data:{search:null,selectedItems:n,locationId:r?r:0},dataType:"json",success:function(t){t.items.length>0&&(s=t.items[0].Name,f=new Option(s,n,!0,!0))},error:function(){$.LoadingOverlay("hide")},complete:function(){o({id:n,text:s});$(e).append(f);i&&$.LoadingOverlay("hide")}})}}).on("select2:select",function(n){onSelectItem2(n)})}function onSelectItem2(n){var r=n.params.data.averageCost,u=n.params.data.latestCost,o=n.params.data.id,h=n.params.data.text,s=n.currentTarget,t=$(s).parent().parent(),f=$(t[0]).find(".item_averagecost"),e=$(t[0]).find(".item_latestcost"),i;$(t[0]).find("td.item_selected").empty();$(t[0]).find("td.item_selected").append('<select class="form-control select2" style="width: 100%;" data-placeholder="Choose an unit"><\/select>');i=$(t[0]).find("td.item_selected select");getUnitsOnServer(o).then(function(n){var o,t,s;if(lstUnits=n,lstUnits.length>0){for(o='<option value=""><\/option> ',t=0;t<lstUnits.length;t++)o+='<option value="'+lstUnits[t].Id+'" quantityOfBaseunit = "'+lstUnits[t].QuantityOfBaseunit+'" >'+lstUnits[t].Name+"<\/option> ";i.append(o)}else s='<option value=""><\/option> ',i.append(s);i.not(".multi-select").select2().on("select2:select",function(n){var t=u,o=r,i=n.params.data.element.attributes.quantityofbaseunit.value;i==0&&(i=1);o=o*i;t=t*i;$(e).val(u).find("span").html(t);$(f).val(r).find("span").html(t)})});$(e).val(u).find("span").html(0);$(f).val(r).find("span").html(0)}var tabItemproduct="",apiDoc=$("#api-uri").val(),curentTab="item-tab",isChangeItem=!1,filter={Item:{Key:""},PriceBook:{Product:" ",Key:""}},selectedNode=null,lstParent=[],lstUnits=[],idAccount="",recipes=[],int=99999999,classActive="li_specifics",isAddNewConversions=!1,BKAccount={},viewTrendData,dataDocument,applyFilter,isCancel,$imageChanged;ItemProductSubmit=function(n,t,i,r){$.ajax({type:"post",url:"/TraderItem/SaveItemProduct?currentLocationId="+i+"&isCurrentLocation="+r,data:{item:n,createInventory:t},dataType:"json",success:function(n){$.LoadingOverlay("hide");n.actionVal===1?(cleanBookNotification.createSuccess(),$("#app-trader-inventory-item-add").modal("toggle"),isChangeItem=!0,curentTab==="item-tab"?CallBackFilterDataItemOverViewServeSide(!0):curentTab==="inventory-tab"?selectInventoryTab():curentTab==="pricebook-tab"&&SelectPriceBookTab()):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#app-trader-inventory-item-add").modal("toggle"),isChangeItem=!0,curentTab==="item-tab"?CallBackFilterDataItemOverViewServeSide(!0):curentTab==="inventory-tab"?selectInventoryTab():curentTab==="pricebook-tab"&&SelectPriceBookTab()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){isChangeItem=!0;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};SubmitItemProductContact=function(n){$.ajax({type:"post",url:"/TraderItem/SaveContact?country="+$("#form_traderitem_contact_country").val(),data:{contact:n},dataType:"json",success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$("#a_process").attr("disabled",!1),loadContact(),cancelContact()):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#a_process").attr("disabled",!1),loadContact(),cancelContact()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){LoadingOverlayEnd()})};$("#movement_daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));SelectMovementTab()});viewTrendData={Chart:{Label:[],QuantityIn:[],QuantityOut:[],QuantityDeff:[]},ChartValue:{LabelValue:[],QuantityInValue:[],QuantityOutValue:[],QuantityDeffValue:[]}};var mychart="",mychart2="",doesLoadingChartViewTrendFinish=1;dataDocument=[];applyFilter=!1;isCancel=!1;$imageChanged="";