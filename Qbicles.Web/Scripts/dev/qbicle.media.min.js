function updateFolderForMedia(n){var t=$("#in-folder").val();$.ajax({url:"/Medias/UpdateFolderForMedia",data:{mediaKey:n,folderId:t},type:"POST",success:function(n){n?cleanBookNotification.success(_L("ERROR_MSG_90"),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function validateAddComment(){var n=$("#comment-media").val();n.length>1500?$("#addcomment-error").show():$("#addcomment-error").hide()}function addCommentToMedia(n){if(!busycomment){var t=$("#comment-media");t.val()&&!$("#addcomment-error").is(":visible")&&(isPlaceholder(!0,"#list-comments-media"),busycomment=!0,$.ajax({url:"/QbicleComments/AddCommentToMedia",data:{message:t.val(),mediaKey:n},type:"POST",success:function(n){n.result&&(t.val(""),n.msg!=""&&($("#list-comments-media").prepend(n.msg),isDisplayFlicker(!1)));busycomment=!1},error:function(){isPlaceholder(!1,"");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");busycomment=!1}}))}}function LoadMoreMedias(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityMedias",data:{activityId:n,size:LinkCountMedia*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadMedias").remove();return}$("#"+i).append(n).hide().fadeIn(250);LinkCountMedia=LinkCountMedia+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function LoadMorePosts(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityPosts",data:{activityKey:n,size:LinkCountPost*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadPosts").remove();return}$("#"+i).append(n).hide().fadeIn(250);LinkCountPost=LinkCountPost+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function SelectVersion(){var n="/Qbicles/MediaReview?id="+$("#version-file").val();$("#preview .spacing-new").LoadingOverlay("show");$("#preview .spacing-new").load(n,function(){window.scrollTo(0,0);$fileVersionId=$("#version-file").val();$("#preview .spacing-new").LoadingOverlay("hide",!0)})}function ClearFileVersion(){$("#inputFileVersion").val("");$("#processPicture").val("");$("#processPicture").attr("src","https://via.placeholder.com/300x250?text=no+image+selected (300x250)");ClearError()}function pictureChange(n){readURLVersionFile(n,"processPicture")}function readURLVersionFile(n,t){var r,u;if(n.files&&n.files[0]){if(r=checkfile($("#inputFileVersion").val()),r.stt===!1){cleanBookNotification.error("Error detail: "+r.err,"Qbicles");ClearFileVersion();return}var e=n.files[0].name.replace(/^.*\./,""),f=$("#"+t),i="";switch(e){case"doc":i="/Content/DesignStyle/img/media-item-doc.jpg";break;case"docx":i="/Content/DesignStyle/img/media-item-docx.jpg";break;case"gif":i="/Content/DesignStyle/img/media-item-gif.jpg";break;case"pdf":i="/Content/DesignStyle/img/media-item-pdf.jpg";break;case"ppt":i="/Content/DesignStyle/img/media-item-ppt.jpg";break;case"pptx":i="/Content/DesignStyle/img/media-item-pptx.jpg";break;case"xls":i="/Content/DesignStyle/img/media-item-xls.jpg";break;case"xlsx":i="/Content/DesignStyle/img/media-item-xlsx.jpg";break;case"zip":i="/Content/DesignStyle/img/media-item-zip.jpg"}if(i!==""){f.attr("src",i);return}u=new FileReader;u.onload=function(t){var i,r;(f.attr("src",t.target.result),i=n.files[0],i)&&(r=new FormData,r.append("file",i))};u.readAsDataURL(n.files[0])}}function ValidateMedia(){var n=!0;return $("#media_edit_name").val()===""&&(n=!1,$("#form_media_edit").validate().showErrors({title:"This field is required."})),$("#media_edit_description").val()===""&&(n=!1,$("#form_media_edit").validate().showErrors({Description:"This field is required."})),n}function updateMedia(){if(ValidateMedia()){var n={Key:$("#media_edit_key").val(),Description:$("#media_edit_description").val(),Name:$("#media_edit_name").val(),TopicId:$("#media-edit-topic").val()};$.ajax({type:"post",url:"/Medias/UpdateMedia",datatype:"json",data:n,success:function(n){n.result?($("#media-edit").modal("hide"),location.reload()):cleanBookNotification.error(n.msg,"Qbicles")}})}}function SaveFileVersion(){if($("#form_file_version").valid()){$.LoadingOverlay("show");var n=document.getElementById("inputFileVersion").files;n&&n.length>0&&UploadMediaS3ClientSide("inputFileVersion").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#media-version-object-key").val(n.objectKey);$("#media-version-object-name").val(n.fileName);$("#media-version-object-size").val(n.fileSize);SaveVersion()})}}function SaveVersion(){$.ajax({type:"post",cache:!1,url:"/Medias/SaveVersionFile",enctype:"multipart/form-data",data:new FormData($("#form_file_version")[0]),processData:!1,contentType:!1,success:function(n){n.result&&($("#create-file-version").modal("hide"),cleanBookNotification.updateSuccess(),$("#version-file").prepend($("<option id='version-"+n.Object.Id+"' value='"+n.Object.Id+"'>"+n.Object.UploadedDate+"<\/option>")),$select.value=n.Object.Id,$select.dispatchEvent(new Event("change")),$("#media-vs-count").text($("#version-file option").length))},error:function(n){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}var LinkCountPost=1,LinkCountMedia=1,busycomment=!1,$downloadUri="",$fileVersionId=0,$select=document.querySelector("#version-file");$(document).ready(function(){setTimeout(function(){$(window).scrollTop(0)},1e3);$("#version-file option").size()>=0&&SelectVersion();removeVersion=function(){var n=document.getElementById("version-file").length;if(n===1){cleanBookNotification.error(_L("ERROR_MSG_320"),"Qbicles");return}$.ajax({url:"/Medias/DeleteVersionFile",data:{versionFileId:$fileVersionId},type:"GET",dataType:"json","async":!1}).done(function(n){n.result?(cleanBookNotification.removeSuccess(),$("#version-file option[value='"+$fileVersionId+"']").remove(),$select.value=$("#version-file").find("option:first-child").val(),$select.dispatchEvent(new Event("change"))):cleanBookNotification.error("Error remove: "+n.msg,"Qbicles")}).fail(function(n){cleanBookNotification.error(n,"Qbicles");cleanBookNotification.error(n.responseText,"Qbicles")})}});uploadVersion=function(){ClearFileVersion();$("#create-file-version").modal("toggle")};