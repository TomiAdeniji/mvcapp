function avatarChange(n){readURL(n)}function readURL(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgAvatar").show();$("#imgAvatar").attr("src",n.target.result)};t.readAsDataURL(n.files[0])}}function initFormEditProfile(){var n=$("#form-profile-general-edit");n.validate({rules:{DisplayUserName:{maxlength:71},forename:{required:!0,maxlength:35},surname:{required:!0,maxlength:35},Company:{maxlength:500},JobTitle:{maxlength:500},tagline:{maxlength:50},description:{required:!0,maxlength:500}}});n.submit(function(t){if((t.preventDefault(),!_isBusy)&&n.valid()){$.LoadingOverlay("show");var i={DisplayUserName:$("#txtDisplayUserName").val(),Forename:$("#txtforename").val(),Surname:$("#txtsurname").val(),Tagline:$("#txtTagline").val(),Company:$("#txtCompanyName").val(),Tell:$("#Telnumber").val(),JobTitle:$("#JobTitle").val(),Description:$("#UserDescription").val(),FacebookLink:$("#facebooklink").val(),InstagramLink:$("#instagramlink").val(),LinkedlnLink:$("#linkedInlink").val(),TwitterLink:$("#twitterlink").val(),WhatsApp:$("#whatsapplink").val()};$.ajax({method:"POST",cache:!1,dataType:"JSON",url:"/Administration/SaveGeneralProfile",data:{user:i},beforeSend:function(){_isBusy=!0},success:function(n){n.result?cleanBookNotification.success(_L("ERROR_MSG_121"),"Qbicles"):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}})}function initFormEditSettings(){var n=$("#save-settings-form");n.validate({rules:{Timezone:{required:!0},TimeFormat:{required:!0},dateformat:{required:!0},ChosenNotificationMethod:{required:!0},NotificationSound:{required:!0}}});n.submit(function(t){if((t.preventDefault(),!_isBusy)&&n.valid()){$.LoadingOverlay("show");var i={Timezone:$("#timezone-setting").val(),TimeFormat:$("#timeformat-setting").val(),DateFormat:$("#dateformat-setting").val(),ChosenNotificationMethod:$("#ChosenNotificationMethod").val(),NotificationSound:$("#NotificationSound").val(),PreferredDomain_Key:$("#sl_PreferredDomain").val(),PreferredQbicle_Id:$("#sl_PreferredQbicle").val()};$.ajax({method:"POST",cache:!1,dataType:"JSON",url:"/Administration/SaveUserSettings",data:{user:i},beforeSend:function(){_isBusy=!0},success:function(n){n.result?cleanBookNotification.success(_L("ERROR_MSG_121"),"Qbicles"):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}})}function loadPreferredQbicles(){$("#sl_PreferredQbicle").empty();$.getJSON("/Administration/loadPreferredQbicles",{domainKey:$("#sl_PreferredDomain").val()},function(n){n&&n.length>0?($(".prefqbicle").fadeIn(),$("#sl_PreferredQbicle").select2({data:n,placeholder:"Please select"})):$(".prefqbicle").fadeOut()})}function SetSelectedAvata(n,t){$("#userAvataUrl").val(n);$("a.avt-elm").removeClass("selected");$("a.avt-elm").addClass("options");$(t).addClass("selected");$(t).removeClass("options")}function SetAvatar(){$.LoadingOverlay("show");$.post("/Administration/SetAvatar",{userAvatar:$("#userAvataUrl").val()},function(n){var t,i;n.result?($("#manage-avatar").modal("hide"),t=$("#hdfApiFile").val()+n.Object+"&size=S",$("#dv-avatar").css("background-image","url("+t+")"),i=$("#hdfApiFile").val()+n.Object+"&size=T",$("#profile-icon").css("background-image","url("+i+")")):cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_502"),"Qbicles");LoadingOverlayEnd()})}function CancelChosseAvata(){$("#userAvataUrl").val("")}function UpdatePass(){$("#password-reset").submit(function(n){(n.preventDefault(),_isBusy)||$("#msg-criteria .invalid").length==0&&$("#password-reset").valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),beforeSend:function(){_isBusy=!0},success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_123"),"Qbicles"),$("#change-password").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}))})}function CancelUpdatePass(){$("#password-reset").trigger("reset");$("#password-reset").resetForm()}function privacyOptions(){$("#frm-privacyOptions").submit(function(n){(n.preventDefault(),_isBusy)||($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),beforeSend:function(){_isBusy=!0},success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_124"),"Qbicles"),$("#profile-permissions").modal("hide")):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}))})}function loadEmloymentHistory(){$("#tbl-profile-history").dataTable({destroy:!0,ajax:"/Administration/GetEmploymentHistory",ordering:!1,columns:[{title:"Employer",data:"Employer",searchable:!0},{title:"Role",data:"Role",searchable:!0},{title:"Dates",data:"Dates",searchable:!0},{title:"Summary",data:"Summary",searchable:!0},null,],columnDefs:[{targets:4,data:"Id",render:function(n){var t='<button class="btn btn-warning" data-toggle="modal" onclick="loadDataEmploymentEdit('+n+')" data-target="#app-community-add-work-history"><i class="fa fa-pencil"><\/i><\/button>';return t+('&nbsp;<button class="btn btn-danger" onclick="deleteEmploymentHistoryConfirm('+n+')"><i class="fa fa-trash"><\/i><\/button>')}}]})}function loadUserAddresses(){$("#tbl-address-list").dataTable({destroy:!0,ajax:"/Administration/GetUserAddresses",ordering:!1,columns:[{title:"Address",data:"AddressFull",searchable:!0},null,null,],columnDefs:[{targets:1,data:"IsDefault",render:function(n,t,i){var r="";return i.IsDefault&&(r="checked"),"<input onClick=\"SetUserDefaultLocation('"+i.Key+'\')" type="radio" '+r+' name = "default'+i.Id+'" > '}},{targets:2,data:"",render:function(n,t,i){var r='<button class="btn btn-warning" onclick="CreateEditUserAddressShow(\''+i.Key+'\')"><i class="fa fa-pencil"><\/i><\/button>',u='&nbsp;<button class="btn btn-danger" onclick="DeleteAddress(\''+i.Key+'\')"><i class="fa fa-trash"><\/i><\/button>';return r+u}}]})}function SetUserDefaultLocation(n){LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SetUserDefaultLocation?addressKey="+n,success:function(n){var t,i;n.result?(t=$("#tbl-address-list"),t!=null&&(t.DataTable().ajax.reload(),cleanBookNotification.updateSuccess()),i=$("#wizard-addresses"),i!=null&&showListWizardAddresses()):cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})}function SaveAddress(){LoadingOverlay();var n=$("#add1").val(),t=$("#add2").val(),i=$("#city").val(),r=$("#state").val(),u=$("#country").val(),f=$("#postcode").val(),e=$("#isDefault").prop("checked"),o={Key:$("#address-id").val(),AddressLine1:n,AddressLine2:t,City:i,State:r,PostCode:f,IsDefault:e};$.ajax({type:"post",datatype:"json",url:"/UserInformation/SaveAddress?country="+u,data:{mdAddress:o},success:function(){var n,t,i;$("#receiveMethod").find('option[value="existing-addresses"]').prop("selected","true").trigger("change");n=$("#tbl-address-list");n!=null&&(n.DataTable().ajax.reload(),cleanBookNotification.updateSuccess());t=$("#noaddresses");t!=null&&listUserAddressesShow();i=$("#wizard-addresses");i!=null&&($("#noaddress").hide(),showListWizardAddresses(),$("#address").show());LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}});LoadingOverlayEnd()}function deleteEmploymentHistoryConfirm(n){$("#emp-delete-confirm").modal("show");$("#emp_deleteId").val(n)}function deleteEmploymentHistory(){var n=$("#emp_deleteId").val();$.LoadingOverlay("show");$.post("/Administration/DeleteEmploymentById",{id:n},function(n){n.result?($("#tbl-profile-history").DataTable().ajax.reload(),cleanBookNotification.success(_L("ERROR_MSG_125"),"Qbicles")):cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_504"),"Qbicles");LoadingOverlayEnd()})}function deleteMyFileConfirm(n){$("#file-delete-confirm").modal("show");$("#file_deleteId").val(n)}function deleteMyFile(){var n=$("#file_deleteId").val();$.LoadingOverlay("show");$.post("/Administration/DeleteProFileById",{id:n},function(n){n.result?($("#tbl-my-files").DataTable().ajax.reload(),cleanBookNotification.success(_L("ERROR_MSG_127"),"Qbicles")):cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_505"),"Qbicles");LoadingOverlayEnd()})}function loadDataEmploymentEdit(n){$.post("/Administration/getEmploymentById",{id:n},function(n){n&&($("#app-community-add-work-history h5.modal-title").text("Edit employment history entry"),$("#frm-employment-history input[name=Employer]").val(n.Employer),$("#frm-employment-history input[name=Id]").val(n.Id),$("#frm-employment-history input[name=Role]").val(n.Role),$("#frm-employment-history input[name=Role]").val(n.Role),$("#frm-employment-history textarea[name=Summary]").val(n.Summary),$("#hdf-StartDate").val(n.StartDate),$("#hdf-EndDate").val(n.EndDate),$("#workhistory-dates").val(n.StartDate+" - "+n.EndDate))})}function loadMyFiles(){$("#tbl-my-files").dataTable({destroy:!0,ajax:"/Administration/GeMyfiles",columns:[{title:"Title",data:"Title",searchable:!0},{title:"Added",data:"Added",searchable:!0},{title:"Type",data:"Type",searchable:!0},{title:"Description",data:"Description",searchable:!0},null,],columnDefs:[{targets:4,data:"Id",render:function(n){return'<button class="btn btn-danger" onclick="deleteMyFileConfirm('+n+')"><i class="fa fa-trash"><\/i><\/button>'}}]})}function SaveEmployment(){var n=$("#frm-employment-history");n.validate({rules:{Employer:{required:!0,maxlength:500,minlength:5},Role:{required:!0,maxlength:500},Summary:{required:!0,minlength:5,maxlength:1500}}});n.submit(function(t){(t.preventDefault(),_isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),beforeSend:function(){_isBusy=!0},success:function(n){if(n.result){$("#tbl-profile-history").DataTable().ajax.reload();$("#app-community-add-work-history").modal("hide");resetFormEmployment();var t=$("#frm-employment-history input[name=Id]").val();t==="0"?cleanBookNotification.success(_L("ERROR_MSG_365"),"Qbicles"):cleanBookNotification.success(_L("ERROR_MSG_366"),"Qbicles")}else cleanBookNotification.error(n.msg?n.msg:"Have an error!","Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}))})}function resetFormEmployment(){$("#frm-employment-history input[name=Id]").val("0");$("#app-community-add-work-history h5.modal-title").text("Add an employment history entry");$("#frm-employment-history")[0].reset();$("#frm-employment-history").validate().resetForm()}function onloadProfilePage(){$("#workhistory-dates").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:"DD/MM/YYYY"}});$("#workhistory-dates").on("apply.daterangepicker",function(n,t){var i=t.startDate.format("DD/MM/YYYY"),r=t.endDate.format("DD/MM/YYYY");$(this).val(i+" - "+r);$("#hdf-StartDate").val(i);$("#hdf-EndDate").val(r)});UpdatePass();privacyOptions();SaveEmployment();loadEmloymentHistory();loadMyFiles();loadUserAddresses();$(".toggle-pw").bind("click",function(n){n.preventDefault();var t=$("#new_password").attr("type");t=="password"?$("#new_password").prop("type","text"):$("#new_password").prop("type","password");$("i",this).toggleClass("fa-eye").toggleClass("fa-eye-slash")});$("#new_password").keyup(function(){var n=0,t=$(this).val();t.length<8?$("#length").removeClass("valid").addClass("invalid"):($("#length").removeClass("invalid").addClass("valid"),n++);t.match(/[A-z]/)?($("#letter").removeClass("invalid").addClass("valid"),n++):$("#letter").removeClass("valid").addClass("invalid");t.match(/[A-Z]/)?($("#capital").removeClass("invalid").addClass("valid"),n++):$("#capital").removeClass("valid").addClass("invalid");t.match(/\d/)?($("#number").removeClass("invalid").addClass("valid"),n++):$("#number").removeClass("valid").addClass("invalid");t.match(/\W+/g)?($("#alpha").removeClass("invalid").addClass("valid"),n++):$("#alpha").removeClass("valid").addClass("invalid")})}function UploadUserMyFile(){var t=$("#frm-my-files"),n;t.valid()&&($.LoadingOverlay("show"),n=document.getElementById("my-file-upload").files,n&&n.length>0?UploadMediaS3ClientSide("my-file-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#user-my-file-object-key").val(n.objectKey);$("#user-my-file-object-name").val(n.fileName);$("#user-my-file-object-size").val(n.fileSize);SaleUserMyFile()}):cleanBookNotification.error("Missing file upload!","Qbicles"))}function SaleUserMyFile(){$.ajax({type:"post",cache:!1,url:"/Administration/SaleUserMyFile",enctype:"multipart/form-data",data:new FormData($("#frm-my-files")[0]),processData:!1,contentType:!1,beforeSend:function(){_isBusy=!0},success:function(n){n.result?($("#tbl-my-files").DataTable().ajax.reload(),$("#profile-file-upload").modal("hide"),resetFormMyFile(),cleanBookNotification.success(_L("ERROR_MSG_128"),"Qbicles")):cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_506"),"Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function resetFormMyFile(){$("#frm-my-files")[0].reset();$("#frm-my-files").validate().resetForm()}function SaveUserAvatatar(){$.ajax({type:"post",cache:!1,url:"/Administration/AvatarUpload",enctype:"multipart/form-data",data:new FormData($("#frm-avatar-upload")[0]),processData:!1,contentType:!1,beforeSend:function(){_isBusy=!0},success:function(n){var t,i;n.result?($("#manage-avatar").modal("hide"),t=$("#hdfApiFile").val()+n.Object,$("#dv-avatar").css("background-image","url("+t+")"),$("a.avt-elm").removeClass("selected"),$("a.avt-elm").addClass("options"),i='<div id="avata-'+n.Object+'" class="col"><a onclick="SetSelectedAvata(\''+n.Object+'\',this)" class="avt-elm article-feature selected">',i+='<div class="article-feature-img" style="background: url(\''+t+"');\"><\/div><\/a><\/div>",$("#avatar-empty").before(i)):cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_503"),"Qbicles");_isBusy=!1;LoadingOverlayEnd()},error:function(n){_isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function showListShowcases(){var t,n,i;$(".loadingoverlay").is(":visible")||LoadingOverlay();t="";n=$("#showcase-key-search");n&&n.length>0&&(t=n.val());i="/UserInformation/ListShowCasesPartial?keySearch="+t;$("#showcases").empty();$("#showcases").load(i);LoadingOverlayEnd()}function modalSaveShowcaseShow(n){LoadingOverlay();var t="/UserInformation/AddEditShowcaseView?showcaseKey="+n;$("#profile-showcase-add").empty();$("#profile-showcase-add").load(t);$("#profile-showcase-add").modal("show");LoadingOverlayEnd()}function deleteShowcase(n){if(confirm("Are you sure you want to delete this Showcase from your profile?")){LoadingOverlay();var t="/UserInformation/DeleteShowCase?showcaseKey="+n;$.ajax({method:"POST",dataType:"JSON",url:t,success:function(n){var t,i;n.result?(cleanBookNotification.success("Deleted Showcase successfully!","Qbicles"),t=$("#showcases"),t!=null&&showListShowcases(),i=$("#list-showcase-wizard"),i!=null&&showListWizardShowcase()):cleanBookNotification.error(n.msg)},error:function(n){cleanBookNotification.error(n.msg)}});LoadingOverlayEnd()}}function intiAddingShowcaseForm(){var n=$("#add-edit-sc-frm");n.validate({rules:{title:{required:!0},cap:{required:!0,maxlength:100}}});n.submit(function(t){var i,r;t.preventDefault();n.valid()&&(LoadingOverlay(),i=document.getElementById("sc-img").files,i&&i.length>0?UploadMediaS3ClientSide("sc-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveShowcase(t)}):(r=$("#showcase-id").val(),r==="0"?(LoadingOverlayEnd(),n.validate().showErrors({image:"This field is required!"})):saveShowcase(null)))})}function saveShowcase(n){var t={Key:$("#showcase-id").val(),Title:$("#sc-title").val(),Caption:$("#sc-caption").val()};$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SaveShowCase",data:{sc:t,uploadedFile:n},success:function(n){var t,i;n.result?(cleanBookNotification.success("Save Showcase successfully!","Qbicles"),t=$("#showcases"),t!=null&&showListShowcases(),i=$("#list-showcase-wizard"),i!=null&&showListWizardShowcase(),$("#profile-showcase-add").modal("hide")):cleanBookNotification.error(n.msg)},error:function(n){cleanBookNotification.error(n.msg)}}).always(function(){LoadingOverlayEnd()})}function showListSkills(){$("#userskills").empty();$("#userskills").load("/UserInformation/UserSkillList")}function modalSaveSkillsShow(n){LoadingOverlay();var t="/UserInformation/AddEditSkillView?skillKey="+n;$("#profile-skill-add").empty();$("#profile-skill-add").load(t);$("#profile-skill-add").modal("show");LoadingOverlayEnd()}function deleteSkills(n){if(confirm("Are you sure you want to remove this skill from your profile?")){LoadingOverlay();var t="/UserInformation/DeleteUserSkill?skillKey="+n;$.ajax({method:"POST",dataType:"JSON",url:t,success:function(n){n.result?(cleanBookNotification.success("Delete Skill successfully.","Qbicles"),showListSkills()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}}function initAddingSkillsForm(){var n=$("#skillform");n.validate({rules:{skillname:{required:!0},skillpoint:{required:!0}}});n.submit(function(t){if(t.preventDefault(),LoadingOverlay(),n.valid()){var i={Name:$("#skillname").val(),Proficiency:$("#skillpoint").val()};$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SaveUserSkill",data:{userSkill:i},success:function(n){n.result?(cleanBookNotification.success("Save Skill successfully.","Qbicles"),showListSkills(),$("#profile-skill-add").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}})}LoadingOverlayEnd()})}function showListWorkExpList(){$("#work-exp-list").empty();$("#work-exp-list").load("/UserInformation/UserWorkExpList")}function modalSaveWorkExpShow(n){LoadingOverlay();var t="/UserInformation/AddEditWorkExpView?expKey="+n;$("#profile-employment-add").empty();$("#profile-employment-add").load(t);$("#profile-employment-add").modal("show");LoadingOverlayEnd()}function initAddingWorkExp(){var n=$("#add-workexp-form");n.validate({rules:{company:{required:!0},role:{required:!0},startdate:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){LoadingOverlay();var i={Key:$("#workId").val(),Company:$("#company-name").val(),Role:$("#role-name").val(),Summary:$("#wsummary").val()},r=$("#wstartdate").val(),u=$("#wcurrent-on").prop("checked"),f=$("#wenddate").val();$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SaveWorkExp",data:{work:i,startDate:r,endDate:f,isCurrentStillWork:u},success:function(n){n.result?(cleanBookNotification.success("Save Work Experience Successfully.","Qbicles"),showListWorkExpList(),$("#profile-employment-add").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}})}function showListEduExpList(){$("#edu-exp-list").empty();$("#edu-exp-list").load("/UserInformation/UserEduExpList")}function modalSaveEduExpShow(n){LoadingOverlay();var t="/UserInformation/AddEditEduExpView?expKey="+n;$("#profile-education-add").empty();$("#profile-education-add").load(t);$("#profile-education-add").modal("show");LoadingOverlayEnd()}function initAddEduExp(){var n=$("#add-eduexp-form");n.validate({rules:{ins:{required:!0},course:{required:!0},startdate:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){LoadingOverlay();var i={Key:$("#eduId").val(),Institution:$("#ins-name").val(),Course:$("#course-name").val(),Summary:$("#esummary").val()},r=$("#estartdate").val(),u=$("#ecurrent-on").prop("checked"),f=$("#eenddate").val();$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SaveEduExp",data:{exp:i,startdate:r,enddate:f,isStillWorkHere:u},success:function(n){n.result?(cleanBookNotification.success("Save Education Experience successfully.","Qbicles"),showListEduExpList(),$("#profile-education-add").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}})}function listProfileFilesShow(n){$("#profile-files").empty();$("#profile-files").load("/UserInformation/UserProfileFileList",{keySearch:n})}function modalSaveProfileFileShow(n){LoadingOverlay();var t="/UserInformation/AddEditProfileFileView?fileKey="+n;$("#profile-file-add").empty();$("#profile-file-add").load(t);$("#profile-file-add").modal("show");LoadingOverlayEnd()}function deleteProfileFile(n){LoadingOverlay();var t="/UserInformation/DeleteUserProfileFile?fileKey="+n;$.ajax({method:"POST",dataType:"JSON",url:t,success:function(n){n.result?(cleanBookNotification.removeSuccess(),listProfileFilesShow("")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}function initSaveProfileFileForm(){var n=$("#save-profilefile-form");n.validate({rules:{title:{required:!0},description:{required:!0}}});n.submit(function(t){t.preventDefault();var i=document.getElementById("file-upload").files;n.valid()&&(LoadingOverlay(),i&&i.length>0?UploadMediaS3ClientSide("file-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize,FileType:n.fileType};saveProfileFile(t)}):saveProfileFile(null))})}function saveProfileFile(n){if(!_isBusy){var t={Key:$("#file-id").val(),Title:$("#file-title").val(),Description:$("#file-description").val()};$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/SaveProfileFile",data:{pfile:t,uploadModel:n},beforeSend:function(){_isBusy=!0},success:function(n){_isBusy=!1;n.result?(cleanBookNotification.success("Save User Profile File successfully.","Qbicles"),listProfileFilesShow(""),$("#profile-file-add").modal("hide")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){_isBusy=!1;cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}}function listUserAddressesShow(){$("#profile-addresses").empty();$("#profile-addresses").load("/UserInformation/ListUserTraderAddressesShow")}function avatarWizardChange(n){readURLWizard(n)}function readURLWizard(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#avatar").attr("style",'background-image: url("'+n.target.result+'")')};t.readAsDataURL(n.files[0])}}function recount(n){stepFinished=n;step=100/stepNum*n;$(".stat").circleProgress({max:100,value:Math.ceil(step),textFormat:"percent",animation:"easeOutExpo",animationDuration:2600});updateWizardStep()}function initUserProfileWizard(){var i=stepFinished+1,n,t;$("#s"+i).addClass("in active");n=$(".myinterests .col .active").map(function(){return $(this).attr("bid")}).get();t="/UserInformation/ShowBusinessByInterests";$("#recommended-businesses").empty();$("#recommended-businesses").load(t,{interestIds:n});showListWizardAddresses();showListWizardShowcase();$(".stat").circleProgress({max:100,value:Math.ceil(step),textFormat:"percent",animation:"easeInOutExpo",animationDuration:2600});$(".myinterests .col a").bind("click",function(n){$("#interests").removeAttr("disabled");n.preventDefault();$(this).toggleClass("active")});$(".owl-carousel-2").owlCarousel({loop:!1,autoplay:!0,autoplayHoverPause:!0,autoplayTimeout:3e3,dots:!0,nav:!1,margin:10,responsiveClass:!0,responsive:{0:{items:1},600:{items:2}}})}function showListWizardAddresses(){$("#wizard-addresses").empty();$("#wizard-addresses").load("/UserInformation/UserListAddressWizard")}function showListWizardShowcase(){$("#list-showcase-wizard").empty();$("#list-showcase-wizard").load("/UserInformation/UserListShowcaseWizard")}function initStep1WizardForm(){var n=$("#wizard-step1-form");n.submit(function(n){n.preventDefault();LoadingOverlay();var t=document.getElementById("setavatar").files;current_step="s"+GeneralSettingsStep;next_step="s"+AddressAndPhoneSettingStep;t&&t.length>0?UploadMediaS3ClientSide("setavatar").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}saveStepInforWizard(n.objectKey,current_step,next_step)}):saveStepInforWizard("",current_step,next_step);LoadingOverlayEnd()})}function saveStepInforWizard(n,t,i){var r=$("#winzard-displayname").val(),u=$("#wizard-tagline").val(),f=$("#wizard-about").val(),e={profilePic:n,DisplayUserName:r,Tagline:u,Profile:f,Tell:$("#wizard-tel").val(),Timezone:$("#wizard-timezone").val(),NotificationSound:$("#wizard-notification-sound").val(),ChosenNotificationMethod:$("#wizard-chosen-notification-method").val(),TimeFormat:$("#wizard-timeformat").val(),DateFormat:$("#wizard-dateformat").val()};$.ajax({method:"POST",dataType:"JSON",url:"/Administration/SaveUserProfileWizard",data:e,success:function(n){if(n.result){$("#"+t).removeClass("active in");$("#"+i).addClass("active in");cleanBookNotification.updateSuccess();var r=t.substring(1);recount(r)}else cleanBookNotification.error(response.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}})}function saveUserInterest(){var n=$(".myinterests .col .active").map(function(){return $(this).attr("bid")}).get();LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/HighlightSetup/AddUserInterest",data:{interestIds:n},success:function(t){if(t.result){cleanBookNotification.updateSuccess();$("#recommended-businesses").empty();$("#recommended-businesses").load("/UserInformation/ShowBusinessByInterests",{interestIds:n});$("#s5").removeClass("active in");$("#s6").addClass("active in");recount(InterestSettingsStep)}else cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}});LoadingOverlayEnd()}function connectBusiness(n,t,i){$.LoadingOverlay("show");$.post("/C2C/ConnectC2C",{linkId:n,type:1},function(n){$.LoadingOverlay("hide");n.result?(_c2cQbiceId=n.Object,cleanBookNotification.success(_L("CONNECTED_SUCCESS",[t]),"Community"),$(i).toggleClass("btn-info btn-success").html("Connected").attr("disabled","")):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function checkValidInput(n){console.log($(n).val());$(n).val()!=""?($(n).addClass("valid").removeClass("invalid"),$(n).next("i").addClass("fa-check green").removeClass("fa-remove red")):($(n).removeClass("valid").addClass("invalid"),$(n).next("i").removeClass("fa-check green").addClass("fa-remove red"))}function checkValidTextArea(n){$(n).val()!=""?$(n).addClass("valid").removeClass("invalid"):$(n).addClass("invalid").removeClass("valid")}function updateWizardStep(){LoadingOverlay();var n="/UserInformation/UpdateWizardFinishedStep?step="+stepFinished;$.ajax({method:"POST",dataType:"JSON",url:n});LoadingOverlayEnd()}function getUserProfilePages(){var n=$("#tblUserProfilePages");n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?n.LoadingOverlay("show"):n.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,autoWidth:!0,pageLength:10,deferLoading:30,ajax:{url:"/ProfilePage/GetUserProfilePages",type:"Get",dataType:"json",data:function(n){var t={keyword:$("#profile-pages input[name=keyword]").val(),status:$("#profile-pages select[name=status]").val()};return $.extend({},n,t)}},columns:[{data:"PageTitle",orderable:!1},{data:"Created",orderable:!1},{data:"DisplayOrder",orderable:!0},{data:"Status",orderable:!0,render:function(n){return""+(n=="IsActive"?'<span class="label label-lg label-success">Active<\/span>':n=="IsInActive"?'<span class="label label-lg label-warning">Inactive<\/span>':'<span class="label label-lg label-info">Draft<\/span>')}},{data:"Key",orderable:!1,render:function(n,t,i,r){var u='<div class="btn-group"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';return u+='Options &nbsp; <i class="fa fa-angle-down"><\/i><\/button>',u+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',u+='<li><a href="/ProfilePage/UserPageBuilder?pageKey='+n+'">Edit<\/a><\/li>',r.row>0&&(u+='<li class="dtMoveUp"><a href="javascript:void(0)">Move up<\/a><\/li>'),u+='<li class="dtMoveDown"><a href="javascript:void(0)">Move down<\/a><\/li>',i.Status=="IsActive"?(u+='<li><a href="/ProfilePage/UserPagePreview?pageKey='+n+'" target="_blank">Preview<\/a><\/li>',u+='<li><a href="javascript:void(0)" onclick="setUserPageStatus(\''+n+"','IsInActive')\">Unpublish<\/a><\/li>"):u+='<li><a href="javascript:void(0)" onclick="setUserPageStatus(\''+n+"','IsActive')\">Publish<\/a><\/li>",u+='<li><a href="javascript:void(0)" onclick="deleteProfilePage(\''+n+"');\">Delete<\/a><\/li>",u+"<\/div>"}}],drawCallback:function(){$("#tblUserProfilePages tr:last .dtMoveDown").remove();$(".dtMoveUp").unbind("click");$(".dtMoveDown").unbind("click");$(".dtMoveUp").click(moveUp);$(".dtMoveDown").click(moveDown)}})}function moveUp(){var n=$(this).parents("tr");moveRow(n,"up")}function moveDown(){var n=$(this).parents("tr");moveRow(n,"down")}function moveRow(n,t){var r=$("#tblUserProfilePages").DataTable(),e=r.row(n).index(),u=-1,f,i,o;t==="down"&&(u=1);f=r.row(e).data();f.order+=u;i=r.row(e+u).data();i.order+=-u;r.row(e).data(i);r.row(e+u).data(f);f.DisplayOrder==i.DisplayOrder&&(i.DisplayOrder=parseInt(i.DisplayOrder)+u);o=[{Key:f.Key,DisplayOrder:i.DisplayOrder},{Key:i.Key,DisplayOrder:f.DisplayOrder}];$.post("/ProfilePage/UpdateDisplayOrder",{pages:o},function(n){n.result?(r.page(0).draw(!1),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function reloadUserProfilePages(){$.fn.DataTable.isDataTable("#tblUserProfilePages")?$("#tblUserProfilePages").DataTable().ajax.reload():wto=setInterval(function(){$.fn.DataTable.isDataTable("#tblUserProfilePages")&&($("#tblUserProfilePages").DataTable().ajax.reload(),clearInterval(wto))},1e3)}function setUserPageStatus(n,t){$.post("/ProfilePage/SetUserPageStatus",{pageKey:n,status:t},function(n){n.result?(reloadUserProfilePages(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function deleteProfilePage(n){var t=confirm("Are you sure you want to delete this page?");t&&$.post("/ProfilePage/DeleteUserProfilePage",{pageKey:n},function(n){n.result?reloadUserProfilePages():!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function saveInterests(){var n=$("select[name=interests]").val();if(!n||n.length==0){cleanBookNotification.error(_L("ERROR_MSG_NOINTEREST"),"Qbicles");return}$.post("/UserProfile/UpdateInterests",{interests:n?n:[]},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function verificationNewEmail(){LoadingOverlay();var n=$("#change-email input[name=email]").val();$.post("/Administration/VerificationNewEmail",{newEmailAddress:n},function(n){LoadingOverlayEnd();n.result?($("#change-email").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"),$("#check-verify").modal("show")):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function checkNewEmailAvailable(n){var i=$("#change-email input[name=email]").val(),t=!1;$.ajax({url:"/Administration/DuplicateEmail",data:{Email:i},type:"GET",dataType:"json","async":!1}).done(function(n){if(n.result)t=!0;else{switch(n.msgId){case"2":$("#verify-box").hide();$("#verify-box-unavailable").show();break;default:t=!0}return}}).fail(function(){var n=$("#verify-box-unavailable");n.empty();n.removeClass("alert-success");n.addClass("alert-danger");n.children("p").text(_L("ERROR_MSG_EXCEPTION_SYSTEM"));$("#verify-box").hide();n.show()});t&&($("#change-email input[name=email]").attr("disabled",!0),$("#verify-box-unavailable").hide(),$("#verify-box").show(),$(n).hide())}function checkDisableBtnAvailable(n){$(n).val()!=""?$("#btncheck").removeAttr("disabled"):$("#btncheck").attr("disabled",!0)}var element=document.getElementById("user-avata-2"),_isBusy=!1,wto;$(document).ready(function(){getUserProfilePages();var n=getQuerystring("tab");switch(n){case"profile-pages":reloadUserProfilePages();$("a[href=#"+n+"]").tab("show")}$("#profile-pages input[name=keyword]").keyup(delay(function(){reloadUserProfilePages()},1e3));$("#profile-pages select[name=status]").change(function(){reloadUserProfilePages()});$("select[name=interests]").change(function(){clearTimeout(wto);wto=setTimeout(function(){saveInterests()},1e3)})});CreateEditUserAddressShow=function(n){LoadingOverlay();$("#create-address").empty();var t="/UserInformation/TraderAddressEditViewShow?addressKey="+n;AjaxElementShowModal(t,"create-address");$("#create-address").fadeIn();LoadingOverlayEnd()};DeleteAddress=function(n){LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/UserInformation/DeleteUserAddress?addressKey="+n,success:function(n){var t,i;n.result?(t=$("#tbl-address-list"),t!=null&&(t.DataTable().ajax.reload(),cleanBookNotification.updateSuccess()),i=$("#wizard-addresses"),i!=null&&showListWizardAddresses()):cleanBookNotification.error("The Address is linking to something else and can not be deleted.","Qbicles");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");LoadingOverlayEnd()}})};UploadUserAvatar=function(){var t=$("#frm-avatar-upload"),n;t.valid()&&($.LoadingOverlay("show"),n=document.getElementById("user-avatar-upload").files,n&&n.length>0&&UploadMediaS3ClientSide("user-avatar-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}console.log(n);$("#user-avatar-upload-object-key").val(n.objectKey);$("#user-avatar-upload-object-name").val(n.fileName);$("#user-avatar-upload-object-size").val(n.fileSize);SaveUserAvatatar()}))};