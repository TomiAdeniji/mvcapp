function LoadDomainList(){$.ajax({type:"POST",datatype:"json",cache:!1,data:{title:$("#searchDomain").val(),order:$("#order :selected").val()},url:"/Domain/SearchDomain",success:function(n){n.result?n.Object&&($(".qbicles-list-v2 li").remove(),$(".qbicles-list-v2").append(n.Object.strResult)):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function updateOrInserDomain(){if($("#form_domain_addedit").valid()){var n=$("#domainId-UI");$.ajax({url:"/Domain/IsDuplicateDomainNameCheck",data:{domainKey:n.length>0?n.val():"",domainName:$("#domainName-UI").val()},type:"POST"}).done(function(n){var t=$('a[href="#dom-1"]');n===!0?($("#form_domain_addedit").validate().showErrors({"domain.Name":_L("ERROR_MSG_9")}),t.length>0&&t.tab("show")):ProcessDomainLogo()}).fail(function(){$("#form_domain_addedit").validate().showErrors({"domain.Name":_L("ERROR_MSG_10")});var n=$('a[href="#dom-1"]');n.length>0&&n.tab("show")})}}function ProcessDomainLogo(){$.LoadingOverlay("show");var n=document.getElementById("logoDomain-UI"),t=document.getElementById("logoQbicle-UI");n&&n.files.length>0&&t&&t.files.length>0?Promise.all([UploadMediaS3ClientSide("logoDomain-UI"),UploadMediaS3ClientSide("logoQbicle-UI")]).then(n=>{if((n[0].objectKey==="no_image"||n[0].objectKey==="no-image")&&(n[1].objectKey==="no_image"||n[1].objectKey==="no-image")){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#domain-logo-uri").val(n[0].objectKey);$("#qbicle-logo-uri").val(n[1].objectKey);$("#logoDomain-UI").val(null);$("#logoQbicle-UI").val(null);DomainSave()}).catch(()=>{LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}):n&&n.files.length>0&&(!t||t.files.length==0)?UploadMediaS3ClientSide("logoDomain-UI").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#domain-logo-uri").val(n.objectKey);$("#logoDomain-UI").val(null);DomainSave()}):t&&t.files.length>0&&(!n||n.files.length==0)?UploadMediaS3ClientSide("logoQbicle-UI").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#qbicle-logo-uri").val(n.objectKey);$("#logoQbicle-UI").val(null);DomainSave()}):DomainSave()}function DomainSave(){var n=new FormData(document.getElementById("form_domain_addedit"));$.ajax({type:"post",cache:!1,url:"/Domain/UpdateOrInsertDomain",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,success:function(n){if(n.result){if(location.href.indexOf("AdminAccount")>0)$("#tbl-associated-domains").DataTable().ajax.reload(),$("#create-domain").modal("hide");else{clearDomainInputModalAddEdit();$("#create-domain").modal("toggle");var t=$("#domainId-UI");(t.length==0||t.val()=="")&&n.Object&&UpdateCurrentDomain(n.Object,"")}cleanBookNotification.updateSuccess()}else!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function SetBusinessDomain(n){$("#sl_hdf_domainType").val(n);clearDomainInputModalAddEdit()}function clearDomainInputModalAddEdit(){$("#domain-logo").attr("src","");$("#domain-logo").css({display:"none"});$("#domainName-UI").val("");$("#logoDomain-UI").val("");$("#domain-logo-uri").val("");$("#domainlogo_preview").attr("src","");$("#domainlogo_preview").css({display:"none"});$('input[name="initQbicle.Name"]').val("");$('textarea[name="initQbicle.Description"]').val("");$("#logoQbicle-UI").val("");$("#qbicle-logo-uri").val("");$("#qbiclelogo_preview").attr("src","");$("#qbiclelogo_preview").css({display:"none"});ClearError()}function ReadURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}function UpdateCurrentDomain(n){$.ajax({type:"post",url:"/Commons/UpdateCurrentDomain",datatype:"json",cache:!1,data:{currentDomainKey:n},success:function(n){n.result&&(window.location.href="/Commerce/BusinessProfile")}})}function CreateDomainRequest(){if(!isBusy&&$("#form_domain_addedit").valid()){var n=$("#domainId-UI");$.ajax({url:"/Domain/IsDuplicateDomainNameCheck",data:{domainKey:n.length>0?n.val():"",domainName:$("#domainName-UI").val()},type:"POST",beforeSend:function(){isBusy=!0}}).done(function(n){var t=$('a[href="#dom-1"]');n===!0?(isBusy=!1,$("#form_domain_addedit").validate().showErrors({"domain.Name":_L("ERROR_MSG_9")}),t.length>0&&t.tab("show")):ProcessDomainRequestLogos()}).fail(function(){isBusy=!1;$("#form_domain_addedit").validate().showErrors({"domain.Name":_L("ERROR_MSG_10")});var n=$('a[href="#dom-1"]');n.length>0&&n.tab("show")})}}function ProcessDomainRequestLogos(){$.LoadingOverlay("show");var n=document.getElementById("logoDomain-UI"),t=document.getElementById("logoQbicle-UI");n&&n.files.length>0&&t&&t.files.length>0?Promise.all([UploadMediaS3ClientSide("logoDomain-UI"),UploadMediaS3ClientSide("logoQbicle-UI")]).then(n=>{if((n[0].objectKey==="no_image"||n[0].objectKey==="no-image")&&(n[1].objectKey==="no_image"||n[1].objectKey==="no-image")){LoadingOverlayEnd();isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#domain-logo-uri").val(n[0].objectKey);$("#qbicle-logo-uri").val(n[1].objectKey);$("#logoDomain-UI").val(null);$("#logoQbicle-UI").val(null);DomainRequestSave()}).catch(()=>{LoadingOverlayEnd();isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}):n&&n.files.length>0&&(!t||t.files.length==0)?UploadMediaS3ClientSide("logoDomain-UI").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#domain-logo-uri").val(n.objectKey);$("#logoDomain-UI").val(null);DomainRequestSave()}):t&&t.files.length>0&&(!n||n.files.length==0)?UploadMediaS3ClientSide("logoQbicle-UI").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#qbicle-logo-uri").val(n.objectKey);$("#logoQbicle-UI").val(null);DomainRequestSave()}):DomainRequestSave()}function DomainRequestSave(){var n=new FormData(document.getElementById("form_domain_addedit"));$.ajax({type:"post",cache:!1,url:"/Domain/AddQbicleDomainRequest",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,success:function(n){n.result?(clearDomainInputModalAddEdit(),$("#create-domain").modal("toggle"),showDomainRequestHistory(),cleanBookNotification.updateSuccess()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){isBusy=!1;LoadingOverlayEnd()})}function initDomainIndexView(){$("#domain-request-daterange").daterangepicker({timePicker:!1,showDropdowns:!0,autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",dateFormat:$dateFormatByUser.toUpperCase()}});$("#domain-request-daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateFormatByUser.toUpperCase())+" - "+t.endDate.format($dateFormatByUser.toUpperCase()));$("#domain-request-history").DataTable().ajax.reload()});$("#domain-request-daterange").on("cancel.daterangepicker",function(){$(this).val("");$("#domain-request-history").DataTable().ajax.reload()});$("#domain-request-key").keyup(delay(function(){$("#domain-request-history").DataTable().ajax.reload()},1e3));$(".dash-carousel").on("initialize.owl.carousel",function(){$("#create-domain-block").removeAttr("hidden")});$(".dash-carousel").owlCarousel({items:1,loop:!0,animateIn:"fadeIn",animateOut:"fadeOut",dots:!1,nav:!1,autoplay:!1,autoplayHoverPause:!1,mouseDrag:!1,autoplayTimeout:5e3,navText:["<i class='fa fa-angle-left'><\/i>","<i class='fa fa-angle-right'><\/i>"]});initUserDomainRequestTable()}var isBusy=!1;$(function(){$("#searchDomain").on("keyup",function(){LoadDomainList()});$("#order").on("change",function(){LoadDomainList()});$("#form_domain_addedit").validate({ignore:"",invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});$(".previewimg").change(function(){var n=$(this).data("target");ReadURL(this,n);$(n).fadeIn()})});