function getCurrencySettings(){$.ajax({url:"/Qbicles/GetCurrencySettings",type:"get","async":!1,success:function(n){currencySetting=n?n:{CurrencySymbol:"",SymbolDisplay:0,DecimalPlace:2}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function setBgHeading(n){$(n).hasClass("collapsed")?$(n).attr("aria-expanded",!0):$(n).attr("aria-expanded",!1)}function enablingButton(n){$(n).val()?$("#tblcontact-applyall").prop("disabled",!1):$("#tblcontact-applyall").prop("disabled",!0)}function enablingButtonApplyAllGroup(n,t){$(n).val()?$("#btnApplyAllGroup"+t).prop("disabled",!1):$("#btnApplyAllGroup"+t).prop("disabled",!0)}function applyAllUnallocated(){var n=$("#slpricontact-applyall").val();n&&$("#tbl-unallocated .slprimarycontact").val(n).change()}function initCreateGroupModal(){var n=$("#frmCreateGroupReorder");n.validate({ignore:"",rules:{primarycontactforgroup:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=getDataUnallocated(),r=!0;if($.each(i.Items,function(n,t){if(t.Dimensions.length==0){cleanBookNotification.error(_L("ERROR_MSG_54",[n+1]),"Trader");$("#dimensions"+t.Id).select2("open");$("#primary-contact-modal").modal("hide");LoadingOverlayEnd();r=!1;return}}),!r)return;$.ajax({type:this.method,cache:!1,url:this.action,data:JSON.stringify(i),dataType:"json",contentType:"application/json",beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?($("#primary-contact-modal").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),window.location.reload()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")}})}else return})}function getDataUnallocated(){var t=$("#collapse-unallocated select[name=delivery]").val(),n={ReorderId:$("#reorderId").val(),PrimaryContactId:$("#primarycontactforgroup").val(),DeliveryMethod:t?t:null,DaysToLastBasis:$("#collapse-unallocated select[name=daytolastbasis]").val(),DaysToLast:$("#collapse-unallocated input[name=daytolast]").val(),Days2Last:$("#collapse-unallocated input[name=day2last]").val(),Items:[]};return $("#tbl-unallocated").DataTable().rows().every(function(){var i=$(this.node()),s=$(i).find("input[type=checkbox]"),u,f,e,o,c;if($(s).prop("checked")){var r=$(s).val(),l=$("#tbl-unallocated").DataTable(),t=l.row(i).data(),h=$(i).find("#unit"+r).val();t.unit&&(h=t.unit);u=$(i).find("#costPerUnit"+r).val();t.costPerUnit&&(u=t.costPerUnit);f=$(i).find("#discount"+r).val();t.discount&&(f=t.discount);e=$(i).find("#dimensions"+r).val();t.dimensions&&(e=t.dimensions);o=$(i).find("#quantity"+r).val();t.quantity&&(o=t.quantity);c={Id:r,Dimensions:e?e:[],PrimaryContactId:n.PrimaryContactId,UnitId:h,Quantity:o?o:0,CostPerUnit:u?u:0,Discount:f?f:0};n.Items.push(c)}}),n}function chkAll(n){var t=$(n).prop("checked"),i=$("#tbl-unallocated").DataTable().rows({search:"applied"}).nodes();$('input[type="checkbox"]',i).prop("checked",t);checkShowWithselected()}function checkShowWithselected(){var n=$("#tbl-unallocated").DataTable().$('input[type="checkbox"]:checked').length;n>0?$(".withselected3").show():$(".withselected3").hide()}function initFormCalculateQuantities(n){var t=$("#frmgroup"+n);t.validate({ignore:"",rules:{primarycontact:{required:!0},Delivery:{required:!0},DaysToLastBasis:{required:!0},DaysToLast:{required:!0}}});t.submit(function(i){if(i.preventDefault(),t.valid()){$.LoadingOverlay("show");var r={Id:n,ReorderId:$("#reorderId").val(),PrimaryContactId:$("#group-primary-contact"+n).val(),DeliveryMethod:$("#Delivery"+n).val(),DaysToLastBasis:$("#DaysToLastBasis"+n).val(),DaysToLast:$("#DaysToLast"+n).val(),Days2Last:$("#filter_daterange"+n).val(),Items:[]},u=!0;if($("#tbgroup"+n).DataTable().rows().every(function(t){var f=$(this.node()),p=$("#tbgroup"+n).DataTable(),i=p.row(f).data(),l=$(f).find("input[type=checkbox]"),s,h,a,o,c,y;if(i.isReorder&&(l=i.isReorder),$(l).prop("checked")){var e=$(l).val(),w=$(f).find("#primary"+e),v=$(f).find("#unit"+e).val();if(i.unit&&(v=i.unit),s=$(f).find("#costPerUnit"+e).val(),i.costPerUnit&&(s=i.costPerUnit),h=$(f).find("#discount"+e).val(),i.discount&&(h=i.discount),a=$(f).find("#hdfIsDisabled"+e).val(),i.isDisabled&&(a=i.isDisabled),o=$(f).find("#dimensions"+e).val(),i.dimensions&&(o=i.dimensions),c=$(f).find("#quantity"+e).val(),i.quantity&&(c=i.quantity),!o)return LoadingOverlayEnd(),cleanBookNotification.error(_L("ERROR_MSG_54",[t+1]),"Trader"),$($(f).find("#dimensions"+e)).select2("open"),u=!1,!1;y={Id:e,PrimaryContactId:$(w).val(),Dimensions:o?o:[],UnitId:v,CostPerUnit:s?s:0,Discount:h?h:0,Quantity:c?c:0,IsForReorder:!0,IsDisabled:a};r.Items.push(y)}}),!u)return;$.ajax({type:this.method,cache:!1,url:this.action,data:JSON.stringify(r),dataType:"json",contentType:"application/json",beforeSend:function(){isBusy=!0},success:function(t){isBusy=!1;t.result?($("#profile-group"+n).load("/TraderInventory/LoadReorderProfileGroup?groupid="+n,function(){$("#profile-group"+n+" .panel-heading h4.panel-title a").click();initDateRange();initControlElm(n)}),$(".countreorderitems").text(t.Object.countRedorderItems),$(".totalreorder").text(t.Object.total),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):!t.result&&t.msg&&cleanBookNotification.error(_L(t.msg),"Trader");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")}})}else return});$("#tbgroup"+n).DataTable({destroy:!0,responsive:!0,drawCallback:function(){$(".trackInput"+n).on("change",function(){var t=$(this),r=t.parents("tr"),s=$("#tbgroup"+n).DataTable(),u=s.row(r).data(),y=$(r).find("input[type=checkbox]"),i=$(y).val(),c=$(r).find("#unit"+i),l=c.find('option[value="'+c.val()+'"]').data("quantityofbaseunit"),o=parseFloat($(r).find("#costPerUnit"+i).val()),f,e,h,a,v;o=o?o:0;f=parseFloat($(r).find("#discount"+i).val());f=f?f:0;e=parseFloat($(r).find("#quantity"+i).val());e=e?e:0;h=$(r).find("#taxname"+i).val();a=$(r).find("#taxrate"+i).val();h?s.cell(".cell-taxrates"+i).data(showTaxRatesDetail(o,e,f,h)):s.cell(".cell-taxrates"+i).data('<ul class="unstyled"><li>Tax free<\/li><\/ul>');v=parseFloat(o)*parseFloat(l?l:1)*parseFloat(e)*(1-parseFloat(f)/100)*(1+parseFloat(a));s.cell(".cell-totalcost"+i).data(toCurrencySymbol(v,!1));switch(t.attr("name")){case"quantity":u.quantity=t.val();break;case"discount":u.discount=t.val();break;case"dimensions":u.dimensions=t.val();break;case"unit":u.unit=t.val();break;case"isDisabled":u.isDisabled=t.val();break;case"isReorder":u.isReorder=t.prop("checked");break;default:u.costPerUnit=t.val()}})}});$("#tbgroup"+n).on("draw.dt",function(){initControlElm(n)})}function setTypeSubmit(n){$("#typesubmit").val(n);$("#frmReorder").submit()}function initFormReorder(){var n=$("#frmReorder");n.validate({ignore:"",rules:{WorkgroupId:{required:!0},Delivery:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i={Id:$("#reorderId").val(),WorkgroupId:$("#frmReorder select[name=WorkgroupId]").val(),Delivery:$("#frmReorder select[name=Delivery]").val(),ExcludeGroupId:$("#frmReorder select[name=ExcludeGroupId]").val()?$("#frmReorder select[name=ExcludeGroupId]").val():null,TypeSubmit:$("#typesubmit").val()};$.ajax({type:this.method,cache:!1,url:this.action,data:JSON.stringify(i),dataType:"json",contentType:"application/json",beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;LoadingOverlayEnd();n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),setTabTrader("ItemsProducts","inventory-tab"),setLocalStorage("sub-inventory-tab","inv-reorders"),window.location.href="/Trader/AppTrader"):!n.result&&n.msg&&cleanBookNotification.error(_L(n.msg),"Trader")},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")}})}else return})}function excludeProductGroup(){var n=$("#frmReorder select[name=ExcludeGroupId]").val(),t=$("#reorderId").val();$.post("/TraderInventory/ExcludeReorderItems",{productGroupId:n?n:0,reorderId:t},function(n){n.result?window.location.reload():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function initDateRange(){$(".datetimerange").daterangepicker({autoUpdateInput:!0,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()},timePicker:!1});$(".datetimerange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateFormatByUser.toUpperCase())+" - "+t.endDate.format($dateFormatByUser.toUpperCase()))});$(".datetimerange").on("cancel.daterangepicker",function(){$(this).val(null)})}function uncheckAllGroup(n){$.post("/TraderInventory/UncheckAllReorder",{groupid:n},function(t){t.result?($("#profile-group"+n).load("/TraderInventory/LoadReorderProfileGroup?groupid="+n,function(){$("#profile-group"+n+" .panel-heading h4.panel-title a").click();initDateRange();initControlElm(n)}),$(".countreorderitems").text(t.Object.countRedorderItems),$(".totalreorder").text(toCurrencySymbol(t.Object.total,!0)),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function changeContact(n){var t=$("#group-primary-contact"+n).val();$.post("/TraderInventory/ChangeContact",{groupid:n,contactid:t},function(t){t.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),$("#profile-group"+n).load("/TraderInventory/LoadReorderProfileGroup?groupid="+n,function(){$("#profile-group"+n+" .panel-heading h4.panel-title a").click();initDateRange();initControlElm(n)})):!t.result&&t.msg?cleanBookNotification.error(t.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function moveContacts(n){var t={Id:n,ReorderId:$("#reorderId").val(),Items:[]};$("#tbgroup"+n).DataTable().rows().every(function(){var n=$(this.node()),r=$(n).find("input[type=checkbox]"),i=$(r).val(),u=$(n).find("#primary"+i),f={Id:i,PrimaryContactId:$(u).val()};t.Items.push(f)});$.LoadingOverlay("show");$.ajax({type:"post",cache:!1,url:"/TraderInventory/MoveContacts",data:JSON.stringify(t),dataType:"json",contentType:"application/json",beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),window.location.reload()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")}})}function changeDelivery(){var n=$("#frmReorder select[name=Delivery]").val();$.post("/TraderInventory/ChangeDelivery",{reorderid:$("#reorderId").val(),DeliveryMethod:n},function(t){t.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"),$("#lstPrimaryContact select[name=Delivery]").val(n).change()):!t.result&&t.msg?cleanBookNotification.error(t.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function setIsReOrderForItem(n,t,i){$.post("/TraderInventory/SetIsReOrderForItem",{itemId:n,isReOrder:t},function(n){n.result&&n.Object!=null&&($("#groupinfo"+i).html(n.Object.countGroupItems+" items &nbsp; &nbsp; "+toCurrencySymbol(n.Object.groupPriceTotal,!0)),$(".countreorderitems").text(n.Object.countRedorderItems),$(".totalreorder").text(toCurrencySymbol(n.Object.total,!0)))})}function initUnallocated(){$("#tbl-unallocated").DataTable({destroy:!0,drawCallback:function(){$(".trackInputUnl").on("change",function(){var t=$(this),i=t.parents("tr"),o=$("#tbl-unallocated").DataTable(),f=o.row(i).data(),l=$(i).find("input[type=checkbox]"),n=$(l).val(),e=parseFloat($(i).find("#costPerUnit"+n).val()),r,u,s,h,c;e=e?e:0;r=parseFloat($(i).find("#discount"+n).val());r=r?r:0;u=parseFloat($(i).find("#quantity"+n).val());u=u?u:0;s=$(i).find("#taxname"+n).val();h=$(i).find("#taxrate"+n).val();s?o.cell(".cell-taxrates"+n).data(showTaxRatesDetail(e,u,r,s)):o.cell(".cell-taxrates"+n).data('<ul class="unstyled"><li>Tax free<\/li><\/ul>');c=parseFloat(e)*parseFloat(u)*(1-parseFloat(r)/100)*(1+parseFloat(h));o.cell(".cell-totalcost"+n).data(toCurrencySymbol(c,!1));switch(t.attr("name")){case"quantity":f.quantity=t.val();break;case"discount":f.discount=t.val();break;case"dimensions":f.dimensions=t.val();break;case"unit":f.unit=t.val();break;default:f.costPerUnit=t.val()}})}});$("#tbl-unallocated").on("draw.dt",function(){$("#tbl-unallocated .select2").select2({placeholder:"Please select"});$("#tbl-unallocated input[data-toggle=toggle]").bootstrapToggle()})}function initControlElm(n){$("#profile-group"+n+" div.well .select2").select2({placeholder:"Please select"});$("#tbgroup"+n+" .select2").select2({placeholder:"Please select"});$("#profile-group"+n+" input[data-toggle=toggle]").bootstrapToggle()}var isBusy=!1;$(document).ready(function(){$(".qbicle-detail .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$('#collapse-unallocated .manage-columns input[type="checkbox"]').change(function(){var t=$("#tbl-unallocated").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#frmReorder select[name=ExcludeGroupId]").select2({placeholder:"Please select",allowClear:!0});initCreateGroupModal();initFormReorder();initDateRange();getCurrencySettings();initUnallocated()});