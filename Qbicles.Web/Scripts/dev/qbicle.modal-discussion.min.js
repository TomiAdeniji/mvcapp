function DiscussionQBInit(){function n(n){if(!n.id)return n.text;var t=n.element.attributes.avatarUrl.value;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+t.toLowerCase()+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function t(n){if(!n.id)return n.text;var t=n.element.attributes.avatarUrl.value;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+t.toLowerCase()+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}$("#frm-discussion-qb").validate({rules:{Title:{required:!0,maxlength:150},FeaturedImage:{filesize:!0},Summary:{maxlength:500}}});$(".preview-discussion-img").change(function(){var n=$(this).data("target");readURLImage(this,n);$(n).fadeIn()});$(".select2avatar-discussion").select2({placeholder:"Please select",templateResult:n,templateSelection:t});$(".singledateandtime-dis").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",drops:"up",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}})}function CreateQbiclesDiscussion(){if($("#frm-discussion-qb").valid()){$("#add-discussion-body").LoadingOverlay("show");var n=document.getElementById("discussion-image-upload").files;n&&n.length>0?UploadMediaS3ClientSide("discussion-image-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}SaveDiscussionForQbicle(n.objectKey)}):SaveDiscussionForQbicle("")}}function SaveDiscussionForQbicle(n){var t={Key:$("#discussion-key").val(),Title:$("#discussion-title").val(),Summary:$("#discussion-summary").val(),ExpiryDate:$("#discussion-expiryDate").val(),IsExpiry:$("#discussion-is-expiry").prop("checked"),Topic:$("#discussion-topic").val(),Assignee:$("#discussion-assignee").val(),FeaturedOption:$("#discussion-featured-option").val(),MediaDiscussionUse:$("#mediaDiscussionUse").val(),UploadKey:n};$.ajax({type:"post",cache:!1,url:"/Discussions/SaveDiscussionForQbicle",data:{model:t},beforeSend:function(){isServerBusy=!0},success:function(n){n.result?($("#create-discussion-qb").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_398"),"Qbicles"),n.msg!=""&&htmlActivityRender(n.msg,0),$("#frm-discussion-qb").trigger("reset"),$("#frm-discussion-qb select[name=Topic]").val("").trigger("change"),$("#frm-discussion-qb select[name=Assignee]").val("").trigger("change"),$("#frm-discussion-qb input[name=IsExpiry]").bootstrapToggle("off"),$(".setexpiry").hide(),$("#frm-discussion-qb").validate().resetForm()):!n.result&&n.Object?$("#frm-discussion-qb").validate().showErrors(n.Object):cleanBookNotification.error(_L(n.msg),"Qbicles");isServerBusy=!1},error:function(){isServerBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");isDisplayFlicker(!1)}}).always(function(){$("#add-discussion-body").LoadingOverlay("hide",!0)})}var isServerBusy=!1;$(document).ready(function(){DiscussionQBInit()});