function initContactMaster(){$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"));$($(".domain_name")[0]).text().replace(/\s/g,"")===""&&selectWorkGroupContact();($("#numberRef").text()===""||$("#numberRef").text()==="0")&&getNewContactRef();$("#form_contact_add").validate({rules:{Name:{required:!0,maxlength:71}}})}function selectTab(){var n=getLocalStorage(contactmanage);n&&$('a[href="#'+n+'"]').tab("show");removeLocalStorage(contactmanage)}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");BKAccount={Id:t,Name:i};$("#accountId").val(t);closeSelected();SaveContact();$("#app-bookkeeping-treeview").modal("toggle")}function closeSelected(){BKAccount.Id?($(".accountInfo").empty(),$(".accountInfo").append(BKAccount.Name)):$(".accountInfo").empty();$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"))}function showChangeAccount(){setTimeout(function(){CollapseAccount()},1)}function CollapseAccount(){$(".jstree").jstree("close_all")}function initSelectedAccount(){setTimeout(function(){$(".selectaccount").removeClass("selectaccount");$(".accountid-"+BKAccount.Id).addClass("selectaccount")},1)}function changeContactManageImageLogo(n){if(ValidateFileImage(n)){var i=$("#trader-contact-avatar-upload"),t="";reader.onload=function(n){t=n.target.result;ChangeContactLogo(t)};reader.readAsDataURL(i[0].files[0])}}function ChangeContactLogo(n){var t=document.getElementById("trader-contact-avatar-upload").files;t&&t.length>0&&UploadMediaS3ClientSide("trader-contact-avatar-upload").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$.ajax({type:"post",url:"/TraderContact/ChangeContactLogo?id="+$("#contact-id").val()+"&mediaObjectKey="+t.objectKey,contentType:!1,processData:!1,dataType:"json",success:function(){cleanBookNotification.updateSuccess();$(".contact-avatar").attr("src",n);$(".avatar").css("background-image","url("+n+")")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})})}function SaveContact(){$.LoadingOverlay("show");$("#update-right").val()==="True"?UpdateContact():CheckStatus($("#contact-id").val(),"Contact").then(function(n){n.result&&n.Object!=="ContactApproved"?UpdateContact():n.result&&n.Object==="ContactApproved"?(cleanBookNotification.error("The Contact has been Approved. Cannot update","Qbicles"),setLocalStorage(contactmanage,$("ul.app_subnav li.active a").attr("href").replace("#","")),setTimeout(function(){window.location.reload()},1e3)):n.result===!1&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}function OnFocusOutControl(n){strValueChanged=n;strValueChanged!==strValueOld&&SaveContact()}function OnFocusControl(n){strValueOld=n}function getNewAllocation(){$("#all_confirmAdd").removeClass("disabled");mode="Allocation";$.LoadingOverlay("show");selectInvoice={};$.ajax({url:"/TraderContact/GetNewAllocation?contactid="+$contactId,type:"GET",datatype:"json"}).success(function(n){$.LoadingOverlay("hide");$("#modal_balance").text(n.ContactBalanceBefore);$("#all_reference_id").val(n.Reference.Id);$("#all_prefic").text(n.Reference.Prefix);$("#all_delimeter_first, #all_delimeter_last").text(n.Reference.Delimeter);$("#all_numberic").text(n.Reference.NumericPart);$("#all_suffic").text(n.Reference.Suffix);$("#all_find_invoice").val("");$("#all_value").val("0");$("#all_note").val(n.Description)}).error(function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$("#create-contact-allocation").modal("hide")})}function onchangeAllocationValue(n){var t=_L("ERROR_MSG_267"),r=parseFloat($("#modal_balance").text()),i=parseFloat($(n).val()),u=$("#all_invoicebalance").val();i>r?(cleanBookNotification.error(t,"Qbicles"),$(n).val($("#modal_balance").text())):selectInvoice.Id&&selectInvoice.Id>0&&i>u?(t=_L("ERROR_MSG_268"),cleanBookNotification.error(t,"Qbicles"),$("#all_confirmAdd").addClass("disabled")):$("#all_confirmAdd").removeClass("disabled")}function findInvoiceContact(){$("#contact-invoice-finder").empty();var n="/TraderContact/FindInvoiceContact?type="+mode;$("#contact-invoice-finder").load(n,function(){})}function selectInvoiceContact(n){$(".invoice-select").hide();$(".selected-invoice").show();selectInvoice={Id:n,Ref:$(".findInvoice_ref"+n).text(),Createdate:$(".findInvoice_createdate"+n).text(),Amount:$(".findInvoice_totalamount"+n).text(),Amountpaid:$(".findInvoice_amountpaid"+n).text(),BalanceInvoice:$("#balanceInvoice_"+n).val()};$("#balance-invoice-value").text(selectInvoice.BalanceInvoice);$("#balance-invoice-lable").show();$("#balanceInvoiceSelected").val(selectInvoice.BalanceInvoice);$("#invoiceselected .ref").text(selectInvoice.Ref);$("#invoiceselected .createdate").text(selectInvoice.Createdate);$("#invoiceselected .totalamount").text(selectInvoice.Amount);$("#invoiceselected .amountpaid").text(selectInvoice.Amountpaid);$(".invoice-select").hide();$(".selected-invoice").show()}function confirmSelectInvoice(){mode==="CreditNote"||mode==="DebitNote"?$("#bit_invoice_key").val(selectInvoice.Ref):($("#all_invoice_id").val(selectInvoice.Id),$("#all_find_invoice").val(selectInvoice.Ref),$("#all_invoicebalance").val(selectInvoice.BalanceInvoice),$("#all_value").val()>parseFloat(selectInvoice.BalanceInvoice)?(cleanBookNotification.error(_L("ERROR_MSG_268"),"Qbicles"),$("#all_confirmAdd").addClass("disabled")):$("#all_confirmAdd").removeClass("disabled"))}function saveAllocation(){var n={Id:$("#all_reference_id").val(),NumericPart:parseFloat($("#all_numberic").text()),Prefix:$("#all_prefic").text(),Suffix:$("#all_suffic").text(),Delimeter:$("#all_delimeter_first").text()},t={id:$("#allocation_id").val(),Contact:{Id:$contactId},Invoice:{Id:$("#all_invoice_id").val()},Value:$("#all_value").val(),ContactBalanceBefore:$("#modal_balance").val(),Description:$("#all_note").val(),Reference:n};$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderContact/SaveAllocation",data:{allocation:t},dataType:"json",success:function(n){$.LoadingOverlay("hide");(n.actionVal===1||n.actionVal===2)&&(cleanBookNotification.createSuccess(),$("#table_allocation").DataTable().ajax.reload());n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function deleteAllocation(n){var i=confirm("Do you want delete an item ?"),t;i!==!1&&(t="/TraderContact/DeleteAllocation?id="+n,$.LoadingOverlay("show"),$.ajax({url:t,type:"delete",dataType:"json",success:function(n){n.result?$("#table_allocation").DataTable().ajax.reload():(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),LoadingOverlayEnd())},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd()}))}function LoadFormAddCreditDebit(n,t){mode=t==="CreditNote"?"CreditNote":"DebitNote";var i="/TraderContact/AddEditCreditDebitNote?id="+n+"&type="+t+"&contactId="+$contactId;$("#create-contact-credit").load(i,function(){})}function WorkGroupSelectedChange(){$(".preview-workgroup").show();var n=$("#workgroup-select-credit").val();n!==""?($.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderTransfers/getworkgroup?id="+n,dataType:"json",success:function(n){n.result?($(".preview-workgroup table tr td.location_name").text(n.Object.Location),$(".preview-workgroup table tr td.workgroup_process").text(n.Object.Process),$(".preview-workgroup table tr td.workgroup_qbicle").text(n.Object.Qbicle),$(".preview-workgroup table tr td.workgroup_item span").text(n.Object.GroupNames),$(".preview-workgroup table tr td.workgroup_member span").text(n.Object.Members)):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_item span").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""));LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""))}function ShowGroupMember(){$("#app-trader-workgroup-preview").empty();$("#app-trader-workgroup-preview").load("/TraderTransfers/ShowListMemberForWorkGroup?wgId="+$("#workgroup-select-credit").val())}function creditFindInvoiceBitContact(){findInvoiceContact()}function creditFindSaleBitContact(){$("#contact-sale-finder").empty();$("#contact-sale-finder").load("/TraderContact/FindSaleCredit",function(){})}function selectChoiseSale(n,t){$(".invoice-select").hide();$(".selected-invoice").show();$("#sale_choise_id").val(n);$("#sale_choise_ref input").val(t);$("#sale_choise_ref span").text($(".find_sale_ref_"+n).text());$("#sale_choise_cretedate").empty();$("#sale_choise_cretedate").append($(".find_sale_createdate_"+n).clone());$("#sale_dimensions").empty();$("#sale_dimensions").append($(".find_sale_dimensions_"+n).clone());$("#sale_choise_amount").text($(".find_sale_amount_"+n).text())}function reSelectSale(){$(".selected-invoice").hide();$(".invoice-select").show();$("#sale_choise_id").val(0);$("#sale_choise_ref input").val(0);$("#sale_choise_ref span").text("");$("#sale_choise_cretedate").empty();$("#sale_dimensions").empty();$("#sale_choise_amount").text()}function confirmSelectSale(){selectSale={Id:$("#sale_choise_id").val(),RefId:$("#sale_choise_ref input").val(),RefName:$("#sale_choise_ref span").text().trim()};$("#bit_sale_value").val(selectSale.RefName)}function editCredit(n){LoadFormAddCreditDebit(n,"CreditNote")}function debitFindIBillBitContact(){findInvoiceContact()}function debitFindSPurchaseBitContact(){$("#contact-sale-finder").empty();$("#contact-sale-finder").load("/TraderContact/FindPurchaseCredit",function(){})}function selectChoisePurchse(n,t){$(".invoice-select").hide();$(".selected-invoice").show();$("#sale_choise_id").val(n);$("#sale_choise_ref input").val(t);$("#sale_choise_ref span").text($(".find_sale_ref_"+n).text());$("#sale_choise_cretedate").empty();$("#sale_choise_cretedate").append($(".find_sale_createdate_"+n).clone());$("#sale_dimensions").empty();$("#sale_dimensions").append($(".find_sale_dimensions_"+n).clone());$("#sale_choise_amount").text($(".find_sale_amount_"+n).text())}function reSelectPurchase(){$(".selected-invoice").hide();$(".invoice-select").show();$("#sale_choise_id").val(0);$("#sale_choise_ref input").val(0);$("#sale_choise_ref span").text("");$("#sale_choise_cretedate").empty();$("#sale_dimensions").empty();$("#sale_choise_amount").text()}function confirmSelectPurchase(){selectPurchase={Id:$("#sale_choise_id").val(),RefId:$("#sale_choise_ref input").val(),RefName:$("#sale_choise_ref span").text().trim()};$("#bit_purchase_value").val(selectPurchase.RefName)}function editDebit(n){LoadFormAddCreditDebit(n,"DebitNote")}function validateCreditDebit(){var t=!0,n={Id:$("#workgroup-select-credit").val()};return(n.Id===""||n.Id===null||n.Id==="0")&&($("#form_creditdebit").validate().showErrors({workgroup:"Workgroup is required."}),t=!1),t}function saveDraft(){saveCreditDebit("Draft")}function savePreview(){saveCreditDebit("PendingReview")}function saveCreditDebit(n){if(!validateCreditDebit())return!1;var t={Id:$("#bit_reference_id").val(),NumericPart:parseFloat($("#bit_numberic").text()),Prefix:$("#bit_prefic").text(),Suffix:$("#bit_suffic").text(),Delimeter:$("#bit_delimeter_first").text()},i={Id:$("#credit_id").val(),Contact:{Id:$contactId},Notes:$("#bit_note").val(),Value:$("#bit_amount").val(),Invoice:{Id:selectInvoice.Id},Sale:{Id:selectSale.Id},Purchase:{Id:selectPurchase.Id},Reason:$("#bit_reason").val(),Reference:t,WorkGroup:{Id:$("#workgroup-select-credit").val()},Status:n};$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderContact/SaveCreditDebitNote",data:{creditNote:i},dataType:"json",success:function(n){$.LoadingOverlay("hide");n.actionVal===1?(cleanBookNotification.createSuccess(),$("#create-contact-credit").modal("toggle"),mode==="CreditNote"?$("#credit-list").DataTable().ajax.reload():mode==="DebitNote"&&$("#debit-list").DataTable().ajax.reload()):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#create-contact-credit").modal("toggle"),mode==="CreditNote"?$("#credit-list").DataTable().ajax.reload():mode==="DebitNote"&&$("#debit-list").DataTable().ajax.reload()):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function UpdateStatusApproval(n){$.ajax({url:"/Qbicles/SetRequestStatusForApprovalRequest",type:"GET",dataType:"json",data:{appKey:n},success:function(n){$.LoadingOverlay("hide");n.actionVal>0&&cleanBookNotification.updateSuccess()},error:function(){$.LoadingOverlay("hide");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function tablePaymentsLoad(){var n=$("#payment-list"),t=$("#contact-domain-id").val();$.fn.DataTable.isDataTable("#payment-list")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[1,"desc"]],ajax:{url:"/TraderContact/PaymentsByContact",data:function(n){return $.extend({},n,{id:$contactId})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Type",data:"Type",searchable:!0,orderable:!1},{data:"Amount",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:2,data:"Type",render:function(n,t,i){return n?'<a href="/TraderInvoices/InvoiceManage?key='+i.IvKey+'">Invoice #'+n+"<\/a>":"Payment on account"}},{targets:4,data:"Status",render:function(n){var t="";switch(n){case 0:t='<span class="label label-lg label-info">Draft<\/span>';break;case 1:t='<span class="label label-lg label-warning">Pending Review<\/span>';break;case 2:t='<span class="label label-lg label-primary">Pending Approval<\/span>';break;case 3:t='<span class="label label-lg label-danger">Denied<\/span>';break;case 4:t='<span class="label label-lg label-success">Approved<\/span>';break;default:t='<span class="label label-lg label-danger">Discarded<\/span>'}return t}},{targets:5,data:"Id",render:function(n,t,i){return i.Status==0||i.Status==1?'<button class="btn btn-primary" disabled=""><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>':'<button class="btn btn-primary" onclick="window.location.href =\'/TraderPayments/PaymentManage?id='+n+'\';"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>'}}]});$("#payment-table_filter").hide()}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||500)}}function tableInvoicesLoad(){var n=$("#invoice-list");$.fn.DataTable.isDataTable("#invoice-list")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[1,"desc"]],ajax:{url:"/TraderContact/InvoiceByContact",data:function(n){return $.extend({},n,{id:$contactId,type:"Sale"})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{data:"Amount",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:3,data:"Status",render:function(n){var t="";switch(n){case 0:t='<span class="label label-lg label-info">Draft<\/span>';break;case 1:t='<span class="label label-lg label-warning">Pending Review<\/span>';break;case 2:t='<span class="label label-lg label-primary">Pending Approval<\/span>';break;case 3:t='<span class="label label-lg label-danger">Denied<\/span>';break;case 4:t='<span class="label label-lg label-success">Approved<\/span>';break;case 5:t='<span class="label label-lg label-danger">Discarded<\/span>';break;default:t='<span class="label label-lg label-success">Issued<\/span>'}return t}},{targets:4,data:"Id",render:function(n,t,i){return i.Status!=0?'<button class="btn btn-primary" onclick="window.location.href =\'/TraderInvoices/InvoiceManage?key='+i.Key+'\'"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>':'<button class="btn btn-primary" disabled=""><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>'}}]});$("#invoice-table_filter").hide()}function tableBillsLoad(){var n=$("#bill-list");$.fn.DataTable.isDataTable("#bill-list")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[1,"desc"]],ajax:{url:"/TraderContact/InvoiceByContact",data:function(n){return $.extend({},n,{id:$contactId,type:"Purchase"})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{data:"Amount",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:3,data:"Status",render:function(n){var t="";switch(n){case 0:t='<span class="label label-lg label-info">Draft<\/span>';break;case 1:t='<span class="label label-lg label-warning">Pending Review<\/span>';break;case 2:t='<span class="label label-lg label-primary">Pending Approval<\/span>';break;case 3:t='<span class="label label-lg label-danger">Denied<\/span>';break;case 4:t='<span class="label label-lg label-success">Approved<\/span>';break;case 5:t='<span class="label label-lg label-danger">Discarded<\/span>';break;default:t='<span class="label label-lg label-success">Issued<\/span>'}return t}},{targets:4,data:"Id",render:function(n,t,i){return i.Status!=0?'<button class="btn btn-primary" onclick="window.location.href =\'/TraderInvoices/InvoiceManage?key='+i.Key+'\'"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>':'<button class="btn btn-primary" disabled=""><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>'}}]});$("#bill-table_filter").hide()}function tableAllocationLoad(){var n=$("#table_allocation");$.fn.DataTable.isDataTable("#table_allocation")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[1,"desc"]],ajax:{url:"/TraderContact/AllocationList",data:function(n){return $.extend({},n,{contactid:$contactId})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Invoice ref",data:"InvoiceRef",searchable:!0,orderable:!1},{data:"Value",searchable:!0,orderable:!0},{title:"Notes",data:"Description",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:5,data:"Id",render:function(n){var t='<button class="btn btn-primary" onclick="window.location.href=\'/TraderContact/AllocationDetail?id='+n+'\';"><i class="fa fa-eye"><\/i> &nbsp; View<\/button>';return t+('<button class="btn btn-danger" onclick="deleteAllocation('+n+')"> <i class="fa fa-trash"><\/i><\/button>')}}]});$("#table_allocation-table_filter").hide()}function tableCreditLoad(){var n=$("#credit-list");$.fn.DataTable.isDataTable("#credit-list")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[6,"desc"]],ajax:{url:"/TraderContact/CreditNoteList",data:function(n){return $.extend({},n,{contactid:$contactId,type:"Credit"})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Reason",data:"Reason",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Invoice reference",data:"InvoiceRef",searchable:!0,orderable:!1},{title:"Sale reference",data:"SaleRef",searchable:!0,orderable:!1},{data:"Value",searchable:!0,orderable:!0},{title:"Finalised",data:"Finalised",searchable:!0,orderable:!0},{title:"Notes",data:"Notes",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:8,data:"Status",render:function(n){var t="";switch(n){case 1:t='<span class="label label-lg label-primary">Draft<\/span>';break;case 2:t='<span class="label label-lg label-warning">Awaiting Review<\/span>';break;case 3:t='<span class="label label-lg label-primary">Reviewed<\/span>';break;case 4:t='<span class="label label-lg label-primary">Approved<\/span>';break;case 5:t='<span class="label label-lg label-danger">Denied<\/span>';break;default:t='<span class="label label-lg label-danger">Discarded<\/span>'}return t}},{targets:9,data:"Id",render:function(n,t,i){return i.Status==1?'<button class="btn btn-info" data-toggle="modal" data-target="#create-contact-credit" onclick="editCredit('+n+')"><i class="fa fa-pencil"><\/i> &nbsp; Continue<\/button>':'<button class="btn btn-primary" onclick="window.location.href=\'/TraderContact/CreditNoteDetail?id='+n+'\';"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>'}}]});$("#credit-table_filter").hide()}function tableDebitLoad(){var n=$("#debit-list");$.fn.DataTable.isDataTable("#debit-list")&&n.DataTable().destroy();n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?$(n).LoadingOverlay("show",{minSize:"70x60px"}):$(n).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,order:[[6,"desc"]],ajax:{url:"/TraderContact/CreditNoteList",data:function(n){return $.extend({},n,{contactid:$contactId,type:"Debit"})}},columns:[{title:"#",data:"Ref",searchable:!0,orderable:!0},{title:"Reason",data:"Reason",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Invoice reference",data:"InvoiceRef",searchable:!0,orderable:!1},{title:"Sale reference",data:"SaleRef",searchable:!0,orderable:!1},{data:"Value",searchable:!0,orderable:!0},{title:"Finalised",data:"Finalised",searchable:!0,orderable:!0},{title:"Notes",data:"Notes",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Actions",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:8,data:"Status",render:function(n){var t="";switch(n){case 1:t='<span class="label label-lg label-primary">Draft<\/span>';break;case 2:t='<span class="label label-lg label-warning">Awaiting Review<\/span>';break;case 3:t='<span class="label label-lg label-primary">Reviewed<\/span>';break;case 4:t='<span class="label label-lg label-primary">Approved<\/span>';break;case 5:t='<span class="label label-lg label-danger">Denied<\/span>';break;default:t='<span class="label label-lg label-danger">Discarded<\/span>'}return t}},{targets:9,data:"Id",render:function(n,t,i){return i.Status==1?'<button class="btn btn-info" data-toggle="modal" data-target="#create-contact-credit" onclick="editCredit('+n+')"><i class="fa fa-pencil"><\/i> &nbsp; Continue<\/button>':'<button class="btn btn-primary" onclick="window.location.href=\'/TraderContact/CreditNoteDetail?id='+n+'\';"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>'}}]});$("#debit-table_filter").hide()}function getNewContactRef(){$.ajax({type:"get",url:"/TraderContact/GetNewContactRef",dataType:"json",success:function(n){n&&($("#contactReferenceId").val(n.Id),$("#numberRef").text(n.Reference))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){})}function selectWorkGroupContact(){var n=$("#group-workgroup-id option:selected");$(".domain_name").text(n.attr("domain")+"-")}var $contactId=$("#contact-id").val(),reader=new FileReader,selectInvoice={},selectSale={},selectPurchase={},mode="Allocation",contactmanage="contactmanage",BKAccount,strValueOld,strValueChanged;$(function(){selectTab();var n=document.getElementById("all_value");n.onkeydown=function(n){if(!(n.keyCode>95&&n.keyCode<106||n.keyCode>47&&n.keyCode<58||n.keyCode===8))return!1}});BKAccount={};$("#group-workgroup-id").on("change",function(){SaveContact()});$("#group-contact-id").on("change",function(){SaveContact()});$("#CountryName").on("change",function(){SaveContact()});UpdateContact=function(){$("#group-contact-id").val()===null&&(cleanBookNotification.error(_L("ERROR_MSG_262"),"Qbicles"),$("#contact-group-label").addClass("text-red"));$("#group-workgroup-id").val()===null&&cleanBookNotification.error(_L("ERROR_MSG_263"),"Qbicles");var t={Id:$("#group-contact-id").val()},i={Id:$("#group-workgroup-id").val()},n={ContactGroup:t,Workgroup:i,Name:$("#contact-name").val(),Id:$("#contact-id").val(),Email:$("#contact-email").val()};if($("#form_contact_add").valid()){if($("#group-contact-id").val()===null)return;if($("#group-workgroup-id").val()===null)return;$.ajax({url:"/TraderContact/TraderContactNameCheck",data:{contact:n},type:"POST",dataType:"json"}).done(function(t){t.result?$("#form_contact_add").validate().showErrors({Name:_L("ERROR_MSG_251")}):$.ajax({method:"POST",dataType:"JSON",url:"/TraderContact/CheckExistedApprovedContact",data:{contact:n}}).done(function(n){n.result?$("#form_contact_add").trigger("submit"):cleanBookNotification.error(n.msg,"Qbicles")}).fail(function(){cleanBookNotification.error("Error checking existing Approved Trader Contact","Qbicles")}).always(function(){LoadingOverlayEnd()})}).fail(function(){$("#form_contact_add").validate().showErrors({Name:_L("ERROR_MSG_251")})}).always(function(){LoadingOverlayEnd()})}else LoadingOverlayEnd()};$("#form_contact_add").submit(function(n){n.preventDefault();document.getElementById("form_contact_add").style.cursor="not-allowed";var t=$("#AddressLine1").val()+" "+$("#AddressLine2").val()+" "+$("#City").val()+" "+$("#CountryName").val();fetch("https://maps.googleapis.com/maps/api/geocode/json?address="+t+"&key="+$("#map-key").val()).then(n=>n.json()).then(n=>{$("#contact-Latitude").val(n.results[0].geometry.location.lat),$("#contact-longitude").val(n.results[0].geometry.location.lng),$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:new FormData(this),processData:!1,contentType:!1,beforeSend:function(){},success:function(n){n.result&&(ClearError(),cleanBookNotification.updateSuccess(),document.getElementById("form_contact_add").style.cursor="default",setLocalStorage(contactmanage,$("ul.app_subnav li.active a").attr("href").replace("#","")))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");document.getElementById("form_contact_add").style.cursor="default"}})})});strValueOld="";strValueChanged="";$(function(){$("#search_invoice").keyup(searchThrottle(function(){$("#invoice-list").DataTable().search($(this).val()).draw()}));$('.manage-columns-invoice input[type="checkbox"]').on("change",function(){var t=$("#invoice-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#search_bill").keyup(searchThrottle(function(){$("#bill-list").DataTable().search($(this).val()).draw()}));$('.manage-columns-bill input[type="checkbox"]').on("change",function(){var t=$("#bill-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#search_payment").keyup(searchThrottle(function(){$("#payment-list").DataTable().search($(this).val()).draw()}));$('.manage-columns-payment input[type="checkbox"]').on("change",function(){var t=$("#payment-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#search_dt_table_allocation").keyup(searchThrottle(function(){$("#table_allocation").DataTable().search($(this).val()).draw()}));$('.manage-columns-allocation input[type="checkbox"]').on("change",function(){var t=$("#table_allocation").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#search_dt_creditnote").keyup(searchThrottle(function(){$("#credit-list").DataTable().search($(this).val()).draw()}));$('.manage-columns-credit input[type="checkbox"]').on("change",function(){var t=$("#credit-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#search_dt_debitnote").keyup(searchThrottle(function(){$("#debit-list").DataTable().search($(this).val()).draw()}));$('.manage-columns-debit input[type="checkbox"]').on("change",function(){var t=$("#debit-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});tablePaymentsLoad();tableInvoicesLoad();tableBillsLoad();tableAllocationLoad();tableCreditLoad();tableDebitLoad()});