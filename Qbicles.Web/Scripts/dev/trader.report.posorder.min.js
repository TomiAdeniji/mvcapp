function initTimer(){(array.push("runTimer"),array.length>1)||(example=new function(){function r(){for(var u,r=0;r<n.length;r++)t[r]||(t[r]=getMilliseconds($(n[r]).text())),u=formatTime(t[r]),$(n[r]).html(u),t[r]+=i+i/20}var n,i=70,t=[];$(function(){n=$(".timer-order");example.Timer=$.timer(r,i,!0);array=[]});this.resetStopwatch=function(){if(n)for(var i=0;i<n.length;i++)t[i]=0;example.Timer.stop().once()}})}function AddEditDiscussion(n){LoadingOverlay();$("#create-discussion-pos").empty();$("#create-discussion-pos").load("/TraderReports/AddDiscussion?id="+n,function(){LoadingOverlayEnd()})}function saveDiscussion(){for(var u,n={Id:$("#queue-discussionId").val(),Topic:{Id:$("#discussion-topic").val()},Summary:$("#discussion-summary").val(),Name:$("#discussion-name").val()},i=$("#discussion-contact").val(),r=[],t=0;t<i.length;t++)r.push({Id:i[t]});n.ActivityMembers=r;$("#expiryDate")[0].checked&&(n.ExpiryDate=$("#discussion-expirydate").val());u={Id:$("#queueId").val(),Discussion:n};LoadingOverlay();$.ajax({type:"post",url:"/TraderReports/SaveDiscussion",datatype:"json",data:{queueOrder:u},success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$("#create-discussion-pos").modal("toggle")):n.actionVal===2?(cleanBookNotification.updateSuccess(),$("#create-discussion-pos").modal("toggle")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function printPDF(){$.LoadingOverlay("show");var n=document.getElementById("order-table");html2canvas(n,{allowTaint:!0,background:"transparent",onrendered:function(n){var i=n.toDataURL("image/jpeg"),t=window.open();$(t.document.body).html('<style type="text/css" media="print">@page{size: auto;margin: 0mm;}<\/style ><img src='+i+" style='width:100%;'><\/img>").ready(function(){t.focus();setTimeout(function(){t.print()},500)})}});LoadingOverlayEnd()}function exportPDF(){$.LoadingOverlay("show");var n="";window.html2canvas(document.getElementById("order-table"),{allowTaint:!0,svgRendering:!0,onrendered:function(t){n=t.toDataURL("image/png").replace("image/png","image/octet-stream");var i="order-table.pdf";$.ajax({type:"post",url:"/Bookkeeping/DownloadReport",datatype:"json",data:{data:n},success:function(n){LoadingOverlayEnd();var t=document.createElement("a");t.download=i;t.href="data:application/pdf;base64,"+n;document.body.appendChild(t);t.click();document.body.removeChild(t);delete t},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}});LoadingOverlayEnd()}function showPosOrder(n){LoadingOverlay();$("#pos-order-summary").empty();$("#pos-order-summary").load("/TraderReports/ShowOrderSummary?queueOrderId="+n,function(){LoadingOverlayEnd()})}function changePageRefreshTime(){var n=Number($("#pageRefreshTime").val()),t;n<5&&(n=5,$("#pageRefreshTime").val("5"));LoadingOverlay();t="/TraderReports/UpdatePageRefreshTime";$.ajax({type:"POST",dataType:"JSON",url:t,data:{refreshTime:n},success:function(){location.reload()}});LoadingOverlayEnd()}function pad(n,t){for(var i=""+n;i.length<t;)i="0"+i;return i}function formatTime(n){var t=Math.floor(n/monthToMilisecond),i=Math.floor(n/weekToMilisecond-t*30.4368),r=Math.floor(n/dayToMilisecond-t*30.4368-i*7),u=Math.floor(n/hourToMilisecond-(t*30.4368+i*7+r)*24),f=Math.floor(n/minuteToMilisecond-((t*30.4368+i*7+r)*1440+u*60)),c=Math.floor(n/secondToMilisecond-((t*30.4368+i*7+r)*86400+u*3600+f*60)),e="",o="",s="",h="";return t>0&&(e=t+"m "),i>0&&(o=i+"w "),r>0&&(s=r+"d "),u>0&&(h=pad(u,2)+"h "),e+o+s+h+(f>0?pad(f,2):"00")+"m "+pad(c,2)+"s"}function getMilliseconds(n){if(!n||n.split(":").length<6)return 0;var t=n.split(":");return parseInt(t[0])*monthToMilisecond+parseInt(t[1])*weekToMilisecond+parseInt(t[2])*dayToMilisecond+parseInt(t[3])*hourToMilisecond+parseInt(t[4])*minuteToMilisecond+parseInt(t[5])*secondToMilisecond}function LoadTableDataOrderHistory(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):($(n.currentTarget).LoadingOverlay("hide",!0),initTimer())}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:""},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{isCompleteShown:$("#isCompletedShown").is(":checked")})}},columns:i,order:[[r,"asc"]]})}function LoadDataByServerSide(){var n=[{name:"OrderRef",data:"OrderRef",orderable:!0},{name:"Status",orderable:!1,render:function(n,t,i){if(i.Status!="")var r='<span class="label label-lg label-primary">'+i.Status+"<\/span>";return r}},{name:"OrderItems",data:"OrderItems",orderable:!0,width:"50px",render:function(n,t,i){return'<button class="btn btn-info" onclick="showPosOrder(\''+i.Id+'\')" data-toggle="modal" data-target="#pos-order-summary"><i class="fa fa-list"><\/i> &nbsp; '+i.OrderItems+"<\/button>"}},{name:"OrderTotal",data:"OrderTotal",width:"50px",orderable:!0},{name:"Queued",data:"Queued",orderable:!1},{name:"Pending",data:"Pending",orderable:!1,render:function(n,t,i){return i.Pending}},{name:"Preparing",data:"Preparing",orderable:!1,render:function(n,t,i){return i.Preparing}},{name:"Completion",data:"Completion",orderable:!1,width:"50px",render:function(n,t,i){return i.Completion}},{name:"DeliveryStatus",data:"DeliveryStatus",orderable:!1,width:"50px",render:function(n,t,i){return i.DeliveryStatus}},{name:"Payment",data:"Payment",orderable:!1,width:"50px",render:function(n,t,i){return i.Payment}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){return""+(i.Discussion?"<button onclick=\"AddEditDiscussion('"+i.Id+'\')" class="btn btn-primary" data-toggle="modal" data-target="#create-discussion-pos"><i class="fa fa-comments"><\/i> &nbsp; Discuss<\/button>':'<button class="btn btn-primary" onclick="AddEditDiscussion(\''+i.Id+'\')" data-toggle="modal" data-target="#create-discussion-pos"><i class="fa fa-comments"><\/i> &nbsp; Discuss<\/button>')}}];LoadTableDataOrderHistory("pos-order-table","/TraderReports/TraderOrderHistoryDataTable",n,4);CallBackFilterDataOrderHistoryServeSide()}function CallBackFilterDataOrderHistoryServeSide(){$("#pos-order-table").DataTable().ajax.reload()}var example,array;$(function(){LoadDataByServerSide()});example=null;array=[];var monthToMilisecond=864e5*30.4368,weekToMilisecond=6048e5,dayToMilisecond=864e5,hourToMilisecond=36e5,minuteToMilisecond=6e4,secondToMilisecond=1e3;