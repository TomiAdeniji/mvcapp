function changeImageCover(n){if(ValidateFileImage(n)){var t=$("#image_featured");reader.onload=function(n){$("div.community-profile-upper").attr("style","background-image: url('"+n.target.result+"');")};reader.readAsDataURL(t[0].files[0])}}function changeImageLogo(n){if(ValidateFileImage(n)){var t=$("#upload_image_logo");reader.onload=function(n){$("div.community-side div.community-avatar").attr("style","background-image: url('"+n.target.result+"');")};reader.readAsDataURL(t[0].files[0])}}function previewDomainProfile(){var n,t,i;if($(".previewDomainProfile").removeClass("hidden"),$(".editProfile").addClass("hidden"),$("#strapline-preview-1").text($("#profile_strapline").val()),$("#strapline-preview-2").text($("#profile_strapline").val()),$("#profile-preview").html($("#domain-profile").val().replace(/\n/g,"<br />")),n=$("#domain-tag option:selected"),$("#profile_preview_tags").empty(),n.length>0){for(t=0;t<n.length;t++)i='<a class="topic-label"> <span class="label label-info">'+$(n[t]).text()+"<\/span> <\/a>",$("#profile_preview_tags").append(i);$("#profile_preview_tags").append("<br><br>")}}function returnEdit(){$(".editProfile").removeClass("hidden");$(".previewDomainProfile").addClass("hidden")}function updateCoverImage(){var t=new FormData,n=$("#image_featured");t.append("Cover-profile",n[0].files[0]);n.length>0&&n[0].files.length>0?$.ajax({type:"post",url:"/DomainProfile/ComunityChangeFeatureDomainImage",data:t,contentType:!1,processData:!1,dataType:"json",success:function(){CommunityUpdateLogo()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}):CommunityUpdateLogo()}function CommunityUpdateLogo(){var t=new FormData,n=$("#upload_image_logo");t.append("avatar-profile",n[0].files[0]);n.length>0&&n[0].files.length>0&&$.ajax({type:"post",url:"/DomainProfile/ChangeLogo",data:t,contentType:!1,processData:!1,dataType:"json",success:function(){cleanBookNotification.updateSuccess();setTimeout(function(){location.href="/Community/DomainProfile"},500)},error:function(){}});cleanBookNotification.updateSuccess();setTimeout(function(){location.href="/Community/DomainProfile"},500)}function updateProfileText(n){if($("#domain-profile").val().length>0){var t=JSON.stringify($("#domain-profile").val().trim());$.ajax({type:"post",url:"/DomainProfile/UpdateProfileText?profileText="+t,contentType:!1,processData:!1,dataType:"json",success:function(t){n||(t.actionVal==1?cleanBookNotification.updateSuccess():t.actionVal==2&&cleanBookNotification.error(t.msg,"Qbicles"))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}else $("#form-domain-profile").validate().showErrors({domainprofile:"This field is required."})}function addLocation(){var n={Name:$("#form_location_name").val(),Address:$("#form_location_address").val()},t=!0;(n.Name===""&&(t=!1,$("#form-domain-profile").validate().showErrors({locationName:"This field is required."})),n.Address===""&&(t=!1,$("#form-domain-profile").validate().showErrors({locationAddress:"This field is required."})),t)&&$.ajax({type:"post",url:"/DomainProfile/BuildLocation",data:{location:n},dataType:"json",success:function(n){n.result?($("#listLocations").append(n.msg),$("#form_location_name").val(""),$("#form_location_address").val("")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function editLocation(n){$locationGuidID=n;$("#location_name").val($("#name-"+n).html().replace(/<br ?\/?>/g,"\n"));$("#location_address").val($("#address-"+n).html().replace(/<br ?\/?>/g,"\n"));$modal.modal("toggle")}function deleteLocation(n){$("#location-"+n).remove()}function locationConfirmChange(){$("#name-"+$locationGuidID).html($("#location_name").val().replace(/\n/g,"<br />"));$("#address-"+$locationGuidID).html($("#location_address").val().replace(/\n/g,"<br />"));$locationGuidID=null;$("#location_name").val("");$("#location_address").val("");$modal.modal("toggle")}function cancelChangeLocation(){$("#form_location_name").val("");$("#form_location_address").val("");$modal.modal("toggle")}function saveAndFinish(){var f=!0,i,e,r,t,o,h,u,s,n,l;if($("#profile_strapline").val()===""&&(f=!1,$("#form-domain-profile").validate().showErrors({strapline:"This field is required."})),$("#domain-profile").val()===""&&(f=!1,$("#form-domain-profile").validate().showErrors({domainprofile:"This field is required."})),f){if(i=$("#domain-tag").val(),e=[],i!=null&&i.length>0)for(r=0;r<i.length;r++)e.push({Id:i[r]});if(t=$("#listLocations div.office-location"),o=[],t.length>0)for(n=0;n<t.length;n++)h={Id:$(t[n]).find("input.location_id").val(),Name:$(t[n]).find("strong.location_name").text().trim(),Address:JSON.stringify($(t[n]).find("p.location_address").html().replace(/<br ?\/?>/g,"\n"))},o.push(h);if(u=$(".page-community div.portlet"),s=[],u.length>0)for(n=0;n<u.length;n++){var c=$(u[n]).find("input.page_id").val(),a=$("#page-display-"+c).prop("checked"),v={Id:c,IsDisplayedOnDomainProfile:a,DisplayOrderOnDomainProfile:n+1};s.push(v)}l={Id:$("#domain-profile-id").val(),StrapLine:$("#profile_strapline").val(),ProfileText:$("#domain-profile").val(),Tags:e};$.ajax({type:"post",url:"/DomainProfile/SaveAndFinish",data:{domainProfile:l,locations:o,pages:s},dataType:"json",success:function(n){n.actionVal==1?SaveAssociate():(n.actionVal==3||n.actionVal==2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}}function DeletePage(n){$.ajax({type:"post",url:"/CommunitySystem/DeletePage",data:{id:n},dataType:"json",success:function(t){t.result?($("#page-community-"+n).remove(),$("#preview-page-"+n).remove(),cleanBookNotification.updateSuccess()):cleanBookNotification.error(t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function SaveAssociate(){if($("#domain-profile").val().length>0){var n=JSON.stringify($("#domain-profile").val().trim());$.ajax({type:"post",url:"/DomainProfile/UpdateProfileText?profileText="+n,contentType:!1,processData:!1,dataType:"json",success:function(){updateCoverImage()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}else $("#form-domain-profile").validate().showErrors({domainprofile:"This field is required."})}var reader=new FileReader,$modal=$("#app-community-edit-location"),$locationGuidID;$(function(){$("#domain-profile-id").val()==="0"?$(".button-update").attr("button-update",!0):$(".button-update").removeAttr("disabled")});$locationGuidID=null;