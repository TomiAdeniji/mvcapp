function SubmitSocialCampaign(n){var t=new FormData($("#frm_marketing-social-campaign_addedit")[0]),i=$("#social-campaign-workgroup option:selected");t.append("qbicleFolderId",i.attr("qbicleid"));t.append("topicid",i.attr("topicid"));$.ajax({type:"post",cache:!1,url:"/SalesMarketing/SaveSocialCampaign",enctype:"multipart/form-data",data:t,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(t){t.result?($("#"+n+"").modal("hide"),LoadSocicalCampains(!0),cleanBookNotification.success(_L("ERROR_MSG_178"),"Sales Marketing")):cleanBookNotification.error(t.msg?t.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){LoadingOverlayEnd();isBusyAddTaskForm=!1})}function ProcessEmailCampaign(){var i,n,r,t;if(LoadingOverlay(),!$("#frm_marketing-email-campaign_addedit").valid()){$(".admintabs a[href=#social-overview]").tab("show");LoadingOverlayEnd();return}if(i=$("#social-campaign-workgroup").val(),!i){cleanBookNotification.error(_L("ERROR_MSG_168"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");LoadingOverlayEnd();return}if(n=$("#social-campaign-folders").val(),!n||n=="0"&&!$("#social-newfolder-name").val()){cleanBookNotification.error(_L("ERROR_MSG_169"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");LoadingOverlayEnd();return}if(r=$("#slBrandCampaign").val(),!r){cleanBookNotification.error(_L("ERROR_MSG_170"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");LoadingOverlayEnd();return}t=document.getElementById("sm-email-campaign-upload-media").files;t&&t.length>0?UploadMediaS3ClientSide("sm-email-campaign-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-email-campaign-object-key").val(n.objectKey);$("#sm-email-campaign-object-name").val(n.fileName);$("#sm-email-campaign-object-size").val(n.fileSize);SubmitEmailCampaign()}):($("#sm-email-campaign-object-key").val(""),$("#sm-email-campaign-object-name").val(""),$("#sm-email-campaign-object-size").val(""),SubmitEmailCampaign())}function SubmitEmailCampaign(){var n=new FormData($("#frm_marketing-email-campaign_addedit")[0]),t=$("#social-campaign-workgroup option:selected");n.append("qbicleFolderId",t.attr("qbicleid"));n.append("topicid",t.attr("topicid"));$.ajax({type:"post",cache:!1,url:"/SalesMarketing/SaveEmailCampaign",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-email-campaign-add").modal("hide"),$("#app-marketing-email-campaign-edit").modal("hide"),LoadEmailCampaigns(!0),cleanBookNotification.success(_L("ERROR_MSG_371"),"Sales Marketing")):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){LoadingOverlayEnd();isBusyAddTaskForm=!1})}function SubmitCampaignResource(){var n=new FormData($("#form_media_smresource")[0]);n.append("qbicleId",$("#media-qbicleId").val());$.ajax({type:"post",cache:!1,url:"/SalesMarketing/SaveCampaignResource",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#create-resource").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_197"),"Sales Marketing"),MedLoadMediasByFolder(),$form_media_addedit.trigger("reset")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()}}).always(function(){LoadingOverlayEnd();isBusyAddTaskForm=!1})}$(document).ready(function(){$("#frm_marketing-email-post").validate({ignore:"",rules:{Headline:{maxlength:500},ButtonText:{maxlength:100}}});$("#sm-social-campaign-upload-media").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()})});ProcessSocialCampaign=function(n){var r,t,u,i;if($.LoadingOverlay("show"),!$("#frm_marketing-social-campaign_addedit").valid()){$(".admintabs a[href=#social-overview]").tab("show");return}if(r=$("#social-campaign-workgroup").val(),!r){cleanBookNotification.error("Please select a Workgroup!","Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(t=$("#social-campaign-folders").val(),!t||t=="0"&&!$("#social-newfolder-name").val()){cleanBookNotification.error("Please select a campaign folder!","Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(u=$("#slBrandCampaign").val(),!u){cleanBookNotification.error("Please select a Brand!","Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}i=document.getElementById("sm-social-campaign-upload-media").files;i&&i.length>0?UploadMediaS3ClientSide("sm-social-campaign-upload-media").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-social-campaign-object-key").val(t.objectKey);$("#sm-social-campaign-object-name").val(t.fileName);$("#sm-social-campaign-object-size").val(t.fileSize);SubmitSocialCampaign(n)}):($("#sm-social-campaign-object-key").val(""),$("#sm-social-campaign-object-name").val(""),$("#sm-social-campaign-object-size").val(""),SubmitSocialCampaign(n))};ProcessCampaignResource=function(){if($("#form_media_smresource").valid()){$.ajax({url:"/Medias/DuplicateMediaNameCheck",data:{qbicleId:$("#media-qbicleId").val(),mediaId:0,MediaName:$("#create-resource input[name=name]").val()},type:"GET",dataType:"json"}).done(function(n){if(n.result){$("#form_media_smresource").validate().showErrors({name:"Name of Media already exists."});return}}).fail(function(){$("#form_media_smresource").validate().showErrors({name:_L("ERROR_MSG_173")});return});$.LoadingOverlay("show");var n=document.getElementById("sm-campaign-resource-upload-image").files;n&&n.length>0?UploadMediaS3ClientSide("sm-campaign-resource-upload-image").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-campaign-resource-object-key").val(n.objectKey);$("#sm-campaign-resource-object-name").val(n.fileName);$("#sm-campaign-resource-object-size").val(n.fileSize);SubmitCampaignResource()}):($("#sm-campaign-resource-object-key").val(""),$("#sm-campaign-resource-object-name").val(""),$("#sm-campaign-resource-object-size").val(""),SubmitCampaignResource())}};