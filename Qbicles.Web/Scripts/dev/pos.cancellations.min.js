function LoadDataOrderCancellationServerSide(){$("#order-cancel-table").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#order-cancel-table").LoadingOverlay("show"):$("#order-cancel-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/OrderCancellation/TraderPosOrderCancellations",type:"POST",data:function(n){return $.extend({},n,{keyword:$("#order-cancel-search-text").val(),cashiers:$("#order-cancel-cashier").val(),managers:$("#order-cancel-manager").val(),datetime:$("#order-cancel-datetimerange").val()})}},columns:[{name:"Ref",data:"Ref",orderable:!0},{name:"Date",data:"Date",orderable:!0,width:"150px"},{name:"SalesChannel",data:"SalesChannel",orderable:!0,width:"100px"},{name:"Reason",data:"Reason",orderable:!0},{name:"CancelledBy",data:"CancelledBy",orderable:!0},{name:"Cashier",data:"Cashier",orderable:!0},{name:"Customer",data:"Customer",orderable:!0},{name:"TotalItems",data:null,orderable:!1,width:"60px",render:function(n,t,i){return i.TotalItems!="0"?"<button class='btn btn-info' onclick=\"ShowOrderCancellationItemDetail('"+i.Key+"')\" ><i class='fa fa-eye'><\/i> &nbsp; "+i.TotalItems+"<\/button>":"<button class='btn btn-info'><i class='fa fa-eye-slash'><\/i> &nbsp; 0<\/button>"}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){if(_.isUndefined(i.PDSOrders))return"";var r="<ul style='margin: 0; padding: 0 0 0 15px;'>";return $.each(i.PDSOrders,function(n,t){r+="<li><a href='javascript:void(0)' onclick=\"ShowPDSOrderItemDetail('"+t.Id+"')\">"+t.Name+"<\/a><\/li>"}),r+="<\/ul>"}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){return(console.log(i.DiscussionKey),i.DiscussionKey=="")?"<button class='btn btn-primary' onclick=\"AddCancellationDiscussion('"+i.Key+"')\" ><i class='fa fa-plus'><\/i>&nbsp; Discuss<\/button>":"<button class='btn btn-primary' onclick=\"OpenDiscussionDetail('"+i.DiscussionKey+"')\" ><i class='fa fa-comments'><\/i>&nbsp; Discuss<\/button>"}}],order:[[1,"desc"]],initComplete:function(){$("#order-cancel-table").DataTable().ajax.reload()}})}function ShowPDSOrderItemDetail(n){$("#order-cancel-table").LoadingOverlay("show");$("#cancel-order-item").empty();$("#cancel-order-item").load("/TraderReports/ShowQueueOrderSummary?queueOrderId="+n,function(){$("#order-cancel-table").LoadingOverlay("hide",!0);$("#cancel-order-item").modal("show")})}function OpenDiscussionDetail(n){$("#order-cancel-table").LoadingOverlay("show");window.location.href="/Qbicles/DiscussionQbicle?disKey="+n}function ShowOrderCancellationItemDetail(n){$cancelKey=n;$("#order-cancel-table").LoadingOverlay("show");var t="/OrderCancellation/OrderCancellationItemDetail?cancelKey="+n;$("#cancel-order-item").empty();$("#cancel-order-item").load(t,function(){$("#order-cancel-table").LoadingOverlay("hide",!0);$("#cancel-order-item").modal("show")})}function AddCancellationDiscussion(n){$cancelKey=n;$("#order-cancel-table").LoadingOverlay("show");var t="/OrderCancellation/AddOrderCancellationDiscussion?cancelKey="+n;$("#create-cancellation-discussion-pos").empty();$("#create-cancellation-discussion-pos").load(t,function(){$("#order-cancel-table").LoadingOverlay("hide",!0);$("#create-cancellation-discussion-pos").modal("show")})}function CreateOrderCancellationDiscussion(){if($("#frm-discussion-qb").valid()){$("#create-cancellation-discussion-pos").LoadingOverlay("show");var n=document.getElementById("discussion-image-upload").files;n&&n.length>0?UploadMediaS3ClientSide("discussion-image-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#order-cancel-table").LoadingOverlay("hide",!0);cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}SaveOrderCancellationDiscussion(n.objectKey)}):SaveOrderCancellationDiscussion("")}}function SaveOrderCancellationDiscussion(n){var t={Key:$("#discussion-key").val(),Title:$("#discussion-title").val(),Summary:$("#discussion-summary").val(),ExpiryDate:$("#discussion-expiryDate").val(),IsExpiry:$("#discussion-is-expiry").prop("checked"),Topic:$("#discussion-topic").val(),Assignee:$("#discussion-assignee").val(),FeaturedOption:$("#discussion-featured-option").val(),MediaDiscussionUse:$("#mediaDiscussionUse").val(),UploadKey:n};$.ajax({type:"post",cache:!1,url:"/OrderCancellation/SaveOrderCancellationDiscussion?cancelKey="+$cancelKey,data:{model:t},beforeSend:function(){},success:function(n){n.result?($("#order-cancel-table").DataTable().ajax.reload(),$("#create-cancellation-discussion-pos").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_398"),"Qbicles"),$("#frm-discussion-qb").validate().resetForm()):!n.result&&n.Object?$("#frm-discussion-qb").validate().showErrors(n.Object):cleanBookNotification.error(_L(n.msg),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){$("#create-cancellation-discussion-pos").LoadingOverlay("hide",!0)})}$cancelKey="";$(function(){function n(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||800)}}$("#order-cancel-search-text").keyup(n(function(){$("#order-cancel-table").DataTable().ajax.reload()}));$("#order-cancel-cashier").change(function(){$("#order-cancel-table").DataTable().ajax.reload()});$("#order-cancel-manager").change(function(){$("#order-cancel-table").DataTable().ajax.reload()});$("#order-cancel-cashier,#order-cancel-manager").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#order-cancel-datetimerange").daterangepicker({autoUpdateInput:!0,timePicker:!0,cancelClass:"btn-danger",opens:"right",startDate:new Date($("#fromDateTime").val()),endDate:new Date($("#toDateTime").val()),locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});$("#order-cancel-datetimerange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$("#order-cancel-datetimerange").html(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$("#order-cancel-table").DataTable().ajax.reload()});$("#order-cancel-datetimerange").on("cancel.daterangepicker",function(){$(this).val(null);$("#order-cancel-datetimerange").html("full history");$("#order-cancel-table").DataTable().ajax.reload()})});