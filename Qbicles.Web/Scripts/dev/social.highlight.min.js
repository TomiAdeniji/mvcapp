function initHighlightBusiness(){initEventHighlightTable();initJobHighlightTable();initNewsHighlightTable();initArticleHighlightTable();initKnowledgeHighlightTable();initRealestateHighlightTable();initEventListingHLTable();initJobListingHLTable();initRealEstateListingHLTable()}function resetPageLoad(){$(window).scrollTop(0);$pageIndex=0;$("#post-list").empty()}function initPostAddShow(){var n=$("#addpostform");n.validate({rules:{type:{required:!0},title:{required:!0},content:{required:!0}}});n.submit(function(t){if(t.preventDefault(),!isBusy){var i=document.getElementById("highlight-img").files;n.valid()&&(i&&i.length>0?UploadMediaS3ClientSide("highlight-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};SaveHighlightPost(t)}):SaveHighlightPost(null))}})}function SaveHighlightPost(n){var t=$("#post-id").val(),i=$("#highlight-type").val(),r=$("#highlight-title").val(),u=$("#highlight-content").val(),f=$("#highlight-link").val(),e=$("#highlight-tags").val().trim().split(" "),o={Id:t,Type:i,Title:r,Content:u,HyperLink:f};LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/HighlightPost/AddEditHighlightPost",data:{highlightPost:o,tags:e,uploadModel:n},success:function(n){n.result?(t>0?cleanBookNotification.updateSuccess():(cleanBookNotification.createSuccess(),previous_shown=!1,$("#taken-total").val(Number($("#taken-total").val())+1)),LoadMoreHighlightPost(!0)):cleanBookNotification.error(n.msg,"Qbicles");$("#highlight-add").modal("hide")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");$("#highlight-add").modal("hide")}}).always(function(){LoadingOverlayEnd()})}function CancelAdvancedSearch(n){var t=$(n).closest(".adv-search");$(t).find("input :not(.multiselect)").each(function(){this.value=""});$(t).find(".select2").each(function(){$(this).val(" ").trigger("change")});$(t).find("input[type=text]").each(function(){$(this).val("")});$("#re-adv-bedroomsearch, #re-adv-bathroomsearch").val("0").trigger("change");$("#re-adv-proptypesearch").val(["0"]);$("#re-adv-proptypesearch").multiselect("refresh");$("#re-adv-propertysearch").val([]);$("#re-adv-propertysearch").multiselect("refresh");$(".adv-search").slideUp();LoadMoreHighlightPost(!0)}function LoadMoreHighlightPost(n){var f=$(".ptags > li").find(".active"),h=$(".followingblock > .cattags > li > .active").text().split("#"),t,i,s,e,w;h.shift();t=0;i=0;f&&f.length>0&&(t=$(f[0]).attr("hlType"),i=$(f[0]).attr("lsType"));s="";e=$(".followed-domains").find(".filterby");e&&e.length>0&&(s=$(e[0]).attr("domain-key"));var b=$(".highltabs > .bookmarked").hasClass("active"),k=$(".highltabs > .flagged").hasClass("active"),r="",u="",c="",l="",a=[],v=0,y=0,p=[],o=0;t==4?i==1&&$("#event").is(":visible")?(r=$("#event-adv-keysearch").val(),u=$("#event-adv-countrySearch").val(),c=$("#event-adv-searchdate").val(),$("#event-adv-areaSearch").val()!=null&&(o=$("#event-adv-areaSearch").val())):i==2&&$("#job").is(":visible")?(r=$("#job-adv-searchkey").val(),u=$("#job-adv-locationsearch").val(),$("#job-adv-areaSearch").val()!=null&&(o=$("#job-adv-areaSearch").val())):i==3&&$("#realestate").is(":visible")&&(r=$("#re-adv-keysearch").val(),u=$("#re-adv-locationsearch").val(),a=$("#re-adv-proptypesearch").val(),v=$("#re-adv-bedroomsearch").val(),y=$("#re-adv-bathroomsearch").val(),p=$("#re-adv-propertysearch").val(),$("#re-adv-areaSearch").val()!=null&&(o=$("#re-adv-areaSearch").val())):t==3&&$("#knowledge").is(":visible")?(r=$("#knowledge-adv-searchkey").val(),u=$("#knowledge-adv-locationsearch").val()):t==2&&$("#news").is(":visible")&&(r=$("#news-adv-keysearch").val(),l=$("#news-adv-datesearch").val());w="/HighlightPost/LoadMoreHighlightPost";$.ajax({method:"POST",dataType:"JSON",url:w,data:{keySearch:r,tagsSearch:h,pageIndex:$pageIndex,typeShowed:t,lsTypeSearch:i,domainKey:s,isBookmarked:b,isFlagged:k,countryName:u,eventDateRange:c,newsPublishedDate:l,rePropTypeIds:a,reBedroomNumber:v,reBathroomNumber:y,rePropertyIds:p,areaId:o},"async":!1,beforeSend:function(){isServerBusy=!0},success:function(t){$("#previous").html("");$("#previous").length===0&&$("#post-list").append('<div id="previous"><\/div>');$(t.ModelString).insertBefore("#previous");n&&$pageIndex<t.TotalPage?($pageIndex+=1,previous_shown=!1):$pageIndex>=t.TotalPage&&(previous_shown=!0)}}).always(function(){})}function Timeline(){$(window).scrollTop(0);$(window).scroll(function(){if($(window).scrollTop()>=$(document).height()-$(window).height()-100&&previous_shown==!1)return loadingNew(),setTimeout(function(){LoadMoreHighlightPost(!0)},100),previous_shown=!0})}function loadingNew(){$("#previous").length===0&&$("#post-list").append('<div id="previous"><\/div>');$("#previous")&&$("#previous").html('<div class="text-center"><img src="/Content/DesignStyle/img/loading-new.gif" style="width: 180px; height: auto;"><\/div><br />')}function PostLikeProcess(n){LoadingOverlay();var t="/HighlightPost/LikePostProcess?highlightPostId="+n;$.ajax({method:"POST",dataType:"JSON",url:t,success:function(t){if(t.result){var i=$("#heart-icon-"+n);i.hasClass("red")?i.removeClass("red").removeClass("fa-heart").addClass("fa-heart-o"):i.addClass("red").removeClass("fa-heart-o").addClass("fa-heart");$("#like-time-"+n).text(t.Object+" people love this")}else cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function initNewsHighlightTable(){$("#hlnews-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hlnews-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hlnews-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#news-searchkey").val(),searchStatus:$("#news-searchstatus").val(),searchType:$("#hlnews-type").val()})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel"},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showNewsAddView('+i.Id+')" data-toggle="modal">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hlnews-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hlnews-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initArticleHighlightTable(){$("#hlarticle-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hlarticle-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hlarticle-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#article-searchkey").val(),searchStatus:$("#article-searchstatus").val(),searchType:$("#hlarticle-type").val()})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel",orderable:!0},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showArticleAddView('+i.Id+')">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hlarticle-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hlarticle-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initKnowledgeHighlightTable(){$("#hlknowledge-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hlknowledge-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hlknowledge-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#knowledge-searchkey").val(),searchStatus:$("#knowledge-searchstatus").val(),searchType:$("#hlknowledge-type").val()})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel",orderable:!0},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showKnowledgeAddView('+i.Id+')" data-toggle="modal">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hlknowledge-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hlknowledge-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initEventHighlightTable(){$("#hlevent-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hlevent-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hlevent-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){var t=$("#listingevent-type").val();return $.extend({},n,{searchKey:$("#event-searchkey").val(),searchStatus:$("#event-searchstatus").val(),searchType:$("#hllisting-type").val(),searchListingTypesStr:JSON.stringify([t])})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Reference",data:"Reference",orderable:!1},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel",orderable:!0},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showEventAddView('+i.Id+')" data-toggle="modal">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hlevent-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hlevent-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initJobHighlightTable(){$("#hljob-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hljob-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hljob-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){var t=$("#listingjob-type").val();return $.extend({},n,{searchKey:$("#job-searchkey").val(),searchStatus:$("#job-searchstatus").val(),searchType:$("#hllisting-type").val(),searchListingTypesStr:JSON.stringify([t])})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Reference",data:"Reference",orderable:!1},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel",orderable:!0},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showJobAddView('+i.Id+')" data-toggle="modal">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hljob-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hljob-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initRealestateHighlightTable(){$("#hlrealestate-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#hlrealestate-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#hlrealestate-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/LoadingHighlightPosts",type:"GET",dataType:"json",data:function(n){var t=$("#listingrealestate-type").val();return $.extend({},n,{searchKey:$("#realestate-searchkey").val(),searchStatus:$("#realestate-searchstatus").val(),searchType:$("#hllisting-type").val(),searchListingTypesStr:JSON.stringify([t])})}},columns:[{name:"Title",data:"Title",orderable:!0},{name:"Property ref",data:"Reference",orderable:!1},{name:"Added",data:"CreatedDate",orderable:!0},{name:"Status",data:"StatusLabel",orderable:!0},{name:"Option",render:function(n,t,i){var r="";return r+='<div class="btn-group">',r+='<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='Options &nbsp; <i class="fa fa-angle-down"><\/i>',r+="<\/button>",r+='<ul class="dropdown-menu dropdown-menu-right primary" style="right: 0;">',r+='<li><a href="#" onclick="showRealEstateAddView('+i.Id+')" data-toggle="modal">Edit<\/a><\/li>',i.IsPublished&&(r+='<li><a href="#" onclick="unpublishPost('+i.Id+", 'hlrealestate-table')\">Unpublish (can't be undone)<\/a><\/li>"),r+='<li><a href="#" onclick="DeleteHighlightPost('+i.Id+", 'hlrealestate-table')\">Delete<\/a><\/li>",r+="<\/ul>",r+"<\/div>"}}]})}function initEventListingHLTable(){$("#listing-event-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#listing-event-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#listing-event-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/ListingPostDataTableContent",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#event-searchkey-1").val(),searchType:$("#listingevent-type").val(),searchRef:$("#event-searchref").val()})}},columns:[{name:"Person",data:"PersonName",render:function(n,t,i){var r="";return r+='<a href="my-contact-profile.php" target="_blank">',r+='<div class="table-avatar mini pull-left" style="background-image: url(\''+i.PersonImageUri+"');\"><\/div>",r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+i.PersonName+"<\/div>",r+='<div class="clearfix"><\/div>',r+"<\/a>"}},{name:"Title",data:"Title",orderable:!0,visible:!1},{name:"Event ref",data:"PostReference",orderable:!0},{name:"Date & time",data:"CreateDateString",orderable:!0},{name:"Option",render:function(n,t,i){return""+(i.HasB2CChat?"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-primary">Chat in B2C<\/button>':"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-info">Connect<\/button>')}}]})}function initJobListingHLTable(){$("#listing-job-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#listing-job-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#listing-job-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/ListingPostDataTableContent",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#job-searchkey-1").val(),searchType:$("#listingjob-type").val(),searchRef:$("#job-searchref").val()})}},columns:[{name:"Person",data:"PersonName",render:function(n,t,i){var r="";return r+='<a href="my-contact-profile.php" target="_blank">',r+='<div class="table-avatar mini pull-left" style="background-image: url(\''+i.PersonImageUri+"');\"><\/div>",r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+i.PersonName+"<\/div>",r+='<div class="clearfix"><\/div>',r+"<\/a>"}},{name:"Title",data:"Title",orderable:!0,visible:!1},{name:"Property ref",data:"PostReference",orderable:!0},{name:"Date & time",data:"CreateDateString",orderable:!0},{name:"Option",render:function(n,t,i){return""+(i.HasB2CChat?"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-primary">Chat in B2C<\/button>':"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-info">Connect<\/button>')}}]})}function initRealEstateListingHLTable(){$("#listing-realestate-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#listing-realestate-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#listing-realestate-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{lengthMenu:"_MENU_ &nbsp; per page"},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,createdRow:function(n,t){t.isCheckpoint&&$(n).removeClass().addClass("checkpoint even")},ajax:{url:"/HighlightPost/ListingPostDataTableContent",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{searchKey:$("#realestate-searchkey-1").val(),searchType:$("#listingrealestate-type").val(),searchRef:$("#realestate-searchref").val()})}},columns:[{name:"Person",data:"PersonName",render:function(n,t,i){var r="";return r+='<a href="my-contact-profile.php" target="_blank">',r+='<div class="table-avatar mini pull-left" style="background-image: url(\''+i.PersonImageUri+"');\"><\/div>",r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+i.PersonName+"<\/div>",r+='<div class="clearfix"><\/div>',r+"<\/a>"}},{name:"Title",data:"Title",orderable:!0,visible:!1},{name:"Property ref",data:"PostReference",orderable:!0},{name:"Date & time",data:"CreateDateString",orderable:!0},{name:"Option",render:function(n,t,i){return""+(i.HasB2CChat?"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-primary">Chat in B2C<\/button>':"<button onclick=\"connectB2CFromListing('"+i.FlaggedUserId+"', '"+i.BusinessProfileId+'\')" class="btn btn-info">Connect<\/button>')}}]})}function showNewsAddView(n){var i="/HighlightPost/NewsHighlightAddView?newsPostId="+n,t="#highlight-news-add";LoadingOverlay();$(t).empty();$(t).load(i);$(t).modal("show");LoadingOverlayEnd()}function showArticleAddView(n){var i="/HighlightPost/ArticleHighlightAddView?articlePostId="+n,t="#highlight-article-add";LoadingOverlay();$(t).empty();$(t).load(i);$(t).modal("show");LoadingOverlayEnd()}function showKnowledgeAddView(n){var i="/HighlightPost/KnowledgeHighlightAddView?knowledgePostId="+n,t="#highlight-knowledge-add";LoadingOverlay();$(t).empty();$(t).load(i);$(t).modal("show");LoadingOverlayEnd()}function showEventAddView(n){var i="/HighlightPost/EventHighlightAddView?listingPostId="+n,t="#highlight-event-add";LoadingOverlay();$(t).empty();$(t).load(i,function(){initPlugins(t);initAddingListingEventForm()});$(t).modal("show");LoadingOverlayEnd()}function showJobAddView(n){var i="/HighlightPost/JobHighlightAddView?listingPostId="+n,t="#highlight-job-add";LoadingOverlay();$(t).empty();$(t).load(i,function(){initPlugins(t);initAddingListingJobForm()});$(t).modal("show");LoadingOverlayEnd()}function showRealEstateAddView(n){var i="/HighlightPost/RealEstateHighlightAddView?listingPostId="+n,t="#highlight-realestate-add";LoadingOverlay();$(t).empty();$(t).load(i,function(){initPlugins(t);initAddingListingRealEstateForm()});$(t).modal("show");LoadingOverlayEnd()}function initPlugins(n){$(n+" .select2").select2({placeholder:"Please select"});$(n+" .select2tag").select2({placeholder:"Please select",tags:!0});$(n+" .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(n+" .singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}})}function initAddingNewsForm(){var n=$("#add-newspost-form");n.validate({rules:{title:{required:!0},hyperlink:{required:!0},summary:{required:!0}}});n.submit(function(t){if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}var i=document.getElementById("news-img").files;n.valid()?(LoadingOverlay(),i&&i.length>0?UploadMediaS3ClientSide("news-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveNewsPost(t)}):saveNewsPost(null)):LoadingOverlayEnd()})}function initAddingArticleForm(){var n=$("#add-articlepost-form");n.validate({rules:{title:{required:!0},summary:{required:!0}}});n.submit(function(t){if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}var i=document.getElementById("article-img").files;n.valid()&&(LoadingOverlay(),i&&i.length>0?UploadMediaS3ClientSide("article-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveArticlePost(t)}):saveArticlePost(null))})}function initAddingKnowledgeForm(){var n=$("#add-knowledgepost-form");n.validate({rules:{title:{required:!0},content:{required:!0}}});n.submit(function(t){if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}var i=document.getElementById("knowledge-img").files;n.valid()?(LoadingOverlay(),i&&i.length>0?UploadMediaS3ClientSide("knowledge-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveKnowledgePost(t)}):saveKnowledgePost(null)):LoadingOverlayEnd()})}function initAddingListingEventForm(){var n=$("#event-form");n.validate({rules:{reference:{required:!0},title:{required:!0},summary:{required:!0}}});n.submit(function(t){var i,u,r,f;if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}if(i=document.getElementById("event-img").files,n.valid()){if(u=Date.parse($("#event-startdate").val()),r=Date.parse($("#event-enddate").val()),u>=r){n.validate().showErrors({"start-date":"The start time must be less than the end time"});return}if(f=Date.parse((new Date).toLocaleDateString()),r<f){n.validate().showErrors({"end-date":"The end time must be greater than today"});return}LoadingOverlay();i&&i.length>0?UploadMediaS3ClientSide("event-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveListingEventPost(t)}):saveListingEventPost(null)}})}function initAddingListingJobForm(){var n=$("#job-form");n.validate({rules:{reference:{required:!0},title:{required:!0},summary:{required:!0},skill:{required:!0}}});n.submit(function(t){var i,r,u;if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}if(i=document.getElementById("job-img").files,n.valid()){if(r=Date.parse($("#job-closingdate").val()),u=Date.parse((new Date).toLocaleDateString()),r<u){n.validate().showErrors({"closing-date":"The closing time must be greater than today"});LoadingOverlayEnd();return}LoadingOverlay();i&&i.length>0?UploadMediaS3ClientSide("job-img").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");LoadingOverlayEnd();return}var t={FileName:n.fileName,FileKey:n.objectKey,FileSize:n.fileSize};saveListingJobPost(t)}):saveListingJobPost(null)}})}function initAddingListingRealEstateForm(){var n=$("#realestate-form");n.validate({rules:{reference:{required:!0},title:{required:!0},summary:{required:!0}}});n.submit(function(t){if(t.preventDefault(),isBusy){LoadingOverlayEnd();return}n.valid()&&(LoadingOverlay(),$ReAttachments.length>0?UploadBatchMediasS3ClientSide($ReAttachments).then(function(){saveListingRealEstatePost()}):saveListingRealEstatePost())})}function saveNewsPost(n){var t={Id:$("#news-id").val(),Title:$("#news-title").val(),NewsHyperLink:$("#news-link").val(),Content:$("#news-summary").val(),NewsCitation:$("#news-citation").val()},i=$("#news-tag").val();$.ajax({method:"POST",url:"/HighlightPost/SaveNewsPost",dataType:"JSON",data:{newsPost:t,tags:i,uploadModel:n},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save News post successfully.","Qbicles"),$("#highlight-news-add").modal("hide"),reloadDataTable("hlnews-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function saveArticlePost(n){var t={Id:$("#article-id").val(),Title:$("#article-title").val(),Content:$("#article-summary").val(),ArticleBody:escape($("#newsletter-editor .ql-editor").html())},i=$("#article-tags").val();$.ajax({method:"POST",url:"/HighlightPost/SaveArticlePost",dataType:"JSON",data:{articlePost:t,tags:i,content:JSON.stringify(escape($("#newsletter-editor .ql-editor").html())),uploadModel:n},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save Article post successfully.","Qbicles"),$("#highlight-article-add").modal("hide"),reloadDataTable("hlarticle-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function saveKnowledgePost(n){var t={Id:$("#knowledge-id").val(),Title:$("#knowledge-title").val(),Content:$("#knowledge-content").val(),KnowledgeHyperlink:$("#knowledge-link").val(),KnowledgeCitation:$("#knowledge-citation").val()},i=$("#knowledge-tags").val();$.ajax({method:"POST",dataType:"JSON",url:"/HighlightPost/SaveKnowledgePost",data:{knowledgePost:t,tags:i,uploadModel:n,countryName:$("#knowledge-country").val()},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save Knowledge post successfully.","Qbicles"),$("#highlight-knowledge-add").modal("hide"),reloadDataTable("hlknowledge-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function saveListingEventPost(n){var r={Id:$("#listing-event-id").val(),Reference:$("#event-ref").val(),Title:$("#event-title").val(),EventLocation:$("#event-location").val(),StartDate:$("#event-startdate").val(),EndDate:$("#event-enddate").val(),Content:$("#event-summary").val()},u=$("#event-tag").val(),t=0,i;$("#area-event").is(":visible")&&(t=$("#listing-event-location").val());i="/HighlightPost/SaveListingEventPost";$.ajax({method:"POST",dataType:"JSON",url:i,data:{eventPost:r,uploadModel:n,tags:u,locationId:t,startDate:$("#event-startdate").val(),endDate:$("#event-enddate").val(),countryName:$("#listing-event-country").val()},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save Listing Event successfully.","Qbicles"),$("#highlight-event-add").modal("hide"),reloadDataTable("hlevent-table"),reloadDataTable("listing-event-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function saveListingJobPost(n){var r={Id:$("#listing-job-id").val(),Reference:$("#job-ref").val(),Title:$("#job-title").val(),Salary:$("#job-salary").val(),ClosingDate:$("#job-closingdate").val(),Content:$("#job-summary").val(),SkillRequired:$("#job-skillrequired").val()},u=$("#job-tag").val(),t=0,i;$("#area-job").is(":visible")&&(t=$("#listing-job-location").val());i="/HighlightPost/SaveListingJobPost";$.ajax({method:"POST",dataType:"JSON",url:i,data:{jobPost:r,uploadModel:n,tags:u,locationId:t,countryName:$("#listing-job-country").val()},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save Listing Job successfully.","Qbicles"),$("#highlight-job-add").modal("hide"),reloadDataTable("hljob-table"),reloadDataTable("listing-job-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function saveListingRealEstatePost(){var u={Id:$("#listing-realestate-id").val(),Reference:$("#realestate-ref").val(),Title:$("#realestate-title").val(),Content:$("#realestate-summary").val(),BedRoomNum:$("#realestate-bedroom-number").val(),BathRoomNum:$("#realestate-bathroom-number").val(),PricingInfo:$("#realestate-pricing-info").val()},t=[],i,n,r;_.forEach($ReAttachments,function(n){n.File={};t.push(n)});i=$("#realestate-tag").val();n=0;$("#area-realestate").is(":visible")&&(n=$("#listing-realestate-location").val());r="/HighlightPost/SaveListingRealEstatePost";$.ajax({method:"POST",dataType:"JSON",url:r,data:{realestatePost:u,countryName:$("#listing-realestate-country").val(),locationId:n,tags:i,propTypeId:$("#realestate-property-type").val(),propListIds:$("#realestate-properties").val(),postAttachments:t,existedAttachments:$ReAttachmentExisted?$ReAttachmentExisted:[],updatedAttachments:$ReUpdatedAttachment?$ReUpdatedAttachment:[]},beforeSend:function(){isBusy=!0},success:function(n){n.result?(cleanBookNotification.success("Save Real Estate Job successfully.","Qbicles"),$("#highlight-realestate-add").modal("hide"),reloadDataTable("hlrealestate-table"),reloadDataTable("listing-realestate-table")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd();isBusy=!1})}function unpublishPost(n,t){var i="/HighlightPost/UnpublishHLPost?postId="+n;LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:i,success:function(n){n.result?(cleanBookNotification.updateSuccess(),reloadDataTable(t)):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function showArticleContentModal(n){var t="/HighlightPost/ArticleContentModal?articleId="+n;$("#highlight-article").empty();$("#highlight-article").load(t);$("#highlight-article").modal("show")}function showRealEstateInfoModal(n){var t="/HighlightPost/RealEstateInfoModal?rePostId="+n;$("#highlight-realestate-info").empty();$("#highlight-realestate-info").load(t);$("#highlight-realestate-info").modal("show")}function reloadDataTable(n){$("#"+n).DataTable().ajax.reload()}function checkRefDuplication(n,t){var r="/HighlightPost/CheckReferenceDuplication?reference="+n+"&lsType="+t,i=!1;return $.ajax({method:"POST",dataType:"JSON",url:r,success:function(n){i=n>0?!0:!1},error:function(){cleanBookNotification.error("Check for reference duplication failed.","Qbicles");i=!1},complete:function(){return i}})}function updateDomainFollowStatus(n,t){LoadingOverlay();var i="/HighlightPost/UpdateHLDomainFollowStatus?domainKey="+n+"&type="+t;$.ajax({method:"POST",dataType:"JSON",url:i,success:function(n){n.result?(cleanBookNotification.updateSuccess(),window.location.reload()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function updateHLFlagStatus(n,t,i){LoadingOverlay();var r="/HighlightPost/UpdateHLFlagStatus?hlPostId="+n+"&type="+t;$.ajax({method:"POST",dataType:"JSON",url:r,success:function(r){if(r.result){cleanBookNotification.updateSuccess();var u=$(i).closest("article").find(".flag"),f=Number($(".flagged > a > span").text());t==1?(u.each(function(t){$(u[t]).hasClass("btn-primary")?$(u[t]).removeClass("btn-primary").addClass("btn-danger").text("I'm not interested"):$(u[t]).addClass("red").text("I'm not interested");$(u[t]).attr("onClick","updateHLFlagStatus("+n+", 2, this)")}),$(".flagged > a > span").text(Number(f+1))):t==2&&(u.each(function(t){$(u[t]).hasClass("red")?$(u[t]).removeClass("red").text("I'm interested"):$(u[t]).addClass("btn-primary").removeClass("btn-danger").text("I'm interested");$(u[t]).attr("onClick","updateHLFlagStatus("+n+", 1, this)")}),$(".flagged").hasClass("active")&&$(i).closest("article").css("display","none"),$(".flagged > a > span").text(Number(f-1)))}else cleanBookNotification.error(r.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).then(function(){return!1}).always(function(){LoadingOverlayEnd()})}function updateHLLikeStatus(n,t,i){LoadingOverlay();var r="/HighlightPost/UpdateHLLikeStatus?hlPostId="+n+"&type="+t;$.ajax({method:"POST",dataType:"JSON",url:r,success:function(r){if(r.result){cleanBookNotification.updateSuccess();var u=$(i).closest("article").find(".likecount").text();t==1?($(i).find("i").addClass("red").addClass("fa-heart").removeClass("fa-heart-o"),$(i).attr("onClick","updateHLLikeStatus("+n+", 2, this)"),u.startsWith("0")?$(i).closest("article").find(".likecount").text("You love this"):$(i).closest("article").find(".likecount").text("You and "+u)):t==2&&($(i).find("i").removeClass("red").removeClass("fa-heart").addClass("fa-heart-o"),$(i).attr("onClick","updateHLLikeStatus("+n+", 1, this)"),u.includes("You and")?(u=u.substr(original.indexOf(" ")+1).substr(original.indexOf(" ")+1),$(i).closest("article").find(".likecount").text(u)):$(i).closest("article").find(".likecount").text("0 people love this"))}else cleanBookNotification.error(r.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).then(function(){return!1}).always(function(){LoadingOverlayEnd()})}function updateHLBookmarkStatus(n,t,i){LoadingOverlay();var r="/HighlightPost/UpdateHLBookmarkStatus?hlPostId="+n+"&type="+t;$.ajax({method:"POST",dataType:"JSON",url:r,success:function(r){if(r.result){cleanBookNotification.updateSuccess();var u=Number($(".bookmarked > a > span").text());t==1?($(i).find("i").addClass("red").addClass("fa-bookmark").removeClass("fa-bookmark-o"),$(i).attr("onClick","updateHLBookmarkStatus("+n+", 2, this)"),$(".bookmarked > a > span").text(Number(u+1))):t==2&&($(i).find("i").removeClass("red").removeClass("fa-bookmark").addClass("fa-bookmark-o"),$(i).attr("onClick","updateHLBookmarkStatus("+n+", 1, this)"),$(".bookmarked").hasClass("active")&&$(i).closest("article").css("display","none"),$(".bookmarked > a > span").text(Number(u-1)))}else cleanBookNotification.error(r.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).then(function(){return!1}).always(function(){LoadingOverlayEnd()})}function showAllTagsModal(){var n=$(".followingblock > .cattags > li > .active").text().split("#");n.shift();$("#highlights-alltags").empty();$("#highlights-alltags").load("/HighlightPost/AllTagsModalShow",{chosenTags:n});$("#highlights-alltags").modal("show")}function filterTags(){var n=$("#tagSearchKey").val(),t=$("#lstTags > li");t.each(function(){$(this).find("span").text().includes(n)?$(this).removeAttr("hidden"):$(this).attr("hidden","true")})}function connectB2CFromListing(n,t){$.LoadingOverlay("show");$.post("/B2C/ConnectB2C",{userId:n,profileId:t},function(n){$.LoadingOverlay("hide");n.result?(_c2cQbiceId=n.Object,window.location.href="/B2C"):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function CloseModalAttachment(){$("#attachments-view").modal("toggle")}function ConfirmAttachment(n,t){var f,l,i,s,a,h,v,e,r,u,c,o;if($ReAttachmentExisted=[],$ReUpdatedAttachment=[],$ReAttachments=[],f="",n){for(l=$(".edit_attachment_row input.inputfile"),i=0;i<l.length;i++)l[i].files.length>0?(s=l[i].files[0],f=s.name.split(".").pop(),a=_.find($qbiclesFileTypes,function(n){return n.Extension===f}),h={Id:GenerateUUID(),Name:s.name,Order:parseInt($("#file_id_"+(i+1)).val())},$("#inputfilename_edit"+(i+1)).val()!==""&&(h.Name=$("#inputfilename_edit"+(i+1)).val()+"."+f),$ReUpdatedAttachment.push(h),v={Id:h.Id,Name:h.Name,Extension:f,Size:s.size,IconPath:a.IconPath,File:s,Index:i+1},$ReAttachments.push(v)):$("#file_id_"+(i+1)).length>0&&$ReAttachmentExisted.push({Order:parseInt($("#file_id_"+(i+1)).val()),Name:$("#inputfilename_edit"+(i+1)).val(),IconPath:$("#inputiconpath_edit"+(i+1)).val(),ImgKey:$("#imgkey_edit"+(i+1)).val()});for(e=$(".add_attachment_row input.inputfile"),r=0;r<e.length;r++)u=e[r].files[0],f=u.name.split(".").pop(),c=_.find($qbiclesFileTypes,function(n){return n.Extension===f}),o={Id:GenerateUUID(),Name:u.name,Extension:u.name.split(".").pop(),Size:u.size,IconPath:c.IconPath,File:u,Index:r+1},$("#inputfilename"+(r+1)).val()!==""&&(o.Name=$("#inputfilename"+(r+1)).val()+"."+f),$ReAttachments.push(o)}else for(e=$(".add_attachment_row input.inputfile"),r=0;r<e.length;r++)u=e[r].files[0],f=u.name.split(".").pop(),c=_.find($qbiclesFileTypes,function(n){return n.Extension===f}),o={Id:GenerateUUID(),Name:u.name,Extension:u.name.split(".").pop(),Size:u.size,IconPath:c.IconPath,File:u},$("#inputfilename"+(r+1)).val()!==""&&(o.Name=$("#inputfilename"+(r+1)).val()+"."+f),$ReAttachments.push(o);LoadAttachmentList();t&&$("#"+t).modal("toggle")}function LoadAttachmentList(){var t=$("#listing-id").val(),n;$("ul.domain-change-list").empty();n=$ReAttachmentExisted.length+$ReAttachments.length;$("#add_attachment").text(" Attachments ("+n+")");n>0&&$("#attachment-icon").removeClass("fa fa-plus").addClass("fa fa-paperclip");_.forEach($ReAttachmentExisted,function(n){var i=" <li> <a onclick='RemoveReImage('"+n.ImgKey+"',"+t+", this)'>";i+='<img src="'+n.IconPath+'" style="max-width: 80px; height: auto; padding-right: 10px;">';i+=n.Name+" <\/a> <\/li>";$("ul.domain-change-list").append(i)});_.forEach($ReAttachments,function(n){var i=" <li> <a onclick='RemoveReImage(\""+n.Index+'",'+t+", this)'>";i+='<img src="'+n.IconPath+'" style="max-width: 80px; height: auto; padding-right: 10px;">';i+=n.Name+" <\/a> <\/li>";$("ul.domain-change-list").append(i)})}function CheckShowingAreaSelection(n,t){var i=$(n).val(),r="/HighlightPost/GetListHLLocationByCountry?countryName="+i;$.ajax({method:"POST",dataType:"JSON",url:r,success:function(n){var i=$("#"+t+" select[name=location]");n.length>1?(i.multiselect("destroy"),i.empty(),$.each(n,function(n,t){i.append('<option value="'+t.id+'">'+t.text+"<\/option>")}),i.select2({enableFiltering:!0}),$("#"+t).fadeIn()):(i.multiselect("destroy"),i.empty(),$("#"+t).fadeOut())},error:function(){$("#"+t).fadeOut()}})}function RemoveReImage(n,t,i){if(confirm("Are you sure you want to remove this image ?")){var r="/HighlightPost/RemoveRestateImage?imgKey="+n+"&postId="+t;LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:r,success:function(t){var r,u;t.result?(cleanBookNotification.updateSuccess(),$(i).remove(),$(".inputFile_"+n).remove(),r="",r+='<i id="attachment-icon"',u=$("#add_attachment"),u.empty(),t.Object>0?(r+='class="fa fa-paperclip"<\/i>',r+=" Attachments "+t.Object):r+='class="fa fa fa-plus"<\/i>',u.html(r)):cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}}function ShowingSharingHLPostPartialView(n){LoadingOverlay();$("#share-content").empty();$("#share-content").load("/HighlightPost/ShowSharePostPartialView",{sharedPostId:n});$("#share-content").modal("show");LoadingOverlayEnd()}function ChangeHidingStatus(n,t){if(confirm("Are you sure?")){LoadingOverlay();var i={domainKey:n,type:t};$.ajax({method:"POST",dataType:"JSON",url:"/HighlightPost/HideDomainHLPost",data:i,success:function(n){n.result?(cleanBookNotification.updateSuccess(),window.location.reload()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}}var isBusy=!1,previous_shown=!1,$qbiclesFileTypes=[],$ReAttachments=[],$ReAttachmentExisted=[],$ReUpdatedAttachment=[];$(document).ready(function(){$qbiclesFileTypes=[];$.ajax({type:"post",url:"/FileTypes/GetFileTypes",dataType:"json",success:function(n){$qbiclesFileTypes=n},error:function(){}}).always(function(){LoadingOverlayEnd()})});highlightPostAddShow=function(n){var t="/HighlightPost/HighlightAddView?highlightPostId="+n;LoadingOverlay();$("#highlight-add").empty();$("#highlight-add").load(t);$("#highlight-add").modal("show");LoadingOverlayEnd()};DeleteHighlightPost=function(n,t){var r=confirm("Are you sure you want to remove this Highlight?"),i;r&&(i="/HighlightPost/DeleteHighlightPost?highlightPostId="+n,LoadingOverlay(),$.ajax({method:"POST",dataType:"JSON",url:i,success:function(n){n.result?(cleanBookNotification.removeSuccess(),reloadDataTable(t)):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()}))};