function LoadDataSalesSelect(){$("#tb_trader_sales_select").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:""},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/TraderSales/GetDataTableSales",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keyword:$("#search_add_edit_return").val(),workGroupId:0,channel:"",datetime:$("#sale-select-date-range").val(),isApproved:!0})}},columns:[{name:"FullRef",data:"FullRef",orderable:!0},{name:"WorkgroupName",data:"WorkgroupName",orderable:!0},{name:"CreatedDate",data:"CreatedDate",orderable:!0},{name:"SalesChannel",data:"SalesChannel",orderable:!0},{name:"Contact",data:"Contact",orderable:!0},{name:"Dimensions",data:"Dimensions",orderable:!1},{name:"SaleTotal",data:"SaleTotal",orderable:!0},{name:null,data:null,orderable:!1,width:"100px",render:function(n,t,i){return"<a saleId = '"+i.Id+"'  saleRef = '"+i.FullRef+"' workgroup = '"+i.WorkgroupName+"' saleTotal = '"+i.SaleTotal+"'  contact = '"+i.Contact+"' approvedOn = '"+i.ApprovedOn+"'saleOrderId = '"+i.SaleOrderId+"' saleOderRef = '"+i.SaleOderRef+"'                             id='sale-select-id-"+i.Id+"' onclick='SelectSaleNextToItemsTab("+i.Id+', "'+i.Key+"\")' class='btn btn-success'><i class='fa fa-check'><\/i><\/a>"}}],order:[[2,"desc"]]});CallBackDataTableTraderSaleSelect()}function CallBackDataTableTraderSaleSelect(){$("#tb_trader_sales_select").DataTable().ajax.reload()}function SelectSaleNextToItemsTab(n,t){var i,u,r;$saleIdSelected=n;i=$("#sale-select-id-"+n);$(".sale-reference-href").attr("href","/TraderSales/SaleMaster?key="+t);$(".sale-reference-fullref").text(i.attr("saleRef"));$(".sale-reference-workgroup-name").text(i.attr("workgroup"));$(".sale-reference-total").text(i.attr("saleTotal"));$(".sale-reference-customer-name").text(i.attr("contact"));$(".sale-reference-approved-on").text(i.attr("approvedOn"));u=i.attr("saleOrderId");$(".sale-reference-order-href").attr("href","/TraderSales/SaleOrder?id="+u);$(".sale-reference-order-reference-fullref").text(i.attr("saleOderRef"));$.LoadingOverlay("show");r="div-sale-items";$("#"+r).empty();$("#"+r).load("/TraderSalesReturn/TraderSaleSelected2Return?saleKey="+t,function(){var i=$("#table-return-items").DataTable(),t,n;i.clear().draw(!1);ValidationSaveAction();t=parseInt($("#sale-return-id").val());t>0&&($("#sale-return-id").val(0),$("#add-edit-return-title").text("Add a Sale Return"),n=parseInt($("#refedit").text())+1,$("#refedit").text(n),$("#refedit-input").val(n));LoadingOverlayEnd();$("#return-item-tab").trigger("click")})}function BackToSelectItemsTab(){$("#return-item-tab").trigger("click")}function BackToSelectSalesTab(){$("#return-sale-tab").trigger("click")}function NextToConfigureReturnTab(){$("#return-configuration-tab").trigger("click")}var $saleIdSelected,$saleItemsSelected;$(function(){$("#table-return-items").DataTable();$("#table-sale-items").DataTable();$(".sale-item-row-select").bootstrapToggle();$(".sale-item-return-row-select").bootstrapToggle();$("#search_add_edit_return").keyup(delay(function(){CallBackDataTableTraderSaleSelect()},1e3));$(".datetimerangesale").daterangepicker({autoUpdateInput:!0,timePicker:!0,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});$(".datetimerangesale").val("");$(".datetimerangesale").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$(".datetimerangesale").html(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));filter.DateRange=$("#sale-select-date-range").val();CallBackDataTableTraderSaleSelect()});$(".datetimerangesale").on("cancel.daterangepicker",function(){$(this).val(null);filter.DateRange=$("#sale-select-date-range").val();$(".datetimerangesale").html("full history");CallBackDataTableTraderSaleSelect()});$("#trader_sale_return_add_workgroup").select2();LoadDataSalesSelect()});$saleIdSelected=0;SaleItemRowChose=function(n,t){if(!n){RemoveRow(t);return}var r=$("#table-sale-items tbody tr#tr-sale-item-"+t),f=$($(r).find("td.item-row-image input")).val(),e=$($(r).find("td.item-row-name")).text(),o=$($(r).find("td.item-row-unit")).text(),u=$($(r).find("td.item-row-quantity")).text(),s=$($(r).find("td.item-row-price")).text(),h=$("#table-return-items").DataTable(),i=h.row.add(["<div class='table-avatar' style=\"background-image: url('"+f+"\");'>&nbsp;<\/div>","<input class='return-item-id' hidden='' value='0' /><input class='transaction-item-id' hidden='' value='"+t+"' /><span>"+e+"<\/span>",o,"<input type='hidden' value='"+u+"'>"+u,s,"<input maxlength='15' onkeypress='decimalKeyPress(this, event)' onpaste='decimalOnPaste(this, event)' type='text' name='qty1' min='1' max='"+u+"' class='form-control' style='width: 80px;' value='"+u+"'>","<div class='checkbox toggle'><label><input checked class='sale-item-return-row-select-"+t+"' data-toggle='toggle' data-size='small' data-onstyle='success' type='checkbox'><\/label><\/div>","<div class='input-group' style='width: 100%;'><span class='input-group-addon'>"+currencySetting.CurrencySymbol+"<\/span><input value='0' min='0' maxlength='15' onkeypress='decimalKeyPress(this, event)' onpaste='decimalOnPaste(this, event)' type='text' class='form-control'><\/div>","<button onclick='RemoveReturnRow("+t+")' class='btn btn-danger'><i class='fa fa-trash'><\/i><\/button>"]).draw().node();$(i).find("td").eq(1).addClass("return-row-item");$(i).find("td").eq(3).addClass("return-row-sale-quantity");$(i).find("td").eq(5).addClass("return-row-quantity");$(i).find("td").eq(6).addClass("return-row-to-inventory");$(i).find("td").eq(7).addClass("return-row-credit");$(i).attr("id","table-row-return-item-"+t);$(i).attr("class","table-row-return-item-list");$(".sale-item-return-row-select-"+t).bootstrapToggle();ValidationSaveAction()};RemoveReturnRow=function(n){RemoveRow(n);$("#sale-item-transaction-selected-"+n).bootstrapToggle("off")};RemoveRow=function(n){var t=$("#table-row-return-item-"+n);$(t).css("background-color","#FF3700");$(t).fadeOut(500,function(){var t=$("#table-return-items").DataTable();t.row("#table-row-return-item-"+n).remove().draw(!1);ValidationSaveAction()})};ValidationSaveAction=function(){var n=$("#table-return-items tbody tr.table-row-return-item-list");n.length===0?DisableSaveAction():EnableSaveAction()};DisableSaveAction=function(){$("#button-save-draft").hide();$("#button-save-review").hide()};EnableSaveAction=function(){$("#button-save-draft").show();$("#button-save-review").show()};SaveDraftSaleReturn=function(){SaveSaleReturn("Draft")};SaveToReviewSaleReturn=function(){SaveSaleReturn("PendingReview")};$saleItemsSelected=[];SaveSaleReturn=function(n){var r,u,t,h,c;if($.LoadingOverlay("show"),r={Id:$("#trader_sale_return_add_workgroup").val()},r.Id===""||r.Id===null||r.Id==="0"){$('.admintabs a[href="#return-1"]').tab("show");cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles");LoadingOverlayEnd();return}u={Id:$("#reference_id").val(),NumericPart:parseFloat($("#refedit").text()),Type:$("#reference_type").val(),Prefix:$("#reference_prefix").val(),Suffix:$("#reference_suffix").val(),Delimeter:$("#reference_delimeter").val(),FullRef:$("#reference_fullref").val()};$saleIdSelected===0&&($saleIdSelected=$("#sale-reference-id").val());var l={Id:$saleIdSelected},f=[],i=$("#table-return-items tbody tr.table-row-return-item-list");if(i.length>0)for(t=0;t<i.length;t++){var e=$($(i[t]).find("td.return-row-item span")).text(),a=parseInt($($(i[t]).find("td.return-row-item input.return-item-id")).val()),v=parseInt($($(i[t]).find("td.return-row-item input.transaction-item-id")).val()),o=parseFloat($($(i[t]).find("td.return-row-quantity input")).val()),s=parseFloat($($(i[t]).find("td.return-row-credit input")).val()),y=$($(i[t]).find("td.return-row-to-inventory input")).is(":checked"),p=parseFloat($($(i[t]).find("td.return-row-sale-quantity input")).val());if(o>p){cleanBookNotification.error(_L("ERROR_MSG_648",[e]),"Qbicles");LoadingOverlayEnd();return}if(s<0){cleanBookNotification.error(_L("ERROR_MSG_649",[e]),"Qbicles");LoadingOverlayEnd();return}h={Id:a,SaleItem:{Id:v},ReturnQuantity:o,Credit:s,IsReturnedToInventory:y};f.push(h)}c={Id:$("#sale-return-id").val(),Location:{Id:$("#local-manage-select").val()},Reference:u,Workgroup:r,Status:n,Sale:l,ReturnItems:f};$.ajax({type:"post",url:"/TraderSalesReturn/SaveTraderSaleReturn",data:{traderSaleReturn:c},dataType:"json",success:function(n){LoadingOverlayEnd();n.actionVal===1?($("#app-trader-sale-return-add").modal("hide"),cleanBookNotification.createSuccess(),setTimeout(function(){ShowTableSaleReturnValue(!0)},500)):n.actionVal===2?($("#app-trader-sale-return-add").modal("hide"),cleanBookNotification.updateSuccess(),setTimeout(function(){ShowTableSaleReturnValue(!0)},500)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){$.LoadingOverlay("hide");cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})};