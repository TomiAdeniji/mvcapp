function searchOnTableWaste(){var i=[],n,t;if($("#waste-workgroup-filter").val()!==" "&&$("#waste-workgroup-filter").val()!==""&&$("#waste-workgroup-filter").val()!==null&&i.push($("#waste-workgroup-filter").val()),n=$("#search_waste").val().split(" "),$("#search_waste").val()!==""&&$("#search_waste").val()!==null&&n.length>0)for(t=0;t<n.length;t++)n[t]!==""&&i.push(n[t]);$("#waste-list").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#waste-list").val("")}function addWasteReport(n){n||(n=0);var t="/TraderWasteReport/AddEditWasteReport?id="+n;$.LoadingOverlay("show");$("#app-trader-waste-report").empty();$("#app-trader-waste-report").load(t.trim().replace(/\s/g,""),function(){LoadingOverlayEnd()})}function editWasteReport(n){n||(n=0);var t="/TraderWasteReport/AddEditWasteReport?id="+n;$.LoadingOverlay("show");$("#app-trader-waste-report").empty();$("#app-trader-waste-report").load(t.trim().replace(/\s/g,""),function(){LoadingOverlayEnd()})}function WorkGroupSelectedChange(){$workgroupId=$("#transfer-workgroup-select").val();$workgroupId!==""?($.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderTransfers/getworkgroup?id="+$workgroupId,dataType:"json",success:function(n){$(".preview-workgroup").show();changeItemByWorkGroup();LoadingOverlayEnd();n.result?($(".preview-workgroup table tr td.location_name").text(n.Object.Location),$(".preview-workgroup table tr td.workgroup_process").text(n.Object.Process),$(".preview-workgroup table tr td.workgroup_qbicle").text(n.Object.Qbicle),$(".preview-workgroup table tr td.workgroup_member span").text(n.Object.Members)):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""));$("#transfer-workgroup-select-error").remove()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):(LoadingOverlayEnd(),$(".preview-workgroup").attr("style","display: none;"))}function ShowGroupMember(){$("#app-trader-workgroup-preview").empty();$("#app-trader-workgroup-preview").load("/TraderTransfers/ShowListMemberForWorkGroup?wgId="+$workgroupId);$("#app-trader-workgroup-preview").modal("toggle")}function changeItemByWorkGroup(){var n=$("#transfer-workgroup-select").val(),t=$("#local-manage-select").val();ResetWasteItemSelected("tb_form_item","item-select",n,t)}function ValidWasteReport(){var n=!0;return $("#waste_name").val()===""&&(n=!1,$("#form_tabspec").validate().showErrors({waste_name:"Name is required."})),$("#waste_Description").val()===""&&(n=!1,$("#form_tabspec").validate().showErrors({waste_description:"Description is required."})),$("#transfer-workgroup-select").val()===""?(n=!1,$("#form_tabspec").validate().showErrors({workgroup:_L("ERROR_MSG_244")})):$("#transfer-workgroup-select-error").remove(),n}function btnWasteReportNext(){ValidWasteReport()?$('a[href="#waste-tab2"]').tab("show"):setTimeout(function(){$('a[href="#waste-tab1"]').tab("show")},500)}function laodWorkGroup(n){var t=$("#"+n).val(),i;t||(t="0");$("#"+n).select2("destroy");i="/TraderWasteReport/LoadWorkGroup";$("#"+n).empty();$("#"+n).load(i.trim().replace(/\s/g,""),function(){$("#"+n).val(t);$("#"+n).select2()})}function saveWaste(n){var t;if(n=="Draft"&&$("#waste_id").val()>0){cleanBookNotification.createSuccess();return}$.LoadingOverlay("show");var r={Id:$("#waste_id").val(),Name:$("#waste_name").val(),Description:$("#waste_Description").val(),Location:{Id:$("#local-manage-select").val()},ProductList:[],Workgroup:{Id:$("#transfer-workgroup-select").val()},Status:n},i=$("#tb_form_item tbody tr"),u=$("#tb_form_item tbody tr td");if(i.length>0&&u.length>1)for(t=0;t<i.length;t++){var f=$($(i[t]).find("td.td_waste_name input.waste_id")).val(),e={Id:f,Product:{Id:$($(i[t]).find("td.td_waste_sku input.waste_item_id")).val()},CountUnit:{Id:$($(i[t]).find("td.td_waste_unit select")).val()},WasteCountValue:0,SavedInventoryCount:$($(i[t]).find("td.td_waste_invoice span.demo")).text(),Notes:$($(i[t]).find("td.td_waste_note input")).val()},o=$($(i[t]).find("td.td_waste_unit select")).val();if(o==null){cleanBookNotification.error("The units of all items are required!","Qbicles");LoadingOverlayEnd();return}r.ProductList.push(e)}$.ajax({type:"post",url:"/TraderWasteReport/SaveWasteReport",data:{wasteReport:r},dataType:"json",success:function(n){LoadingOverlayEnd();n.actionVal===1||n.actionVal===2?(cleanBookNotification.createSuccess(),$("#app-trader-waste-report").modal("hide"),$("#search_waste").val(""),$("#waste-list").DataTable().ajax.reload(),laodWorkGroup("waste-workgroup-filter")):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function ChangeSelectedUnit(){$("#tb_form_template tbody tr td.td_waste_unit").empty();var n="/Trader/TraderSaleSelectUnit?idLocation="+$("#local-manage-select").val()+"&idTraderItem="+$("#item-select").val().split(":")[0]+"&spotcount=true";$("#tb_form_template tbody tr td.td_waste_unit").load(n,function(){$("#addrowitem").removeClass("disabledTab");$("#addrowitem").prop("disabled",!1)})}function removeWasteItem(n){if($("#waste_id").val()==0){$("#tb_form_item tbody tr.tr_waste_item_"+n).remove();var t=$("#transfer-workgroup-select").val(),i=$("#local-manage-select").val();ResetWasteItemSelected("tb_form_item","item",t,i,!1)}else UpdateWasteReportProduct(n,!0)}function addRowItemWaste(){var n=$("#item-select").val().split(":"),t;$("#tb_form_item").LoadingOverlay("show");t=parseInt(n[4]);$.ajax({type:"post",url:"/Select2Data/GetUnusedInventoryQuantity",data:{inventoryId:t},dataType:"json",success:function(t){var r={Id:n[0],ImageUri:n[1],Name:n[2],SKU:n[3],Level:t},i=$("#tb_form_template tbody tr").clone(),u,f,e;$(i).attr("class","tr_waste_item_"+r.Id);$($(i).find("td.td_waste_name span")).text(r.Name);$($(i).find("td.td_waste_name input")).val(0);$($(i).find("td.td_waste_sku span")).text(r.SKU);$($(i).find("td.td_waste_sku input")).val(r.Id);$($(i).find("td.td_waste_invoice span.demo")).text(r.Level);$($(i).find("td.td_waste_note")).val("");$($(i).find("td.td_waste_note")).attr("onchange","UpdateWasteReportProduct('"+r.Id+"',false)");$($(i).find("td.td_waste_unit select")).not(".multi-select").select2();$($(i).find("td.td_waste_unit select")).attr("onchange","UpdateWasteReportProduct('"+r.Id+"',false)");$($(i).find("td.td_waste_button button")).attr("onclick","removeWasteItem('"+r.Id+"')");u=$("#tb_form_item tbody trtr_waste_item_"+r.Id);u.length===0?$("#tb_form_item tbody").prepend(i):cleanBookNotification.error(_L("ERROR_MSG_373"),"Qbicles");$("#item-select").val("");$("#item-select").select2({placeholder:"Please select"});$("#addrowitem").prop("disabled",!0);f=$("#transfer-workgroup-select").val();e=$("#local-manage-select").val();ResetWasteItemSelected("tb_form_item","item-select",f,e);$("#waste_id").val()>0&&UpdateWasteReportProduct(r.Id,!1)},error:function(){}}).always(function(){$("#tb_form_item").LoadingOverlay("hide",!0)})}function UpdateWasteReportProduct(n,t){if($("#waste_id").val()!=0){$("#tb_form_item").LoadingOverlay("show");var i=$("#tb_form_item tbody tr.tr_waste_item_"+n),r={WasteReport:{Id:$("#waste_id").val()},Id:$($(i).find("td.td_waste_name input.waste_id")).val(),Product:{Id:$($(i).find("td.td_waste_sku input.waste_item_id")).val()},CountUnit:{Id:$($(i).find("td.td_waste_unit select")).val()},WasteCountValue:0,SavedInventoryCount:$($(i).find("td.td_waste_invoice span.demo")).text(),Notes:$($(i).find("td.td_waste_note input")).val()};$.ajax({type:"post",url:"/TraderWasteReport/UpdateWasteReportProduct",data:{wasteItem:r,isDelete:t},dataType:"json",success:function(n){if(n.result==!1){cleanBookNotification.error(n.msg,"Qbicles");return}$("#tb_form_item").DataTable().ajax.reload(null,!1);var t=$("#transfer-workgroup-select").val(),i=$("#local-manage-select").val();ResetWasteItemSelected("tb_form_item","item-select",t,i);$("#waste-list").DataTable().ajax.reload(null,!1)},error:function(){cleanBookNotification.error(err,"Qbicles")}}).always(function(){$("#tb_form_item").LoadingOverlay("hide",!0)})}}function ResetWasteItemSelected(n,t,i,r=0){var u,o;if($("#"+n)&&$("#"+t))if($("#waste_id").val()>0)initSelect2MethodAJAX(t,"/Select2Data/GetWasteReportItemsById?wasteReportId="+$("#waste_id").val()+"&workGroupId="+i+"&locationId="+r);else{var f=$("#"+n+" tbody tr"),s=$("#"+n+" tbody tr td"),e=[];if(f.length>0&&s.length>1)for(u=0;u<f.length;u++)e.push($($(f[u]).find(" td.td_waste_sku input.waste_item_id")).val());o=e.join(",");initSelect2MethodAJAX(t,"/Select2Data/GetSpotCountWasteItemsByWorkgroup?workGroupId="+i+"&locationId="+r+"&itemIds="+o,{},!1)}}function tableWasteReportLoad(){var n=$("#waste-list");$.fn.DataTable.isDataTable("#waste-list")&&n.DataTable().destroy();n.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).dataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,order:[[1,"desc"]],ajax:{url:"/TraderWasteReport/GetByLocationPagination",type:"POST",data:function(n){var t=$("#waste-workgroup-filter").val(),i=$("#waste-status-filter").val();return $.extend({},n,{keyword:$("#search_waste").val(),datetime:$("#waste-datetimerange").val(),workgroups:_.isNull(t)?[-1]:t,status:_.isNull(i)?[-1]:i})}},columns:[{title:"Name",data:"Name",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Created",data:"CreatedBy",searchable:!0,orderable:!0},{title:"Workgroup",data:"WorkgroupName",searchable:!0,orderable:!0},{title:"Items",data:"ItemsCount",searchable:!0,orderable:!1},{title:"Description",data:"Description",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!1,orderable:!0},{title:"Options",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:6,data:"Status",render:function(n){var t="";switch(n){case 1:t='<span class="label label-lg label-primary">Draft<\/span>';break;case 2:t='<span class="label label-lg label-warning">Started<\/span>';break;case 3:t='<span class="label label-lg label-info">Completed<\/span>';break;case 4:t='<span class="label label-lg label-success">Stock Adjusted<\/span>';break;default:t='<span class="label label-lg label-danger">Discarded<\/span>'}return t}},{targets:7,data:"Id",render:function(n,t,i){return i.Status!=1?'<button class="btn btn-primary" onclick="window.location.href=\'/TraderWasteReport/WasteReportMaster?id='+n+'\';"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button>':'<button class="btn btn-info" data-toggle="modal" data-target="#app-trader-waste-report" onclick="editWasteReport('+n+')"><i class="fa fa-pencil"><\/i> &nbsp; Continue<\/button>'}}],initComplete:function(){$("#waste-list").DataTable().ajax.reload()}});$("#waste-table_filter").hide()}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||500)}}$(function(){$("#search_waste").keyup(searchThrottle(function(){$("#waste-list").DataTable().search($(this).val()).draw()}));$("#waste-workgroup-filter,#waste-status-filter").on("change",function(){$("#waste-list").DataTable().ajax.reload()});$("#waste-workgroup-filter,#waste-status-filter").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#waste-datetimerange").daterangepicker({autoUpdateInput:!0,timePicker:!0,cancelClass:"btn-danger",opens:"right",autoUpdateInput:!1,locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});$("#waste-datetimerange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$("#waste-datetimerange").html(t.startDate.format($dateTimeFormatByUser)+" - "+t.endDate.format($dateTimeFormatByUser));$("#waste-list").DataTable().ajax.reload()});$("#waste-datetimerange").on("cancel.daterangepicker",function(){$(this).val(null);$("#waste-datetimerange").html("full history");$("#waste-list").DataTable().ajax.reload()});tableWasteReportLoad()});var filter={Workgroup:" ",Key:""};$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#waste-list").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});