function CallBackFilterDataInventoryServeSide(){$("#tb_inventories").DataTable().ajax.reload()}function GetDataInventories(){var n=[{name:"Icon",data:"Icon",orderable:!1,render:function(n,t,i){return"<div class='table-avatar' style='background-image: url(\""+i.Icon+"\");'><\/div>"}},{name:"Item",data:"Item",orderable:!0},{name:"Description",data:"Description",orderable:!0},{id:"",name:"Unit",data:"Unit",orderable:!0,render:function(n,t,i){return"<span id='row-unit-item-"+i.Id+"'>"+i.Unit+"<\/span>"}},{name:"AverageCost",data:"AverageCost",orderable:!1,render:function(n,t,i){return"<span id='row-average-cost-"+i.Id+"'>"+i.AverageCost+"<\/span>"}},{name:"LatestCost",data:"LatestCost",orderable:!1,render:function(n,t,i){return"<span id='row-latest-cost-"+i.Id+"'>"+i.LatestCost+"<\/span>"}},{name:"CurrentInventory",data:"CurrentInventory",orderable:!1,render:function(n,t,i){return"<span id='row-current-inventory-"+i.Id+"'>"+i.CurrentInventory+"<\/span>"}},{name:"Can reorder",data:"isBought",orderable:!1,render:function(n){return n?"Yes":"No"}},{name:"DaysToLast",data:"DaysToLast",orderable:!1,render:function(n,t,i){return i.DaysToLastHighlighted?"<span id='row-day-to-last-"+i.Id+"' class='label label-danger' data-tooltip='Reorder required' data-tooltip-color='#dd4b39'>"+i.DaysToLast+"<\/span>":"<span id='row-day-to-last-"+i.Id+"'>"+i.DaysToLast+"<\/span>"}},{name:"MinInventory",data:"MinInventory",orderable:!1,render:function(n,t,i){return"<span id='row-min-inventory-"+i.Id+"'>"+i.MinInventory+"<\/span>"}},{name:"MaxInventory",data:"MaxInventory",orderable:!1,render:function(n,t,i){return"<span id='row-max-inventory-"+i.Id+"'>"+i.MaxInventory+"<\/span>"}},{name:"InventoryTotal",data:"InventoryTotal",orderable:!1,render:function(n,t,i){return"<span id='row-inventory-total-"+i.Id+"'>"+i.InventoryTotal+"<\/span>"}},{name:"Associated",data:"Associated",orderable:!1,render:function(n,t,i){return i.Associated==="0 item(s)"?"":"<button onclick='ShowIngredientsItemAssociated("+i.Id+")' class='btn btn-info'><i class='fa fa-cube'><\/i> &nbsp; "+i.Associated+"<\/button>"}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="<div class='btn-group options'><button type='button' class='btn btn-success dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>";return r+="<i class='fa fa-cog'><\/i> &nbsp; Options<\/button><ul class='dropdown-menu dropdown-menu-right' style='right: 0;'>",r+="<li><a href='javascript:' onclick=ShowChangeItemUnits("+i.Id+")>Change display unit<\/a><\/li>",r+="<li><a href='javascript:' onclick='editTraderItem("+i.EditType+", "+i.Id+',"inventory-tab")\'>Edit<\/a><\/li>',r+"<\/ul><\/div>"}}];$("#tb_inventories").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:"",decimal:".",thousands:","},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/TraderInventory/GetInventoryServerSide",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keySearch:$("#inventory_search_text").val(),inventoryBasis:$("#inventory-basis-select").val(),maxDayToLast:$("#max-day-to-last").val(),days2Last:$("#filter_daterange").val(),dayToLastOperator:$("#day-to-last-basis-select").val(),hasSymbol:!1})}},columns:n,columnDefs:[{targets:[0,2],visible:!1}],order:[[1,"asc"]]});CallBackFilterDataInventoryServeSide()}function ShowIngredientsItemAssociated(n){var t="/TraderInventory/ShowIngredientsItemAssociated?itemId="+n;AjaxElementShowModal(t,"associated-items-view")}function ShowChangeItemUnits(n){var t="/TraderInventory/ShowChangeItemUnits?itemId="+n;AjaxElementShowModal(t,"app-trader-change-unit")}function UpdateItemUnit(n){$.LoadingOverlay("show");$.ajax({type:"get",url:"/TraderInventory/UpdateChangeItemUnit",data:{unitId:$("#display-unit-change").val(),itemId:n,inventoryBasis:$("#inventory-basis-select").val(),maxDayToLast:$("#max-day-to-last").val(),days2Last:$("#filter_daterange").val(),dayToLastOperator:$("#day-to-last-basis-select").val(),hasSymbol:!1},dataType:"json",success:function(n){if(n.result){var t=n.Object.Id;$("#row-unit-item-"+t).text(n.Object.Unit);$("#row-average-cost-"+t).text(n.Object.AverageCost);$("#row-latest-cost-"+t).text(n.Object.LatestCost);$("#row-current-inventory-"+t).text(n.Object.CurrentInventory);$("#row-day-to-last-"+t).text(n.Object.DaysToLast);$("#row-min-inventory-"+t).text(n.Object.MinInventory);$("#row-max-inventory-"+t).text(n.Object.MaxInventory);$("#row-inventory-total-"+t).text(n.Object.InventoryTotal);$("#app-trader-change-unit").modal("hide");cleanBookNotification.updateSuccess()}else{cleanBookNotification.error("Have an error, detail: "+n.msg,"Qbicles");return}},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function InitTableReorder(){var n=$("#tblReorders");n.dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,autoWidth:!0,pageLength:10,order:[[1,"desc"]],ajax:{url:"/TraderInventory/SearchReorders",data:function(n){return $.extend({},n,{keyword:$("#txtSearchReorder").val(),status:$("#slReorderStatus").val(),daterange:$("#txtReorderDateRanger").val()})}},columns:[{title:"Reference",data:"Reference",searchable:!0,orderable:!0},{title:"Date",data:"Date",searchable:!0,orderable:!0},{title:"Items",data:"Items",searchable:!0,orderable:!1},{data:"Total",searchable:!0,orderable:!0},{title:"Status",data:"Status",searchable:!0,orderable:!0},{title:"",data:"Id",searchable:!1,orderable:!1}],columnDefs:[{targets:2,data:"Items",render:function(n,t,i){return'<button class="btn btn-info" onclick="ShowReorderItems('+i.Id+",'"+i.Reference+'\')"><i class="fa fa-cube"><\/i> &nbsp; '+n+"<\/button>"}},{targets:3,data:"Total",render:function(n){return toCurrencySymbol(n,!1)}},{targets:4,data:"Status",render:function(n){var t='<span class="label label-lg label-primary">Incomplete<\/span>';return n==1&&(t='<span class="label label-lg label-success">Complete<\/span>'),t}},{targets:5,data:"Id",render:function(n,t,i){var r="";return i.Status==0&&(r='<button class="btn btn-info" onclick="window.location.href=\'/Trader/TraderReorder?id='+n+'\';"><i class="fa fa-pencil"><\/i> &nbsp; Continue<\/button>'),r}},]})}function InitReorderSearch(){$("#txtSearchReorder").keyup(delay(function(){$("#tblReorders").DataTable().ajax.reload()},700));$("#slReorderStatus").change(delay(function(){$("#tblReorders").DataTable().ajax.reload()},700));var n=$dateFormatByUser.toUpperCase();$("#txtReorderDateRanger").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:n}});$("#txtReorderDateRanger").on("apply.daterangepicker",function(t,i){$(this).val(i.startDate.format(n)+" - "+i.endDate.format(n));$("#tblReorders").DataTable().ajax.reload()});$("#txtReorderDateRanger").on("cancel.daterangepicker",function(){$(this).val(null)})}function ShowReorderItems(n){n>0&&($("#reorder-breakdown").load("/TraderInventory/ReorderBreakdown",{reorderid:n},function(){$("#reorder-breakdown .select2").select2({placeholder:"Please select"});$("#txtsearchbreakdown").keyup(delay(function(){$("#tblReorderitems").DataTable().search(this.value).draw()},200));$("#slprimarycontactbreakdown").change(delay(function(){var n=$("#slprimarycontactbreakdown option:selected").text();$("#tblReorderitems").DataTable().search(n=="Show all"?"":n).draw()},200))}),$("#reorder-breakdown").modal("show"))}function ConfirmReorderProcess(){var n={keySearch:$("#inventory_search_text").val(),inventoryBasis:$("#inventory-basis-select").val(),maxDayToLast:$("#max-day-to-last").val(),days2Last:$("#filter_daterange").val(),dayToLastOperator:$("#day-to-last-basis-select").val()};parseInt(n.maxDayToLast)==1?$("#maxdayshow").text("1 day"):$("#maxdayshow").text(n.maxDayToLast+" days");$.get("/TraderInventory/CountReorderItems",n).done(function(n){n&&$("#countReorderItems").text(n)});$("#app-trader-inventory-reorder").modal("show")}function AgreeReorderProcess(){var n={keySearch:$("#inventory_search_text").val(),inventoryBasis:$("#inventory-basis-select").val(),maxDayToLast:$("#max-day-to-last").val(),days2Last:$("#filter_daterange").val(),dayToLastOperator:$("#day-to-last-basis-select").val()};$.LoadingOverlay("show");$.post("/TraderInventory/TriggeringReorderProcess",n,function(n){n.result?window.location.href="/Trader/TraderReorder?id="+n.Object.id:cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()})}function GetDefaultInventoryTab(){var n="sub-inventory-tab";getLocalStorage(n)&&(activeSubTab=getLocalStorage(n));$('a[href="#'+activeSubTab+'"]').tab("show")}function SaveInventoryTab(n){setLocalStorage("sub-inventory-tab",n)}$(function(){var n=$dateFormatByUser.toUpperCase();$(".inventory-select2").select2();$("#filter_daterange").daterangepicker({autoUpdateInput:!0,timePicker:!0,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:n}});$("#filter_daterange").val("");$("#filter_daterange").on("apply.daterangepicker",function(t,i){$(this).val(i.startDate.format(n)+" - "+i.endDate.format(n));$("#filter_daterange").html(i.startDate.format(n)+" - "+i.endDate.format(n));CallBackFilterDataInventoryServeSide()});$("#filter_daterange").on("cancel.daterangepicker",function(){$(this).val(null);$("#filter_daterange").html("full history")});$("#inventory-basis-select,#max-day-to-last").on("change",function(){CallBackFilterDataInventoryServeSide()});$("#day-to-last-basis-select").on("change",function(){$("#day-to-last-basis-select").val()==="3"?$("#div-filter-by-date-range").show():($("#div-filter-by-date-range").hide(),$(".datetimerange").val(""),CallBackFilterDataInventoryServeSide())});$("#inventory_search_text").keyup(delay(function(){($("#inventory_search_text").val().length===0||$("#inventory_search_text").val().length>=3)&&CallBackFilterDataInventoryServeSide()},1e3));$('.manage-inventory-columns input[type="checkbox"]').on("change",function(){var t=$("#tb_inventories").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});GetDefaultInventoryTab();GetDataInventories();InitReorderSearch();InitTableReorder()});