function initAlertSettingPage(){FilterMovementDataTable();FilterMovementAlertSettings();$("#alert-settings-daterange").daterangepicker({autoUpdateInput:!1,timePicker:!0,timePicker24Hour:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser}});$("#alert-setting_status").select2();$("#key-search-alert-setting").keyup(delay(function(){$("#alert-settings_table").DataTable().ajax.reload()},1e3));$("#alert-setting_status").change(function(){$("#alert-settings_table").DataTable().ajax.reload()})}function FilterMovementAlertSettings(){$("#alert-settings_table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$("#alert-settings_table").LoadingOverlay("show",{minSize:"70x60px"}):$("#alert-settings_table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,bDestroy:!0,language:{infoFiltered:""},serverSide:!0,info:!0,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],ajax:{url:"/TraderMovement/GetListMovementAlertSettings",type:"GET",dataType:"json",data:function(n){return $.extend({},n,{key:$("#key-search-alert-setting").val(),dateRange:$("#alert-settings-daterange").val(),statusShown:$("#alert-setting_status").val()})}},columns:[{data:"Reference",name:"Reference",orderable:!0,visible:!0},{data:"Date",name:"Date",orderable:!0,visible:!0},{data:"NoMvnAlert",name:"NoMvnAlert",orderable:!0,visible:!0,render:function(n,t,i){return""+(i.NoMvnAlert?"<td><span class='label label-lg label-success'>Enabled<\/span><\/td>":'<td><span class="label label-lg label-danger">Disabled<\/span><\/td>')}},{data:"MinMaxAlert",name:"Min/max alerts",orderable:!0,visible:!0,render:function(n,t,i){return""+(i.MinMaxAlert?"<td><span class='label label-lg label-success'>Enabled<\/span><\/td>":'<td><span class="label label-lg label-danger">Disabled<\/span><\/td>')}},{data:"AccumulationAlert",name:"Accumulation alerts",orderable:!0,visible:!0,render:function(n,t,i){return""+(i.AccumulationAlert?"<td><span class='label label-lg label-success'>Enabled<\/span><\/td>":'<td><span class="label label-lg label-danger">Disabled<\/span><\/td>')}},{name:"Options",orderable:!1,visible:!0,render:function(n,t,i){return""+("<button class='btn btn-warning' onclick=window.location.href='/TraderMovement/TraderMovementSetting?alertGroupId="+i.alertGroupId+"';><i class='fa fa-pencil'><\/i><\/button>")}}],columnDefs:[{targets:[0,2],visible:!1}],order:[[1,"desc"]]})}function FilterMovementDataTable(){var n="/Trader/ListItemInventoryBatch?locationId="+$("#local-manage-select").val()+"&callback=true&datestring="+($("#movement_daterange").val()+"").trim().replace(/\s/g,"");$("#movement-table").LoadingOverlay("show");$(".table-movement").removeClass("manage-columns");$("#movement-table").empty();$("#movement-table").load(n,function(){$('.table-movement input[type="checkbox"]').on("change",function(){var t=$("#movement_table").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$(".table-movement").addClass("manage-columns");$("#movement-table").LoadingOverlay("hide");$("#movement_table").DataTable().draw()})}function SetProductGroups(n){var t,i;($("#applyc").attr("disabled","disabled"),n!=0)&&(t=$("#product-groups").val(),$("#ProductEmpty-error").remove(),t==null?$("#productgroups-selector").append("<label id='ProductEmpty-error' class='error' for='ProductGroups'>No Product Groups selected.<\/label>"):(LoadingOverlay(),i="/TraderMovement/SetAlertProductGroups",$.ajax({method:"POST",dataType:"JSON",url:i,data:{alertGroupId:n,lstProductGroupIds:t},success:function(n){n.result?(cleanBookNotification.updateSuccess(),window.location="/TraderMovement/TraderMovementSetting?alertGroupId="+n.Object):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()})))}function ConfirmProductGroups(n){var t=$("#product-groups").val(),i;$("#PosDevices-error").remove();t==null?$("#productgroups-selector").append("<label id='PosDevices-error' class='error' for='PosDevices'>No Product Groups selected.<\/label>"):(LoadingOverlay(),i="/TraderMovement/SetAlertProductGroups",$.ajax({method:"POST",dataType:"JSON",url:i,data:{alertGroupId:n,lstProductGroupIds:t},success:function(n){n.result?(cleanBookNotification.updateSuccess(),setTimeout(function(){window.location.href="/TraderMovement/TraderMovementSetting?alertGroupId="+n.msgId},3e3)):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){LoadingOverlayEnd()}))}function GenerateNoMovementThresholds(n){var t=$("#nomovement-daterange").val(),i;if($("#nomvnt-daterange-error").remove(),t==""){$("#nomovement-inputcontainer").append("<label id='nomvnt-daterange-error' class='error' for='NoMovementAlert'>The daterange must be selected first.<\/label>");return}$(".no-movement-alerts").LoadingOverlay("show");i="/TraderMovement/SetNoMovementThresholds?alertGroupId="+n;$.ajax({method:"POST",dataType:"JSON",url:i,data:{daterangeString:t},success:function(n){n.result?(cleanBookNotification.updateSuccess(),ReloadActiveProductGroup()):(cleanBookNotification.error(n.msg,"Qbicles"),ReloadActiveProductGroup())},error:function(n){cleanBookNotification.error(n.msg)}}).always(function(){$(".no-movement-alerts").LoadingOverlay("hide",!0)})}function GenerateMinMaxThresholds(n){var t=$("#minmax-daterange").val(),i;if($("#minmax-daterange-error").remove(),t==""){$("#minmax-inputcontainer").append("<label id='minmax-daterange-error' class='error' for='MinMaxAlert'>The daterange must be selected first.<\/label>");return}$(".inventory-min-max-alerts").LoadingOverlay("show");i="/TraderMovement/SetMinMaxThresholds";$.ajax({method:"POST",dataType:"JSON",url:i,data:{alertGroupId:n,daterangeString:t},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$(".inventory-min-max-alerts").LoadingOverlay("hide",!0)});ReloadActiveProductGroup()}function GenerateAccumulationThresholds(n){var t=$("#accumulation-daterange").val(),i,r;if($("#accumulation-daterange-error").remove(),t==""){$("#accumulation-inputcontainer").append("<label id='accumulation-daterange-error' class='error' for='AccumulationAlert'>The daterange must be selected first.<\/label>");return}i=$("#accumulation_check-event").val();r="/TraderMovement/SetAccumulationThresholds";$(".inventory-accumulation-alerts").LoadingOverlay("show");$.ajax({method:"POST",dataType:"JSON",url:r,data:{alertGroupId:n,daterangeString:t,checkPeriod:i},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(n.msg)},error:function(n){cleanBookNotification.error(n.msg)}}).always(function(){$(".inventory-accumulation-alerts").LoadingOverlay("hide",!0)});ReloadActiveProductGroup()}function EnableNoMovementCheckJob(n,t,i){$(".no-movement-alerts").LoadingOverlay("show");var r="/TraderMovement/EnableNoMovementJob?alertGroupId="+n,u=$("#no-movement_check-event").val();$.ajax({method:"POST",dataType:"JSON",url:r,data:{checkPeriod:u},success:function(t){t.result?($(i).toggleClass("btn-success btn-danger"),$(i).html()=="Disable"?$(i).html("Enable"):$(i).html("Disable"),$(i).attr("onclick","DisableScheduleJob("+n+", "+t.Object+", 'noMovement', this)"),cleanBookNotification.success("Enable Thresholds checking job successfully.","Qbicles")):cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$(".no-movement-alerts").LoadingOverlay("hide",!0)})}function EnableMinMaxCheckJob(n,t,i){$(".inventory-min-max-alerts").LoadingOverlay("show");var r="/TraderMovement/EnableMinMaxJob?alertGroupId="+n,u=$("#minmax_check-event").val();$.ajax({method:"POST",dataType:"JSON",url:r,data:{checkPeriod:u},success:function(t){t.result?($(i).toggleClass("btn-success btn-danger"),$(i).html()=="Disable"?$(i).html("Enable"):$(i).html("Disable"),$(i).attr("onclick","DisableScheduleJob("+n+", "+t.Object+", 'minMax', this)"),cleanBookNotification.success("Enable Thresholds checking job successfully.","Qbicles")):cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$(".inventory-min-max-alerts").LoadingOverlay("hide",!0)})}function EnableAccumulationJob(n,t,i){var r="/TraderMovement/EnableAccumulationJob?alertGroupId="+n,u=$("#accumulation_check-event").val();$(".inventory-accumulation-alerts").LoadingOverlay("show");$.ajax({method:"POST",dataType:"JSON",url:r,data:{checkPeriod:u},success:function(t){t.result?($(i).toggleClass("btn-success btn-danger"),$(i).html()=="Disable"?$(i).html("Enable"):$(i).html("Disable"),$(i).attr("onclick","DisableScheduleJob("+n+", "+t.Object+", 'accumulation', this)"),cleanBookNotification.success("Enable Thresholds checking job successfully.","Qbicles")):cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$(".inventory-accumulation-alerts").LoadingOverlay("hide",!0)})}function DisableScheduleJob(n,t,i,r){i=="noMovement"&&$(".no-movement-alerts").LoadingOverlay("show");i=="minMax"&&$(".inventory-min-max-alerts").LoadingOverlay("show");i=="accumulation"&&$(".inventory-accumulation-alerts").LoadingOverlay("show");var u="/TraderMovement/DisableScheduleJob?alertConstraintId="+t;$.ajax({method:"POST",dataType:"JSON",url:u,success:function(u){u.result?($(r).toggleClass("btn-success btn-danger"),console.log($(r).html()),$(r).html()=="Disable"?$(r).html("Enable"):$(r).html("Disable"),i=="noMovement"?$(r).attr("onclick","EnableNoMovementCheckJob("+n+", "+t+", this)"):i=="minMax"?$(r).attr("onclick","EnableMinMaxCheckJob("+n+", "+t+", this)"):i=="accumulation"&&$(r).attr("onclick","EnableAccumulationJob("+n+", "+t+", this)"),cleanBookNotification.success("Disable Thresholds checking job successfully.","Qbicles")):cleanBookNotification.error(u.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){i=="noMovement"&&$(".no-movement-alerts").LoadingOverlay("hide",!0);i=="minMax"&&$(".inventory-min-max-alerts").LoadingOverlay("hide",!0);i=="accumulation"&&$(".inventory-accumulation-alerts").LoadingOverlay("hide",!0)})}function ShowProductGroupItems(n){var t="/TraderMovement/ProductGroupItemsShow?productGroupId="+n;$("#productgroup-items").empty();$("#productgroup-items").load(t)}function ReloadActiveProductGroup(){$("#product-group-list .active a").trigger("click")}function UpdateItemAlertGroup(n){$("#productgroup-items").LoadingOverlay("show");var t={id:n,NoMovementInDaysThreshold:$("#NoMovementInDaysThreshold-"+n).val(),NoMovementOutDaysThreshold:$("#NoMovementOutDaysThreshold-"+n).val(),MinInventoryThreshold:$("#MinInventoryThreshold-"+n).val(),MaxInventoryThreshold:$("#MaxInventoryThreshold-"+n).val(),AccumulationTreshold:$("#AccumulationTreshold-"+n).val()};$.ajax({method:"POST",dataType:"JSON",url:"/TraderMovement/UpdateItemAlertGroup",data:{item:t},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#productgroup-items").LoadingOverlay("hide",!0)})}