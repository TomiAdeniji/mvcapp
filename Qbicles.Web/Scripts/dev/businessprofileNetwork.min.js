function changeavatar(n){var t=document.getElementById("commerce-logo").files,i=$("#commerce-logo-object-key").val();i?saveProfileB2B():t&&t.length>0&&UploadMediaS3ClientSide("commerce-logo").then(function(t){if(t.objectKey==="no_image"||t.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}LoadingOverlayEnd();var i=$("#api-uri").val();$("#commerce-logo-object-key").val(t.objectKey);$(n).css("background-image","url('"+i+t.objectKey+"&size=T')");saveProfileB2B()})}function initNavClick(){$("ul.nav-stacked li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#b2b-profile-1":reloadPosts(!0,tabs.isprofile1load);tabs.isprofile1load=!0;break;case"#b2b-profile-2":reloadPosts(!1,tabs.isprofile2load);tabs.isprofile2load=!0;break;case"#trading-general":$('a[href="#general-locations"]').trigger("click");break;case"#trading-items":loadTabContent(n,tabs.istradingitemsload);tabs.istradingitemsload=!0;break;case"#trading-pricing":loadTabContent(n,tabs.istradingpricingload);tabs.istradingpricingload=!0;break;case"#trading-menus":loadTabContent(n,tabs.istradingmenuload);tabs.istradingmenuload=!0;break;case"#logistics-general":initPluginsOfTabGarenal(tabs.islogisticsgeneral);tabs.islogisticsgeneral=!0;break;case"#logistics-charges":getLocationsDomain($("#logistics-charges select[name=locations]"),tabs.islogisticscharges);loadContentPriceList();initFormClonePriceList(tabs.islogisticscharges);tabs.islogisticscharges=!0;break;case"#logistics-vehicles":initPluginsOfTabVehicles(tabs.islogisticsvehicles);tabs.islogisticsvehicles=!0;break;case"#logistics-drivers":getLocationsDomain($("#logistics-drivers select[name=locations]"),tabs.islogisticsdrivers);initPluginsOfTabDrivers(tabs.islogisticsdrivers);tabs.islogisticsdrivers=!0;break;case"#trading-menus-distribution":loadTabContent(n,tabs.iscatalogdimenstionload);tabs.iscatalogdimenstionload=!0}},200)});$("ul.trading-general-tabs li a").click(function(){var n=$(this).attr("href");setTimeout(function(){var i=window.location.protocol+"//"+window.location.host+window.location.pathname,r=n.replace("#",""),t=i+"?tab="+r;window.history.pushState({path:t},"",t);switch(n){case"#general-locations":loadTabContent(n,tradinggeneraltabs.istablocationsload);tradinggeneraltabs.istablocationsload=!0;break;case"#general-workgroups":loadTabContent(n,tradinggeneraltabs.istabworkgroupsload);tradinggeneraltabs.istabworkgroupsload=!0;break;case"#general-candb":loadTabContent(n,tradinggeneraltabs.istabcandbload);tradinggeneraltabs.istabcandbload=!0;break;case"#general-currency":loadTabContent(n,tradinggeneraltabs.istabcurrencyload);tradinggeneraltabs.istabcurrencyload=!0;break;case"#general-groups":loadTabContent(n,tradinggeneraltabs.istabgroupsload);tradinggeneraltabs.istabgroupsload=!0;break;case"#general-b2b":loadTabContent(n,tradinggeneraltabs.istabb2bload);tradinggeneraltabs.istabb2bload=!0;break;case"#general-b2c":loadTabContent(n,tradinggeneraltabs.istabb2cload);tradinggeneraltabs.istabb2cload=!0;break;case"#general-pos":loadTabContent(n,tradinggeneraltabs.istabposload);tradinggeneraltabs.istabposload=!0;break;case"#general-storefront":loadTabContent(n,tradinggeneraltabs.istabstorefrontload);tradinggeneraltabs.istabstorefrontload=!0;break;default:loadTabContent(n,tradinggeneraltabs.istabcontactsload);tradinggeneraltabs.istabcontactsload=!0}},200)});$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#profile-managers input[name=search]").keyup(delay(function(){$("#tblManagers").DataTable().search($(this).val()).draw()},500));$("#profile-managers select[name=filtermanagers]").change(function(){var n=$("#profile-managers select[name=filtermanagers] option:selected").text();n=n!="Show all"?n:"";$("#tblManagers").DataTable().search(n).draw()});$("#tblManagers_filter").hide();$("#itemtype a").bind("click",function(n){n.preventDefault();$(".wizard-start").hide();$("#productorservice li").removeClass("active");$(".theformtype").hide();$("#itemtype li").removeClass("active");$(this).closest("li").addClass("active");var t=$(this).data("value");$("#sltype").val(t);t!="icompound"?$("#prodorserv").fadeIn():$("#prodorserv").hide();t=="icompound"&&$(".wizard-start").show()});$("#productorservice a").bind("click",function(n){n.preventDefault();$("#productorservice li").removeClass("active");$(this).closest("li").addClass("active");var t=$(this).data("value");$("#chkIsProduct").prop("checked",t=="service"?!1:!0);$(".wizard-start").show()})}function initNavSubgroupsClick(){$("ul.nav-subgroups li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#tab-groups-items":loadTabContent(n,tradinggrouptabs.istabgroupsitemsload);tradinggrouptabs.istabgroupsitemsload=!0;break;default:loadTabContent(n,tradinggrouptabs.istabgroupscontactsload);tradinggrouptabs.istabgroupscontactsload=!0}},200)})}function saveProfileB2B(){var n=new FormData($("#frmB2BProfile")[0]);$.ajax({type:"post",cache:!1,url:"/Commerce/SaveProfileB2B",enctype:"multipart/form-data",processData:!1,contentType:!1,dataType:"json",data:n,beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Commerce"),$("#commerce-logo-object-key").val(""),$("#hdfProfileId").val(returnJson.Object),$("div.social-links input, select[name=tags]").removeAttr("disabled")):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")}})}function initFormPost(){var n=$("#frmCommerePost");n.validate({ignore:"",rules:{Title:{required:!0,maxlength:150},Content:{required:!0,maxlength:500}}});n.submit(function(t){if((t.preventDefault(),!isBusy)&&n.valid()){$.LoadingOverlay("show");var i=document.getElementById("commerce-post-feature").files;i.length>0?UploadMediaS3ClientSide("commerce-post-feature").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#commerce-post-feature-object-key").val(n.objectKey);SavePostB2B()}):($("#commerce-post-feature-object-key").val(""),SavePostB2B())}});$("#txtFilterFeaturedSearch").keyup(delay(function(){reloadPosts(!0)},800));$("#txtFilterOtherSearch").keyup(delay(function(){reloadPosts(!1)}));$("#frmB2BProfile input,#frmB2BProfile textarea").change(function(){$("#btnConfigCancel").attr("disabled",!1)})}function SavePostB2B(){var n=new FormData($("#frmCommerePost")[0]);n.append("ProfileId",$("#frmB2BProfile input[name=Id]").val());$.ajax({type:"post",cache:!1,url:"/Commerce/SavePostB2B",enctype:"multipart/form-data",processData:!1,contentType:!1,dataType:"json",data:n,beforeSend:function(){isBusy=!0},success:function(n){isBusy=!1;n.result?($("#app-commerce-post-add").modal("hide"),reloadPosts($("#hdfIsFeatured").val()=="true"?!0:!1),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Commerce")):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce");LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")}})}function addArea(){var n='<tr class="add-area animated flipInY">';n+='<td><input type="text" name="AreasOfOperation[]" maxlength="150" class="form-control" value="" placeholder="e.g. London" style="width: 100%;"><\/td>';n+='<td><button type="button" class="btn btn-danger" onclick="$(this).parent().parent().hide();"><i class="fa fa-trash"><\/i><\/button><\/td>';n+="<\/tr>";$("#tblAreas tbody").append(n)}function initModalPost(n,t){$("#frmCommerePost").validate().resetForm();$("#hdfPostId").val(0);$("#hdfIsFeatured").val(t?"true":"false");$("#frmCommerePost input[name=Title]").val("");$("#frmCommerePost textarea[name=Content]").val("");$("#frmCommerePost input[name=FeaturedImage]").val("");n&&n>0&&$.get("/Commerce/GetPostById",{id:n}).done(function(n){if(n.result){var t=n.Object;$("#frmCommerePost input[name=Title]").val(t.Title);$("#frmCommerePost textarea[name=Content]").val(t.Content);$("#hdfPostId").val(t.Id)}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")});n&&n>0&&t?$("#app-commerce-post-add h5.modal-title").text("Edit Featured Post"):n&&n>0&&!t?$("#app-commerce-post-add h5.modal-title").text("Edit Profile Post"):!n&&t?$("#app-commerce-post-add h5.modal-title").text("Add a Featured Post"):$("#app-commerce-post-add h5.modal-title").text("Add a Profile Post");$("#app-commerce-post-add").modal("show")}function reloadPosts(n,t){if(!t){var i={profileId:$("#frmB2BProfile input[name=Id]").val(),search:"",isfeatured:n};n?(i.search=$("#txtFilterFeaturedSearch").val(),setTimeout(function(){var n=$(".featured-posts");n.LoadingOverlay("show");n.load("/Commerce/LoadPostsContent",i,function(){n.LoadingOverlay("hide")})},100)):(i.search=$("#txtFilterOtherSearch").val(),setTimeout(function(){var n=$("#b2b-profile-2 .from-community");n.LoadingOverlay("show");n.load("/Commerce/LoadPostsContent",i,function(){n.LoadingOverlay("hide")})},100))}}function deletePost(n,t){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Commerce",message:_L("ERROR_MSG_708"),callback:function(i){if(i){$.post("/Commerce/DeletePostById",{id:n},function(n){n.result?reloadPosts(t):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")});return}}})}function showIconProfileManager(){setTimeout(function(){var n=$("input[name=IsDisplayedInB2BListings]").prop("checked"),t=$("input[name=IsDisplayedInB2CListings]").prop("checked");n||t?$(".managers").show():$(".managers").hide();n?$(".cell-b2b-action button").prop("disabled",!1):$(".cell-b2b-action button").prop("disabled",!0);t?$(".cell-b2c-action button").prop("disabled",!1):$(".cell-b2c-action button").prop("disabled",!0)},200)}function showModalManagers(n,t,i){var u=i?"Edit":"Add",r=$("#bprofile-add-managers select[name=managers]"),f=$(".btn-profileaction");n=="B2B"?($(".modalprofile-type-text").text(n),$("#bprofile-add-managers .modal-title").text(u+" B2B default relationship managers"),r.attr("onchange","bindManagersBusinessProfile('B2B',this)"),f.attr("onclick","updateDefaultManagers('B2B',"+t+")")):($(".modalprofile-type-text").text(n),$("#bprofile-add-managers .modal-title").text(u+" B2C default relationship managers"),r.attr("onchange","bindManagersBusinessProfile('B2C',this)"),f.attr("onclick","updateDefaultManagers('B2C',"+t+")"));t>0?$.get("/Commerce/LoadDefaultManagers?profileId="+t,function(t){n=="B2B"?r.val(t.defaultb2bmanagers):r.val(t.defaultb2cmanagers);r.multiselect("refresh")}):(r.val([]),r.multiselect("refresh"))}function updateDefaultManagers(n,t){var i=$("select[name=UserIdB2BRelationshipManagers]").val(),r=$("select[name=UserIdB2CRelationshipManagers]").val(),u=$("input[name=IsDisplayedInB2BListings]").prop("checked"),f=$("input[name=IsDisplayedInB2CListings]").prop("checked"),e={Id:t,IsDisplayedInB2BListings:u,IsDisplayedInB2CListings:f,UserIdB2BRelationshipManagers:i?i:[],UserIdB2CRelationshipManagers:r?r:[]};t>0?($.LoadingOverlay("show"),$.post("/Commerce/UpdateDefaultManagers",e,function(i){var r,u;LoadingOverlayEnd();i.result?($(".managers").hide(),n=="B2B"?(r=htmlManagersTemplate(i.Object.defaultb2bmanagers),$(".cell-b2b-defaultmanagers").html(r),u='<button class="btn btn-warning" onclick="showModalManagers(\'B2B\','+t+',true)" data-toggle="modal" data-target="#bprofile-add-managers"><i class="fa fa-pencil"><\/i><\/button>',$(".cell-b2b-action").html(u)):(r=htmlManagersTemplate(i.Object.defaultb2cmanagers),$(".cell-b2c-defaultmanagers").html(r),u='<button class="btn btn-warning" onclick="showModalManagers(\'B2C\','+t+',true)" data-toggle="modal" data-target="#bprofile-add-managers"><i class="fa fa-pencil"><\/i><\/button>',$(".cell-b2c-action").html(u))):!data.result&&data.msg?cleanBookNotification.error(_L(data.msg),"Commerce"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Commerce")})):($(".managers").hide(),cleanBookNotification.warning(_L("WARNING_MSG_SAVEBUSINESSPROFILE"),"Commerce"));$("#bprofile-add-managers").modal("hide")}function htmlManagersTemplate(n){var t="None assigned yet.";return n.length>0&&(t='<ul style="padding-left: 15px;">',$.each(n,function(n,i){t+="<li>"+i+"<\/li>"}),t+="<\/ul>"),t}function bindManagersBusinessProfile(n,t){var i=$(t).val();n=="B2B"?$("select[name=UserIdB2BRelationshipManagers]").val(i):$("select[name=UserIdB2CRelationshipManagers]").val(i)}function loadTabContent(n,t){if(!t){n=n.replace("#","");var i;switch(n){case"general-locations":i=$("#general-locations .general-dynamiccontent");break;case"tab-groups-items":i=$("#tab-groups-items .groups-items-dynamiccontent");break;case"tab-groups-contacts":i=$("#tab-groups-contacts .groups-contacts-dynamiccontent");break;default:i=$("#"+n)}i.empty();n!="general-candb"&&i.LoadingOverlay("show");i.load("/Commerce/LoadBusinessProfileTab",{tab:n},function(){i.LoadingOverlay("hide");overrideFunctions(n);$(".dataTables_filter").hide();html5tooltips.refresh()})}}function overrideFunctions(n){var i,t;switch(n){case"general-locations":reloadLocation=function(){tradinggeneraltabs.istablocationsload=!1;$('a[href="#general-locations"]').trigger("click")};$("#general-locations input[name=search]").keyup(delay(function(){$("#tbllocations").DataTable().search($(this).val()).draw()},500));$("#general-locations select[name=type]").change(function(){var n=$("#general-locations select[name=type]").val();switch(n){case"1":n="check";break;case"2":n="none";break;default:n=""}$("#tbllocations").DataTable().search(n).draw()});break;case"general-workgroups":moveModalIntoBody("#"+n+" .gp-modal-content");ReloadWorkgroup=function(){var n=$(".tbl-wg-content");n.empty();n.LoadingOverlay("show");n.load("/Commerce/LoadBusinessProfileTab",{tab:"general-workgroups",reload:!0},function(){$("#wg-table").DataTable({destroy:!0,responsive:!0,pageLength:10});n.LoadingOverlay("hide")})};$("#general-workgroups input[name=search]").keyup(delay(function(){$("#wg-table").DataTable().search($(this).val()).draw()},500));$("#processes-filter").change(function(){var t=$("#processes-filter option:selected"),n=[];$(t).each(function(){n.push([$(this).text()])});$("#wg-table").DataTable().search(n.join("|"),!0,!1,!0).draw()});break;case"general-currency":initCurrency();reloadAccounting=function(){var n=$(".tbl-taxrates-content");n.empty();n.LoadingOverlay("show");n.load("/Commerce/LoadBusinessProfileTab",{tab:"general-currency",reload:!0},function(){$("#tblTaxrates").DataTable({destroy:!0,responsive:!0,pageLength:10});n.LoadingOverlay("hide")})};$("#general-currency input[name=search]").keyup(delay(function(){$("#tblTaxrates").DataTable().search($(this).val()).draw()},500));$("#general-currency select[name=transactiontype]").change(function(){var t=$("#general-currency select[name=transactiontype] option:selected"),n=[];$(t).each(function(){n.push([$(this).text()])});$("#tblTaxrates").DataTable().search(n.join("|"),!0,!1,!0).draw()});$("#general-currency select[name=type]").change(function(){var t=$("#general-currency select[name=type] option:selected"),n=[];$(t).each(function(){n.push([$(this).text()])});$("#tblTaxrates").DataTable().search(n.join("|"),!0,!1,!0).draw()});break;case"trading-items":$("#search_dt").keyup(delay(function(){CallBackFilterDataItemOverViewServeSide()},1e3));$("#itemoverview-filter-type").change(function(){applyItemOverviewFilter();CallBackFilterDataItemOverViewServeSide()});$("#itemoverview-filter-group").change(function(){applyItemOverviewFilter();CallBackFilterDataItemOverViewServeSide()});break;case"general-contacts":moveModalIntoBody("#"+n+" .ct-modal-content");$("#group-workgroup-id").select2();$("#group-contact-id").select2();$("#CountryName").select2();break;case"general-groups":initNavSubgroupsClick();$("ul.nav-subgroups li a[href=#tab-groups-items]").click();case"tab-groups-items":reloadgroup=function(){tradinggrouptabs.istabgroupsitemsload=!1;$("ul.nav-subgroups li a[href=#tab-groups-items]").click();clickAddgroup()};$("#tab-groups-items input[name=search]").keyup(delay(function(){$("#tab-groups-items .dataTable").DataTable().search($(this).val()).draw()},500));break;case"tab-groups-contacts":reloadTableContactGroup=function(){tradinggrouptabs.istabgroupscontactsload=!1;tradinggeneraltabs.istabcontactsload=!1;$("ul.nav-subgroups li a[href=#tab-groups-contacts]").click()};$("#tab-groups-contacts input[name=search]").keyup(delay(function(){$("#tab-groups-contacts .dataTable").DataTable().search($(this).val()).draw()},500));break;case"trading-pricing":moveModalIntoBody("#"+n+" .pr-modal-content");addGroupTab=function(n,t){$("#tabs-pgroup").append('<li><a data-toggle="tab" onclick=\'loadReloadPrices('+n+");' href='#group"+n+"'>"+t+"<\/a><\/li>");$("#tabs-content").append('<div class="tab-pane fade" id=\'group'+n+"'><\/div>");$("#group"+n).load("/Commerce/LoadGroupConfigTab?groupid="+n,function(){$("#group"+n+" select.select2").select2({placeholder:"Please select"});$("#group"+n+" .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#tabs-pgroup a[href=#group"+n+"]").click()});$("#tabs-pgroup a[href=#group"+n+"]").tab("show")};case"trading-menus":i=$("a[href='#"+n+"']").attr("catalogType");moveModalIntoBody("#"+n+" .mn-modal-content");SearchMenu=function(){$("#trading-menus #catalog-distribution-list").remove();var n=$("#pos-menu-list");n.empty();n.LoadingOverlay("show");n.load("/PointOfSaleMenu/LoadPosMenu",{locationIds:$("#trading-menus select[name=locations]").val(),catalogSearchType:i,salesChannel:$("#trading-menus select[name=salechannel]").val(),keyword:$("#trading-menus input[name=search]").val(),status:$("#trading-menus select[name=status]").val()},function(){n.LoadingOverlay("hide")})};SearchMenu();resetValidateMenuForm=function(){$("#menu-name").removeClass("error valid");$("#pos-menu-form").validate().resetForm()};CreateMenu=function(){$menuAction=1;$("#menu-name").val("");$("#menu-summary").val("");$("#pos-menu-form select[name=Locations]").prop("disabled",!1);$("#menu-salechannel").prop("disabled",!1);$("#menu-salechannel").val("B2C").change();$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Add a Catalog");resetValidateMenuForm();$menuId=0;$("#app-trader-pos-menu-modal").modal("show");var n=$(".nav-stacked > .active > a"),t=0;n&&(t=n.attr("catalogType"));t=="1"?($("#menu-salechannel").val("B2B").change(),$("#menu-salechannel").attr("disabled","disabled"),$(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show())};SuccessAction=function(){var n=$(".nav-stacked > .active > a").attr("catalogType");n=="1"?SearchCatalogDistribution():SearchMenu()};$("#trading-menus select.select2").select2({placeholder:"Please select"});$("#trading-menus select.checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".mn-modal-content select.select2").select2({placeholder:"Please select"});t=null;$("#trading-menus input[name=search]").keyup(function(){clearTimeout(t);t=setTimeout(function(){SearchMenu()},1e3)});break;case"trading-menus-distribution":i=$("a[href='#"+n+"']").attr("catalogType");moveModalIntoBody("#"+n+" .mn-modal-content");SearchCatalogDistribution=function(){$("#trading-menus-distribution #pos-menu-list").remove();var n=$("#catalog-distribution-list");n.empty();n.LoadingOverlay("show");n.load("/PointOfSaleMenu/LoadPosMenu",{locationIds:$("#trading-menus-distribution select[name=locations]").val(),catalogSearchType:i,salesChannel:$("#trading-menus-distribution select[name=salechannel]").val(),keyword:$("#trading-menus-distribution input[name=search]").val(),status:$("#trading-menus-distribution select[name=status]").val()},function(){n.LoadingOverlay("hide")})};SearchCatalogDistribution();resetValidateMenuForm=function(){$("#menu-name").removeClass("error valid");$("#pos-menu-form").validate().resetForm()};CreateMenu=function(){$menuAction=1;$("#menu-name").val("");$("#menu-summary").val("");$("#pos-menu-form select[name=Locations]").prop("disabled",!1);$("#menu-salechannel").prop("disabled",!1);$("#menu-salechannel").val("B2C").change();$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Add a Catalog");resetValidateMenuForm();$menuId=0;$("#app-trader-pos-menu-modal").modal("show");var n=$(".nav-stacked > .active > a"),t=0;n&&(t=n.attr("catalogType"));t=="1"?($("#menu-salechannel").val("B2B").change(),$("#menu-salechannel").attr("disabled","disabled"),$(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show())};SuccessAction=function(){var n=$(".nav-stacked > .active > a").attr("catalogType");n=="1"?SearchCatalogDistribution():SearchMenu()};$("#trading-menus-distribution select.select2").select2({placeholder:"Please select"});$("#trading-menus-distribution select.checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".mn-modal-content select.select2").select2({placeholder:"Please select"});t=null;$("#trading-menus-distribution input[name=search]").keyup(function(){clearTimeout(t);t=setTimeout(function(){SearchCatalogDistribution()},1e3)});$("#trading-menus-distribution .filter-tab select").attr("onchange","SearchCatalogDistribution()");break;case"general-candb":showTableCashBankValue();clearAllModal()}}function onKeySearchChanged(n){filter.Key=$(n).val();setTimeout(function(){searchOnTableCashBank()},200)}function searchOnTableCashBank(){var i=[],t=$("#search_dt_cb").val().split(" "),n;if($("#search_dt_cb").val()!==""&&$("#search_dt_cb").val()!==null&&t.length>0)for(n=0;n<t.length;n++)t[n]!==""&&i.push(t[n]);$("#community-list").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#community-list").val("")}function clearAllModal(){$("#cashbank-transfer").empty();$("#app-trader-cashbank").empty();$("#cashbank-payment").empty()}function AddEditTraderCashBank(n){$.LoadingOverlay("show");clearAllModal();setTimeout(function(){$("#app-trader-cashbank").load("/TraderCashBank/TraderCashBankAddEdit?id="+n);$.LoadingOverlay("hide");$("#app-trader-cashbank").modal("toggle")},2e3)}function initBKAccount(n,t){BKAccount.Id=n;BKAccount.Name=t}function SaveCashAccount(){if($("#form_cash_bank").valid()){if($("#cash-bank-icon").val()===""&&$("#cash-bank-id").val()==="0"){cleanBookNotification.error(_L("ERROR_MSG_618"),"Qbicles");return}var n={Id:$("#cash-bank-id").val(),Name:$("#cash-bank-name").val()};$.ajax({type:"post",url:"/TraderCashBank/TraderCashAccountNameCheck",data:{cashBank:n},dataType:"json",success:function(n){if(n.result===!1){$("#form_cash_bank").validate().showErrors({Name:n.msg});return}ProcessCashBankAccount()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");return}})}}function ProcessCashBankAccount(){$.LoadingOverlay("show");var n=document.getElementById("cash-bank-icon").files;n&&n.length>0?UploadMediaS3ClientSide("cash-bank-icon").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#cash-bank-object-key").val(n.objectKey);$("#cash-bank-object-name").val(n.fileName);$("#cash-bank-object-size").val(n.fileSize);CashBankAccountSubmit()}):CashBankAccountSubmit()}function CashBankAccountSubmit(){var n=new FormData($("#form_cash_bank")[0]);$.ajax({type:"post",cache:!1,url:"/TraderCashBank/SaveTraderCashAccount",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){},success:function(n){LoadingOverlayEnd();n.actionVal===1?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.createSuccess();showTableCashBankValue()},100)):n.actionVal===2?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.updateSuccess();showTableCashBankValue()},100)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){$.LoadingOverlay("hide");cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function UploadImage(){UploadMediaS3ClientSide("form_specifics_icon").then(function(n){return n.objectKey})}function manageonclick(n){$.LoadingOverlay("show");window.location.href="/TraderCashBank/TraderCashAccount?id="+n+"&locationid=0"}function showTableCashBankValue(){$("#cashbank-content").LoadingOverlay("show");$("#cashbank-content").load("/TraderCashBank/TraderCashBankContents",function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#community-list-cash-bank").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#cashbank-content").LoadingOverlay("hide");setTimeout(function(){searchOnTableCashBank()},300)})}function LoadTableDataCashBank(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:"",processing:loadingoverlay_value},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keysearch:$("#search_dt_cb").val()})}},columns:i,order:[[r,"asc"]]})}function FilterDataCashBankByServerSide(){var n=[{name:"Image",data:"Image",render:function(n,t,i){return""+('<div class="table-avatar" style="background-image: url(\''+$("#api-uri").val()+i.Image+"&size=T');\">&nbsp;<\/div>")}},{name:"Name",data:"Name",orderable:!0,render:function(n,t,i){return""+('<h5 style="margin: 0; padding: 0 0 3px 0;">'+i.Name+"<\/h5>")}},{name:"BookkeepingAccount",data:"BookkeepingAccount",orderable:!1},{name:"FundsIn",data:"FundsIn",orderable:!1},{name:"FundsOut",data:"FundsOut",orderable:!1},{name:"Charges",data:"Charges",orderable:!1},{name:"Transactions",data:"Transactions",orderable:!1},{data:null,orderable:!1,render:function(n,t,i){var r='<div class="btn-group options">';return r+='<button type="button" class="btn btn-success dropdown-toggle"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a href="#" onclick="manageonclick('+i.Id+')">Manage<\/a><\/li>',i.BankmateType==0&&(r+='<li><a href="#" data-toggle="modal" onclick="AddEditTraderCashBank('+i.Id+')" >Edit<\/a><\/li>'),r+="<\/ul> <\/div>",i.AllowEdit?r:""}}];LoadTableDataCashBank("community-list-cash-bank","/TraderCashBank/GetCashBankContent",n,1);CallBackFilterDataCashBankServeSide()}function CallBackFilterDataCashBankServeSide(){$("#community-list-cash-bank").DataTable().ajax.reload()}function moveModalIntoBody(n){var t=$(n);t.length>0&&($("body "+n).remove(),t.appendTo("body"))}function initCurrency(){$("#frmCurrencyConfiguration").submit(function(n){n.preventDefault();var t=$("select[name=CurrencySymbol]").val(),i=$("select[name=SymbolDisplay]").val(),r=$("select[name=DecimalPlace]").val();$.ajax({type:"post",url:this.action,data:{CurrencySymbol:t,SymbolDisplay:i,DecimalPlace:r},dataType:"json",success:function(n){if(n.result){cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles");var u="resetSettings('"+t+"','"+i+"','"+r+"')";$("#btnCurrencyReset").attr("onclick",u);tabs.istradingitemsload=!1;tradinggeneraltabs.istabcandbload=!1}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})})}function resetSettings(n,t,i){$("select[name=CurrencySymbol]").val(n).trigger("change");$("select[name=SymbolDisplay]").val(t).trigger("change");$("select[name=DecimalPlace]").val(i).trigger("change")}function loadModalTradingItemAdd(){var t,i,n;$("#wizard").hide();t=$("#sltype");i=$("#chkIsProduct");$("#app-trader-inventory-item-add").empty();n=$("#theform");n.fadeIn();n.empty();n.LoadingOverlay("show");n.load("/Commerce/LoadTradingItemAdd",{type:t.val(),isProduct:i.prop("checked")},function(){$("#theform .select2").select2({placeholder:"Please select"});$("#theform .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});n.LoadingOverlay("hide");initNextPreviousTab("#theform",".app_subnav");initFormTradingItem()})}function initNextPreviousTab(n,t){$(n+" .btnNext").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").next("li").find("a").trigger("click")});$(n+" .btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").prev("li").find("a").trigger("click")})}function initFormTradingItem(){recipes=[];var n=$("#frmTradingItem");n.validate({ignore:"",rules:{name:{required:!0,maxlength:50,minlength:4},description:{required:!0,maxlength:200,minlength:4},sku:{required:!0,maxlength:50},barcode:{maxlength:50}},invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(t){var r,i,u;if(t.preventDefault(),!isBusy){if(r=$("#sltype").val(),r=="icompound"&&recipes.length===0)return cleanBookNotification.error(_L("ERROR_MSG_628"),"Qbicles"),$.LoadingOverlay("hide"),!1;n.valid()&&checkUniqueSKUandBarcode()&&($.LoadingOverlay("show"),i=document.getElementById("form_specifics_icon").files,u=$("#itemimg-object-key").val(),!u||i&&i.length>0?UploadMediaS3ClientSide("form_specifics_icon").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#itemimg-object-key").val(n.objectKey);saveTradingItem()}):saveTradingItem())}})}function saveTradingItem(){var n={Id:$("#traderItem_id").val(),Group:{Id:$("#frmTradingItem  select[name=groups]").val()},Name:$("#frmTradingItem  input[name=name]").val(),Description:$("#frmTradingItem  textarea[name=description]").val(),ImageUri:$("#itemimg-object-key").val(),Locations:[],Units:[],Barcode:$("#frmTradingItem  input[name=barcode]").val(),SKU:$("#frmTradingItem  input[name=sku]").val(),IsCompoundProduct:!1,PrimaryVendors:[],InventoryDetails:[],ResourceDocuments:[],AdditionalInfos:[],AssociatedRecipes:[],VendorsPerLocation:[],PurchaseAccount:[],SalesAccount:[],TaxRates:[],InventoryAccount:[],IsCommunityProduct:!1,IsBought:!1,IsSold:!1,IsActiveInAllLocations:!0},k=$("#sltype").val(),d=$("#chkIsProduct").prop("checked"),c,l,i,v,r,t,u,a,w,s,f,b,e,h,o;switch(k){case"isell":n.IsSold=!0;break;case"ibuysell":n.IsSold=!0;n.IsBought=!0;break;case"icompound":n.IsSold=!0;n.IsBought=!1;n.IsCompoundProduct=!0;break;default:n.IsBought=!0}if(c=$("#sl_taxrate_purchase").val(),c)for(i=0;i<c.length;i++)n.TaxRates.push({Id:c[i]});if(l=$("#sl_taxrate_sale").val(),l)for(i=0;i<l.length;i++)n.TaxRates.push({Id:l[i]});if(recipes.length>0)for(i=0;i<recipes.length;i++)n.AssociatedRecipes.push(recipes[i]);d&&(v=$("#local-manage-select").val(),v&&n.InventoryDetails.push({Location:{Id:v},MinInventorylLevel:$("#form_inventory_mininv").val().replace(/\,/g,""),MaxInventoryLevel:$("#form_inventory_maxinv").val().replace(/\,/g,""),CurrentInventoryLevel:0}));var y=$("#ivquantity").val(),p=$("#ivunitcost").val(),g={ivquantity:y?y:0,ivunitcost:p?p:0};if($("#unit_conversions tbody tr#add-unit-row").length>0&&$("#unit_conversions tbody tr#add-unit-row").remove(),$("#unit_conversions tbody tr").length>0&&$("#unit_conversions tbody tr td").length>1&&(r=$("#unit_conversions tbody tr"),r.length>0)){for(t=[],u=0;u<r.length;u++)a=$($(r[u]).find("td.row_componentUnit input")).val(),w={Id:$($(r[u]).find("td.row_name .unitIds")).val(),Name:$($(r[u]).find("td.row_name .unitName")).val(),IsBase:$($(r[u]).find("td.row_name p")).text()==="true"?!0:!1,MeasurementType:$("#item_measure_type").val(),Quantity:$($(r[u]).find("td.row_quantity")).text(),QuantityOfBaseunit:$($(r[u]).find("td.row_name span")).text(),IsActive:$(r[u]).find("td.row_active input")[0].checked,ParentUnit:a&&a!==""?{Id:a}:null},t.push(w);if(t.length>0){for(s=0;s<t.length;s++)t[s].ParentUnit=selectedChild(t[s],t);for(f=0;f<t.length;f++)if(b=t[f].Id.toString(),isNaN(parseInt(t[f].Id.toString()))){if(n.AssociatedRecipes&&n.AssociatedRecipes.length>0)for(e=0;e<n.AssociatedRecipes.length;e++)if(n.AssociatedRecipes[e].Ingredients&&n.AssociatedRecipes[e].Ingredients.length>0)for(h=0;h<n.AssociatedRecipes[e].Ingredients.length;h++)n.AssociatedRecipes[e].Ingredients[h].Unit.Id===t[f].Id&&(n.AssociatedRecipes[e].Ingredients[h].Unit.Id=int);for(t[f].Id=int,o=0;o<t.length;o++)f!==o&&t[o].Id===b&&(t[o].Id=int);int--}n.Units=t}}$.ajax({type:"post",url:"/TraderItem/SaveItemProduct?currentLocationId=0&isCurrentLocation=false",data:{item:n,createInventory:g},dataType:"json",success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$("#wizard-add-item").modal("hide"),CallBackFilterDataItemOverViewServeSide(!0)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function checkUniqueSKUandBarcode(){var t=$("#frmTradingItem input[name=sku]").val(),r=$("#frmTradingItem input[name=barcode]").val(),i=$("#frmTradingItem").validate(),n=!0;return t||(n=!1,i.showErrors({sku:"The Product SKU is required!"})),t&&$.ajax({method:"POST",data:{traderId:$("#traderItem_id").val(),SKU:t,Barcode:r},url:"/TraderItem/validateUniqueSKUandBarcode",dataType:"json","async":!1}).done(function(t){t.sku&&(n=!1,i.showErrors({sku:"The Product SKU already exists!"}));t.barcode&&(n=!1,i.showErrors({barcode:"The Product Barcode already exists!"}));$('a[href="#item-details"]').click()}),n}function filterTradingItemByServerSide(){var n=$("#trading-items").attr("SubscribeTrader"),t=[{data:"ImageUri",orderable:!1,render:function(n,t,i){return""+('<a href="'+apiDoc+i.ImageUri+'" class="table-avatar image-pop" rel="resources" style="display: block; background-image: url(\''+apiDoc+i.ImageUri+"&size=T');\">&nbsp;<\/a>")}},{name:"ItemName",data:"ItemName",orderable:!0,render:function(n,t,i){return i.ItemName}},{name:"SKU",data:"SKU",orderable:!0},{name:"Barcode",data:"Barcode",orderable:!0},{orderable:!1,render:function(n,t,i){var r="";return i.IsBought&&(r+='<span class="label label-lg label-warning">Item I buy<\/span> '),i.IsSold&&(r+='<span class="label label-lg label-success">Item I sell<\/span> '),i.IsCompoundProduct&&(r+='<span class="label label-lg label-primary">Compound<\/span> '),r}},{name:"GroupName",data:"GroupName",orderable:!0},{name:"Description",data:"Description",orderable:!1},{name:"Vendor",data:"Vendor",orderable:!1},{orderable:!1,render:function(t,i,r){return""+(n?'<button class="btn btn-info" title="Subscribe to Trader to unlock this feature" data-toggle="modal" onclick="showTraderItemAdditional(\''+r.Id+'\')" data-target="#app-trader-item-additional"><i class="fa fa-list"><\/i> &nbsp; View<\/button>':'<button class="btn btn-info" title="Subscribe to Trader to unlock this feature" disabled><i class="fa fa-list"><\/i> &nbsp; View<\/button>')}},{name:"IsActive",data:"IsActive",orderable:!0,render:function(n,t,i){return""+(i.IsActive?'<label><i class="fa fa-check green" style="width: 15px;"><\/i> &nbsp; Active<\/label>':'<label><i class="fa fa-remove red" style="width: 15px;"><\/i> &nbsp; Inactive<\/label>')}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="";return r+='<div class="btn-group options">',r+='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+(i.IsBought?'<li><a href="javascript:void(0)" onclick="editTraderItem(1, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>":'<li><a href="javascript:void(0)" onclick="editTraderItem(2, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>")}}];LoadTableDataItemOverView("tb_trader_items","/Trader/GetDataItemOverView",t);CallBackFilterDataItemOverViewServeSide(!1)}function initIVCreateModal(){var i=$("#frmTradingItem  input[name=name]"),n,t;if(!i.valid()){$("#app-trader-inventory-create").modal("hide");$('a[href="#item-details"]').click();return}if($(".iv-item-name").text(i.val()),n=$("#unit_conversions tr td.row_name p:contains('true')"),n.text()==="true")if(t=n.closest("tr").find("td.row_name .unitName").val(),t)$(".iv-unit-base-name").text(t);else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}$("#frmCreateInventory").validate({rules:{ivquantity:{required:!0,min:0},ivunitcost:{required:!0,min:0}}});$("#frmCreateInventory").submit(function(n){if(n.preventDefault(),$("#frmCreateInventory").valid()){var t=parseFloat($("#ivquantity").val());$("#form_inventory_instock").val(t);$("#app-trader-inventory-create").modal("hide")}else $("#ivquantity").val(0),$("#ivunitcost").val(0)});$("#app-trader-inventory-create").modal("show")}function saveOverNewRecipe(n){var e,t,i;if(validateRecipeForm(n)){var r="",u=0,f=!1;if(n==="tb_add_recipe"?(r=$("#form_add_recipe_name").val(),u=int,f=$("#form_add_recipe_iscurrent")[0].checked,int--):n==="tb_edit_recipe"&&(r=$("#edit_recipe_name").val(),u=$("#edit_recipe_form_id").val(),f=$("#edit_recipe_iscurrent")[0].checked),e={Id:u,Name:r,Ingredients:[],IsActive:!0,IsCurrent:f},t=$("#"+n+" tbody tr"),t.length>0)for(i=0;i<t.length;i++)$($(t[i]).find("td.item_name select")).val()||$($(t[i]).find("td.item_name select")).val(""),e.Ingredients.push({Id:$($(t[i]).find("td.item_name input")).val(),SubItem:{Id:$($(t[i]).find("td.item_name select")).val().split("|")[0]},Quantity:$($(t[i]).find("td.item_quantity input")).val(),Unit:{Id:$($(t[i]).find("td.item_selected select")).val()},AverageCost:$($(t[i]).find("td.item_averagecost span")).text(),LatestCost:$($(t[i]).find("td.item_latestcost span")).text()});addObjectToRecipeTable(e);$("#newrecipe").hide();$("#editrecipe").hide()}}function validateRecipeForm(n){var t=!0,r,i,u,f,e;for(n==="tb_add_recipe"?$("#form_add_recipe_name").val().trim()===""&&(t=!1,$("#frmTradingItem").validate().showErrors({recipe_name:"Recipe name is required."})):$("#edit_recipe_name").val().trim()===""&&(t=!1,$("#frmTradingItem").validate().showErrors({recipe_name_edit:"Recipe name is required."})),r=$("#"+n+" tr"),i=0;i<r.length;i++){if(u=$(r[i]).find("td.item_name select"),u.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_623"),"Recipe items");break}if(f=$(r[i]).find("td.item_quantity input"),f.val()<=0){t=!1;cleanBookNotification.error(_L("ERROR_MSG_624"),"Recipe items");break}if(e=$(r[i]).find("td.item_selected select"),e.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_625"),"Recipe items");break}}return t}function checkInventoryChooseBP(n){$(n).valid();var t=$(n).val();t?($(".iv-locations").text($(n).find(":selected").text()),$(".btnaddinventory").prop("disabled",!1)):$(".btnaddinventory").prop("disabled",!0)}function initPluginsOfTabGarenal(n){n||(getLocationsDomain($("#logistics-general select[name=locations]"),n),$("#logistics-general #select-traderitems").select2({ajax:{url:"/TraderItem/Select2TraderItemsByLocationId",delay:250,data:function(n){return{keyword:n.term,page:n.page||1,locationId:$('#logistics-general select[name="locations"]').val()}},cache:!0},minimumInputLength:1}))}function initPluginsOfTabVehicles(n){n||($("#tblvehicles").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#logistics-vehicles").LoadingOverlay("show"):$("#logistics-vehicles").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/TraderChannels/SearchVehicles",data:function(n){return $.extend({},n,{keyword:$("#txtvehiclekeyword").val()})}},columns:[{title:"Vehicle type",data:"VehicleType",searchable:!0,orderable:!0},{title:"Name",data:"Name",searchable:!0,orderable:!0},{title:"Reference or registration",data:"RefOrRegistration",searchable:!0,orderable:!0},{title:"Options",data:"Id",searchable:!0,orderable:!1,render:function(n){var t='<div class="btn-group"><button class="btn btn-primary" data-toggle="dropdown"><i class="fa fa-cog"><\/i><\/button>';return t+='<ul class="dropdown-menu dropdown-menu-right primary">',t+='<li><a href="#" onclick="loadModalDeliveryVehicle('+n+')">Edit<\/a><\/li>',t+='<li><a href="#" onclick="deleteVehicle('+n+')">Delete<\/a><\/li>',t+"<\/ul><\/div>"}}]}),$("#tblvehicles").DataTable().ajax.reload(),$("#txtvehiclekeyword").keyup(delay(function(){reloadTableVehicles()},400)))}function initPluginsOfTabDrivers(n){if(!n){loadVehicles();var t=$("#tbldrivers");t.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#logistics-drivers").LoadingOverlay("show"):$("#logistics-drivers").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/TraderChannels/SearchDrivers",data:function(n){return $.extend({},n,{keyword:$("#txtSearchDriver").val(),locationId:$("#logistics-drivers select[name=locations]").val()})}},columns:[{title:"Driver",data:"Driver",searchable:!0,orderable:!0,render:function(n,t,i){var r='<a href="#"><div class="table-avatar mini pull-left" style="background-image: url(\''+i.DriverIcon+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+n+"<\/div>",r+'<div class="clearfix"><\/div><\/a>'}},{title:"Email",data:"Email",searchable:!0,orderable:!0,render:function(n){return'<a href="mailto:'+n+'">'+n+"<\/a>"}},{title:"Verhicle",data:"VehicleId",searchable:!0,orderable:!0,render:function(n,t,i){var r='<select name="vehicle" onchange="updateVehicleDriver('+i.Id+',this)" class="form-control select2 dt-select2" style="width: 100%;">';return r+="<option><\/option>",dataVehicles.forEach(function(t){r+='<optgroup label="'+fixQuoteCode(t.GroupName)+'">';t.Items&&t.Items.forEach(function(t){r+='<option value="'+t.Id+'" '+(t.Id==n?"selected":"")+">"+fixQuoteCode(t.Text)+"<\/option>"});r+="<\/optgroup>"}),r+="<\/select>"}},{title:"Status",data:"Status",searchable:!0,orderable:!0,render:function(n){var t='<label class="label label-lg label-success">Active<\/label>';return n!=1&&(t='<label class="label label-lg label-warning">Off duty<\/label>'),t}},{title:"Options",data:"Id",searchable:!0,orderable:!1,render:function(n,t,i){var r='<div class="btn-group"><button class="btn btn-primary" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-cog"><\/i><\/button>';return r+='<ul class="dropdown-menu dropdown-menu-right primary">',r+=i.Status==1?'<li><a href="#" onclick="setOnOffDuty('+n+',2)">Set off duty<\/a><\/li>':'<li><a href="#" onclick="setOnOffDuty('+n+',1)">Set on duty<\/a><\/li>',r+='<li><a href="#" onclick="loadModalLocationChange('+n+')">Change location<\/a><\/li>',r+='<li><a href="#" onclick="deleteDriver('+n+')">Delete<\/a><\/li>',r+"<\/ul><\/div>"}}],drawCallback:function(){$(".dt-select2").select2({placeholder:"Please select"})}});reloadTableDrivers();$("#txtmembersearch").keyup(delay(function(){searchDeliveryDrivers()},400));$("#txtSearchDriver").keyup(delay(function(){reloadTableDrivers()},400))}}function loadContentItemInfo(){var t=$("#logistics-general #select-traderitems").val(),n;t&&(n=$("#item-info"),n.empty(),n.LoadingOverlay("show"),n.load("/TraderChannels/LoadContentItemInfo?itemId="+t,function(){$("#tbliteminfo").DataTable();n.LoadingOverlay("hide")}))}function saveDeliverySettings(n){$.LoadingOverlay("show");var t={Id:0,DeliveryService:{Id:n},Location:{Id:$("#logistics-general select[name=locations]").val()}};$.post("/TraderChannels/SaveDeliverySettings",{settings:t},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()})}function loadModalPriceList(n){var t=$("#delivery-charge-pricelist-add");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalPriceList?id="+n,function(){$("#delivery-charge-pricelist-add select.select2").select2({placeholder:"Please select"});var n=$("#frmb2bpricelist");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},Icon:{filesize:!0},Summary:{required:!0,minlength:3,maxlength:500}}});n.submit(function(t){if((t.preventDefault(),!isBusy)&&n.valid()){$.LoadingOverlay("show");var i=document.getElementById("b2b-price-icon-input").files;i.length>0?UploadMediaS3ClientSide("b2b-price-icon-input").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#b2b-price-icon-object-key").val(n.objectKey);$("#b2b-price-icon-object-name").val(n.fileName);$("#b2b-price-icon-object-size").val(n.fileSize);saveB2bPriceList()}):($("#b2b-price-icon-object-key").val(""),$("#b2b-price-icon-object-name").val(""),$("#b2b-price-icon-object-size").val(""),saveB2bPriceList())}})})}function saveB2bPriceList(){var n=new FormData($("#frmb2bpricelist")[0]);$.ajax({type:"post",cache:!1,url:"/TraderChannels/SavePriceList",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#delivery-charge-pricelist-add").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}})}function loadContentPriceList(){var n=$("#b2b-charges-content");n.empty();n.LoadingOverlay("show");n.load("/TraderChannels/LoadContentPriceList",{keyword:$("#txtplkeyword").val(),locationId:$("#logistics-charges select[name=locations]").val()},function(){n.LoadingOverlay("hide")})}function loadContentChargeFramework(n){$(".pricelists").hide();var t=$("#framework-1");t.fadeIn();t.empty();t.LoadingOverlay("show");t.load("/TraderChannels/LoadContentChargeFramework",{priceId:n},function(){t.LoadingOverlay("hide")})}function loadModalDeliveryChargeFramework(n,t){var i=$("#delivery-charge-framework-add");i.empty();i.modal("show");i.load("/TraderChannels/LoadModalDeliveryChargeFramework?",{priceListId:t,id:n},function(){var n=$("#frmChargeFramework");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},DistanceTravelledFlatFee:{required:!0},DistanceTravelPerKm:{required:!0},TimeTakenFlatFee:{required:!0},TimeTakenPerSecond:{required:!0},ValueOfDeliveryFlatFee:{required:!0},ValueOfDeliveryPercentTotal:{required:!0,min:0,max:100}}});n.submit(function(r){(r.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(i.modal("hide"),loadContentChargeFramework(t),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))});initSelect2avatarDelivery()})}function initPriceCloneCurrentLocation(n,t){$("#frmPriceListCLocationClone input[name=cloneId]").val(n);$("#frmPriceListCLocationClone input[name=cloneName]").val(t);$("#frmPriceListCLocationClone input[ name=locationId]").val($("#location_item_"+n).val());$("#b2b-charge-framework-clone").modal("show")}function initFormClonePriceList(n){if(!n){var t=$("#frmPriceListCLocationClone");t.validate({rules:{cloneName:{required:!0,minlength:3,maxlength:150}}});t.submit(function(n){(n.preventDefault(),isBusy)||t.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#b2b-charge-framework-clone").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))});$("#txtplkeyword").keyup(delay(function(){loadContentPriceList()},400))}}function initFormCloneOtherLocationPriceList(){var n=$("#frmPriceListOtherLocationClone");n.validate({rules:{cloneName:{required:!0,minlength:3,maxlength:150},locationId:{required:!0}}});n.submit(function(t){(t.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#b2b-charge-framework-port").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))})}function loadModalLocationChange(n){var t=$("#b2b-charge-framework-port");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalChargeFrameworkPort?priceId="+n,function(){initFormCloneOtherLocationPriceList();$("#frmPriceListOtherLocationClone .select2").select2({placeholder:"Please select"})})}function deletePriceList(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"B2B Logistics",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeletePriceList",{id:n},function(n){n.result?loadContentPriceList():!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function deleteChargeFramework(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"B2B Logistics",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteChargeFramework",{id:n},function(n){n.result?loadContentChargeFramework($("#hdfPriceListId").val()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function loadModalDeliveryVehicle(n){var t=$("#delivery-vehicle-add");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalDeliveryVehicle?id="+n,function(){var n=$("#frmVehicle");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},RefOrRegistration:{required:!0,maxlength:50}}});n.submit(function(i){(i.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(t.modal("hide"),reloadTableVehicles(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()}}))});initSelect2avatarDelivery()})}function initSelect2avatarDelivery(){$(".select2avatar-delivery").select2({placeholder:"Please select",templateResult:formatOptions2,templateSelection:formatSelected2})}function formatOptions2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function formatSelected2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function reloadTableVehicles(){setTimeout(function(){$("#tblvehicles").DataTable().ajax.reload()},100);loadVehicles()}function reloadTableDrivers(){setTimeout(function(){$("#tbldrivers").DataTable().ajax.reload()},100)}function deleteVehicle(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Trader",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteVehicle",{id:n},function(n){n.result?reloadTableVehicles():!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function deleteDriver(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Trader",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteDriver",{id:n},function(n){n.result?reloadTableDrivers():!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function loadVehicles(){$.get("/TraderChannels/GetVehiclesForSelect2",function(n){dataVehicles=n})}function searchDeliveryDrivers(){var n=$("#txtmembersearch").val();$(".contact-list-found").LoadingOverlay("show");$(".contact-list-found").load("/TraderChannels/LoadModalDeliveryDriver",{keyword:n},function(){$(".existing-member").show();$(".contact-list-found").LoadingOverlay("hide")})}function setOnOffDuty(n,t){$.post("/TraderChannels/UpdateStatusDriver",{id:n,status:t},function(n){n.result?reloadTableDrivers():!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function loadModalLocationChange(n){var t=$("#b2b-driver-location-change");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalLocationChange?driverId="+n,function(){var n=$("#frmLocationchange");n.submit(function(n){(n.preventDefault(),isBusy)||($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(t.modal("hide"),reloadTableDrivers(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()}}))});$("#frmLocationchange .select2").select2()})}function updateVehicleDriver(n,t){$.post("/TraderChannels/UpdateVehicleDriver",{id:n,vehicleId:$(t).val()},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function loadContentMemberDetail(n){var t=$(".contact-add");t.empty();t.LoadingOverlay("show");t.load("/TraderChannels/LoadContentMemberDetail?posUId="+n,function(){t.LoadingOverlay("hide");$("#slLocationIdForDriver").select2({placeholder:"Please select"});$(".contact-list-found").hide();$(".contact-invite").hide();$(".contact-add").hide();$(".contact-add").fadeIn()})}function saveMember(){var n=$("#slLocationIdForDriver").val();if(n==0){cleanBookNotification.error(_L("ERROR_MSG_622"),"B2B Logistics");return}$.LoadingOverlay("show");$.post("/TraderChannels/AddDriver",{posUId:$("#hdfPosUid").val(),accountId:$("#hdfAccountId").val(),locationId:n,driverUserId:$("#hdfUserid").val()},function(n){n.result?($("#delivery-driver-add").modal("hide"),reloadTableDrivers(),$("#lnkBackSearch").click(),$("#txtmembersearch").val(""),$(".contact-list-found").empty(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()})}function getLocationsDomain(n,t){t||$.get("/Commerce/getLocationsOfCurrentDomain",function(t){n.select2("destroy");n.select2({placeholder:"Please select",data:t})})}function initSelectedAccount(){}function closeSelected(){BKAccount.Id?($(".accountInfo").empty(),$(".accountInfo").append(BKAccount.Name)):$(".accountInfo").empty();$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"))}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");BKAccount.Id=t;BKAccount.Name=i;$("#accountId").length>0&&$("#accountId").val(t);$("#hdfAccountId").length>0&&$("#hdfAccountId").val(t);closeSelected();$("#app-bookkeeping-treeview").modal("hide")}function showChangeAccount(){setTimeout(function(){CollapseAccount()},1)}function CollapseAccount(){$(".jstree").jstree("close_all")}function initSelectedAccount(){setTimeout(function(){$(".selectaccount").removeClass("selectaccount");$(".accountid-"+BKAccount.Id).addClass("selectaccount")},1)}function initEventStoreProfile(){$("div.social-links input").keyup(delay(function(){saveSocialLinks()},1e3));$("#frmB2BProfile input[name=BusinessName], #frmB2BProfile textarea[name=BusinessSummary]").keyup(delay(function(){saveProfileB2B()},1e3));$("select[name=tags]").change(function(){delay(function(){saveTags()},1e3)});$("#frmsociallinks").validate({rules:{FacebookUrl:{url:!0},LinkedInUrl:{url:!0},TwitterUrl:{url:!0},YoutubeUrl:{url:!0},InstagramUrl:{url:!0}}})}function saveSocialLinks(){var i=$("#hdfProfileId").val();if(i&&$("#frmsociallinks").valid()){var r=$("#frmsociallinks input[name=FacebookUrl]"),u=$("#frmsociallinks input[name=InstagramUrl]"),f=$("#frmsociallinks input[name=LinkedInUrl]"),e=$("#frmsociallinks input[name=TwitterUrl]"),o=$("#frmsociallinks input[name=YoutubeUrl]"),t={Id:i},s={Url:r.val(),Type:r.data("type"),B2BProfile:t},h={Url:u.val(),Type:u.data("type"),B2BProfile:t},c={Url:f.val(),Type:f.data("type"),B2BProfile:t},l={Url:e.val(),Type:e.data("type"),B2BProfile:t},a={Url:o.val(),Type:o.data("type"),B2BProfile:t},n=[];n.push(s);n.push(h);n.push(c);n.push(l);n.push(a);$.post("/Commerce/UpdateSocialLinks",{socialLinks:n},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")})}}function saveTags(){var n=$("#hdfProfileId").val(),t;n&&(t=$("select[name=tags] option:selected").text(),$.post("/Commerce/UpdateTags",{tags:t,profileId:n},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}))}var isBusy=!1,recipes=[],dataVehicles=[],BKAccount={Id:0,Name:""},tabs={isprofile1load:!1,isprofile2load:!1,istradingitemsload:!1,istradingpricingload:!1,islogisticsgeneral:!1,islogisticscharges:!1,islogisticsvehicles:!1,islogisticsdrivers:!1,istradingmenuload:!1,iscatalogdimenstionload:!1},tradinggeneraltabs={istablocationsload:!1,istabworkgroupsload:!1,istabcandbload:!1,istabcurrencyload:!1,istabgroupsload:!1,istabcontactsload:!1,istabb2bload:!1,istabb2cload:!1,istabposload:!1,istabstorefrontload:!1},tradinggrouptabs={istabgroupsitemsload:!1,istabgroupscontactsload:!1},$cashAccountId,filter;$(document).ready(function(){reloadPosts(!0,!1);initFormPost();initNavClick();var n=getQuerystring("tab");n=="general-contacts"?($("a[href=#trading-general]").click(),setTimeout(function(){$("a[href=#"+n+"]").click()},500)):n=="trading-menus"?$("a[href=#trading-menus]").click():n=="general-candb"?($("a[href=#trading-general]").click(),setTimeout(function(){$("a[href=#"+n+"]").click()},500)):n=="trading-menus-distribution"&&$("a[href=#trading-menus-distribution]").click();initEventStoreProfile();$(".select2tag").select2({tags:!0})});$cashAccountId=0;filter={Workgroup:"",Key:""};