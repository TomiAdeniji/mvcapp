function initNavClick(){$("ul.profilenav li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#profile-info":$('a[href="#general-locations"]').trigger("click");break;case"#profile-items":$('a[href="#items"]').trigger("click");break;case"#profile-vouchers":initPluginsOfTabActive(tradingpromotionstabs.istabactiveload);tradingpromotionstabs.istabactiveload=!0}},200)});$("ul.trading-general-tabs li a").click(function(){var n=$(this).attr("href");setTimeout(function(){var i=window.location.protocol+"//"+window.location.host+window.location.pathname,r=n.replace("#",""),t=i+"?tab="+r;window.history.pushState({path:t},"",t);switch(n){case"#general-locations":loadTabContent(n,tradinggeneraltabs.istablocationsload);tradinggeneraltabs.istablocationsload=!0;break;case"#general-workgroups":loadTabContent(n,tradinggeneraltabs.istabworkgroupsload);tradinggeneraltabs.istabworkgroupsload=!0;break;case"#general-candb":loadTabContent(n,tradinggeneraltabs.istabcandbload);tradinggeneraltabs.istabcandbload=!0;break;case"#general-currency":loadTabContent(n,tradinggeneraltabs.istabcurrencyload);tradinggeneraltabs.istabcurrencyload=!0;break;case"#general-groups":loadTabContent(n,tradinggeneraltabs.istabgroupsload);tradinggeneraltabs.istabgroupsload=!0;break;case"#general-b2b":loadTabContent(n,tradinggeneraltabs.istabb2bload);tradinggeneraltabs.istabb2bload=!0;break;case"#general-b2c":loadTabContent(n,tradinggeneraltabs.istabb2cload);tradinggeneraltabs.istabb2cload=!0;break;case"#general-pos":loadTabContent(n,tradinggeneraltabs.istabposload);tradinggeneraltabs.istabposload=!0;break;case"#general-storefront":loadTabContent(n,tradinggeneraltabs.istabstorefrontload);tradinggeneraltabs.istabstorefrontload=!0;break;case"#general-contacts":loadTabContent(n,tradinggeneraltabs.istabcontactsload);tradinggeneraltabs.istabcontactsload=!0;break;default:loadTabContent(n,tradinggeneraltabs.istabgeneralorderdefaultsload);tradinggeneraltabs.istabgeneralorderdefaultsload=!0}},200)});$("ul.trading-items-catalogues-tabs li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#items":loadTabContent(n,tradingitemscataloguestabs.istabitemsload);tradingitemscataloguestabs.istabitemsload=!0;break;case"#item-resources":loadTabContent(n,tradingitemscataloguestabs.istabitemresourcefirstload);tradingitemscataloguestabs.istabitemresourcefirstload=!0;break;case"#items-pricing":loadTabContent(n,tradingitemscataloguestabs.istabitemspricingload);tradingitemscataloguestabs.istabitemspricingload=!0;break;case"#items-catalogues":loadTabContent(n,tradingitemscataloguestabs.istabitemscatalogues);tradingitemscataloguestabs.istabitemscatalogues=!0;break;case"#items-catalogues-distribution":loadTabContent(n,tradingitemscataloguestabs.istabitemscataloguesdistribution);tradingitemscataloguestabs.istabitemscataloguesdistribution=!0;break;case"#items-import":loadTabContent(n,tradingitemscataloguestabs.istabitemsimport);tradingitemscataloguestabs.istabitemsimport=!0}},200)});$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#itemtype a").bind("click",function(n){n.preventDefault();$(".wizard-start").hide();$("#productorservice li").removeClass("active");$(".theformtype").hide();$("#itemtype li").removeClass("active");$(this).closest("li").addClass("active");var t=$(this).data("value");$("#sltype").val(t);t!="icompound"?$("#prodorserv").fadeIn():$("#prodorserv").hide();t=="icompound"&&$(".wizard-start").show()});$("#productorservice a").bind("click",function(n){n.preventDefault();$("#productorservice li").removeClass("active");$(this).closest("li").addClass("active");var t=$(this).data("value");$("#chkIsProduct").prop("checked",t=="service"?!1:!0);$(".wizard-start").show()});$("input[name=b2b-service-toggle]").change(function(){clearTimeout(wto);wto=setTimeout(function(){updateB2BUsabilty()},1e3)})}function initNavSubgroupsClick(){$("ul.nav-subgroups li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#tab-groups-items":loadTabContent(n,tradinggrouptabs.istabgroupsitemsload);tradinggrouptabs.istabgroupsitemsload=!0;break;default:loadTabContent(n,tradinggrouptabs.istabgroupscontactsload);tradinggrouptabs.istabgroupscontactsload=!0}},200)})}function loadTabContent(n,t){if(!t){n=n.replace("#","");var i;switch(n){case"general-locations":i=$("#general-locations");break;case"tab-groups-items":i=$("#tab-groups-items .groups-items-dynamiccontent");break;case"tab-groups-contacts":i=$("#tab-groups-contacts .groups-contacts-dynamiccontent");break;default:i=$("#"+n)}i.empty();n!="general-candb"&&n!="general-groups"&&($(".loadingoverlay").is(":visible")||i.LoadingOverlay("show"));i.load("/Commerce/LoadBusinessProfileTab",{tab:n},function(){i.LoadingOverlay("hide");overrideFunctions(n);$(".dataTables_filter").hide();html5tooltips.refresh()})}}function overrideFunctions(n){var i,t;switch(n){case"general-locations":reloadLocation=function(){tradinggeneraltabs.istablocationsload=!1;$('a[href="#general-locations"]').trigger("click")};break;case"general-workgroups":$("#wg-key-search").keyup(delay(function(){$("#wg-table").DataTable().ajax.reload()},500));$("#wg-processes-filter").change(function(){$("#wg-table").DataTable().ajax.reload()});break;case"general-currency":initCurrency();reloadAccounting=function(){var n=$(".tbl-taxrates-content");n.empty();n.LoadingOverlay("show");n.load("/Commerce/LoadBusinessProfileTab",{tab:"general-currency",reload:!0},function(){$("#tblTaxrates").DataTable({destroy:!0,responsive:!0,pageLength:10});$("#general-currency input[name=search]").val().length>0&&$("#tblTaxrates").DataTable().search($("#general-currency input[name=search]").val(),!0,!1,!1).draw();n.LoadingOverlay("hide")})};$("#general-currency input[name=search]").keyup(delay(function(){$("#tblTaxrates").DataTable().search($(this).val(),!0,!1,!0).draw()},500));$("#general-currency select[name=transactiontype]").change(function(){var t=$("#general-currency select[name=transactiontype] option:selected"),n=[];$(t).each(function(){n.push([$(this).text()])});$("#tblTaxrates").DataTable().search(n.join("|"),!0,!1,!0).draw()});$("#general-currency select[name=type]").change(function(){var t=$("#general-currency select[name=type] option:selected"),n=[];$(t).each(function(){n.push([$(this).text()])});$("#tblTaxrates").DataTable().search(n.join("|"),!0,!1,!0).draw()});break;case"items":$("#search_dt").keyup(delay(function(){CallBackFilterDataItemOverViewServeSide()},1e3));$("#slLocation_items").change(function(){applyItemOverviewFilter();CallBackFilterDataItemOverViewServeSide()});$("#itemoverview-filter-type").change(function(){applyItemOverviewFilter();CallBackFilterDataItemOverViewServeSide()});$("#itemoverview-filter-group").change(function(){applyItemOverviewFilter();CallBackFilterDataItemOverViewServeSide()});break;case"general-contacts":moveModalIntoBody("#"+n+" .ct-modal-content");$("#group-workgroup-id").select2();$("#group-contact-id").select2();$("#CountryName").select2();break;case"general-groups":initNavSubgroupsClick();$("ul.nav-subgroups li a[href=#tab-groups-items]").click();case"tab-groups-items":reloadgroup=function(){tradinggrouptabs.istabgroupsitemsload=!1;$("ul.nav-subgroups li a[href=#tab-groups-items]").click();clickAddgroup();$("#tab-groups-items input[name=search]").val().length>0&&$("#tab-groups-items .dataTable").DataTable().search($("#tab-groups-items input[name=search]").val(),!0,!1,!1).draw()};$("#tab-groups-items input[name=search]").keyup(delay(function(){$("#tab-groups-items .dataTable").DataTable().search($(this).val(),!0,!1,!0).draw()},500));break;case"tab-groups-contacts":reloadTableContactGroup=function(){tradinggrouptabs.istabgroupscontactsload=!1;tradinggeneraltabs.istabcontactsload=!1;$("ul.nav-subgroups li a[href=#tab-groups-contacts]").click();$("#tab-groups-contacts input[name=search]").val().length>0&&$("#tab-groups-contacts .dataTable").DataTable().search($("#tab-groups-contacts input[name=search]").val(),!0,!1,!1).draw()};$("#tab-groups-contacts input[name=search]").keyup(delay(function(){$("#tab-groups-contacts .dataTable").DataTable().search($(this).val(),!0,!1,!0).draw()},500));break;case"items-pricing":moveModalIntoBody("#"+n+" .pr-modal-content");addGroupTab=function(n,t){$("#tabs-pgroup").append('<li><a data-toggle="tab" onclick=\'loadReloadPrices('+n+");' href='#group"+n+"'>"+t+"<\/a><\/li>");$("#tabs-content").append('<div class="tab-pane fade" id=\'group'+n+"'><\/div>");$("#group"+n).load("/Commerce/LoadGroupConfigTab?groupid="+n,function(){$("#group"+n+" select.select2").select2({placeholder:"Please select"});$("#group"+n+" .checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#tabs-pgroup a[href=#group"+n+"]").click()});$("#tabs-pgroup a[href=#group"+n+"]").tab("show")};case"items-catalogues":i=$("a[href='#items-catalogues']").attr("catalogType");moveModalIntoBody("#items-catalogues .mn-modal-content");SearchMenu();resetValidateMenuForm=function(){$("#menu-name").removeClass("error valid");$("#pos-menu-form").validate().resetForm()};CreateMenu=function(){$menuAction=1;$("#menu-name").val("");$("#menu-summary").val("");$("#pos-menu-form select[name=Locations]").prop("disabled",!1);$("#menu-salechannel").prop("disabled",!1);$("#menu-salechannel").val("B2C").change();$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Add a Catalog");resetValidateMenuForm();$menuId=0;$("#app-trader-pos-menu-modal").modal("show");var n=getCatalogType();n=="1"?($("#menu-salechannel").val("B2B").change(),$("#menu-salechannel").attr("disabled","disabled"),$(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show())};SuccessAction=function(){var n=getCatalogType();n=="1"?SearchCatalogDistribution():SearchMenu()};$("#items-catalogues select.select2").select2({placeholder:"Please select"});$("#items-catalogues select.checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".mn-modal-content select.select2").select2({placeholder:"Please select"});t=null;$("#items-catalogues input[name=search]").keyup(function(){clearTimeout(t);t=setTimeout(function(){SearchMenu()},1e3)});break;case"items-catalogues-distribution":i=$("a[href='#items-catalogues-distribution']").attr("catalogType");moveModalIntoBody("#items-catalogues-distribution .mn-modal-content");SearchCatalogDistribution=function(){$("#items-catalogues-distribution #pos-menu-list").remove();var n=$("#catalog-distribution-list");n.empty();n.LoadingOverlay("show");n.load("/PointOfSaleMenu/LoadPosMenu",{catalogSearchType:i,salesChannel:$("#items-catalogues-distribution select[name=salechannel]").val(),keyword:$("#items-catalogues-distribution input[name=search]").val(),status:$("#items-catalogues-distribution select[name=status]").val()},function(){n.LoadingOverlay("hide")})};SearchCatalogDistribution();resetValidateMenuForm=function(){$("#menu-name").removeClass("error valid");$("#pos-menu-form").validate().resetForm()};CreateMenu=function(){$menuAction=1;$("#menu-name").val("");$("#menu-summary").val("");$("#pos-menu-form select[name=Locations]").prop("disabled",!1);$("#menu-salechannel").prop("disabled",!1);$("#menu-salechannel").val("B2C").change();$("#report_filters").val("");$("#report_filters").select2({placeholder:"Please select"});$("#menu-modal-title").text("Add a Catalog");resetValidateMenuForm();$menuId=0;$("#app-trader-pos-menu-modal").modal("show");var n=getCatalogType();n=="1"?($("#menu-salechannel").val("B2B").change(),$("#menu-salechannel").attr("disabled","disabled"),$(".display-locations").hide(),$(".display-report-filters").hide()):($(".display-locations").show(),$(".display-report-filters").show())};SuccessAction=function(){var n=$(".trading-items-catalogues-tabs > .active > a").attr("catalogType");n=="1"?SearchCatalogDistribution():SearchMenu()};$("#items-catalogues-distribution select.select2").select2({placeholder:"Please select"});$("#items-catalogues-distribution select.checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".mn-modal-content select.select2").select2({placeholder:"Please select"});t=null;$("#items-catalogues-distribution input[name=search]").keyup(function(){clearTimeout(t);t=setTimeout(function(){SearchCatalogDistribution()},1e3)});$("#items-catalogues-distribution .filter-tab select").attr("onchange","SearchCatalogDistribution()");break;case"items-import":moveModalIntoBody("#"+n+" .pr-modal-content");break;case"general-candb":showTableCashBankValue();clearAllModal()}}function onKeySearchChanged(n){filter.Key=$(n).val();setTimeout(function(){searchOnTableCashBank()},200)}function searchOnTableCashBank(){var i=[],t=$("#search_dt_cb").val().split(" "),n;if($("#search_dt_cb").val()!==""&&$("#search_dt_cb").val()!==null&&t.length>0)for(n=0;n<t.length;n++)t[n]!==""&&i.push(t[n]);$("#community-list").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#community-list").val("")}function clearAllModal(){$("#cashbank-transfer").empty();$("#app-trader-cashbank").empty();$("#cashbank-payment").empty()}function AddEditTraderCashBank(n){$.LoadingOverlay("show");clearAllModal();setTimeout(function(){$("#app-trader-cashbank").load("/TraderCashBank/TraderCashBankAddEdit?id="+n);$.LoadingOverlay("hide");$("#app-trader-cashbank").modal("toggle")},2e3)}function initBKAccount(n,t){BKAccount.Id=n;BKAccount.Name=t}function SaveCashAccount(){if($("#form_cash_bank").valid()){if($("#cash-bank-icon").val()===""&&$("#cash-bank-id").val()==="0"){cleanBookNotification.error(_L("ERROR_MSG_618"),"Qbicles");return}var n={Id:$("#cash-bank-id").val(),Name:$("#cash-bank-name").val()};$.ajax({type:"post",url:"/TraderCashBank/TraderCashAccountNameCheck",data:{cashBank:n},dataType:"json",success:function(n){if(n.result===!1){$("#form_cash_bank").validate().showErrors({Name:n.msg});return}ProcessCashBankAccount()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");return}})}}function ProcessCashBankAccount(){$.LoadingOverlay("show");var n=document.getElementById("cash-bank-icon").files;n&&n.length>0?UploadMediaS3ClientSide("cash-bank-icon").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#cash-bank-object-key").val(n.objectKey);$("#cash-bank-object-name").val(n.fileName);$("#cash-bank-object-size").val(n.fileSize);CashBankAccountSubmit()}):CashBankAccountSubmit()}function CashBankAccountSubmit(){var n=new FormData($("#form_cash_bank")[0]);$.ajax({type:"post",cache:!1,url:"/TraderCashBank/SaveTraderCashAccount",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){},success:function(n){LoadingOverlayEnd();n.actionVal===1?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.createSuccess();showTableCashBankValue()},100)):n.actionVal===2?($("#app-trader-cashbank").modal("hide"),setTimeout(function(){cleanBookNotification.updateSuccess();showTableCashBankValue()},100)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){LoadingOverlayEnd();cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}})}function UploadImage(){UploadMediaS3ClientSide("form_specifics_icon").then(function(n){return n.objectKey})}function manageonclick(n){$.LoadingOverlay("show");window.location.href="/TraderCashBank/TraderCashAccount?id="+n+"&locationid=0"}function showTableCashBankValue(){$("#cashbank-content").LoadingOverlay("show");$("#cashbank-content").load("/TraderCashBank/TraderCashBankContents",function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#community-list-cash-bank").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#cashbank-content").LoadingOverlay("hide");setTimeout(function(){searchOnTableCashBank()},300)})}function LoadTableDataCashBank(n,t,i,r){r||(r=1);$("#"+n).on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i&&$(".loadingoverlay").length===0?$(n.currentTarget).LoadingOverlay("show"):$(n.currentTarget).LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',language:{infoFiltered:"",processing:loadingoverlay_value},serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:t,type:"GET",dataType:"json",data:function(n){return $.extend({},n,{keysearch:$("#search_dt_cb").val()})}},columns:i,order:[[r,"asc"]]})}function FilterDataCashBankByServerSide(){var n=[{name:"Image",data:"Image",render:function(n,t,i){return""+('<div class="table-avatar" style="background-image: url(\''+$("#api-uri").val()+i.Image+"&size=T');\">&nbsp;<\/div>")}},{name:"Name",data:"Name",orderable:!0,render:function(n,t,i){return""+('<h5 style="margin: 0; padding: 0 0 3px 0;">'+i.Name+"<\/h5>")}},{name:"BookkeepingAccount",data:"BookkeepingAccount",orderable:!1},{name:"FundsIn",data:"FundsIn",orderable:!1},{name:"FundsOut",data:"FundsOut",orderable:!1},{name:"Charges",data:"Charges",orderable:!1},{name:"Transactions",data:"Transactions",orderable:!1},{data:null,orderable:!1,render:function(n,t,i){var r='<div class="btn-group options">';return r+='<button type="button" class="btn btn-success dropdown-toggle"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+='<li><a href="#" onclick="manageonclick('+i.Id+')">Manage<\/a><\/li>',i.BankmateType==0&&(r+='<li><a href="#" data-toggle="modal" onclick="AddEditTraderCashBank('+i.Id+')" >Edit<\/a><\/li>'),r+="<\/ul> <\/div>",i.AllowEdit?r:""}}];LoadTableDataCashBank("community-list-cash-bank","/TraderCashBank/GetCashBankContent",n,1);CallBackFilterDataCashBankServeSide()}function CallBackFilterDataCashBankServeSide(){$("#community-list-cash-bank").DataTable().ajax.reload()}function moveModalIntoBody(n){var t=$(n);t.length>0&&($("body "+n).remove(),t.appendTo("body"))}function initCurrency(){$("#frmCurrencyConfiguration").submit(function(n){n.preventDefault();var t=$("select[name=CurrencySymbol]").val(),i=$("select[name=SymbolDisplay]").val(),r=$("select[name=DecimalPlace]").val();$.ajax({type:"post",url:this.action,data:{CurrencySymbol:t,SymbolDisplay:i,DecimalPlace:r},dataType:"json",success:function(n){if(n.result){cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles");var u="resetSettings('"+t+"','"+i+"','"+r+"')";$("#btnCurrencyReset").attr("onclick",u);tabs.istradingitemsload=!1;tradinggeneraltabs.istabcandbload=!1}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})})}function resetSettings(n,t,i){$("select[name=CurrencySymbol]").val(n).trigger("change");$("select[name=SymbolDisplay]").val(t).trigger("change");$("select[name=DecimalPlace]").val(i).trigger("change")}function loadModalTradingItemAdd(){var t,i,n;$("#wizard").hide();t=$("#sltype");i=$("#chkIsProduct");$("#app-trader-inventory-item-add").empty();n=$("#theform");n.fadeIn();n.empty();n.LoadingOverlay("show");n.load("/Commerce/LoadTradingItemAdd",{type:t.val(),isProduct:i.prop("checked")},function(){$("#theform .select2").select2({placeholder:"Please select"});$("#theform .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});n.LoadingOverlay("hide");initNextPreviousTab("#theform",".app_subnav");initFormTradingItem()})}function initNextPreviousTab(n,t){$(n+" .btnNext").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").next("li").find("a").trigger("click")});$(n+" .btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").prev("li").find("a").trigger("click")})}function initFormTradingItem(){recipes=[];var n=$("#frmTradingItem");n.validate({ignore:"",rules:{name:{required:!0,maxlength:150},description:{required:!0},extratags:{required:!0},sku:{required:!0,maxlength:50},barcode:{maxlength:50}},invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(t){var r,i,u;if(t.preventDefault(),!isBusy){if(r=$("#sltype").val(),r=="icompound"&&recipes.length===0){cleanBookNotification.error(_L("ERROR_MSG_628"),"Qbicles");$.LoadingOverlay("hide");return}if(!$("#item_protags").val()){$("#frmTradingItem").validate().showErrors({extratags:"This field is required."});$.LoadingOverlay("hide");return}n.valid()&&checkUniqueSKUandBarcode()&&($.LoadingOverlay("show"),i=document.getElementById("form_specifics_icon").files,u=$("#itemimg-object-key").val(),!u||i&&i.length>0?UploadMediaS3ClientSide("form_specifics_icon").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#itemimg-object-key").val(n.objectKey);saveTradingItem()}):saveTradingItem())}})}function saveTradingItem(){var n={Id:$("#traderItem_id").val(),Group:{Id:$("#frmTradingItem  select[name=groups]").val()},Name:$("#frmTradingItem  input[name=name]").val(),Description:$("#form_specifics_description").text(),DescriptionText:$("#form_specifics_description_text").val(),ImageUri:$("#itemimg-object-key").val(),Locations:[],Units:[],Barcode:$("#frmTradingItem  input[name=barcode]").val(),SKU:$("#frmTradingItem  input[name=sku]").val(),IsCompoundProduct:!1,PrimaryVendors:[],InventoryDetails:[],ResourceDocuments:[],AdditionalInfos:[],AssociatedRecipes:[],VendorsPerLocation:[],PurchaseAccount:[],SalesAccount:[],TaxRates:[],InventoryAccount:[],IsCommunityProduct:!1,IsBought:!1,IsSold:!1,IsActiveInAllLocations:!0,GalleryItems:GetGalleryItems()},w,y,b,k,c,l,a,p,t,r,i,u,v,nt,s,f,tt,e,h,o;if($("#item_brand").val()!==""&&$("#item_brand").val()!==null&&n.AdditionalInfos.push({Id:$("#item_brand").val(),Type:1}),$("#item_protags").val())for(w=$("#item_protags").val(),y=JSON.parse(w),t=0;t<y.length;t++)n.AdditionalInfos.push({Id:0,Name:y[t].value,Type:4});b=$("#sltype").val();k=$("#chkIsProduct").prop("checked");switch(b){case"isell":n.IsSold=!0;break;case"ibuysell":n.IsSold=!0;n.IsBought=!0;break;case"icompound":n.IsSold=!0;n.IsBought=!1;n.IsCompoundProduct=!0;break;default:n.IsBought=!0}if(c=$("#sl_taxrate_purchase").val(),c)for(t=0;t<c.length;t++)n.TaxRates.push({Id:c[t]});if(l=$("#sl_taxrate_sale").val(),l)for(t=0;t<l.length;t++)n.TaxRates.push({Id:l[t]});if(recipes.length>0)for(t=0;t<recipes.length;t++)n.AssociatedRecipes.push(recipes[t]);if(k&&(a=$("#local-manage-select").val(),a&&n.InventoryDetails.push({Location:{Id:a},MinInventorylLevel:$("#form_inventory_mininv").val().replace(/\,/g,""),MaxInventoryLevel:$("#form_inventory_maxinv").val().replace(/\,/g,""),CurrentInventoryLevel:0})),$("#item_brand").val()!==""&&$("#item_brand").val()!==null&&n.AdditionalInfos.push({Id:$("#item_brand").val()}),$("textarea[name='extratags']").val()!==""&&$("textarea[name='extratags']").val()!==null)for(p=JSON.parse($("textarea[name='extratags']").val()),t=0;t<p.length;t++)n.AdditionalInfos.push({Id:p[t].id});var d=$("#ivquantity").val(),g=$("#ivunitcost").val(),it={LocationId:a,Quantity:d?d:0,Unitcost:g?g:0};if($("#unit_conversions tbody tr#add-unit-row").length>0&&$("#unit_conversions tbody tr#add-unit-row").remove(),$("#unit_conversions tbody tr").length>0&&$("#unit_conversions tbody tr td").length>1&&(r=$("#unit_conversions tbody tr"),r.length>0)){for(i=[],u=0;u<r.length;u++)v=$($(r[u]).find("td.row_componentUnit input")).val(),nt={Id:$($(r[u]).find("td.row_name .unitIds")).val(),Name:$($(r[u]).find("td.row_name .unitName")).val(),IsBase:$($(r[u]).find("td.row_name p")).text()==="true"?!0:!1,MeasurementType:$("#item_measure_type").val(),Quantity:$($(r[u]).find("td.row_quantity")).text(),QuantityOfBaseunit:$($(r[u]).find("td.row_name span")).text(),IsActive:$(r[u]).find("td.row_active input")[0].checked,ParentUnit:v&&v!==""?{Id:v}:null},i.push(nt);if(i.length>0){for(s=0;s<i.length;s++)i[s].ParentUnit=selectedChild(i[s],i);for(f=0;f<i.length;f++)if(tt=i[f].Id.toString(),isNaN(parseInt(i[f].Id.toString()))){if(n.AssociatedRecipes&&n.AssociatedRecipes.length>0)for(e=0;e<n.AssociatedRecipes.length;e++)if(n.AssociatedRecipes[e].Ingredients&&n.AssociatedRecipes[e].Ingredients.length>0)for(h=0;h<n.AssociatedRecipes[e].Ingredients.length;h++)n.AssociatedRecipes[e].Ingredients[h].Unit.Id===i[f].Id&&(n.AssociatedRecipes[e].Ingredients[h].Unit.Id=int);for(i[f].Id=int,o=0;o<i.length;o++)f!==o&&i[o].Id===tt&&(i[o].Id=int);int--}n.Units=i}}$.ajax({type:"post",url:"/TraderItem/SaveItemProduct?currentLocationId=0&isCurrentLocation=false",data:{item:n,createInventory:it},dataType:"json",success:function(n){n.actionVal===1?(cleanBookNotification.createSuccess(),$("#wizard-add-item").modal("hide"),CallBackFilterDataItemOverViewServeSide(!0)):n.actionVal===3&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function checkUniqueSKUandBarcode(){var t=$("#frmTradingItem input[name=sku]").val(),r=$("#frmTradingItem input[name=barcode]").val(),i=$("#frmTradingItem").validate(),n=!0;return t||(n=!1,i.showErrors({sku:"The Product SKU is required!"})),t&&$.ajax({method:"POST",data:{traderId:$("#traderItem_id").val(),SKU:t,Barcode:r},url:"/TraderItem/validateUniqueSKUandBarcode",dataType:"json","async":!1}).done(function(t){t.sku&&(n=!1,i.showErrors({sku:"The Product SKU already exists!"}));t.barcode&&(n=!1,i.showErrors({barcode:"The Product Barcode already exists!"}));$('a[href="#item-details"]').click()}),n}function filterTradingItemByServerSide(){var n=$("#items").attr("SubscribeTrader"),t=[{data:"ImageUri",orderable:!1,render:function(n,t,i){return""+('<a href="'+apiDoc+i.ImageUri+'" class="table-avatar image-pop" rel="resources" style="display: block; background-image: url(\''+apiDoc+i.ImageUri+"&size=T');\">&nbsp;<\/a>")}},{name:"ItemName",data:"ItemName",orderable:!0,render:function(n,t,i){return i.ItemName}},{name:"SKU",data:"SKU",orderable:!0},{name:"Barcode",data:"Barcode",orderable:!0},{orderable:!1,render:function(n,t,i){var r="";return i.IsBought&&(r+='<span class="label label-lg label-warning">Item I buy<\/span> '),i.IsSold&&(r+='<span class="label label-lg label-success">Item I sell<\/span> '),i.IsCompoundProduct&&(r+='<span class="label label-lg label-primary">Compound<\/span> '),r}},{name:"GroupName",data:"GroupName",orderable:!0},{name:"Description",render:function(n,t,i){return'<a data-toggle="modal" href="#app-trader-item-description" onclick="showTraderItemDescription(\''+i.Id+"')\">"+i.Description+"<\/a>"},orderable:!0},{name:"Vendor",data:"Vendor",orderable:!1},{orderable:!1,render:function(t,i,r){return""+(n?'<button class="btn btn-info" title="Subscribe to Trader to unlock this feature" data-toggle="modal" onclick="showTraderItemAdditional(\''+r.Id+'\')" data-target="#app-trader-item-additional"><i class="fa fa-list"><\/i> &nbsp; View<\/button>':'<button class="btn btn-info" title="Subscribe to Trader to unlock this feature" disabled><i class="fa fa-list"><\/i> &nbsp; View<\/button>')}},{name:"IsActive",data:"IsActive",orderable:!0,render:function(n,t,i){return""+(i.IsActive?'<label><i class="fa fa-check green" style="width: 15px;"><\/i> &nbsp; Active<\/label>':'<label><i class="fa fa-remove red" style="width: 15px;"><\/i> &nbsp; Inactive<\/label>')}},{data:null,orderable:!1,width:"100px",render:function(n,t,i){var r="";return r+='<div class="btn-group options">',r+='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',r+='<i class="fa fa-cog"><\/i> &nbsp; Options <\/button>',r+='<ul class="dropdown-menu dropdown-menu-right" style="right: 0;">',r+(i.IsBought?'<li><a href="javascript:void(0)" onclick="editTraderItem(1, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>":'<li><a href="javascript:void(0)" onclick="editTraderItem(2, '+i.Id+", 'item-tab')\">Edit<\/a><\/li>")}}];LoadTableDataItemOverView("tb_trader_items","/Trader/GetDataItemOverView",t);CallBackFilterDataItemOverViewServeSide(!1)}function initIVCreateModal(){var i=$("#frmTradingItem  input[name=name]"),n,t;if(!i.valid()){$("#app-trader-inventory-create").modal("hide");$('a[href="#item-details"]').click();return}if($(".iv-item-name").text(i.val()),n=$("#unit_conversions tr td.row_name p:contains('true')"),n.text()==="true")if(t=n.closest("tr").find("td.row_name .unitName").val(),t)$(".iv-unit-base-name").text(t);else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}else{cleanBookNotification.error(_L("ERROR_MSG_700"),"Qbicles");return}$("#frmCreateInventory").validate({rules:{ivquantity:{required:!0,min:0},ivunitcost:{required:!0,min:0}}});$("#frmCreateInventory").submit(function(n){if(n.preventDefault(),$("#frmCreateInventory").valid()){var t=parseFloat($("#ivquantity").val());$("#form_inventory_instock").val(t);$("#app-trader-inventory-create").modal("hide")}else $("#ivquantity").val(0),$("#ivunitcost").val(0)});$("#app-trader-inventory-create").modal("show")}function saveOverNewRecipe(n){var e,t,i;if(validateRecipeForm(n)){var r="",u=0,f=!1;if(n==="tb_add_recipe"?(r=$("#form_add_recipe_name").val(),u=int,f=$("#form_add_recipe_iscurrent")[0].checked,int--):n==="tb_edit_recipe"&&(r=$("#edit_recipe_name").val(),u=$("#edit_recipe_form_id").val(),f=$("#edit_recipe_iscurrent")[0].checked),e={Id:u,Name:r,Ingredients:[],IsActive:!0,IsCurrent:f},t=$("#"+n+" tbody tr"),t.length>0)for(i=0;i<t.length;i++)$($(t[i]).find("td.item_name select")).val()||$($(t[i]).find("td.item_name select")).val(""),e.Ingredients.push({Id:$($(t[i]).find("td.item_name input")).val(),SubItem:{Id:$($(t[i]).find("td.item_name select")).val().split("|")[0]},Quantity:$($(t[i]).find("td.item_quantity input")).val(),Unit:{Id:$($(t[i]).find("td.item_selected select")).val()},AverageCost:$($(t[i]).find("td.item_averagecost span")).text(),LatestCost:$($(t[i]).find("td.item_latestcost span")).text()});addObjectToRecipeTable(e);$("#newrecipe").hide();$("#editrecipe").hide()}}function validateRecipeForm(n){var t=!0,r,i,u,f,e;for(n==="tb_add_recipe"?$("#form_add_recipe_name").val().trim()===""&&(t=!1,$("#frmTradingItem").validate().showErrors({recipe_name:"Recipe name is required."})):$("#edit_recipe_name").val().trim()===""&&(t=!1,$("#frmTradingItem").validate().showErrors({recipe_name_edit:"Recipe name is required."})),r=$("#"+n+" tr"),i=0;i<r.length;i++){if(u=$(r[i]).find("td.item_name select"),u.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_623"),"Recipe items");break}if(f=$(r[i]).find("td.item_quantity input"),f.val()<=0){t=!1;cleanBookNotification.error(_L("ERROR_MSG_624"),"Recipe items");break}if(e=$(r[i]).find("td.item_selected select"),e.val()===""){t=!1;cleanBookNotification.error(_L("ERROR_MSG_625"),"Recipe items");break}}return t}function checkInventoryChooseBP(n){$(n).valid();var t=$(n).val();t?($(".iv-locations").text($(n).find(":selected").text()),$(".btnaddinventory").prop("disabled",!1)):$(".btnaddinventory").prop("disabled",!0)}function initPluginsOfTabGarenal(n){n||(getLocationsDomain($("#logistics-general select[name=locations]"),n),$("#logistics-general #select-traderitems").select2({ajax:{url:"/TraderItem/Select2TraderItemsByLocationId",delay:250,data:function(n){return{keyword:n.term,page:n.page||1,locationId:$('#logistics-general select[name="locations"]').val()}},cache:!0},minimumInputLength:1}))}function saveDeliverySettings(n){$.LoadingOverlay("show");var t={Id:0,DeliveryService:{Id:n},Location:{Id:$("#logistics-general select[name=locations]").val()}};$.post("/TraderChannels/SaveDeliverySettings",{settings:t},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()})}function saveB2bPriceList(){var n=new FormData($("#frmb2bpricelist")[0]);$.ajax({type:"post",cache:!1,url:"/TraderChannels/SavePriceList",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#delivery-charge-pricelist-add").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}})}function loadContentChargeFramework(n){$(".pricelists").hide();var t=$("#framework-1");t.fadeIn();t.empty();t.LoadingOverlay("show");t.load("/TraderChannels/LoadContentChargeFramework",{priceId:n},function(){t.LoadingOverlay("hide")})}function loadModalDeliveryChargeFramework(n,t){var i=$("#delivery-charge-framework-add");i.empty();i.modal("show");i.load("/TraderChannels/LoadModalDeliveryChargeFramework?",{priceListId:t,id:n},function(){var n=$("#frmChargeFramework");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},DistanceTravelledFlatFee:{required:!0},DistanceTravelPerKm:{required:!0},TimeTakenFlatFee:{required:!0},TimeTakenPerSecond:{required:!0},ValueOfDeliveryFlatFee:{required:!0},ValueOfDeliveryPercentTotal:{required:!0,min:0,max:100}}});n.submit(function(r){(r.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(i.modal("hide"),loadContentChargeFramework(t),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))});initSelect2avatarDelivery()})}function initPriceCloneCurrentLocation(n,t){$("#frmPriceListCLocationClone input[name=cloneId]").val(n);$("#frmPriceListCLocationClone input[name=cloneName]").val(t);$("#frmPriceListCLocationClone input[ name=locationId]").val($("#location_item_"+n).val());$("#b2b-charge-framework-clone").modal("show")}function initFormClonePriceList(n){if(!n){var t=$("#frmPriceListCLocationClone");t.validate({rules:{cloneName:{required:!0,minlength:3,maxlength:150}}});t.submit(function(n){(n.preventDefault(),isBusy)||t.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#b2b-charge-framework-clone").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))});$("#txtplkeyword").keyup(delay(function(){loadContentPriceList()},400))}}function initFormCloneOtherLocationPriceList(){var n=$("#frmPriceListOtherLocationClone");n.validate({rules:{cloneName:{required:!0,minlength:3,maxlength:150},locationId:{required:!0}}});n.submit(function(t){(t.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#b2b-charge-framework-port").modal("hide"),loadContentPriceList(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()}}))})}function loadModalLocationChange(n){var t=$("#b2b-charge-framework-port");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalChargeFrameworkPort?priceId="+n,function(){initFormCloneOtherLocationPriceList();$("#frmPriceListOtherLocationClone .select2").select2({placeholder:"Please select"})})}function deletePriceList(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"B2B Logistics",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeletePriceList",{id:n},function(n){n.result?loadContentPriceList():!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function deleteChargeFramework(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"B2B Logistics",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteChargeFramework",{id:n},function(n){n.result?loadContentChargeFramework($("#hdfPriceListId").val()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function loadModalDeliveryVehicle(n){var t=$("#delivery-vehicle-add");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalDeliveryVehicle?id="+n,function(){var n=$("#frmVehicle");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},RefOrRegistration:{required:!0,maxlength:50}}});n.submit(function(i){(i.preventDefault(),isBusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(t.modal("hide"),reloadTableVehicles(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()}}))});initSelect2avatarDelivery()})}function initSelect2avatarDelivery(){$(".select2avatar-delivery").select2({placeholder:"Please select",templateResult:formatOptions2,templateSelection:formatSelected2})}function formatOptions2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function formatSelected2(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+$(n.element).data("iconurl")+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function reloadTableVehicles(){setTimeout(function(){$("#tblvehicles").DataTable().ajax.reload()},100);loadVehicles()}function reloadTableDrivers(){$.fn.DataTable.isDataTable("#tbldrivers")&&setTimeout(function(){$("#tbldrivers").DataTable().ajax.reload()},100)}function deleteVehicle(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Trader",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteVehicle",{id:n},function(n){n.result?reloadTableVehicles():!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function deleteDriver(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Trader",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/TraderChannels/DeleteDriver",{id:n},function(n){n.result?reloadTableDrivers():!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics")});return}}})}function searchDeliveryDrivers(){var n=$("#txtmembersearch").val();$(".contact-list-found").LoadingOverlay("show");$(".contact-list-found").load("/TraderChannels/LoadModalDeliveryDriver",{keyword:n},function(){$(".existing-member").show();$(".contact-list-found").LoadingOverlay("hide")})}function setOnOffDuty(n,t){$.post("/TraderChannels/UpdateStatusDriver",{id:n,status:t},function(n){n.result?reloadTableDrivers():!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function loadModalLocationChange(n){var t=$("#b2b-driver-location-change");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalLocationChange?driverId="+n,function(){var n=$("#frmLocationchange");n.submit(function(n){(n.preventDefault(),isBusy)||($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){isBusy=!0},success:function(n){n.result?(t.modal("hide"),reloadTableDrivers(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader");LoadingOverlayEnd()}}))});$("#frmLocationchange .select2").select2()})}function updateVehicleDriver(n,t){$.post("/TraderChannels/UpdateVehicleDriver",{id:n,vehicleId:$(t).val()},function(n){n.result?cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Trader"):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Trader"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Trader")})}function loadContentMemberDetail(n){var t=$(".contact-add");t.empty();t.LoadingOverlay("show");t.load("/TraderChannels/LoadContentMemberDetail?posUId="+n,function(){t.LoadingOverlay("hide");$("#slLocationIdForDriver").select2({placeholder:"Please select"});$(".contact-list-found").hide();$(".contact-invite").hide();$(".contact-add").hide();$(".contact-add").fadeIn()})}function saveMember(){var n=$("#slLocationIdForDriver").val();if(n==0){cleanBookNotification.error(_L("ERROR_MSG_622"),"B2B Logistics");return}$.LoadingOverlay("show");$.post("/TraderChannels/AddDriver",{posUId:$("#hdfPosUid").val(),accountId:$("#hdfAccountId").val(),locationId:n,driverUserId:$("#hdfUserid").val()},function(n){n.result?($("#delivery-driver-add").modal("hide"),reloadTableDrivers(),$("#lnkBackSearch").click(),$("#txtmembersearch").val(""),$(".contact-list-found").empty(),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"B2B Logistics")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"B2B Logistics"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2B Logistics");LoadingOverlayEnd()})}function initSelectedAccount(){setTimeout(function(){$(".selectaccount").removeClass("selectaccount");$(".accountid-"+BKAccount.Id).addClass("selectaccount")},1)}function loadContentItemInfo(){var t=$("#logistics-general #select-traderitems").val(),n;t&&(n=$("#item-info"),n.empty(),n.LoadingOverlay("show"),n.load("/TraderChannels/LoadContentItemInfo?itemId="+t,function(){$("#tbliteminfo").DataTable();n.LoadingOverlay("hide")}))}function loadModalPriceList(n){var t=$("#delivery-charge-pricelist-add");t.empty();t.modal("show");t.load("/TraderChannels/LoadModalPriceList?id="+n,function(){$("#delivery-charge-pricelist-add select.select2").select2({placeholder:"Please select"});var n=$("#frmb2bpricelist");n.validate({rules:{Name:{required:!0,minlength:3,maxlength:150},Icon:{filesize:!0},Summary:{required:!0,minlength:3,maxlength:500}}});n.submit(function(t){if((t.preventDefault(),!isBusy)&&n.valid()){$.LoadingOverlay("show");var i=document.getElementById("b2b-price-icon-input").files;i.length>0?UploadMediaS3ClientSide("b2b-price-icon-input").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#b2b-price-icon-object-key").val(n.objectKey);$("#b2b-price-icon-object-name").val(n.fileName);$("#b2b-price-icon-object-size").val(n.fileSize);saveB2bPriceList()}):($("#b2b-price-icon-object-key").val(""),$("#b2b-price-icon-object-name").val(""),$("#b2b-price-icon-object-size").val(""),saveB2bPriceList())}})})}function loadContentPriceList(){var n=$("#b2b-charges-content");n.empty();n.LoadingOverlay("show");n.load("/TraderChannels/LoadContentPriceList",{keyword:$("#txtplkeyword").val(),locationId:$("#logistics-charges select[name=locations]").val()},function(){n.LoadingOverlay("hide")})}function loadVehicles(){$.get("/TraderChannels/GetVehiclesForSelect2",function(n){dataVehicles=n})}function initPluginsOfTabVehicles(n){n||($("#tblvehicles").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#logistics-vehicles").LoadingOverlay("show"):$("#logistics-vehicles").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/TraderChannels/SearchVehicles",data:function(n){return $.extend({},n,{keyword:$("#txtvehiclekeyword").val()})}},columns:[{title:"Vehicle type",data:"VehicleType",searchable:!0,orderable:!0},{title:"Name",data:"Name",searchable:!0,orderable:!0},{title:"Reference or registration",data:"RefOrRegistration",searchable:!0,orderable:!0},{title:"Options",data:"Id",searchable:!0,orderable:!1,render:function(n){var t='<div class="btn-group"><button class="btn btn-primary" data-toggle="dropdown"><i class="fa fa-cog"><\/i><\/button>';return t+='<ul class="dropdown-menu dropdown-menu-right primary">',t+='<li><a href="#" onclick="loadModalDeliveryVehicle('+n+')">Edit<\/a><\/li>',t+='<li><a href="#" onclick="deleteVehicle('+n+')">Delete<\/a><\/li>',t+"<\/ul><\/div>"}}]}),$("#tblvehicles").DataTable().ajax.reload(),$("#txtvehiclekeyword").keyup(delay(function(){reloadTableVehicles()},400)))}function getLocationsDomain(n,t){t||$.get("/Commerce/getLocationsOfCurrentDomain",function(t){n.select2("destroy");n.select2({placeholder:"Please select",data:t})})}function initPluginsOfTabDrivers(n){if(!n){loadVehicles();var t=$("#tbldrivers");t.on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#logistics-drivers").LoadingOverlay("show"):$("#logistics-drivers").LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/TraderChannels/SearchDrivers",data:function(n){return $.extend({},n,{keyword:$("#txtSearchDriver").val(),locationId:$("#logistics-drivers select[name=locations]").val()})}},columns:[{title:"Driver",data:"Driver",searchable:!0,orderable:!0,render:function(n,t,i){var r='<a href="#"><div class="table-avatar mini pull-left" style="background-image: url(\''+i.DriverIcon+"');\"><\/div>";return r+='<div class="avatar-name pull-left" style="color: #333; line-height: 4; padding-left: 15px;">'+n+"<\/div>",r+'<div class="clearfix"><\/div><\/a>'}},{title:"Email",data:"Email",searchable:!0,orderable:!0,render:function(n){return'<a href="mailto:'+n+'">'+n+"<\/a>"}},{title:"Verhicle",data:"VehicleId",searchable:!0,orderable:!0,render:function(n,t,i){var r='<select name="vehicle" onchange="updateVehicleDriver('+i.Id+',this)" class="form-control select2 dt-select2" style="width: 100%;">';return r+="<option><\/option>",dataVehicles.forEach(function(t){r+='<optgroup label="'+fixQuoteCode(t.GroupName)+'">';t.Items&&t.Items.forEach(function(t){r+='<option value="'+t.Id+'" '+(t.Id==n?"selected":"")+">"+fixQuoteCode(t.Text)+"<\/option>"});r+="<\/optgroup>"}),r+="<\/select>"}},{title:"Status",data:"Status",searchable:!0,orderable:!0,render:function(n){var t='<label class="label label-lg label-success">Active<\/label>';return n!=1&&(t='<label class="label label-lg label-warning">Off duty<\/label>'),t}},{title:"Options",data:"Id",searchable:!0,orderable:!1,render:function(n,t,i){var r='<div class="btn-group"><button class="btn btn-primary" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-cog"><\/i><\/button>';return r+='<ul class="dropdown-menu dropdown-menu-right primary">',r+=i.Status==1?'<li><a href="javascript:void(0)" onclick="setOnOffDuty('+n+',2)">Set off duty<\/a><\/li>':'<li><a href="javascript:void(0)" onclick="setOnOffDuty('+n+',1)">Set on duty<\/a><\/li>',r+='<li><a href="javascript:void(0)" onclick="loadModalLocationChange('+n+')">Change location<\/a><\/li>',r+='<li><a href="javascript:void(0)" onclick="deleteDriver('+n+')">Delete<\/a><\/li>',r+"<\/ul><\/div>"}}],drawCallback:function(){$(".dt-select2").select2({placeholder:"Please select"})}});reloadTableDrivers();$("#txtmembersearch").keyup(delay(function(){searchDeliveryDrivers()},400));$("#txtSearchDriver").keyup(delay(function(){reloadTableDrivers()},400))}}function updateB2BUsabilty(){var n=$("#hdfProfileId").val(),t=$("input[name=b2b-service-toggle]").prop("checked");LoadingOverlay();$.ajax({method:"POST",dataType:"JSON",url:"/Commerce/ChangeB2BServiceAcessibilityStatus",data:{profileId:n,IsActive:t},success:function(n){n.result?cleanBookNotification.updateSuccess():cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).done(function(){LoadingOverlayEnd()})}function initSelectedAccount(){}function closeSelected(){BKAccount.Id?($(".accountInfo").empty(),$(".accountInfo").append(BKAccount.Name)):$(".accountInfo").empty();$(".accountInfo").text().length>0?($(".addbtnaccount").attr("style","display:none;"),$(".editbtnaccount").removeAttr("style")):$(".accountInfo").text().length===0&&($(".editbtnaccount").attr("style","display:none;"),$(".addbtnaccount").removeAttr("style"))}function selectAccount(n,t){var i=$(".accountid-"+t).data("name");$(".selectaccount").removeClass("selectaccount");$(n).addClass("selectaccount");BKAccount.Id=t;BKAccount.Name=i;$("#accountId").length>0&&$("#accountId").val(t);$("#hdfAccountId").length>0&&$("#hdfAccountId").val(t);$("#hdfcontactaccountId").length>0&&$("#hdfcontactaccountId").val(t);closeSelected();$("#app-bookkeeping-treeview").modal("hide")}function showChangeAccount(){setTimeout(function(){CollapseAccount()},1)}function CollapseAccount(){$(".jstree").jstree("close_all")}function initSelectedAccount(){setTimeout(function(){$(".selectaccount").removeClass("selectaccount");$(".accountid-"+BKAccount.Id).addClass("selectaccount")},1)}function initPluginsOfTabArchived(n){n||(getArchivedPromotions(),$("#tblArchivedPromotions").DataTable().ajax.reload(),$("#promos-archive input[name=search]").keyup(delay(function(){$("#tblArchivedPromotions").DataTable().ajax.reload()},1e3)),$("#promos-archive select[name=type]").change(function(){$("#tblArchivedPromotions").DataTable().ajax.reload()}),$("#promos-archive input[name=scheduleddate]").change(function(){$("#tblArchivedPromotions").DataTable().ajax.reload()}))}function getArchivedPromotions(){var n=$("#tblArchivedPromotions");n.on("processing.dt",function(t,i,r){$("#processingIndicator").css("display","none");r?n.LoadingOverlay("show"):n.LoadingOverlay("hide",!0)}).dataTable({destroy:!0,serverSide:!0,paging:!0,searching:!0,autoWidth:!0,searchDelay:800,pageLength:10,deferLoading:30,order:[[0,"asc"]],ajax:{url:"/Commerce/GetArchivedPromotions",data:function(n){return $.extend({},n,{keyword:$("#promos-archive input[name=search]").val(),daterange:$("#promos-archive input[name=scheduleddate]").val(),type:$("#promos-archive select[name=type]").val()})}},columns:[{data:"Name",orderable:!0},{data:"Type",orderable:!0},{data:"StartDate",orderable:!0},{data:"EndDate",orderable:!0}]})}function initPluginsOfTabActive(n){n||(loadActivePromotions(),$("#promos-active input[name=search]").keyup(delay(function(){loadActivePromotions()},1e3)),$("#promos-active select[name=type]").change(function(){loadActivePromotions()}),$("#promos-active input[name=scheduleddate]").change(function(){loadActivePromotions()}),$("#promos-active select[name=status]").change(function(){loadActivePromotions()}))}function loadActivePromotions(n){var i={keyword:$("#promos-active input[name=search]").val(),daterange:$("#promos-active input[name=scheduleddate]").val(),type:$("#promos-active select[name=type]").val(),status:$("#promos-active select[name=status]").val()},t=$("#promos-active .flex-grid-quarters-lg");n||t.LoadingOverlay("show");t.load("/Commerce/LoadActivePromotions",{filterModel:i},function(){t.LoadingOverlay("hide")})}function OpenPromotion(n){$.LoadingOverlay("show");window.location.href="/Commerce/Promotion?key="+n}function loadModalPromotionAddEdit(n){$.LoadingOverlay("show");var t=$("#moniback-promo-add");t.empty();t.modal("show");t.load("/Commerce/LoadModalPromotionAddEdit",{promotionKey:n},function(){$("#moniback-promo-add .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#moniback-promo-add .select2").select2({placeholder:"Please select"});$("#moniback-promo-add .singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#moniback-promo-add .chktoggle").bootstrapToggle();initFormPromotionValidate();setTimeout(function(){$.LoadingOverlay("hide")},500)})}function initFormPromotionValidate(){var n=$("#frmAddEditPromotion");n.validate({ignore:"",invalidHandler:function(n,t){console.log(t,"validator");t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(t){if((t.preventDefault(),setMinTimeFromToTimePromotion(),!isBusy)&&n.valid()){$.LoadingOverlay("show");var i=document.getElementById("filefeaturedimg").files,r=$("#hdffeaturedimguri").val();!r||i&&i.length>0?UploadMediaS3ClientSide("filefeaturedimg").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#hdffeaturedimguri").val(n.objectKey);savePromotion()}):savePromotion()}})}function switchpromos(n){$(n).valid();$(".promotype").hide();var t=$(n).val();t=="1"?$("#itemdiscount").show():t=="2"&&$("#orderdiscount").show();setValidateItemAndOrderByType(t)}function startPromotion(n){stopStartPromotion(n,!1)}function stopPromotion(n){stopStartPromotion(n,!0)}function openPromotionMessageModel(n,t,i,r){$promotionKey=n;$promotionName=t;$promotionStop=r;var u=$("#promotion-message-modal");$("#promotion-name").text($promotionName);$("#total-claimed").text(i);$promotionMessage=$("#business-name").val()+' have stopped their "'+$promotionName+'" promotion.\nAny vouchers you have not redeemed for this promotion will be affected.\nIf you have any questions please leave us a message.';$("#message-title").text("Stopping");$promotionStop||($("#message-title").text("Restarting"),$promotionMessage=$("#business-name").val()+' have restarted their "'+$promotionName+'" promotion.\nAny vouchers you have not redeemed for this promotion should now be available.\nIf you have any questions please leave us a message.');$("#promotion-message-text").val($promotionMessage);u.modal("show")}function stopStartPromotion(){$.LoadingOverlay("show");$.post("/Commerce/StopStartPromotion",{promotionKey:$promotionKey,isStop:$promotionStop,message:$("#promotion-message-text").val()},function(n){LoadingOverlayEnd();n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Promotions & vouchers"),loadActivePromotions(!0)):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")})}function archivePromotion(n){$.LoadingOverlay("show");$.post("/Commerce/ArchivePromotion",{promotionKey:n},function(n){n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Promotions & vouchers"),loadActivePromotions(!0)):!Response.result&&Response.msg?cleanBookNotification.error(Response.msg,"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers");LoadingOverlayEnd()})}function savePromotionDraftOld(){var n,t,i;isDraft=!0;n=$("#frmAddEditPromotion");n.validate({ignore:"",invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});setMinTimeFromToTimePromotion();n.valid()&&($.LoadingOverlay("show"),t=document.getElementById("filefeaturedimg").files,i=$("#hdffeaturedimguri").val(),!i||t&&t.length>0?UploadMediaS3ClientSide("filefeaturedimg").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#hdffeaturedimguri").val(n.objectKey);savePromotion()}):savePromotion())}function savePromotion(){var n="#frmAddEditPromotion",i=$(n+" select[name=Days]").val();i||(i=[]);var t={model:{PromotionKey:$(n+" input[name=PromotionKey]").val(),Name:$(n+" input[name=Name]").val(),Description:$(n+" textarea[name=Description]").val(),StartDateString:$(n+" input[name=StartDate]").val(),EndDateString:$(n+" input[name=EndDate]").val(),DisplayDateString:$("#chkAdvertiseCustome").prop("checked")?$(n+" input[name=DisplayDate]").val():$(n+" input[name=StartDate]").val(),DaysOfweek:$("#chkSpecificTime").prop("checked")?i.join(","):[],FromTime:$(n+" input[name=FromTime]").val(),ToTime:$(n+" input[name=ToTime]").val(),VoucherExpiryDateString:$("#chkExpiryDate").prop("checked")?$("#expiry-date").val():"",IsDraft:$(n+" input[name=IsDraft]").val(),Audience:{}},itemDiscountVoucherInfo:{},orderDiscountVoucherInfo:{}},o=$(n+" select[name=Locations]").val(),r=[];$.each(o,function(n,t){r.push({Id:t})});var u=$(n+" select[name=Type]").val(),e=$(n+" input[name=Plan]").val(),f=$(n+" select[name=locationVisibility]").val();t.featuredImageUri=$("#hdffeaturedimguri").val();t.model.Type=u;t.model.PlanType={Id:e};t.model.Audience=f=="1"?{LocationVisibility:f,Distance:$(n+" input[name=distance]").val(),DistanceFactor:$(n+" select[name=factor]").val(),BusinessLocation:$(n+" select[name=location]").val()}:{LocationVisibility:f};u=="1"?(t.itemDiscountVoucherInfo={Id:0,MaxVoucherCount:$(n+" input[name=MaxVoucherCount]").val(),MaxVoucherCountPerCustomer:$(n+" input[name=MaxVoucherCountPerCustomer]").val(),TermsAndConditions:$(n+" textarea[name=TermsAndConditions]").val(),Locations:$("#chkSpecificLocation").prop("checked")?r:[],ItemSKU:$(n+" input[name=hdfItemSKU]").val(),ItemDiscount:$(n+" input[name=ItemDiscount]").val(),MaxNumberOfItemsPerOrder:$(n+" input[name=MaxNumberOfItemsPerOrder]").val()},t.itemDiscountVoucherInfo.MaxVoucherCount||(t.itemDiscountVoucherInfo.MaxVoucherCount=-1),t.itemDiscountVoucherInfo.MaxNumberOfItemsPerOrder||(t.itemDiscountVoucherInfo.MaxNumberOfItemsPerOrder=-1)):u=="2"&&(t.orderDiscountVoucherInfo={Id:0,MaxVoucherCount:$(n+" input[name=MaxVoucherCount]").val(),MaxVoucherCountPerCustomer:$(n+" input[name=MaxVoucherCountPerCustomer]").val(),TermsAndConditions:$(n+" textarea[name=TermsAndConditions]").val(),Locations:$("#chkSpecificLocation").prop("checked")?r:[],OrderDiscount:$(n+" input[name=OrderDiscount]").val(),MaxDiscountValue:$(n+" input[name=MaxDiscountValue]").val()},t.orderDiscountVoucherInfo.MaxVoucherCount||(t.orderDiscountVoucherInfo.MaxVoucherCount=-1),t.orderDiscountVoucherInfo.MaxDiscountValue||(t.orderDiscountVoucherInfo.MaxDiscountValue=-1));$.ajax({type:"post",url:"/Commerce/SavePromotion",data:t,dataType:"json",success:function(n){if(console.log(n,"res"),n.result){if(console.log(t.model,"model"),t.model.IsDraft=="false"&&e!=="1"&&n.Object!==null){var{access_code:i}=n.Object;const t=new PaystackPop;t.newTransaction({accessCode:i,onLoad:n=>{console.log("onLoad: ",n)},onSuccess:n=>{n?.status=="success"?$.ajax({type:"post",url:"/Commerce/UpdatePromotionPayment",data:{reference:n?.reference,status:"success"},dataType:"json",success:function(n){n.result?cleanBookNotification.createSuccess():!n.result&&n.msg?cleanBookNotification.error(n.msg,"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}):cleanBookNotification.error("Error processing payment","Promotions & vouchers"),console.log(n,"res")},onCancel:n=>{console.log("onCancel",n)},onError:n=>{$.ajax({type:"post",url:"/Commerce/UpdatePromotionPayment",data:{reference:n?.reference,status:"error"},dataType:"json",success:function(n){cleanBookNotification.error(n.msg,"Promotions & vouchers")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}),cleanBookNotification.error("Error processing payment","Promotions & vouchers"),console.log("Error: ",n.message)}})}else cleanBookNotification.createSuccess();$("#moniback-promo-add").modal("hide");loadActivePromotions(!1)}else!n.result&&n.msg?cleanBookNotification.error(n.msg,"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}).always(function(){loadActivePromotions(!1);LoadingOverlayEnd()})}function retryPromotionPayment(n){$.LoadingOverlay("show");$.ajax({type:"post",url:"/Commerce/RetryPromotionPayment",data:{promotionKey:n},dataType:"json",success:function(n){if(console.log(n,"res"),n.result){var{access_code:t}=n.Object;const i=new PaystackPop;i.newTransaction({accessCode:t,onLoad:n=>{console.log("onLoad: ",n)},onSuccess:n=>{n?.status=="success"?$.ajax({type:"post",url:"/Commerce/UpdatePromotionPayment",data:{reference:n?.reference,status:"success"},dataType:"json",success:function(n){n.result?(loadActivePromotions(!1),cleanBookNotification.createSuccess()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}):cleanBookNotification.error("Error processing payment","Promotions & vouchers"),console.log(n,"res")},onCancel:n=>{console.log("onCancel",n)},onError:n=>{$.ajax({type:"post",url:"/Commerce/UpdatePromotionPayment",data:{reference:n?.reference,status:"error"},dataType:"json",success:function(n){cleanBookNotification.error(n.msg,"Promotions & vouchers")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}),cleanBookNotification.error("Error processing payment","Promotions & vouchers"),console.log("Error: ",n.message)}})}else!n.result&&n.msg?cleanBookNotification.error(n.msg,"Promotions & vouchers"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers");loadActivePromotions(!0)},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}).always(function(){LoadingOverlayEnd()})}function setValidateItemAndOrderByType(n){n=="1"?($("#itemdiscount input[name=ItemSKU]").attr("required",!0),$("#itemdiscount input[name=ItemDiscount]").attr("required",!0),$("#orderdiscount input[name=OrderDiscount]").removeAttr("required")):n=="2"&&($("#itemdiscount input[name=ItemSKU]").removeAttr("required",!0),$("#itemdiscount input[name=ItemDiscount]").removeAttr("required",!0),$("#orderdiscount input[name=OrderDiscount]").attr("required",!0))}function showModalFindSKU(){var t=$("#item_sku").val(),n="/Commerce/LoadModalFindTraderItem?sku="+t;n=n.replace(/\s/g,"%20");$("#app-trader-pos-itemlist").load(n)}function selectTraderItem(n,t){$("#itemdiscount input[name=hdfItemSKU]").val(t);$("#item_sku").val(t);$("#app-trader-pos-itemlist").modal("hide")}function calculateDaysForVoucherUsed(){var n=$("#moniback-promo-add input[name=StartDate]").val(),t=$("#moniback-promo-add input[name=EndDate]").val();$.post("/Commerce/GetCalculateDatesForPromotions",{endDate:t,startDate:n},function(n){var t=$("#moniback-promo-add select[name=Days]");$("#moniback-promo-add select[name=Days] > option").each(function(){if(n){var t=n.find(n=>n.ShortName===this.value);t?$(this).attr("disabled",!1):$(this).attr("disabled",!0)}});t.multiselect("refresh")})}function calculateDaysForVoucherUsedInBulkDeal(){var n=$("#moniback-promo-add input[name=StartDate]").val(),t=$("#moniback-promo-add input[name=EndDate]").val();$.post("/Commerce/GetCalculateDatesForPromotions",{endDate:t,startDate:n},function(n){var t=$("#moniback-promo-add select[name=Days]");$("#moniback-promo-add select[name=Days] > option").each(function(){if(n){var t=n.find(n=>n.ShortName===this.value);t?$(this).attr("disabled",!1):$(this).attr("disabled",!0)}});t.multiselect("refresh")})}function setMinTimeFromToTimePromotion(){var r=$("#chkSpecificTime").prop("checked"),t=$("#frmAddEditPromotion input[name=FromTime]").val(),i=$("#frmAddEditPromotion input[name=ToTime]"),n;t&&r?(n=t.split(":"),n[1]++,n[0]=n[0].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),n[1]=n[1].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),t=n[0]+":"+n[1],i.attr("min",t)):i.removeAttr("min")}function initDateTimeCustomize(){var n=moment().format($dateTimeFormatByUser),t=moment().endOf("day");$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:t,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#frmAddEditPromotion input[name=StartDate], #frmAddEditPromotion input[name=EndDate]").length&&$("#frmAddEditPromotion input[name=StartDate], #frmAddEditPromotion input[name=EndDate]").daterangepicker({alwaysShowCalendars:!0,minDate:n,timePicker:!0,autoApply:!0,autoUpdateInput:!1,showDropdowns:!0,cancelClass:"btn-danger",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}},function(t,i){var u=t.format($dateTimeFormatByUser),r=i.format($dateTimeFormatByUser),f,e;$checkinInput=$("#frmAddEditPromotion input[name=StartDate]");$checkoutInput=$("#frmAddEditPromotion input[name=EndDate]");$checkinInput.val(u);$checkoutInput.val(r);f=$checkoutInput.data("daterangepicker");f.setStartDate(u);f.setEndDate(r);e=$checkinInput.data("daterangepicker");e.setStartDate(u);e.setEndDate(r);$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:r,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});calculateDaysForVoucherUsed()});$("#frmAddEditDeal input[name=StartDate], #frmAddEditDeal input[name=EndDate]").length&&$("#frmAddEditDeal input[name=StartDate], #frmAddEditDeal input[name=EndDate]").daterangepicker({alwaysShowCalendars:!0,minDate:n,timePicker:!0,autoApply:!0,autoUpdateInput:!1,showDropdowns:!0,cancelClass:"btn-danger",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}},function(t,i){var u=t.format($dateTimeFormatByUser),r=i.format($dateTimeFormatByUser),f,e;$checkinInput=$("#frmAddEditDeal input[name=StartDate]");$checkoutInput=$("#frmAddEditDeal input[name=EndDate]");$checkinInput.val(u);$checkoutInput.val(r);f=$checkoutInput.data("daterangepicker");f.setStartDate(u);f.setEndDate(r);e=$checkinInput.data("daterangepicker");e.setStartDate(u);e.setEndDate(r);$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:r,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});calculateDaysForVoucherUsedInBulkDeal()})}function GetGalleryItems(){var t=$("#itemgalerylist figure"),i=[],n,r,u;if(t.length>0)for(n=0;n<t.length;n++)r=$($(t[n]).find("span.image_row")).text(),u={FileUri:r,Order:n},i.push(u);return i}function AddImage(){$("#image-galery-input").trigger("click")}function ItemGaleryDelete(n){var i=confirm("Are you sure you want to delete this image?"),t;i&&($("#figure-"+n).remove(),t=$("#itemgalerylist figure"),t.length<=0&&($(".gallerynone").show(),$(".gallerystart").hide()))}function changeOrderGalery(n){console.log(n)}function AddImageGalery(){$("#theform").LoadingOverlay("show");UploadMediaS3ClientSide("image-galery-input").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#theform").LoadingOverlay("hide",!0);return}var t="<figure id='figure-"+n.objectKey+"'>";t+="<div class='flex-contain' id='"+n.objectKey+"'>";t+="<div class='col img'>";t+="<div style=\"background-image: url('"+apiDoc+n.objectKey+"')\"><\/div>";t+="<\/div>";t+="<div class='col options'>";t+='<span class="image_row" style="display:none">'+n.objectKey+"<\/span>";t+="<div class='dropdown contactoptside'>";t+="<button class='btn btn-primary dropdown-toggle' type='button' data-toggle='dropdown'>";t+="<i class='fa fa-ellipsis-h'><\/i>";t+="<\/button>";t+="<ul class='dropdown-menu dropdown-menu-right'>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryEdit('"+n.objectKey+"')\">Edit<\/a><\/li>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryDelete('"+n.objectKey+"')\">Delete<\/a><\/li>";t+="<\/ul><\/div><\/div><\/div>";$("#itemgalerylist").append(t);$(".gallerynone").hide();$(".gallerystart").show();$("#theform").LoadingOverlay("hide",!0)})}function ItemGaleryEdit(n){$imageChanged=n;$("#image-galery-edit").trigger("click")}function ChangeImageGalery(){$("#theform").LoadingOverlay("show");UploadMediaS3ClientSide("image-galery-edit").then(function(n){var t,i;if(n.objectKey==="no_image"||n.objectKey==="no-image"){$("#theform").LoadingOverlay("hide",!0);return}$("#"+$imageChanged).remove();t="<div class='flex-contain' id='"+n.objectKey+"'>";t+="<div class='col img'>";t+="<div style=\"background-image: url('"+apiDoc+n.objectKey+"')\"><\/div>";t+="<\/div>";t+="<div class='col options'>";t+='<span class="image_row" style="display:none">'+n.objectKey+"<\/span>";t+="<div class='dropdown contactoptside'>";t+="<button class='btn btn-primary dropdown-toggle' type='button' data-toggle='dropdown'>";t+="<i class='fa fa-ellipsis-h'><\/i>";t+="<\/button>";t+="<ul class='dropdown-menu dropdown-menu-right'>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryEdit('"+n.objectKey+"')\">Edit<\/a><\/li>";t+="<li><a style='cursor: pointer !important;' onclick=\"ItemGaleryDelete('"+n.objectKey+"')\">Delete<\/a><\/li>";t+="<\/ul><\/div><\/div>";$("#figure-"+$imageChanged).append(t);i=document.getElementById("figure-"+$imageChanged);i.setAttribute("id","figure-"+n.objectKey);$("#theform").LoadingOverlay("hide",!0)})}var isBusy=!1,isDraft=!1,recipes=[],BKAccount={Id:0,Name:""},wto,dataVehicles=[],BKAccount={Id:0,Name:""},tradinglogisticstabs={istablogisticsgeneralload:!1,istablogisticschargesload:!1,istablogisticsvehiclesload:!1,istablogisticsdriversload:!1},tradinggeneraltabs={istablocationsload:!1,istabworkgroupsload:!1,istabcandbload:!1,istabcurrencyload:!1,istabgroupsload:!1,istabcontactsload:!1,istabb2bload:!1,istabb2cload:!1,istabposload:!1,istabstorefrontload:!1,istabgeneralorderdefaultsload:!1},tradingitemscataloguestabs={istabitemsload:!1,istabitemspricingload:!1,istabitemscatalogues:!1,istabitemscataloguesdistribution:!1,istabitemsimport:!1,istabitemresourcefirstload:!1},tradinggrouptabs,tradingpromotionstabs,$cashAccountId,filter,$imageChanged;$("ul.trading-logistics-tabs li a").click(function(){var n=$(this).attr("href");setTimeout(function(){switch(n){case"#logistics-general":initPluginsOfTabGarenal(tradinglogisticstabs.istablogisticsgeneralload);tradinglogisticstabs.istablogisticsgeneralload=!0;break;case"#logistics-charges":getLocationsDomain($("#logistics-charges select[name=locations]"),tradinglogisticstabs.istablogisticschargesload);loadContentPriceList();initFormClonePriceList(tradinglogisticstabs.istablogisticschargesload);tradinglogisticstabs.istablogisticschargesload=!0;break;case"#logistics-vehicles":initPluginsOfTabVehicles(tradinglogisticstabs.istablogisticsvehiclesload);tradinglogisticstabs.istablogisticsvehiclesload=!0;break;case"#logistics-drivers":getLocationsDomain($("#logistics-drivers select[name=locations]"),tradinglogisticstabs.istablogisticsdriversload);initPluginsOfTabDrivers(tradinglogisticstabs.istablogisticsdriversload);tradinglogisticstabs.istablogisticsdriversload=!0}},200)});tradinggrouptabs={istabgroupsitemsload:!1,istabgroupscontactsload:!1};tradingpromotionstabs={istabactiveload:!1,istabarchivedload:!1};$(document).ready(function(){if(initNavClick(),location.hash==="#profile-vouchers"){$('a[href="#profile-vouchers"]').trigger("click");return}var n=getQuerystring("tab");n=="general-contacts"?($("a[href=#profile-info]").click(),setTimeout(function(){$("a[href=#"+n+"]").click()},500)):n=="items-catalogues"?($("a[href=#profile-items]").click(),setTimeout(function(){$("a[href=#"+n+"]").click()},500)):n=="general-candb"?($("a[href=#trading-general]").click(),setTimeout(function(){$("a[href=#"+n+"]").click()},500)):n=="items-catalogues-distribution"?($("a[href=#profile-items]").click(),setTimeout(function(){$("a[href=#items-catalogues-distribution]").click()},500)):n=="items-import"?($("a[href=#profile-items]").click(),setTimeout(function(){$("a[href=#items-import]").click()},500)):$("a[href=#profile-info]").click();initPluginsOfTabGarenal(tradinglogisticstabs.istablogisticsgeneralload);tradinglogisticstabs.istablogisticsgeneralload=!0});$cashAccountId=0;filter={Workgroup:"",Key:""};var $promotionKey="",$promotionName="",$promotionStop=!1,$promotionMessage=!1;$imageChanged="";