function InitTopic(n,t){$.ajax({type:"post",url:"/Topics/GetTopic2SelectByQbicle",datatype:"json",data:{qbicleId:n},success:function(n){if(n.result){var i=$("#"+t);i.data("select2")&&i.select2("destroy");i.empty().append(n.Object);i.select2()}},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function ClearForm(n){var t,i;$_members=[];$_approvers=[];$_reviewers=[];$wgId=0;ReInitUsersEdit(0);ResetFormControl(n);t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active")[0].id==="step_1_add"&&$(t).find(".app_subnav .active").prev("li").find("a").trigger("click");i=$("#wg-table-members-add").DataTable();i.clear();i.destroy();$("#wg-group-add").val("").trigger("change")}function RemoveRowTableMemberAdd(n){var t="add",f,i,r,u;for($wgId>0&&(t="edit"),f=$("#wg-table-members-"+t).DataTable(),f.destroy(),$("#wg-table-members-"+t+" tbody tr#tr_"+t+"_user_"+n).remove(),$("#wg-table-members-"+t).DataTable().draw(),i=$_approvers.length;i--;)$_approvers[i].Id===n&&$_approvers.splice(i,1);for(r=$_reviewers.length;r--;)$_reviewers[r].Id===n&&$_reviewers.splice(r,1);for(u=$_members.length;u--;)$_members[u].Id===n&&$_members.splice(u,1)}function CreateRowTable(n){var i="add",f,t;$wgId>0&&(i="edit");var r="",u="",e=$_approvers.filter(t=>t.Id===n.Id);return e.length>0&&(r="checked"),f=$_reviewers.filter(t=>t.Id===n.Id),f.length>0&&(u="checked"),t='<tr id="tr_'+i+"_user_"+n.Id+'">',t+='<td><div class="table-avatar mini" style="background-image: url(\''+n.Pic+"');\">&nbsp;<\/div><\/td>",t+="<td>"+n.Name+'<span id="span-approval-add-'+n.Id+"\" class='hidden'><\/span><span id=\"span-review-add-"+n.Id+"\" class='hidden'><\/span><\/td>",t+="<td><input "+r+" onchange=\"AddUsersApprovers(this.checked,'"+n.Id+'\',\'span-approval-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><input "+u+" onchange=\"AddUsersToReviewers(this.checked,'"+n.Id+'\',\'span-review-add-\')" class="check-right" data-toggle="toggle" data-onstyle="success" data-on="<i class=\'fa fa-check\'><\/i>" data-off=" " type="checkbox"><\/td>',t+="<td><button class='btn btn-danger' onclick=\"RemoveRowTableMemberAdd('"+n.Id+"')\"><i class='fa fa-trash'><\/i><\/button><\/td>",t+"<\/tr>"}function CreateWorkgroupData(n){var t="add",f,r,i;n>0&&(t="edit");var e={Id:$("#wg-location-"+t).val()},o={Id:$("#wg-qbicle-"+t).val()},s={Id:$("#wg-topic-"+t).val()},u=[];return $("#wg-group-"+t).val()!==null&&$("#wg-group-"+t).val().length>0&&(f=$("#wg-group-"+t).val().toString().split(","),$.each(f,function(n,t){var i={Id:t};u.push(i)})),r=[],i=$("#wg-process-"+t).val(),i!==null&&i.length>0&&(i=i.toString().split(","),$.each(i,function(n,t){var i={Id:t};r.push(i)})),{Id:n,Name:$("#wg-name-"+t).val(),Processes:r,Location:e,Qbicle:o,Topic:s,ItemCategories:u,Members:$_members,Reviewers:$_reviewers,Approvers:$_approvers}}function Delete(n,t){$.ajax({type:"delete",url:"/TraderWorkGroups/Delete",datatype:"json",data:{id:t},success:function(t){t.result?($("#"+n).DataTable().ajax.reload(),cleanBookNotification.removeSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function InitWorkgroupDataTable(){var n=$("#wg-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#wg-table").LoadingOverlay("show"):$("#wg-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/Commerce/GetWorkgroupTableData",type:"POST",dataType:"json",data:function(n){var t=$("#wg-key-search"),i=$("#wg-processes-filter");return keySearch="",lstProcessIds=null,t.length>0&&(keySearch=t.val()),i.length>0&&(lstProcessIds=i.val()),$.extend({},n,{keySearch:keySearch,lstProcessIds:lstProcessIds})}},columns:[{data:"Name",orderable:!0},{data:"Creator",orderable:!1},{data:"CreatedDate",orderable:!1},{data:"Location",orderable:!1},{data:"Process",orderable:!1},{data:"QbicleName",orderable:!1},{data:"MemberNum",orderable:!1},{data:"ProductGroupNum",orderable:!1},{data:"Id",orderable:!1,render:function(n,t,i){var r="";return i.IsOptionBtnShown==!1?r:(r+='<button class="btn btn-warning" onclick="Edit('+i.Id+')" data-toggle="modal" data-target="#app-trader-group-edit"><i class="fa fa-pencil"><\/i><\/button> ',r+(i.CanBeDeleted==!1?'<button class="btn btn-danger" disabled=""><i class="fa fa-trash"><\/i><\/button>':"<button class=\"btn btn-danger\" onclick=\"Delete('wg-table', '"+i.Id+'\')"><i class="fa fa-trash"><\/i><\/button>'))}}],drawCallback:function(){}})}var $_members=[],$_reviewers=[],$_approvers=[],$wgId=0,addTable,allTable;$(document).ready(function(){$("#wg-key-search").keyup(delay(function(){$("#wg-table").DataTable().ajax.reload()},500));$("#wg-processes-filter").change(function(){$("#wg-table").DataTable().ajax.reload()});$(".check-right").bootstrapToggle();$("#wg-table-members-add,#user-list").DataTable({destroy:!0,responsive:!0,pageLength:10});$("#wg-qbicle-add").on("change",function(){var n=$(this).val();InitTopic(n,"wg-topic-add")});$("#wg-table_filter").show();setTimeout(function(){$(".checkmulti").multiselect({includeSelectAllOption:!0,selectAllJustVisible:!0,includeResetOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0});$(".chosen-multiple").select2({multiple:!0});$("select.select2").select2()},500);InitTopic($("#wg-qbicle-add").val(),"wg-topic-add")});PreviousAdd=function(){var n=$(".btnNextAdd").closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")};$(".btnPreviousAdd").click(function(){var n=$(this).closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")});$(".btnNextAdd").click(function(){var n={Id:0,Name:$("#wg-name-add").val()};$("#form-wg-add").valid()&&$.ajax({url:"/TraderWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});else{var t=$(".btnNextAdd").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click")}}).fail(function(n){$("#form-wg-add").validate().showErrors({wgNameAdd:"Error"+n})})});addTable=$("#wg-table-members-add");$("#search-right-add").on("change",function(){var n=$(this).val();addTable.DataTable().search(n).draw()});$("#search-member-add").keyup(function(){addTable.DataTable().search($(this).val()).draw()});allTable=$("#user-list");$("#search-right-all").on("change",function(){var n=$(this).val();n===null&&(n="");allTable.DataTable().search(n,!0,!1,!0).draw()});$("#search-member-all").keyup(function(){allTable.DataTable().search($(this).val()).draw()});AddUsersToMembers=function(n,t,i,r){var f={Id:t,Name:i,Pic:r},u;if(n===!0)$_members.push(f);else for(u=$_members.length;u--;)$_members[u].Id===f.Id&&$_members.splice(u,1)};AddUsersToReviewers=function(n,t,i){var u={Id:t},r;if(n===!0)$_reviewers.push(u),$("#"+i+t).text("Reviewers");else for(r=$_reviewers.length;r--;)$_reviewers[r].Id===u.Id&&($_reviewers.splice(r,1),$("#"+i+t).text(""))};AddUsersApprovers=function(n,t,i){var u={Id:t},r;if(n===!0)$_approvers.push(u),$("#"+i+t).text("Approvers");else for(r=$_approvers.length;r--;)$_approvers[r].Id===u.Id&&($_approvers.splice(r,1),$("#"+i+t).text(""))};AddMemberToWorkgroup=function(){var n,t;$_members.length>0&&(n="add",$wgId>0&&(n="edit"),t=$("#wg-table-members-"+n).DataTable(),t.clear(),t.destroy(),$.each($_members,function(t,i){$("table#wg-table-members-"+n+" > tbody").prepend(CreateRowTable(i))}),$(".check-right").bootstrapToggle(),$("#wg-table-members-"+n).DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#wg-table-members-"+n).show())};CreateWorkgroup=function(){if(ValidateWorkgroupForm("add")!==!1){var n={Id:$wgId,Name:$("#wg-name-add").val()};$("#form-wg-add").valid()&&$.ajax({url:"/TraderWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result){$("#form-wg-add").validate().showErrors({wgNameAdd:"Name of Workgroup already exists."});PreviousAdd();return}$("#app-trader-group-add").modal("hide");var t=CreateWorkgroupData(0);$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderWorkGroups/Create",datatype:"json",data:{wg:t},success:function(n){$.LoadingOverlay("hide");n.result?(cleanBookNotification.createSuccess(),$("#wg-table").DataTable().ajax.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n})})}};ValidateWorkgroupForm=function(n){var t=!0,i;return($("#wg-group-"+n).val()===null||$("#wg-group-"+n).val().length<=0)&&(t=!1,n==="add"?$("#form-wg-"+n).validate().showErrors({wgProductsNameAdd:"This field is required."}):$("#form-wg-"+n).validate().showErrors({wgProductsNameEdit:"This field is required."})),$("#wg-name-"+n).val()===""&&(n==="add"?$("#form-wg-"+n).validate().showErrors({wgNameAdd:"This field is required."}):$("#form-wg-"+n).validate().showErrors({wgNameEdit:"This field is required."}),t=!1),i=$("#wg-process-"+n).val(),(i===null||i.length===0)&&(cleanBookNotification.error(_L("ERROR_MSG_377"),"Qbicles"),t=!1),t===!1?(n==="add"?PreviousAdd():PreviousEdit(),t):t};ReloadWorkgroup=function(){$("#comfig-content").LoadingOverlay("show");$("#comfig-content").empty();setTimeout(function(){$("#comfig-content").load("/TraderConfiguration/TraderConfigurationContent?value=Workgroups");$("#comfig-content").LoadingOverlay("hide")},500)};QbicleEditChange=function(n){var t=$(n).val();InitTopic(t,"wg-topic-edit")};NextEdit=function(){var n={Id:$wgId,Name:$("#wg-name-edit").val()};$("#form-wg-edit").valid()&&$.ajax({url:"/TraderWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result)$("#form-wg-edit").validate().showErrors({wgNameEdit:"Name of Workgroup already exists."});else{var t=$(".btnNextEdit").closest(".modal");$(t).find(".app_subnav .active").next("li").find("a").trigger("click");$("#step_1_edit").removeClass("active");$("#edit-specifics").removeClass("in active");$("#step_2_edit").addClass("active");$("#edit-members").addClass("in active")}}).fail(function(n){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Error"+n})})};PreviousEdit=function(){$("#step_2_edit").removeClass("active");$("#edit-members").removeClass("in active");$("#step_1_edit").addClass("active");$("#edit-specifics").addClass("in active")};Edit=function(n){$("#workgroup-content-edit").empty();$_members=[];$_approvers=[];$_reviewers=[];PreviousEdit();$wgId=n;$("#search-right-all").val("").trigger("change");$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderWorkGroups/GetWorkGroupUser",datatype:"json",data:{id:n},success:function(n){$_members=n.Members;$_approvers=n.Approvers;$_reviewers=n.Reviewers},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}});ReInitUsersEdit(n);setTimeout(function(){$("#workgroup-content-edit").load("/TraderWorkGroups/Edit?id="+n);$.LoadingOverlay("hide")},2e3)};ReInitUsersEdit=function(n){var t=$("#user-list").DataTable();t.clear();t.destroy();$.ajax({type:"post",url:"/TraderWorkGroups/ReInitUsersEdit",datatype:"json",data:{id:n},success:function(n){n?($("table#user-list > tbody").prepend(n),$(".check-right").bootstrapToggle(),$("#user-list").DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}],order:[]}),$("#user-list").show()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})};UpdateWorkgroup=function(){if(ValidateWorkgroupForm("edit")!==!1){var n={Id:$wgId,Name:$("#wg-name-edit").val()};$.ajax({url:"/TraderWorkGroups/ValidateName",data:{wg:n},type:"POST",dataType:"json"}).done(function(n){if(n.result){$("#form-wg-edit").validate().showErrors({wgNameEdit:"Name of Workgroup already exists."});PreviousEdit();return}$("#app-trader-group-edit").modal("toggle");var t=CreateWorkgroupData($wgId);$.ajax({type:"post",url:"/TraderWorkGroups/Update",datatype:"json",data:{wg:t},success:function(n){n.result?($("#wg-table").DataTable().ajax.reload(),cleanBookNotification.updateSuccess()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}).fail(function(){})}};