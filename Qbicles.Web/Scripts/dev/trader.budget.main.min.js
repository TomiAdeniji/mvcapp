function WorkGroupSelectedChange(){$workgroupId=$("#budget-workgroup-select").val();$workgroupId!==""?($.LoadingOverlay("show"),$.ajax({type:"get",url:"/TraderTransfers/getworkgroup?id="+$workgroupId,dataType:"json",success:function(n){LoadingOverlayEnd();n.result?($(".preview-workgroup table tr td.location_name").text(n.Object.Location),$(".preview-workgroup table tr td.workgroup_process").text(n.Object.Process),$(".preview-workgroup table tr td.workgroup_qbicle").text(n.Object.Qbicle),$(".preview-workgroup table tr td.workgroup_member span").text(n.Object.Members)):($(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""));$(".preview-workgroup").show()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})):($(".preview-workgroup").show(),$(".preview-workgroup table tr td.location_name").text(""),$(".preview-workgroup table tr td.workgroup_process").text(""),$(".preview-workgroup table tr td.workgroup_qbicle").text(""),$(".preview-workgroup table tr td.workgroup_member span").text(""))}function ShowGroupMember(){$("#app-trader-workgroup-preview").empty();$("#app-trader-workgroup-preview").load("/TraderTransfers/ShowListMemberForWorkGroup?wgId="+$workgroupId);$("#app-trader-workgroup-preview").modal("toggle")}function BudgetGroupTypeSelected(n,t){$budgetScenarioItemGroupId=0;$budgetScenarioId=t;DisplayBudgetItemInput(n);$(".unitextra").hide();$("#budget-item-table > tbody").html("");$("#dynamic-budget-add-item").show();$(".dynamic-budget-item-table").hide();$("#budget-ready").hide();$("#budget-draft").hide()}function DisplayBudgetItemInput(n){var t="/TraderBudget/BudgetAddEditChoseItem?budgetScenarioItemGroupId="+$budgetScenarioItemGroupId+"&itemGroupType="+n+"&budgetScenarioId="+$budgetScenarioId;AjaxElementLoad(t,"dynamic-budget-add-item")}function ItemSelected(){var n=$("#item-select").find(":selected");if(n.val()===""){$(".unitextra").hide();itemSelect.Id="";itemSelect.Name="";itemSelect.Image="";itemSelect.Unit="";return}itemSelect.Id=n.attr("itemId");itemSelect.Name=n.attr("itemName");itemSelect.Image=n.attr("itemImage");itemSelect.Unit=n.attr("itemUnit");$("#item-unit-name").text(itemSelect.Unit);$(".unitextra").show()}function RemoveRowItem(){$.LoadingOverlay("show");$.ajax({type:"get",url:"/TraderBudget/RemoveBudgetScenarioItem?budgetScenarioGroupId="+$budgetScenarioItemGroupId+"&itemId="+$rowRemoveId,dataType:"json",success:function(n){if(n.result)$("#confirm-delete").modal("hide"),$("#tr_id_"+$rowRemoveId).remove(),ResetBudgetItemSelected("budget-item-table","item-select");else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ConfirmRemoveRowItem(n){$rowRemoveId=n}function CancelDelete(){$("#confirm-delete").modal("hide")}function BudgetItemAddNow(n){if($workgroupId===0||$workgroupId===""){cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles");return}if(itemSelect.Id===0||itemSelect.Id===""){cleanBookNotification.error(_L("ERROR_MSG_617"),"Qbicles");return}SaveItem(n).then(function(t){AddItemToTableList(t.actionVal,n)})}function PeriodBreakdownItem(n,t){if($workgroupId===0||$workgroupId===""){cleanBookNotification.error(_L("ERROR_MSG_168"),"Qbicles");return}if(itemSelect.Id===0||itemSelect.Id===""){cleanBookNotification.error(_L("ERROR_MSG_617"),"Qbicles");return}SaveItem(t).then(function(i){var r=i.actionVal;n>0&&(r=n);PeriodBreakdownItemShow(t,r)})}function PeriodBreakdownItemOnTable(n,t){PeriodBreakdownItemShow(t,n)}function SaveItem(n){$.LoadingOverlay("show");var t=new $.Deferred,i=[{Item:{Id:itemSelect.Id},SaleQuantity:$("#item-sale-quantity").val(),AverageSalePrice:$("#item-sale-average-price").val(),PurchaseQuantity:$("#item-purchase-quantity").val(),AveragePurchaseCost:$("#item-purchase-average-cost").val()}],r={Id:$budgetScenarioItemGroupId,BudgetScenario:{Id:$budgetScenarioId},WorkGroup:{Id:$("#budget-workgroup-select").val()},Status:1,Type:n,BudgetScenarioItems:i};return $.ajax({"async":!1,type:"post",url:"/TraderBudget/AddBudgetScenarioItem",data:{budgetScenarioGroup:r},dataType:"json",success:function(n){if(n.msgId>0)$budgetScenarioItemGroupId=n.msgId,t.resolve(n);else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");t.resolve(n);return}},error:function(){t.resolve("");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()}),t.promise()}var itemSelect,$rowRemoveId,$quantityTotal;$(function(){function n(n){var t=$("#filter-col-"+n).val();t===null&&(t="");$("#budget-quantities-list").DataTable().column(n).search(t.toString().replace(/,/g,"|"),!0,!1).draw()}$(".select2-unit").select2();$(".checkmulti").multiselect({allSelectedText:"All",includeSelectAllOption:!0,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0}).multiselect("selectAll",!1).multiselect("updateButtonText");$(".budget-quantities-search").keyup(function(){$("#budget-quantities-list").DataTable().search($(this).val()).draw()});$(".checkmulti").on("change",function(){n($(this).attr("data-column"))})});LoadBudgetStartingQuantities=function(n){var t="/TraderBudget/BudgetStartingQuantities?id="+n;AjaxElementLoad(t,"budget-quantities")};UpdateScenarioItemStartingQuantity=function(n){$.LoadingOverlay("show");var t={Id:n,Quantity:$("#quantity-"+n).val()};$.ajax({type:"post",url:"/TraderBudget/UpdateScenarioItemStartingQuantity",data:{startingQuantity:t},dataType:"json",success:function(n){if(n.result)cleanBookNotification.updateSuccess();else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};UpdateScenarioItemStartingUnit=function(n){$.LoadingOverlay("show");var t={Id:n,Unit:{Id:$("#unit-"+n).val()}};$.ajax({type:"post",url:"/TraderBudget/UpdateScenarioItemStartingUnit",data:{startingQuantity:t},dataType:"json",success:function(n){if(n.result)cleanBookNotification.updateSuccess();else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};LoadBudgetProcess=function(n){var t="/TraderBudget/BudgetProcess?id="+n;AjaxElementLoad(t,"budget-process")};LoadBudgetReport=function(n){var t="/TraderBudget/BudgetReport?id="+n;AjaxElementLoad(t,"budget-report")};LoadBudgetCashflow=function(n){var t="/TraderBudget/BudgetCashflow?id="+n;AjaxElementLoad(t,"budget-cashflow")};LoadBudgetVsActual=function(n){var t="/TraderBudget/BudgetVsActual?id="+n;AjaxElementLoad(t,"budget-vs")};BudgetProcessItemsPreview=function(n){var t="/TraderBudget/BudgetProcessItemsPreview?id="+n;AjaxElementShowModal(t,"app-trader-budget-process-items")};var $workgroupId=0,$budgetScenarioItemGroupId=0,$budgetScenarioId=0;BudgetAddEditItem=function(n,t,i){$.LoadingOverlay("show");$budgetScenarioItemGroupId=n;$budgetScenarioId=t;$.ajax({type:"get",url:"/TraderBudget/ValidBudgetGroupItemStatus?id="+$budgetScenarioItemGroupId,dataType:"json",success:function(t){if(t.result){var r="/TraderBudget/BudgetAddEditItem?budgetScenarioItemGroupId="+n+"&budgetScenarioId="+$budgetScenarioId+"&oView="+i;AjaxElementShowModal(r,"app-trader-budget-item-add-edit")}else{cleanBookNotification.warning(_L("ERROR_MSG_372"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};itemSelect={Id:"",Name:"",Image:"",Unit:""};ValuePurchaseOnChange=function(){var n=$("#item-purchase-quantity").val(),t=$("#item-purchase-average-cost").val();$("#item-purchase-amount").val(n*t)};ValueSaleOnChange=function(){var n=$("#item-sale-quantity").val(),t=$("#item-sale-average-price").val();$("#item-sale-amount").val(n*t)};$rowRemoveId=0;AddItemToTableList=function(n,t){var i,r,u;if(t===1?($(".sale-col-qty").hide(),$(".sale-col-price").hide(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show()):t===2?($(".purchase-col-qty").hide(),$(".purchase-col-cost").hide(),$(".sale-col-qty").show(),$(".sale-col-price").show()):($(".sale-col-qty").show(),$(".sale-col-price").show(),$(".purchase-col-qty").show(),$(".purchase-col-cost").show()),$(".dynamic-budget-item-table").show(),$("#budget-ready").show(),$("#budget-draft").show(),i=$("#tb_form_template tbody tr").clone(),$(i).attr("id","tr_id_"+itemSelect.Id),$($(i).find("td.row_image div")).attr("style","background-image: url('"+itemSelect.Image+"');"),$($(i).find("td.row_name")).text(itemSelect.Name),$($(i).find("td.row_unit")).text(itemSelect.Unit),$($(i).find("td.row_button input.traderItem")).val(itemSelect.Id),$($(i).find("td.purchase-col-qty")).text(numberString($("#item-purchase-quantity").val(),"")),$($(i).find("td.purchase-col-cost")).text(toCurrencySymbol($("#item-purchase-average-cost").val())),$($(i).find("td.sale-col-qty")).text(numberString($("#item-sale-quantity").val(),"")),$($(i).find("td.sale-col-price")).text(toCurrencySymbol($("#item-sale-average-price").val())),r=0,t===1)r=$("#item-purchase-amount").val();else if(t===2)r=$("#item-sale-amount").val();else{var f=$("#item-purchase-quantity").val(),e=$("#item-purchase-average-cost").val(),o=$("#item-sale-quantity").val(),s=$("#item-sale-average-price").val();r=f*e+o*s}$($(i).find("td.row_total")).text(toCurrencySymbol(r));$($(i).find("td.row_button button.remove")).attr("onclick","ConfirmRemoveRowItem('"+itemSelect.Id+"')");$($(i).find("td.row_button button.period")).attr("onclick","PeriodBreakdownItemOnTable("+n+","+t+")");u=$("#budget-item-table tbody tr#tr_id_"+itemSelect.Id);u.length===0?$("#budget-item-table tbody").append(i):cleanBookNotification.error(_L("ERROR_MSG_373"),"Qbicles");ResetBudgetItemSelected("budget-item-table","item-select");itemSelect.Id="";$("#dynamic-budget-add-item input").val("0")};PeriodBreakdownItemShow=function(n,t){var i="/TraderBudget/PeriodBreakdownItemManagement?budgetScenarioItemId="+t+"&type="+n;AjaxElementShowModal(i,"app-trader-budget-item-breakdown-buysell")};$quantityTotal=$("#qty-total").val();SaveDraft=function(){LoadBudgetProcess($budgetScenarioId)};SendToReview=function(){$.LoadingOverlay("show");$.ajax({type:"post",url:"/TraderBudget/SendToReviewBudgetScenario",data:{budgetScenarioGroupId:$budgetScenarioItemGroupId},dataType:"json",success:function(n){if(n.result)cleanBookNotification.updateSuccess(),LoadBudgetProcess($budgetScenarioId),$("#app-trader-budget-item-add-edit").modal("hide");else{cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");return}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})};