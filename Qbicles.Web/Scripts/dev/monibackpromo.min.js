function OpenPromotion(n){$.LoadingOverlay("show");window.location.href="/Administration/PromotionType?key="+n}function switchpromos(n){$(n).valid();$(".promotype").hide();var t=$(n).val();t=="1"?$("#itemdiscount").show():t=="2"&&$("#orderdiscount").show();setValidateItemAndOrderByType(t)}function loadModalPromotionAddEdit(n){var t=$("#moniback-promo-add");t.empty();t.modal("show");t.load("/Administration/LoadModalPromotionAddEdit",{promotionKey:n},function(){$("#moniback-promo-add .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#moniback-promo-add .select2").select2({placeholder:"Please select"});$("#moniback-promo-add .singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#moniback-promo-add .chktoggle").bootstrapToggle();initFormPromotionValidate()})}function loadModalPromotionView(n){var t=$("#moniback-promo-view");t.empty();t.modal("show");t.load("/Administration/LoadModalPromotionView",{promotionKey:n},function(){$("#moniback-promo-view .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#moniback-promo-view .select2").select2({placeholder:"Please select"});$("#moniback-promo-view .singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#moniback-promo-view .chktoggle").bootstrapToggle()})}function loadModalRankPromotion(){$.LoadingOverlay("show");var n=$("#moniback-promo-rank");n.empty();n.modal("show");n.load("/Administration/LoadModalRankPromotion",function(){$("#moniback-promo-rank .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});initMonibackRankPromotionTable();LoadRankPromotionList();setTimeout(function(){$.LoadingOverlay("hide")},1e3)})}function setMinTimeFromToTimePromotion(){var r=$("#chkSpecificTime").prop("checked"),t=$("#frmAddEditDeal input[name=FromTime]").val(),i=$("#frmAddEditDeal input[name=ToTime]"),n;t&&r?(n=t.split(":"),n[1]++,n[0]=n[0].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),n[1]=n[1].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),t=n[0]+":"+n[1],i.attr("min",t)):i.removeAttr("min")}function showModalFindSKU(){var t=$("#item_sku").val(),n="/Commerce/LoadModalFindTraderItem?sku="+t;n=n.replace(/\s/g,"%20");$("#app-trader-pos-itemlist").load(n)}function LoadRankPromotionList(){$.fn.DataTable.isDataTable("#tblMonibackRankPromotions")?$("#tblMonibackRankPromotions").DataTable().ajax.reload():setTimeout(function(){$("#tblMonibackRankPromotions").DataTable().ajax.reload()},1e3)}function loadModalPromotionsUsedBy(n){$.LoadingOverlay("show");var t=$("#moniback-promo-usedby");t.empty();t.modal("show");t.load("/Administration/loadModalPromotionsUsedBy",{promotionKey:n},function(){$("#moniback-promo-usedby .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});initPromotionTypeParticipatingDomainTable(n);LoadPromotionUsedByList();setTimeout(function(){$.LoadingOverlay("hide")},1e3)})}function LoadPromotionUsedByList(){$.fn.DataTable.isDataTable("#tblMonibackPromotionsUsedBy")?$("#tblMonibackPromotionsUsedBy").DataTable().ajax.reload():setTimeout(function(){$("#tblMonibackPromotionsUsedBy").DataTable().ajax.reload()},1e3)}function initPromotionTypeParticipatingDomainTable(n){$("#tblMonibackPromotionsUsedBy").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblMonibackPromotionsUsedBy").LoadingOverlay("show"):$("#tblMonibackPromotionsUsedBy").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100],],pageLength:10,deferLoading:30,order:[[1,"desc"]],ajax:{url:"/Administration/GetParticipatingDomainsInPromotionType",type:"POST",data:{promotionKey:n}},columns:[{data:"BusinessName",orderable:!0},{data:"DateStarted",orderable:!1,render:function(n){if(n!=null){let t=new Date(parseInt(n.substr(6)));return t.toLocaleDateString()}return""}},{data:"ElapseDate",orderable:!1,render:function(n){if(n!=null){let t=new Date(parseInt(n.substr(6)));return t.toLocaleDateString()}return""}},]})}function initDragDrop(){$("#tblMonibackRankPromotions tbody").on("click","tr",function(){var n=table.row(this).data();console.log("Row clicked:",n)})}function initMonibackRankPromotionTable(){$("#tblMonibackRankPromotions").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblMonibackRankPromotions").LoadingOverlay("show"):$("#tblMonibackRankPromotions").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100],],pageLength:10,deferLoading:30,order:[[1,"desc"]],ajax:{url:"/Administration/GetRankPromotionTypes",type:"POST"},rowReorder:{selector:"tr",dataSrc:"Rank",update:!1},columns:[{data:"Promotion",orderable:!1},{data:"Type",orderable:!1},{data:"Duration",orderable:!1,render:function(n){return n+" days"}},{data:"Amount",orderable:!1,render:function(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NGN"}).format(n)}},{data:"Rank",orderable:!1,render:function(n){return n}},]});let n=$("#tblMonibackRankPromotions").DataTable();n.on("row-reorder.dt",function(t,i,r){let f=r.triggerRow.data(),u="Reorder started on row: "+r.triggerRow.data().Promotion+"<br>";for(let t=0,r=i.length;t<r;t++){let r=n.row(i[t].node).data();console.log(r,"rowData");u+=r.Promotion+" updated to be in position "+i[t].newData+" (was "+i[t].oldData+")<br>";(r!==undefined||r!==null)&&n.rows().every(function(u){let f=this.data();return f.Key===r.Key&&(console.log(f,"row match"),f.Rank=i[t].newData,n.row(u).data(f)),f})}console.log(n,"table")});LoadRankPromotionList()}function SaveRankPromotionOrder(){$.LoadingOverlay("show");let n=[];$("#tblMonibackRankPromotions").DataTable().rows().every(function(){let t=this.data();n.push({PromotionTypeKey:t.Key,Name:t.Promotion,Type:t.Type,Duration:t.Duration,Price:t.Amount,Rank:t.Rank})});$.ajax({url:"/Administration/SaveRankPromotionOrder",type:"POST",contentType:"application/json",data:JSON.stringify(n),success:function(n){console.log(n,"response");n.result?(cleanBookNotification.createSuccess(),initMonibackRankPromotionTable()):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Moniback Promotions"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Moniback Promotions")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Moniback Promotions")},complete:function(){setTimeout(function(){$.LoadingOverlay("hide")},1e3)}})}function initMonibackRankPromotionTableOld(){$("#tblMonibackRankPromotions").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblMonibackRankPromotions").LoadingOverlay("show"):$("#tblMonibackRankPromotions").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100],],pageLength:10,deferLoading:30,order:[[1,"desc"]],ajax:{url:"/Administration/GetRankPromotionTypes",type:"POST"},rowReorder:{selector:"tr:not(.no-reorder) td:not(:first-child)"},columns:[{data:"Promotion",orderable:!1},{data:"Type",orderable:!1},{data:"Duration",orderable:!1,render:function(n){return n+" days"}},{data:"Amount",orderable:!1,render:function(n){return n}},{data:"Rank",orderable:!1,render:function(n){return n}},]})}function disableInputsAndHideButton(){$("#frmAddEditPromotion input").prop("disabled",!0);$("#frmAddEditPromotion textarea").prop("disabled",!0);$("#frmAddEditPromotion select").prop("disabled",!0);$("#stp1").hide()}function searchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||500)}}function initFormPromotionValidate(){var n=$("#frmAddEditPromotion");n.validate({ignore:"",invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(t){(t.preventDefault(),isBusy)||n.valid()&&$.LoadingOverlay("show")})}function savePromotionType(){var n="#frmAddEditPromotion",t={model:{PromotionTypeKey:$(n+" input[name=Key]").val(),Name:$(n+" input[name=Name]").val(),Description:$(n+" textarea[name=Description]").val(),Icon:$(n+" select[name=Icon]").val(),Type:$(n+" select[name=Type]").val(),Duration:$(n+" input[name=Duration]").val(),Price:$(n+" input[name=Price]").val(),Rank:$(n+" input[name=Rank]").val()}};console.log(t,"params");$.ajax({type:"post",url:"/Administration/SavePromotionType",data:t,dataType:"json",success:function(n){console.log(n,"response");n.result?(cleanBookNotification.createSuccess(),$("#moniback-promo-add").modal("hide"),LoadListMonibackPromotion(),$(window).scrollTop(300)):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Moniback Promotions"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Moniback Promotions")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Moniback Promotions")}}).always(function(){LoadingOverlayEnd()})}function initDateTimeCustomize(){var n=moment().format($dateTimeFormatByUser),t=moment().endOf("day");$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:t,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#frmAddEditPromotion input[name=StartDate], #frmAddEditPromotion input[name=EndDate]").length&&$("#frmAddEditPromotion input[name=StartDate], #frmAddEditPromotion input[name=EndDate]").daterangepicker({alwaysShowCalendars:!0,minDate:n,timePicker:!0,autoApply:!0,autoUpdateInput:!1,showDropdowns:!0,cancelClass:"btn-danger",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}},function(t,i){var u=t.format($dateTimeFormatByUser),r=i.format($dateTimeFormatByUser),f,e;$checkinInput=$("#frmAddEditPromotion input[name=StartDate]");$checkoutInput=$("#frmAddEditPromotion input[name=EndDate]");$checkinInput.val(u);$checkoutInput.val(r);f=$checkoutInput.data("daterangepicker");f.setStartDate(u);f.setEndDate(r);e=$checkinInput.data("daterangepicker");e.setStartDate(u);e.setEndDate(r);$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:r,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});calculateDaysForVoucherUsed()});$("#frmAddEditDeal input[name=StartDate], #frmAddEditDeal input[name=EndDate]").length&&$("#frmAddEditDeal input[name=StartDate], #frmAddEditDeal input[name=EndDate]").daterangepicker({alwaysShowCalendars:!0,minDate:n,timePicker:!0,autoApply:!0,autoUpdateInput:!1,showDropdowns:!0,cancelClass:"btn-danger",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}},function(t,i){var u=t.format($dateTimeFormatByUser),r=i.format($dateTimeFormatByUser),f,e;$checkinInput=$("#frmAddEditDeal input[name=StartDate]");$checkoutInput=$("#frmAddEditDeal input[name=EndDate]");$checkinInput.val(u);$checkoutInput.val(r);f=$checkoutInput.data("daterangepicker");f.setStartDate(u);f.setEndDate(r);e=$checkinInput.data("daterangepicker");e.setStartDate(u);e.setEndDate(r);$(".singledateandtime-displaydate").daterangepicker({minDate:n,maxDate:r,singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});calculateDaysForVoucherUsedInBulkDeal()})}function calculateDaysForVoucherUsedInBulkDeal(){var n=$("#bulkdeal-promo-add input[name=StartDate]").val(),t=$("#bulkdeal-promo-add input[name=EndDate]").val();$.post("/Commerce/GetCalculateDatesForPromotions",{endDate:t,startDate:n},function(n){var t=$("#bulkdeal-promo-add select[name=Days]");$("#bulkdeal-promo-add select[name=Days] > option").each(function(){if(n){var t=n.find(n=>n.ShortName===this.value);t?$(this).attr("disabled",!1):$(this).attr("disabled",!0)}});t.multiselect("refresh")})}function LoadListMonibackPromotion(){$.fn.DataTable.isDataTable("#tblMonibackPromotions")?$("#tblMonibackPromotions").DataTable().ajax.reload():setTimeout(function(){$("#tblMonibackPromotions").DataTable().ajax.reload()},1e3)}function initMonibackPromotionTable(){$("#tblMonibackPromotions").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblMonibackPromotions").LoadingOverlay("show"):$("#tblMonibackPromotions").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100],],pageLength:10,deferLoading:30,order:[[2,"desc"]],ajax:{url:"/Administration/GetPromotionTypes",type:"POST",data:function(n){return $.extend({},n,{keyword:$("#request-search").val(),dateRange:$("#request-daterange").val(),type:$("#request-type").val()})}},columns:[{data:"Icon",orderable:!1,render:function(n,t,i){return'<i class="fa fa-'+i.Icon+'" style="font-size: 25px;color: #fc8b02;"><\/i>'}},{data:"Name",name:"Name",orderable:!0,render:function(n,t,i){return i.Name}},{data:"CreatedDate",name:"CreatedDate",orderable:!0,render:function(n){return n}},{data:"IsActive",name:"IsActive",orderable:!0,render:function(n,t,i){return n===!0?'<span class="label label-success label-lg" id="status-'+i.Key+'">Active<\/span>':'<span class="label label-danger label-lg" id="status-'+i.Key+'">Deactivated<\/span>'}},{data:null,orderable:!1,render:function(n,t,i){var r=' <div class="btn-group options">';return r+=' <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Options &nbsp; <i class="fa fa-angle-down"><\/i><\/button>',r+='<ul class="dropdown-menu">',r+="  <li>",r+='<a href="javascript:void(0)" onclick="loadModalPromotionView(\''+i.Key+"')\">View<\/a>",r+="<\/li>",r+="  <li>",r+='<a href="javascript:void(0)" onclick="loadModalPromotionAddEdit(\''+i.Key+"', 'edit')\">Edit <\/a>",r+="<\/li>",r+=" <li>",r+=' <a href="javascript:void(0)" id="openOrClose-'+i.Id+'" onclick="managePromotionTypeStatus(\''+i.Key+"')\">",r+=i.IsActive===!1?"Activate":"Deactivate",r+=" <\/a>",r+=" <\/li>",r+="  <li>",r+='<a href="javascript:void(0)" onclick="loadModalPromotionsUsedBy(\''+i.Key+"')\">Used by<\/a>",r+="<\/li>",r+=" <\/ul>",r+"<\/div>"}},]});$("#request-type").select2();$("#request-daterange").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",locale:{cancelLabel:"Clear",format:"DD-MM-YYYY"}});$("#request-daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateFormatByUser.toUpperCase())+" - "+t.endDate.format($dateFormatByUser.toUpperCase()));LoadListMonibackPromotion()});$("#request-daterange").on("cancel.daterangepicker",function(){$(this).val("");LoadListMonibackPromotion()});$("#request-search").keyup(searchThrottle(function(){LoadListMonibackPromotion()}));$("#request-type").change(function(){LoadListMonibackPromotion()});LoadListMonibackPromotion()}function managePromotionTypeStatus(n){$("#tblMonibackPromotions").DataTable().ajax.reload();$.ajax({type:"POST",url:"/Administration/ManagePromotionTypeStatus",datatype:"json",data:{key:n},success:function(n){n.result?(cleanBookNotification.success("Change successful! ","Qbicles"),LoadListMonibackPromotion()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function loadModalBulkAddEdit(n){$.LoadingOverlay("show");var t=$("#bulkdeal-promo-add");t.empty();t.modal("show");t.load("/Administration/loadAddEditBulkDeal",{promotionKey:n},function(){$("#bulkdeal-promo-add .checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#bulkdeal-promo-add .select2").select2({placeholder:"Please select"});$("#bulkdeal-promo-add .singledateandtime").daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateFormatByUser.toUpperCase()+" "+$timeFormatByUser}});$("#itemdiscount").show();$("#bulkdeal-promo-add .chktoggle").bootstrapToggle();initFormBulkDealPromotionValidate();setTimeout(function(){$.LoadingOverlay("hide")},500)})}function loadActiveBulkDealPromotions(n){var i={name:$("#promos-active input[name=search-bulk-deal]").val(),daterange:$("#promos-active input[name=bulk-deal-daterange-search]").val(),type:$("#promos-active select[name=type]").val()},t=$("#promos-active .flex-grid-quarters-lg");n||t.LoadingOverlay("show");t.load("/Administration/LoadActiveBulkDealPromotions",{filterModel:i},function(){t.LoadingOverlay("hide")})}function loadSearchItemsForBulkDealPromotions(n){var i={keyword:$("#promos-active input[name=search-bulk-deal]").val(),daterange:$("#promos-active input[name=bulk-deal-daterange-search]").val(),type:$("#promos-active select[name=bulk-deal-type]").val()},t=$("#promos-active .flex-grid-quarters-lg");n||t.LoadingOverlay("show");t.load("/Administration/loadSearchItemsForBulkDealPromotions",{filterModel:i},function(){t.LoadingOverlay("hide")})}function initFormBulkDealPromotionValidate(){var n=$("#frmAddEditDeal");n.validate({ignore:"",invalidHandler:function(n,t){t.errorList.length&&$('a[href="#'+jQuery(t.errorList[0].element).closest(".tab-pane").attr("id")+'"]').tab("show")}});n.submit(function(t){if((t.preventDefault(),setMinTimeFromToTimeBulkDealPromotion(),!isBusy)&&n.valid()){$.LoadingOverlay("show");var i=document.getElementById("filefeaturedimg").files,r=$("#hdffeaturedimguri").val();!r||i&&i.length>0?UploadMediaS3ClientSide("filefeaturedimg").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#hdffeaturedimguri").val(n.objectKey);saveBulkDealPromotion()}):saveBulkDealPromotion()}})}function setMinTimeFromToTimeBulkDealPromotion(){var r=$("#chkSpecificTime").prop("checked"),t=$("#frmAddEditDeal input[name=FromTime]").val(),i=$("#frmAddEditDeal input[name=ToTime]"),n;t&&r?(n=t.split(":"),n[1]++,n[0]=n[0].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),n[1]=n[1].toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),t=n[0]+":"+n[1],i.attr("min",t)):i.removeAttr("min")}function saveBulkDealPromotion(){var n="#frmAddEditDeal",r=$(n+" select[name=Days]").val(),t,i;r||(r=[]);t={model:{PromotionKey:$(n+" input[name=PromotionKey]").val(),Name:$(n+" input[name=Name]").val(),Description:$(n+" textarea[name=Description]").val(),StartDateString:$(n+" input[name=StartDate]").val(),EndDateString:$(n+" input[name=EndDate]").val(),DisplayDateString:$("#chkAdvertiseCustome").prop("checked")?$(n+" input[name=DisplayDate]").val():$(n+" input[name=StartDate]").val(),DaysOfweek:$("#chkSpecificTime").prop("checked")?r.join(","):[],FromTime:$(n+" input[name=FromTime]").val(),ToTime:$(n+" input[name=ToTime]").val(),VoucherExpiryDateString:$("#chkExpiryDate").prop("checked")?$("#expiry-date").val():""},itemDiscountVoucherInfo:{}};i=$(n+" select[name=Type]").val();t.model.Type=i;t.featuredImageUri=$("#hdffeaturedimguri").val();i=="1"?(t.itemDiscountVoucherInfo={Id:0,MaxVoucherCount:$(n+" input[name=MaxVoucherCount]").val(),MaxVoucherCountPerCustomer:$(n+" input[name=MaxVoucherCountPerCustomer]").val(),TermsAndConditions:$(n+" textarea[name=TermsAndConditions]").val(),BusinessesTermsAndConditions:$(n+" textarea[name=BusinessesTermsAndConditions]").val(),IsDraft:"true",ItemDiscount:$(n+" input[name=ItemDiscount]").val()},t.itemDiscountVoucherInfo.MaxVoucherCount||(t.itemDiscountVoucherInfo.MaxVoucherCount=-1)):i=="2";$.ajax({type:"post",url:"/Administration/SaveBulkDealPromotion",data:t,dataType:"json",success:function(n){n.result?(cleanBookNotification.createSuccess(),$("#bulkdeal-promo-add").modal("hide"),LoadFilterToBulkDealPromotions(!0)):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Bulk Deal Creation"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Bulk Deal Creation")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Promotions & vouchers")}}).always(function(){LoadingOverlayEnd()})}function LoadFilterToBulkDealPromotions(n){var i={Name:$("#tab-bulkdeal input[name=search-bulk-deal]").val(),DateRange:$("#tab-bulkdeal input[name=scheduleddate-bulk-deal]").val(),Type:$("#tab-bulkdeal select[name=type-bulk-deal]").val()},t=$("#tab-bulkdeal .flex-grid-quarters-lg");n||t.LoadingOverlay("show");t.load("/Administration/ApplyFilterToBulkDealPromotions",{bulkDealParameter:i},function(){t.LoadingOverlay("hide")})}function ApplySearchToBulkDealPromotions1(){$("#bulk-deal-list").LoadingOverlay("show");var n={Name:$("#search-bulk-deal").val(),Date:$("#bulk-deal-daterange-search").val(),Type:$("#bulk-deal-type :selected").val()};$.ajax({type:"post",url:"/Qbicles/ApplyFilterQbicle",data:n,dataType:"html",success:function(n){n!==""&&($("#bulk-deal-dash-grid").empty(),$("#bulk-deal-dash-grid").append(n))},error:function(){}}).always(function(){$("#bulk-deal-list").LoadingOverlay("hide",!0)})}function ApplySearchToBulkDealPromotions(){$("#bulk-deal-list").LoadingOverlay("show");var n={Open:$checkOpen.is(":checked"),Closed:$checkClosed.is(":checked"),Name:$nameSearch.val(),Peoples:$selectPeople.val(),Topics:$selectTopic.val(),order:$("#order :selected").val(),IsShowHidden:$("#isShowHidden").is(":checked")?!0:!1};$("#remove-filters").removeAttr("disabled");$.ajax({type:"post",url:"/Qbicles/ApplyFilterQbicle",data:n,dataType:"html",success:function(n){n!==""&&($("##bulk-deal-dash-grid").empty(),$("##bulk-deal-dash-grid").append(n))},error:function(){}}).always(function(){$("##bulk-deal-list").LoadingOverlay("hide",!0)})}function ActivateOrDeactiveBulkDeal(n,t){$.ajax({type:"post",url:"/Qbicles/ShowOrHideBulkDeal",data:{key:n,isHidden:!t},dataType:"json",success:function(n){n.result?ApplySearchToBulkDealPromotions():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function RemoveFilter(){$checkOpen.prop("checked",!0).trigger("change");$checkClosed.prop("checked",!1).trigger("change");$nameSearch.val("");$selectPeople.val("").trigger("change");$selectTopic.val("").trigger("change");$("#order").val(4).trigger("change");$("#isShowHidden").bootstrapToggle("off");ApplySearchToBulkDealPromotions();$("#remove-filters").attr("disabled","disabled")}function BulkDealSelected(){return}function loadBulkDealPromotions(n){var i={keyword:$("#promos-active input[name=search]").val(),daterange:$("#promos-active input[name=scheduleddate]").val(),type:$("#promos-active select[name=type]").val(),status:$("#promos-active select[name=status]").val()},t=$("#promos-active .flex-grid-quarters-lg");n||t.LoadingOverlay("show");t.load("/Administration/LoadBulkDealPromotions",{filterModel:i},function(){t.LoadingOverlay("hide")})}function loadSearchAndAddToBulkDealTab(){var n=$("#tab-search-add").attr("href"),t;activeTab=n.substring(n.indexOf("#")+1);setTabTrader(tabItemproduct,activeTab);t="/Trader/ListTraderItem";$("#tab-search-add").LoadingOverlay("show");cleanItemAndProductSubTabs();$("#tab-search-add").load(t,function(){$('.manage-columns input[type="checkbox"]').on("change",function(){var t=$("#tb_trader_items").DataTable(),n=t.column($(this).attr("data-column"));n.visible(!n.visible())});$("#tab-search-add").LoadingOverlay("hide");searchOnTableItems()})}function searchOnTableSearchAndAdd(){var i=[],t=$("#search_dt").val().split(" "),n;if($("#search_dt").val()!==""&&$("#search_dt").val()!==null&&t.length>0)for(n=0;n<t.length;n++)t[n]!==""&&i.push(t[n]);$("#tb_trader_items").DataTable().search(i.join("|"),!0,!1,!0).draw();$("#tb_trader_items").val("")}function LoadItemOverviewItemProductForSearchAndAddBulkDeal(){const n=$("#search_dt").val().toLowerCase();console.log(n);bdlTable=$("#tblSearchAddToBulkDeal").DataTable({processing:!0,serverSide:!0,ajax:{url:"/Administration/GetItemOverviewItemProductForSearchAndAddBulkDeal",type:"GET",data:function(t){t.searchValue=n},beforeSend:function(){$("#trLoader").show()},dataSrc:function(n){$("#trLoader").remove();let t=n.data;return console.log({bulkDealItems:t}),t},complete:function(){$("#trLoader").remove()}},columns:[{data:"id",render:function(n){return'<input type="checkbox" class="largerCheckbox tblChk" data-id="'+n+'">'}},{data:"ImageUri",orderable:!1,render:function(n){return'<img src="'+apiDoc+n+'" alt="Item Image" style="width:50px;height:50px;border-radius:50%;" />'}},{data:"ItemName"},{data:"SKU"},{data:"Barcode"},{data:"Business"},{data:"Location"},{data:"ItemId",visible:!1},{data:"DomainId",visible:!1},]})}function updateSelectedCount(){$("#selectedElement").text(bulkDealItems.length);console.log({bulkDealItems})}function ClearSelectedItems(){bulkDealItems.length=0;$("#addToBulkDeal").hide();$("#clearSelectedItems").hide();var n=$("#chkAll").prop("checked");n?$("#chkAll").prop("checked",!1).trigger("change"):($("#chkAll").prop("checked",!0).trigger("change"),$("#chkAll").prop("checked",!1).trigger("change"));$("#selectedElement").text(bulkDealItems.length)}function AddToBulkDealPromotion(){$.LoadingOverlay("show");var n=$("#add-to-bulkdeal");n.empty();n.modal("show");n.load("/Administration/loadAddToBulkDeal",function(){setTimeout(function(){$.LoadingOverlay("hide")},500)})}function InitAddToBulkDealPromotionTable(){console.log("I was here at AddToBulkDealPromotion");$("#tblBulkDealCreation").DataTable({data:bulkDealItems,columns:[{data:"ImageUri",orderable:!1,render:function(n){return'<img src="'+apiDoc+n+'" alt="Item Image" style="width:50px;height:50px;border-radius:50%;" />'}},{data:"ItemName"},{data:"SKU"},{data:"Barcode"},{data:"Business"},{data:"Location"},{data:"ItemId",visible:!1},{data:"DomainId",visible:!1},]});$("#bulkDealSelect .select2").select2({placeholder:"Please select"});$("#bulkDealSelect .select2").change(function(){var n=$(this).find("option:selected"),t=n.val(),i=n.data("Name"),r=n.data("Description");console.log("Selected ID:",t);console.log("Selected Name:",i);console.log("Other Property:",r)})}function CreateBulkPromotions(){console.log("Items and Business",{bulkDealItems})}function updateBulkDealElements(){bulkDealItems.length?($("#addToBulkDeal").show(),$("#clearSelectedItems").show()):($("#addToBulkDeal").hide(),$("#clearSelectedItems").hide());$("#selectedElement").text(bulkDealItems.length)}var isBusy=!1,apiDoc,bulkDealItems;let rankPromotionTypeRowsCollections=[];apiDoc=$("#api-uri").val();bulkDealItems=[];var $promotionKey="",$promotionName="",$promotionStop=!1,$promotionMessage=!1;$("#subfilter-group").on("change",function(){table.draw()});$("#search-user-list").on("keyup",function(){table.search(this.value).draw()});$(document).ready(function(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".select2avatarDomain").select2({placeholder:"Please select",templateResult:formatOptions,templateSelection:formatSelected,dropdownCssClass:"withdrop"});$(".select2avatar").select2({placeholder:"Please select",templateResult:formatOptions,templateSelection:formatSelected});$("#search_dt").keyup(delay(function(){LoadItemOverviewItemProductForSearchAndAddBulkDeal()},1e3));$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){var t=$(n.target).attr("data-target"),i;if(console.log("Switched to tab: "+t),t==="#tab-bulkdeal")console.log("Bulk Deal tab is active"),$("#search-bulk-deal").keyup(searchThrottle(function(){LoadFilterToBulkDealPromotions(!0)})),$("#bulk-deal-type").change(function(){LoadFilterToBulkDealPromotions(!0)}),$("#bulk-deal-daterange-search input[name=scheduleddate-bulk-deal]").change(function(){LoadFilterToBulkDealPromotions(!0)});else if(t==="#tab-search-add"){$("#clearSelectedItems").hide();$("#addToBulkDeal").hide();i=$("#tblSearchAddToBulkDeal").DataTable({lengthMenu:[25,50,100],processing:!0,serverSide:!0,responsive:!0,destroy:!0,ajax:{url:"/Administration/GetItemOverviewItemProductForSearchAndAddBulkDeal",type:"GET",data:function(n){n.searchValue=$("#search_add_dt").val().toLowerCase()},beforeSend:function(){$("#trLoader").show()},dataSrc:function(n){$("#trLoader").remove();let t=n.data;return console.log({bulkDealItems:t}),t},complete:function(){$("#trLoader").remove()}},columns:[{data:"id",render:function(n){return'<input type="checkbox" class="largerCheckbox tblChk" data-id="'+n+'">'}},{data:"ImageUri",orderable:!1,render:function(n){return'<img src="'+apiDoc+n+'" alt="Item Image" style="width:50px;height:50px;border-radius:50%;" />'}},{data:"ItemName"},{data:"SKU"},{data:"Barcode"},{data:"Business"},{data:"Location"},{data:"ItemId",visible:!1},{data:"DomainId",visible:!1},]});$("#tblSearchAddToBulkDeal").on("change",".tblChk",function(){var n=i.row($(this).closest("tr")).data(),t;$(this).prop("checked")?bulkDealItems.push(n):(t=$("#chkAll").prop("checked"),t&&$("#chkAll").prop("checked",!1),bulkDealItems=bulkDealItems.filter(function(t){return t.Id!==n.Id}));updateBulkDealElements()});$("#chkAll").change(function(){var n=$(this).prop("checked");$(".tblChk").prop("checked",n).trigger("change")});$("#search_add_dt").keyup(delay(function(){i.draw()},1e3))}});initMonibackPromotionTable();initMonibackRankPromotionTable();initDragDrop()});