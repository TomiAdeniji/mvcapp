function formatDate(n){if(n!==null){var t=new Date(parseInt(n.replace(/(^.*\()|([+-].*$)/g,""))),i=(t.getMonth()+1<10?"0":"")+(t.getMonth()+1),r=(t.getDate()<10?"0":"")+t.getDate();return r+"/"+i+"/"+t.getFullYear()}return""}function save_task(){var n=!0;if($select_task_type.val()!==$hdTransactionMatching.val()&&(cleanBookNotification.error(_L("ERROR_MSG_475"),"Qbicles"),n=!1),$form_reconciliationtask.valid()){if($select_task_type.val()===null?(cleanBookNotification.error(_L("ERROR_MSG_477"),"Qbicles"),n=!1):$select_task_type.val()===$hdTransactionMatching.val()?$firstaccount.val()===null||$firstaccount.val()===""?(cleanBookNotification.error(_L("ERROR_MSG_478"),"Qbicles"),n=!1):$secondaccount.val()===null||$secondaccount.val()===""?(cleanBookNotification.error(_L("ERROR_MSG_479"),"Qbicles"),n=!1):$firstaccount.val()===$secondaccount.val()&&(cleanBookNotification.error(_L("ERROR_MSG_480"),"Qbicles"),n=!1):$select_task_type.val()===$hdTransactionAnlysis.val()&&($firstaccount.val()===null||$firstaccount.val()==="")&&(cleanBookNotification.error(_L("ERROR_MSG_478"),"Qbicles"),n=!1),$("#task_workgroup").val()===null&&($form_reconciliationtask.validate().showErrors({task_workgroup:_L("ERROR_MSG_168")}),n=!1),!n)return;$AssignedUserId.val()===""?bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,className:"my-modal",title:"Qbicles",message:"The Assign To is not set when the Task is saved. Are you sure continue?",callback:function(n){if(!n){$("body").css("overflow-y","hidden");return}$("body").css("overflow-y","auto");saveaddtask()}}):saveaddtask()}else if($("#task_workgroup").val()===null&&($form_reconciliationtask.validate().showErrors({task_workgroup:_L("ERROR_MSG_168")}),n=!1),!n)return}function saveaddtask(){$.ajax({type:"post",url:"/Tasks/TaskNameCheck",datatype:"json",data:{name:$taskname.val(),id:$hdReconciliationTaskId.val()},success:function(n){if(n.dupplicate)$form_reconciliationtask.validate().showErrors({Name:"name of reconciliation task already exists"});else{var t=$("#typeoftask :selected").val();if(t===$("#hdBalanceAnalysis").val()){if($("#tblBalanceAnalysis tbody tr td").length<=1){cleanBookNotification.error("You not enter balance mapping ruler","Qbicles");return}$("#step_1").removeClass("active").addClass("disabled disabledTab");$("#stepv1").removeClass("in active").addClass("disabled disabledTab");$("#step_2").removeClass("disabled disabledTab").addClass("active");$("#stepv2").removeClass("disabled disabledTab").addClass("in active");$("#step2-vtab").css({color:"#337ab7"});$("#step1-vtab").removeAttr("style")}else SaveTask()}}})}function SaveTask(){var y=$taskname.val(),i=$("#typeoftask").val(),p=$firstaccount.val(),w=$secondaccount.val(),o=$TransactionMatchingTypeId.val(),b=$TaskExecutionIntervalId.val(),k=$AssignedUserId.val(),d=$("#Task-Description").val(),at=$("#chkDateVariance").prop("checked"),vt=$("#chkamounVariance").prop("checked"),u=$("#hdReconciliationTaskId").val(),g=$selectgroup.val(),nt=$("#hdTaskTypeIdOld").val(),tt=$("#DateVariance").val(),it=$("#amounVariance").val(),rt=$("#hdtransactionmatchingtaskrulesaccessId").val(),f=$("#InitialTransactionDate").val(),s=[],h=[],r,l,n,a,v;if(i===$("#hdTransactionMatching").val()){if(f===""){cleanBookNotification.error(_L("ERROR_MSG_482"),"Qbicles");return}}else if(i===$("#hdTransactionAnlysis").val()&&f===""){cleanBookNotification.error(_L("ERROR_MSG_482"),"Qbicles");return}if(i===$("#hdBalanceAnalysis").val()){if(arrNumberrow.length<=0){cleanBookNotification.error(_L("ERROR_MSG_483"),"Qbicles");return}if($("#tblBalanceAnalysis tbody tr td").length<=1){cleanBookNotification.error(_L("ERROR_MSG_484"),"Qbicles");return}for(r=0;r<arrNumberrow.length;++r){var ut=$("#hdValue"+arrNumberrow[r]).val(),c=0,e="",t=ut.split("#");t.length>1?(c=t[0]===""?"0":t[0],e=t[1]):e=t[0];l={Id:c,Name:e};h.push(l)}for(n=0;n<arrEdit.length;n++){var ft=$("#desc1"+arrEdit[n]).html(),et=$("#ref1"+arrEdit[n]).html(),ot=$("#desc2"+arrEdit[n]).html(),st=$("#ref2"+arrEdit[n]).html(),ht=$("#min"+arrEdit[n]).html(),ct=$("#max"+arrEdit[n]).html(),lt={Id:0,TaskId:u,Description1:ft,Reference1:et,Description2:ot,Reference2:st,MinDifference:ht,MaxDifference:ct};s.push(lt)}}a={Id:u,Name:y,Description:d,ReconciliationTaskGroupId:g,TaskExecutionIntervalId:b,TaskTypeId:i,AssignedUserId:k,WorkGroup:{Id:$("#task_workgroup").val()},TransactionMatchingTypeId:o===""?"0":o,IsActionNotify:$("#IsActionNotify").val(),IsActionReport:$("#IsActionReport").val(),IsActionNewLedger:$("#IsActionNewLedger").val(),InitialTransactionDate:$("#InitialTransactionDate").val(),CreatedById:$hdCreatedById.val(),CreatedDate:$hdCreatedDate.val()};v={rectask:a,InitialTransactionDate:f,AccountId1:p,AccountId2:w,TaskTypeIdOld:nt,DateVariance:tt,amounVariance:it,transactionmatchingtaskrulesaccessId:rt,balancemapingruler:s,balanceAction:h,Priority:$SelectPriority.val(),Deadline:$task_Deadline.val(),WorkGroupId:$("#task_workgroup").val()};$.ajax({type:"post",url:"/Tasks/Save_ManageReconciliationTasks",datatype:"json",data:v,success:function(n){n.status&&($("#task-page-display").empty(),$("#task-page-display").html("<div id='task-content'><\/div>"),LoadTasks(""),$modal_reconciliationtask.modal("toggle"),u>0?cleanBookNotification.updateSuccess():cleanBookNotification.createSuccess())}})}function GetRules(n){$.ajax({url:"/Tasks/get_rulesaccess",type:"GET",dataType:"json",data:{id:n},success:function(n){n!==""&&($("#hdtransactionmatchingtaskrulesaccessId").val(n.Id),$("#chkDateVariance").prop("checked",n.IsDateVarianceVisible).change(),$("#chkamounVariance").prop("checked",n.IsAmountVarianceVisible).change(),$("#DateVariance").val(n.IsDateVarianceVisible),$("#amounVariance").val(n.IsAmountVarianceVisible))}})}function GetBalanceAction(n){$("#lblwell div").remove();arrNumberrow=[];$.ajax({url:"/Tasks/get_editBalanceAction",type:"GET",dataType:"json",data:{id:n},success:function(n){var i="",t;if(n!==""){for(t=0;t<n.length;++t)i+='    <div class="row">',i+='<div class="col-md-10">'+n[t].Name,i+='<input type="hidden" id="hdValue'+t+'" value="'+n[t].Id+"#"+n[t].Name+'" />',i+=" <\/div>",i+='<div class="col-md-2"><a href="#" style="margin-left: -15px;" onclick="DeleteItembalanceanalysisaction(this,'+t+","+n[t].Id+')">Delete<\/a><\/div>',i+="<\/div>",arrNumberrow.push(t),numberrow++;$("#lblwell").append(i)}}})}function GetBalanceMapingRuler(n){$("#tblBalanceAnalysis tbody tr").remove();arrEdit=[];$.ajax({url:"/Tasks/get_editBalanceMapingRuler",type:"GET",dataType:"json",data:{id:n},success:function(n){var r,t,i;if(n!==""){for(r="",t=0;t<n.length;++t)arrtmp.push(n[t].Reference1+"#"+n[t].Reference2),r+='    <tr id="balance'+t+'">',r+='<td><input type="checkbox" name="trows[]" id="chk'+t+'" onchange="CheckBoxChange(this,'+t+",'"+n[t].Reference1+"#"+n[t].Reference2+"',"+n[t].Id+')"><\/td>',r+='<td><span class="editable" id="desc1'+t+'">'+n[t].Description1+"<\/span><\/td>",r+='<td><span class="editable" id="ref1'+t+'">'+n[t].Reference1+"<\/span><\/td>",r+='<td><span class="editable" id="desc2'+t+'">'+n[t].Description2+"<\/span><\/td>",r+='<td><span class="editable" id="ref2'+t+'">'+n[t].Reference2+"<\/span><\/td>",r+='<td><span class="editable" id="min'+t+'">'+n[t].MinDifference+"<\/span><\/td>",r+='<td><span class="editable" id="max'+t+'">'+n[t].MaxDifference+"<\/span><\/td>",r+='<td class="table_options"><a href="#" onclick="Removebalanceanalysismappingrule(this,'+t+",'"+n[t].Reference1+"#"+n[t].Reference2+"',"+n[t].Id+')">Delete<\/a><\/td>',r+=" <\/tr>";$("#lblBalanceTable").html("");i='<table class="table table-hover t5style" id="tblBalanceAnalysis" cellspacing="0" width="100%">';i+="     <thead>";i+="              <tr>";i+="                <th><\/th>";i+="                <th>Description 1<\/th>";i+="                 <th>Reference 1<\/th>";i+="                 <th>Description 2<\/th>";i+="                 <th>Reference 2<\/th>";i+="                <th>Ref 1 - 2 min<\/th>";i+="                 <th>Ref 1 - 2 max<\/th>";i+="                <th>Options<\/th>";i+="            <\/tr>";i+="        <\/thead>";i+="         <tbody>";i+=r;i+="   <\/tbody>";i+="     <\/table>";$("#lblBalanceTable").append(i);$("#tblBalanceAnalysis").DataTable({sDom:'<"top">rt<"bottomtable"ip><"clear">',bInfo:!0,bFilter:!1,bPaginate:!0,bSearchable:!1,sPaginationType:"numbers",pageLength:5,columnDefs:[{targets:0,orderable:!1},{targets:7,orderable:!1}]});$("#description_1_add").val("");$("#reference_1_add").val("");$("#description_2_add").val("");$("#reference_2_add").val("");$("#ref_min_add").val("");$("#ref_max_add").val("")}}})}function Addbalanceanalysismappingrule(){var o=$("#description_1_add").val(),n=$("#reference_1_add").val(),s=$("#description_2_add").val(),t=$("#reference_2_add").val(),h=$("#ref_min_add").val(),c=$("#ref_max_add").val(),r,u,f,l,i,e;if(o===""){cleanBookNotification.warning("You have not entered a description 1!","Message");return}if(n===""){cleanBookNotification.warning("You have not entered a Reference 1!","Message");return}if(s===""){cleanBookNotification.warning("You have not entered a description 2!","Message");return}if(t===""){cleanBookNotification.warning("You have not entered a Reference 2!","Message");return}if(h===""){cleanBookNotification.warning("You have not entered a min value!","Message");return}if(c===""){cleanBookNotification.warning("You have not entered a max value!","Message");return}if(r=$("#hdReconciliationTaskId").val(),r!==""&&r!=="0")$.ajax({type:"post",url:"/BalanceAnalysis/CheckName",dataType:"json",data:{name1:n,Name2:t,TaskId:r},success:function(i){var u=!1,f,e,r;if(i.ref1===1&&(cleanBookNotification.warning("Reference 1 already exists","Message"),u=!0),i.ref2===1&&(cleanBookNotification.warning("Reference 2 already exists","Message"),u=!0),!u)for(f=0;f<arrtmp.length;++f)e=arrtmp[f].split("#"),e[0]===n&&(cleanBookNotification.warning("Reference 1 already exists","Message"),u=!0),e[1]===t&&(cleanBookNotification.warning("Reference 2 already exists","Message"),u=!0);u||($("#tblBalanceAnalysis tbody tr.odd").remove(),arrtmp.push(n+"#"+t),r="",indexbalanceanalysis=arrEdit.length,r='    <tr id="balance'+indexbalanceanalysis+'">',r+='<td><input type="checkbox" name="trows[]" id="chk'+indexbalanceanalysis+'" onchange="CheckBoxChange(this,'+indexbalanceanalysis+",'"+n+"#"+t+"',0)\"><\/td>",r+='<td><span class="editable" id="desc1'+indexbalanceanalysis+'">'+o+"<\/span><\/td>",r+='<td><span class="editable" id="ref1'+indexbalanceanalysis+'">'+n+"<\/span><\/td>",r+='<td><span class="editable" id="desc2'+indexbalanceanalysis+'">'+s+"<\/span><\/td>",r+='<td><span class="editable" id="ref2'+indexbalanceanalysis+'">'+t+"<\/span><\/td>",r+='<td><span class="editable" id="min'+indexbalanceanalysis+'">'+h+"<\/span><\/td>",r+='<td><span class="editable" id="max'+indexbalanceanalysis+'">'+c+"<\/span><\/td>",r+='<td class="table_options"><a href="#" onclick="Removebalanceanalysismappingrule(this,'+indexbalanceanalysis+",'"+n+"#"+t+"',0)\">Delete<\/a><\/td>",r+=" <\/tr>",$("#tblBalanceAnalysis tbody").append(r),arrEdit.push(indexbalanceanalysis),$("#description_1_add").val(""),$("#reference_1_add").val(""),$("#description_2_add").val(""),$("#reference_2_add").val(""),$("#ref_min_add").val(""),$("#ref_max_add").val(""))}});else{for(u=!1,f=0;f<arrtmp.length;++f)l=arrtmp[f].split("#"),l[0]===n&&(cleanBookNotification.warning("Reference 1 already exists","Message"),u=!0),l[1]===t&&(cleanBookNotification.warning("Reference 2 already exists","Message"),u=!0);if(u)return;$("#tblBalanceAnalysis tbody tr.odd").remove();arrtmp.push(n+"#"+t);i="";e=$("#tblBalanceAnalysis tbody tr:last").attr("id");e=e.replace("balance","");indexbalanceanalysis=parseInt(e);i='    <tr id="balance'+indexbalanceanalysis+'">';i+='<td><input type="checkbox" name="trows[]" id="chk'+indexbalanceanalysis+'" onchange="CheckBoxChange(this,'+indexbalanceanalysis+",'"+n+"#"+t+"',0)\"><\/td>";i+='<td><span class="editable" id="desc1'+indexbalanceanalysis+'">'+o+"<\/span><\/td>";i+='<td><span class="editable" id="ref1'+indexbalanceanalysis+'">'+n+"<\/span><\/td>";i+='<td><span class="editable" id="desc2'+indexbalanceanalysis+'">'+s+"<\/span><\/td>";i+='<td><span class="editable" id="ref2'+indexbalanceanalysis+'">'+t+"<\/span><\/td>";i+='<td><span class="editable" id="min'+indexbalanceanalysis+'">'+h+"<\/span><\/td>";i+='<td><span class="editable" id="max'+indexbalanceanalysis+'">'+c+"<\/span><\/td>";i+='<td class="table_options"><a href="#" onclick="Removebalanceanalysismappingrule(this,'+indexbalanceanalysis+",'"+n+"#"+t+"',0)\">Delete<\/a><\/td>";i+=" <\/tr>";$("#tblBalanceAnalysis tbody").append(i);arrEdit.push(indexbalanceanalysis);$("#description_1_add").val("");$("#reference_1_add").val("");$("#description_2_add").val("");$("#reference_2_add").val("");$("#ref_min_add").val("");$("#ref_max_add").val("")}}function Removebalanceanalysismappingrule(n,t,i,r){var u,f,e,o;$(n).parent().parent().remove();u=arrtmp.indexOf(i);u>=0&&arrtmp.splice(u,1);f=arrEdit.indexOf(t);f>=0&&arrEdit.splice(f,1);e=[];o=[];e.push(r);o.push(t);$.ajax({type:"post",url:"/BalanceAnalysis/DeleteBalanceMapingRuler",dataType:"json",data:{lstId:e,lstindex:o},success:function(){}})}function RemoveMultiplebalanceanalysismappingrule(){for(var i,t,r=[],u=[],n=0;n<multiplebalanceanalysismappingrule.length;++n)$("#balance"+multiplebalanceanalysismappingrule[n]).remove(),i=arrtmp.indexOf(arrtmp2[n]),i>=0&&arrtmp.splice(i,1),t=arrEdit.indexOf(multiplebalanceanalysismappingrule[n]),t>=0&&(arrEdit.splice(t,1),u.push(t)),Idarr[n]>0&&r.push(Idarr[n]);$.ajax({type:"post",url:"/BalanceAnalysis/DeleteBalanceMapingRuler",dataType:"json",data:{lstId:r,lstindex:u},success:function(){}})}function CheckBoxChange(n,t,i,r){var u,f;$(n).is(":checked")?(multiplebalanceanalysismappingrule.push(t),arrtmp2.push(i),Idarr.push(r)):(u=multiplebalanceanalysismappingrule.indexOf(r),u>=0&&multiplebalanceanalysismappingrule.splice(u,1),f=arrtmp2.indexOf(i),f>=0&&arrtmp2.splice(f,1));multiplebalanceanalysismappingrule.length>0?$("#btnRemoveMultipleBalanceAnalysisMapRuler").removeAttr("disabled"):$("#btnRemoveMultipleBalanceAnalysisMapRuler").attr("disabled","disabled")}function Add2balanceanalysisaction(){var i=$("#ddlbalanceanalysispredefaction :selected").val(),r=$("#ddlbalanceanalysispredefaction :selected").html(),f=i+"#"+r,u,t,e,n;if(i!==""&&i!==undefined){for(u=!0,t=0;t<arrNumberrow.length;++t)if(e=$("#hdValue"+arrNumberrow[t]).val(),e===f){u=!1;break}u?(n='    <div class="row">',n+='<div class="col-md-10">'+r,n+='<input type="hidden" id="hdValue'+numberrow+'" value="'+f+'" />',n+=" <\/div>",n+='<div class="col-md-2"><a href="#" style="margin-left: -15px;" onclick="DeleteItembalanceanalysisaction(this,'+numberrow+',0)">Delete<\/a><\/div>',n+="<\/div>",$("#lblwell").append(n),arrNumberrow.push(numberrow),numberrow++):($("#lblWarningError").css({display:"block"}),$("#lblErrorMessage").html(r+" already exists"))}else $("#lblWarningError").css({display:"block"}),$("#lblErrorMessage").html("Please select or enter at least one Option")}function Add2balanceanalysisaction2(){var t=$("#add_new_option").val(),u="#"+t,r,i,f,n;if(t!==""){for(r=!0,i=0;i<arrNumberrow.length;++i)if(f=$("#hdValue"+arrNumberrow[i]).val(),f.indexOf(u)>0){r=!1;break}r?(n='    <div class="row">',n+='<div class="col-md-10">'+t,n+='<input type="hidden" id="hdValue'+numberrow+'" value="'+u+'" />',n+=" <\/div>",n+='<div class="col-md-2"><a href="#" style="margin-left: -15px;" onclick="DeleteItembalanceanalysisaction(this,'+numberrow+',0)">Delete<\/a><\/div>',n+="<\/div>",$("#lblwell").append(n),arrNumberrow.push(numberrow),numberrow++):($("#lblWarningError").css({display:"block"}),$("#lblErrorMessage").html(t+" already exists"))}else $("#lblWarningError").css({display:"block"}),$("#lblErrorMessage").html("Please enter an option")}function DeleteItembalanceanalysisaction(n,t,i){$(n).parent().parent().remove();var r=arrNumberrow.indexOf(t);r>=0&&arrNumberrow.splice(r,1);i>0&&$.ajax({type:"post",url:"/BalanceAnalysis/DeleteBalanceAction",dataType:"json",data:{Id:i},success:function(){}})}function Back(){$("#step_2").removeClass("active").addClass("disabled disabledTab");$("#stepv2").removeClass("in active").addClass("disabled disabledTab");$("#step_1").removeClass("disabled disabledTab").addClass("active");$("#stepv1").removeClass("disabled disabledTab").addClass("in active");$("#step1-vtab").css({color:"#337ab7"});$("#step2-vtab").removeAttr("style")}function uploadfile(){var r=document.forms.form_reconciliationtask.bulk_add.files[0],i,t,n;r!==undefined&&(window.FormData!==undefined?(i=new FormData,i.append("file",r),t=$("#hdReconciliationTaskId").val(),t===""&&(t="0"),n=$("#tblBalanceAnalysis tr:last").attr("id"),n=n===undefined?0:parseInt(n.replace("balance",""))+1,$.ajax({type:"POST",url:"/BalanceAnalysis/ReadSheets?Id="+t+"&index="+n,contentType:!1,processData:!1,data:i,success:function(n){if(n.status===2)cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles"),$("#txtUploadFile").val("");else if(n.status===1)if(n.dataerror!=="")$("#linkerrorfile").attr("href",".."+n.dataerror),$("#modal_error").modal("show"),$("#txtUploadFile").val("");else{$("#lblBalanceTable").html("");var t='<table class="table table-hover t5style" id="tblBalanceAnalysis" cellspacing="0" width="100%">';t+="     <thead>";t+="              <tr>";t+="                <th><\/th>";t+="                <th>Description 1<\/th>";t+="                 <th>Reference 1<\/th>";t+="                 <th>Description 2<\/th>";t+="                 <th>Reference 2<\/th>";t+="                <th>Ref 1 - 2 min<\/th>";t+="                 <th>Ref 1 - 2 max<\/th>";t+="                <th>Options<\/th>";t+="            <\/tr>";t+="        <\/thead>";t+="         <tbody>";t+=n.datasuccess;t+="   <\/tbody>";t+="     <\/table>";$("#lblBalanceTable").append(t);$("#tblBalanceAnalysis").DataTable({sDom:'<"top">rt<"bottomtable"ip><"clear">',bInfo:!0,bFilter:!1,bPaginate:!0,bSearchable:!1,sPaginationType:"numbers",pageLength:5,columnDefs:[{targets:0,orderable:!1},{targets:7,orderable:!1}]});$("#txtUploadFile").val("")}},error:function(){return cleanBookNotification.error("Have an error when Scaning virus. Please contact the system administrator for help.","Qbicles"),$("#txtUploadFile").val(""),!1}})):alert("This browser doesn't support HTML5 file uploads!"))}function save_recGroup(){Save_Group()}function Save_Group(){if($("#form_group").valid()){var n={Id:$input_rectaskgroup_id.val(),Name:$input_rectaskgroup_name.val()};$.ajax({type:"post",url:"/Tasks/dupplicateRecTaskGroupCheck",dataType:"json",data:n}).done(function(n){n.dupplicate?$("#form_group").validate().showErrors({Name:"Task Group name of '"+$input_rectaskgroup_name.val()+"' already exists."}):$("#form_group").trigger("submit")}).fail(function(){$("#form_group").validate().showErrors({Name:"Error checking existing name of group in the current Domain!"})})}}function EditGroup(n,t){$("#"+t).hasClass("isDisabled")||(ClearError(),n&&n>0&&$.ajax({type:"GET",url:"/Tasks/get_reconciliationtaskgroups",datatype:"json",data:{id:n},success:function(n){n.Id&&($("#form_group").validate().resetForm(),$input_rectaskgroup_id.val(n.Id),$input_rectaskgroup_name.val(n.Name),$input_rectaskgroup_createddate.val(n.CreatedDate?new Date(parseInt(n.CreatedDate.substr(6))).toJSON():null),$input_rectaskgroup_createdbyid.val(n.CreatedById),$modal_group_title.text("Edit Group"),$("#save-group").text("Confirm"),$modal_group.modal("toggle"))},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Qbicles")}}))}function AddGroup(){ClearError();$input_rectaskgroup_id.val(0);$input_rectaskgroup_name.val("");$input_rectaskgroup_createddate.val("");$input_rectaskgroup_createdbyid.val("");$modal_group_title.text("Add a Group");$("#save-group").text("Add now");$modal_group.modal("toggle")}function RemoveAttr(){$taskname.removeAttr("disabled");$select_task_type.removeAttr("disabled");$TaskExecutionIntervalId.removeAttr("disabled");$TransactionMatchingTypeId.removeAttr("disabled");$firstaccount.removeAttr("disabled");$secondaccount.removeAttr("disabled")}function clearForm(){$TaskExecutionIntervalId[0].selectedIndex=0;$taskname.val("");$firstaccount[0].selectedIndex=-1;$firstaccount.trigger("change");$secondaccount[0].selectedIndex=-1;$secondaccount.trigger("change");$(".task-account").hide();$TransactionMatchingTypeId[0].selectedIndex=-1;$selectgroup[0].selectedIndex=0;$("textarea[name='Description']").val("");$("#description_1_add").val("");$("#reference_1_add").val("");$("#description_2_add").val("");$("#reference_2_add").val("");$("#ref_min_add").val("");$("#ref_max_add").val("");$("#tblBalanceAnalysis tbody tr").remove();$("#lblwell div").remove();arrEdit=[];$("#lblWarningError").css({display:"none"});$("#lblErrorMessage").html("");$("#balance_analysis").css({display:"none"});$("#InitialTransactionDate").val("");$SelectPriority[0].selectedIndex=0;$task_Deadline.val("");$select_task_type[0].selectedIndex=0;$select_task_type.trigger("change");$(".tab-content").removeClass("hidden");$(".tab-content").removeAttr("style")}function GetUser(n){$.ajax({url:"/Tasks/GetUserAsign",type:"GET",dataType:"json",success:function(t){var r="",i;for($("#AssignedUserId option").remove(),i=0;i<t.length;i++)r+="<option value='"+t[i].Id+"'>"+t[i].UserName+"<\/option>";$AssignedUserId.html(r);n!==""&&$AssignedUserId.val(n);$AssignedUserId.trigger("change")}})}function AddTask(n,t){$("#"+t).hasClass("isDisabled")||(clearForm(),RemoveAttr(),GetUser(),$("#task_workgroup").select2().val(null).change(),$("#task-modal-title").text("Add Task"),$modal_reconciliationtask.modal("toggle"),$selectgroup.val(n),$hdReconciliationTaskId.val("0"),$("#hdtransactionmatchingtaskrulesaccessId").val(0),$("#chkDateVariance").prop("checked",!1).change(),$("#chkamounVariance").prop("checked",!1).change(),$("#DateVariance").val(0),$("#amounVariance").val(0))}function EditTask(n,t,i){i.className.indexOf("isDisabled")!==0&&($hdReconciliationTaskId.val(n),clearForm(),n>0&&GetTaskEdit(n,t))}function GetTaskEdit(n,t){$.ajax({url:"/Tasks/checkEdit",type:"GET",dataType:"json",data:{id:n},success:function(i){if(i.Status===!0){var r=i.isInPresson;r?($("#task-name-info").html(t),$("#modal-warning").modal("toggle")):$.ajax({url:"/Tasks/GetTaskEdit",type:"GET",dataType:"json",data:{id:n},success:function(t){$("#task_workgroup").select2().val(t.WorkGroupId).change();setTimeout(function(){GetRules(n)},100);setTimeout(function(){GetBalanceMapingRuler(n)},100);setTimeout(function(){GetBalanceAction(n)},100);setTimeout(function(){var e,r,u;if(t){if($SelectPriority.val(t.Priority),t.Deadline==="01-01-0001 00:01"?$task_Deadline.val(""):$task_Deadline.val(t.Deadline),e=t.isInPresson,e)return $("#task-name-info").html(n),$("#modal-warning").modal("toggle"),!1;var o=t.taskinstance,i=t.task,f=t.taskaccount;if(i!==null){if($("#InitialTransactionDate").val(""),$("#lblInitialTransactionDate").hide(),$selectgroup.val(i.ReconciliationTaskGroupId),$taskname.val(i.Name),$("textarea[name='Description']").val(i.Description),$select_task_type.val(i.TaskTypeId).trigger("change"),$hdTaskTypeIdOld.val(i.TaskTypeId),$TaskExecutionIntervalId.val(i.TaskExecutionIntervalId),setTimeout(function(){GetUser(i.AssignedUserId)},200),$hdCreatedById.val(i.CreatedById),$hdCreatedDate.val(i.CreatedDate),i.TaskTypeId==$hdTransactionMatching.val()?($("#save-tab-1").text("Finish and Save"),$("#save-tab-div-1").show(),$("#step_2").hide(),$("#balance_analysis").hide(),$(".task-account").show(),$TransactionMatchingTypeId.val(i.TransactionMatchingTypeId),$TransactionMatchingTypeId.trigger("change"),$("#lblInitialTransactionDate").show(),$("#InitialTransactionDate").val(formatDate(i.InitialTransactionDate))):i.TaskTypeId==$hdTransactionAnlysis.val()?($("#save-tab-1").text("Next"),$("#step_2").show(),$("#save-tab-div-1").show(),$(".task-account").show(),$("#taskcount3").hide(),$("#taskcount2").hide(),$("#balance_analysis").hide(),$("#lblInitialTransactionDate").show(),$("#InitialTransactionDate").val(formatDate(i.InitialTransactionDate))):$select_task_type.val()==$hdBalanceAnalysis.val()&&($("#save-tab-1").text("Next"),$("#step_2").show(),$(".task-account").hide(),$("#taskcount3").hide(),$("#taskcount2").hide(),$("#pnDateVariance").hide(),$("#pnamounVariance").hide(),$("#balance_analysis").show()),f.length>0)for(r=0;r<f.length;r++)u=f[r],u.Order===1?($firstaccount.val(u.AccountId),$firstaccount.trigger("change")):($secondaccount.val(u.AccountId),$secondaccount.trigger("change"));o===!0?($taskname.attr({disabled:"disabled"}),$select_task_type.attr({disabled:"disabled"}),$TaskExecutionIntervalId.attr({disabled:"disabled"}),$TransactionMatchingTypeId.attr({disabled:"disabled"}),$firstaccount.attr({disabled:"disabled"}),$secondaccount.attr({disabled:"disabled"})):RemoveAttr()}$(".tab-content").removeClass("hidden");$(".tab-content").removeAttr("style");$("#form_reconciliationtask.tab-content").show();$("#task-modal-title").text("Edit Task");$modal_reconciliationtask.modal("toggle")}},500)}})}}})}function GetDomainRoleAccounts(n){return $.ajax({url:"/Tasks/GetDomainRoleAccounts",type:"GET",dataType:"json",data:{taskId:n}})}function TaskDelete(n,t,i,r){r.className.indexOf("isDisabled")!==0&&$.ajax({type:"post",url:"/Tasks/ValidDeleteTask",dataType:"json",data:{taskId:n},success:function(r){r.status===!0?($("#permission-del").show(),$("#confirm-del").hide(),$("#task-name-permission").text(t)):($trDelete=$("#task-tr-"+n),$liDelete=$("#task-"+n),$taskIdDelete=n,$taskNameDelete=t,$taskDesDelete=i,$("#permission-del").hide(),$("#confirm-del").show(),$("#task-name-confirm").text($taskNameDelete));$modal_task_remove.modal("toggle")}})}function deleteTask(){if(!($taskIdDelete<=0)){var n={Id:$taskIdDelete,Name:$taskNameDelete,Description:$taskDesDelete};$.ajax({type:"post",url:"/Tasks/DeleteTask",dataType:"json",data:n,success:function(n){n.status?($modal_task_remove.modal("hide"),cleanBookNotification.removeSuccess(),$($trDelete).css("background-color","#FF3700"),$($trDelete).fadeOut(1500,function(){$($trDelete).remove()}),$($liDelete).css("background-color","#FF3700"),$($liDelete).fadeOut(1500,function(){$($liDelete).remove()}),$taskIdDelete=0):cleanBookNotification.removeFail()}})}}function checkAmount(n,t){var i=$(n).is(":checked");t===0?$("#DateVariance").val(i?1:0):$("#amounVariance").val(i?1:0)}function ViewInstanceMatchingTask(n,t,i){i.className.indexOf("a-btn-disabled")!==0&&($(".modal-taskname").text(t),$table_instancetask.dataTable().fnDestroy(),$table_instancetask.find("tbody").find("tr").remove(),$.ajax({type:"post",url:"/TransactionMatching/GetTaskInstanceMatching",dataType:"json",data:{taskid:n,runTask:$("#right-run-task").val()},success:function(n){$table_instancetask.dataTable().fnDestroy();$table_instancetask.find("tbody").find("tr").remove();$table_instancetask.find("tbody").append(n.msg);var t=$table_instancetask.DataTable({responsive:!0,lengthChange:!0,pageLength:10,columnDefs:[{targets:3,orderable:!1}]});$("#modal-task-instances").modal("toggle")}}))}function LoadTasks(n){cleanBookNotification.clearmessage();$.ajax({url:"/Tasks/LoadTasks/",data:{groupId:$selectFilter.val(),orderBy:$selectOrder.val()},cache:!1,type:"POST",success:function(t){if(t.length!==0)if($(t.ModelString).insertAfter("#task-content").hide().fadeIn(1e3),n==="init")DisplayView("grid");else if(typeof Storage!="undefined"){var i=sessionStorage.getItem("showType");DisplayView(i)}else DisplayView("grid")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function DisplayView(n){SetShowAccountType(n);$(".task-view").hide();n==="grid"?($("#grid-view").addClass("active"),$("#grid_view").show()):($("#list-view").addClass("active"),$("#list_view").show())}function SetShowAccountType(n){typeof Storage!="undefined"?(sessionStorage.removeItem("showType"),sessionStorage.setItem("showType",n)):cleanBookNotification.warning("Your browser is too old. Please upgrade your browser!","Qbicles")}function swichPage(){var n=document.getElementById("menu-select").value;n==="Task"?window.location="/Apps/Tasks":n==="Account"?window.location="/Apps/Accounts":n==="Config"&&(window.location="/Apps/CleanBookConfig")}function ClearError(){$("label.error").hide();$(".error").removeClass("error");$(".valid").removeClass("valid");$("label.valid").hide();$(".valid").removeClass("valid")}var $topicsQbicle=[],$selectFilter=$("#filter-group"),$selectOrder=$("#filter-order"),$button_add_group=$("#button_add_group"),$button_add_account=$("button[name='button_add_account']"),$trDelete=null,$modal_group=$("#modal_group"),$modal_group_title=$("#modal_group [class='modal-title']"),$input_rectaskgroup_id=$("#input_rectaskgroup_id"),$input_rectaskgroup_name=$("#input_rectaskgroup_name"),$input_rectaskgroup_createddate=$("#input_rectaskgroup_createddate"),$input_rectaskgroup_createdbyid=$("#input_rectaskgroup_createdbyid"),arrtmp;$hdsucessMsg=$("#hdsucessMsg");$button_edit_group=$("button[name='button_edit_group']");$button_remove_group=$("button[name='button_remove_group']");$button_add_reconciliationtask=$("button[name='button_add_reconciliationtask']");$modal_task_remove=$("#modal-delete");$form_reconciliationtask=$("#form_reconciliationtask");$form_reconciliationtaskgroup=$("#form_reconciliationtaskgroup");$modal_reconciliationtask=$("#modal_reconciliationtask");$modal_group=$("#modal_group");$modal_group_title=$("#modal_group [class='modal-title']");$selectgroup=$("#SelectGroup");$select_task_type=$("#typeoftask");$hdReconciliationTaskId=$("#hdReconciliationTaskId");$hdTransactionMatching=$("#hdTransactionMatching");$hdTransactionAnlysis=$("#hdTransactionAnlysis");$hdControlReport=$("#hdControlReport");$hdBalanceAnalysis=$("#hdBalanceAnalysis");$hdTaskTypeIdOld=$("#hdTaskTypeIdOld");$hdCreatedById=$("#hdCreatedById");$hdCreatedDate=$("#hdCreatedDate");$TransactionMatchingTypeId=$("#TransactionMatchingTypeId");$firstaccount=$("#AccountId1");$secondaccount=$("#AccountId2");$TaskExecutionIntervalId=$("#TaskExecutionIntervalId");$taskname=$("#task_Name");$table_instancetask=$("#tblInstanceTask");$AssignedUserId=$("#AssignedUserId");$SelectPriority=$("#SelectPriority");$task_Deadline=$("#task-Deadline");$taskIdDelete=0;$taskNameDelete=0;$taskDesDelete=0;$liDelete=null;$TaskGroupDelId=null;arrtmp=[];$(document).ready(function(){LoadTasks("init");$selectFilter.change(function(){$("#task-page-display").empty();$("#task-page-display").html("<div id='task-content'><\/div>");LoadTasks("")});$selectOrder.change(function(){$("#task-page-display").empty();$("#task-page-display").html("<div id='task-content'><\/div>");LoadTasks("")});$button_add_group.bind("click",function(n){if(this.classList.contains("isDisabled")){n.preventDefault();return}AddGroup()});$(".btnPreviousTask").click(function(){$(".app_subnav > .active").prev("li").find("a").trigger("click")});$select_task_type.change(function(){$("#InitialTransactionDate").val("");$("#lblInitialTransactionDate").hide();$("#save-tab-div-1").hide();ClearError();$select_task_type.val()===$hdTransactionMatching.val()?($("#save-tab-1").text("Finish and Save"),$("#save-tab-div-1").show(),$("#step_2").hide(),$(".task-account").show(),$(".task-account .alert").html("Please select the two accounts to perform matching against, then which type of matching you wish to occur in this task"),$("#taskcount3").show(),$("#taskcount2").show(),$("#pnDateVariance").show(),$("#pnamounVariance").show(),$("#balance_analysis").hide(),$hdReconciliationTaskId.val()!=="0"&&$select_task_type.val()===$select_task_type.attr("data-type")?$TransactionMatchingTypeId[0].selectedIndex=0:($firstaccount[0].selectedIndex=-1,$secondaccount[0].selectedIndex=-1,$firstaccount.trigger("change"),$secondaccount.trigger("change"),$TransactionMatchingTypeId[0].selectedIndex=-1,$TransactionMatchingTypeId.trigger("change")),$("#lblInitialTransactionDate").show()):$select_task_type.val()===$hdTransactionAnlysis.val()?($("#save-tab-1").text("Next"),$("#step_2").show(),$("#save-tab-div-1").show(),$(".task-account").show(),$("#taskcount3").hide(),$("#taskcount2").hide(),$("#pnDateVariance").hide(),$("#pnamounVariance").hide(),$("#balance_analysis").hide(),$(".task-account .alert").html("Please select account to analyse"),$hdReconciliationTaskId.val()!=="0"&&$select_task_type.val()===$select_task_type.attr("data-type")||($firstaccount[0].selectedIndex=-1,$firstaccount.trigger("change")),$secondaccount[0].selectedIndex=-1,$secondaccount.trigger("change"),$TransactionMatchingTypeId[0].selectedIndex=-1,$("#lblInitialTransactionDate").show()):$select_task_type.val()===$hdControlReport.val()?($("#save-tab-1").text("Next"),$("#step_2").show(),$("#save-tab-div-1").show(),$(".task-account").hide(),$("#pnDateVariance").hide(),$("#pnamounVariance").hide(),$("#balance_analysis").hide(),$firstaccount[0].selectedIndex=-1,$firstaccount.trigger("change"),$secondaccount[0].selectedIndex=-1,$secondaccount.trigger("change"),$TransactionMatchingTypeId[0].selectedIndex=-1,$TransactionMatchingTypeId.trigger("change")):$select_task_type.val()===$hdBalanceAnalysis.val()&&($("#save-tab-1").text("Next"),$("#step_2").show(),$(".task-account").hide(),$("#taskcount3").hide(),$("#taskcount2").hide(),$("#pnDateVariance").hide(),$("#pnamounVariance").hide(),$("#balance_analysis").show(),$("#save-tab-div-1").show())});$firstaccount.change(function(){$firstaccount.val()!==""&&$firstaccount.val()!==null&&$secondaccount.val()!==""&&$secondaccount.val()!==null&&$firstaccount.val()===$secondaccount.val()&&$select_task_type.val()!==$hdControlReport.val()&&cleanBookNotification.error(_L("ERROR_MSG_474"),"Qbicles")});$secondaccount.change(function(){$secondaccount.val()!==""&&$secondaccount.val()!==null&&$firstaccount.val()!==""&&$firstaccount.val()!==null&&$firstaccount.val()===$secondaccount.val()&&$select_task_type.val()!==$hdControlReport.val()&&cleanBookNotification.error(_L("ERROR_MSG_474"),"Qbicles")})});var arrtmp2=[],arrEdit=[],Idarr=[],multiplebalanceanalysismappingrule=[],indexbalanceanalysis=0;var numberrow=0,arrNumberrow=[],taskId=0;$("#form_group").submit(function(n){n.preventDefault();$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:new FormData(this),processData:!1,contentType:!1,success:function(n){n.result?($modal_group.modal("toggle"),n.actionVal===1?($("#list_view").prepend(n.Object.toString()),$("#grid_view").prepend(n.msg),$selectFilter.append("<option value='"+n.msgId+"'>"+n.msgName+"<\/option>"),$selectgroup.prepend("<option value='"+n.msgId+"'>"+n.msgName+"<\/option>"),cleanBookNotification.success(_L("ERROR_MSG_485",[$input_rectaskgroup_name.val()]),"Qbicles")):n.actionVal===2&&($("#task-group-name-grid-"+$input_rectaskgroup_id.val()).text(n.msg),$("#task-group-name-list-"+$input_rectaskgroup_id.val()).text(n.msg),$('#SelectGroup [value="'+n.msgId+'"]').text(n.msgName),$('#filter-group [value="'+n.msgId+'"]').text(n.msgName),cleanBookNotification.success(_L("ERROR_MSG_486",[$input_rectaskgroup_name.val()]),"Qbicles"))):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})});