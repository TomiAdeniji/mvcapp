function ChangeCheckItem(n){$(n).is(":checked")?$(n).attr("att-checked",1):$(n).attr("att-checked",0)}function SaveEvent(){if(!isBusyAddEventForm){lstDate=[];$("#hdLastOccurrence").val($("input[name='recur-final-event']").val());var t="",n="",i=$("#hdEventRecurrenceType").val();if(i=="0"?(t="",$(".dailyEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):i=="1"?(t="",$(".weeklyEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):(t="",$(".monthEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})),$("#hdDayOrMonth").val(t),$("#hdEventDayOfWeek").val(n),$("#create-event-recurrence").find("input[name=isRecurs]").is(":checked")&&$("#lstEventDate tbody tr").find("input[type='checkbox']").each(function(){$(this).is(":checked")&&lstDate.push($(this).attr("att-date"))}),$("#create-event-recurrence").find("input[name=isRecurs]").is(":checked")&&lstDate.length<=0){cleanBookNotification.error(_L("ERROR_MSG_110"),"Event");return}if(uiEls.$form_event_addedit.valid())$.ajax({url:"/Events/DuplicateEventNameCheck",data:{cubeId:uiEls.$eventQbicleId.val(),eventKey:$eventKey,EventName:$("#eventName").val()},type:"GET",dataType:"json"}).done(function(n){if(n.result)uiEls.$form_event_addedit.validate().showErrors({Name:_L("ERROR_MSG_321")});else if($("#eventAttachments").val()){var t=checkfile($("#eventAttachments").val());t.stt?uiEls.$form_event_addedit.trigger("submit"):uiEls.$form_event_addedit.validate().showErrors({eventAttachment:t.err})}else ProcessEventMedia()}).fail(function(){uiEls.$form_event_addedit.validate().showErrors({Name:_L("ERROR_MSG_93")})});else if($("#create-event-overview .error").length)return $('#eventTabs a[href="#create-event-overview"]').tab("show"),!1}}function ProcessEventMedia(){$.LoadingOverlay("show");var n=document.getElementById("event-media-upload").files;n&&n.length>0?UploadMediaS3ClientSide("event-media-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#event-object-key").val(n.objectKey);$("#event-object-name").val(n.fileName);$("#event-object-size").val(n.fileSize);EventSubmit()}):EventSubmit()}function RecursCheck(n){$(n).is(":checked")?($(n).prop("checked",!0),$(n).val(!0),$("#recurrenceEvent").css({display:"block"})):($(n).prop("checked",!1),$(n).val(!1),$("#recurrenceEvent").css({display:"none"}))}function ResetEvent(){var n=$("#deadline").val();uiEls.$form_event_addedit.trigger("reset");$("#deadline").val(n);$("#create-event-overview select[name=EventType]").val($("select[name=EventType] option:first").val()).change();$("#create-event-people select[name=sendInvitesTo]").val("").change();$("#create-event-related select[name=ActivitiesRelate]").val("").change();$("#create-event-overview input[name=Name]").val("");$("#create-event-overview textarea[name=Description]").val("");$("#create-event-overview textarea[name=Location]").val("");$("#create-event-recurrence").find("input[name=isRecurs]").prop("checked",!1).change();$("#create-event-recurrence").find("input[name=isRecurs]").val(!1);$("#create-event-related .chkevtoggle").bootstrapToggle("off");ClearError()}function OnCheckType(n,t){var i=$("#hdEventRecurrenceType").val();i==0?$(n).is(":checked")?$(".dailyEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!1)}):$(".dailyEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!0)}):i==1?$(n).is(":checked")?$(".weeklyEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!1)}):$(".weeklyEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!0)}):$(n).is(":checked")?$(".monthEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!1)}):$(".monthEvent").each(function(){$(this).val()==t&&$(this).prop("checked",!0)})}function show_recurEvent(n){var t;if(n!=""){var i=$("input[name=event-recur-start]").val(),r=$("input[name=recur-final-event]"),u=".Event-recur-"+n;$("#event-recur").show();$(".event-recurtype").hide();$(u).show();t=$dateFormatByUser.toUpperCase();n=="daily"?($("#hdEventRecurrenceType").val(0),r.daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",maxDate:moment(i,$dateTimeFormatByUser).add(1,"months"),locale:{cancelLabel:"Clear",format:t}})):n=="weekly"?($("#hdEventRecurrenceType").val(1),r.daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",maxDate:moment(i,$dateTimeFormatByUser).add(6,"months"),locale:{cancelLabel:"Clear",format:t}})):n=="monthly"&&($("#hdEventRecurrenceType").val(2),r.daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",maxDate:moment(i,$dateTimeFormatByUser).add(24,"months"),locale:{cancelLabel:"Clear",format:t}}))}else $("#event-recur").hide();$(".exclusion-list-event").css({display:"none"});EventGenarateDateTable()}function NextTab_EventOverview(){uiEls.$form_event_addedit.valid()&&$("#eventTabs > .active").next("li").find("a").trigger("click")}function update_recurrenceEvent(){$("#event-restricted").hide();var n=$("#Eventduration").val(),t=$("#Eventmode :selected").text().trim().toLowerCase();$("#Eventdailyopt").removeAttr("disabled");$("#Eventweeklyopt").removeAttr("disabled");n>24&&t=="hours"&&($("#event-indicated-duration").html(n+" "+t),$("#event-indicated-duration").val(n+" "+t),$("#event-restricted").show(),$("#Eventdailyopt").attr("disabled",!0));n>1&&t=="days"&&($("#event-indicated-duration").html(n+" "+t),$("#event-indicated-duration").val(n+" "+t),$("#event-restricted").show(),$("#Eventdailyopt").attr("disabled",!0));n>7&&t=="days"&&($("#event-indicated-duration").html(n+" "+t),$("#event-indicated-duration").val(n+" "+t),$("#event-restricted").show(),$("#Eventdailyopt").attr("disabled",!0),$("#Eventweeklyopt").attr("disabled",!0));n>1&&t=="weeks"&&($("#event-indicated-duration").html(n+" "+t),$("#event-indicated-duration").val(n+" "+t),$("#event-restricted").show(),$("#Eventdailyopt").attr("disabled",!0),$("#Eventweeklyopt").attr("disabled",!0));$("input[name='event-recur-start']").val($("#deadline").val()).trigger("change");$("input[name='event-duration']").val(n+" "+t).trigger("change")}function GetListDateEvent(n,t,i,r,u,f){return $.ajax({url:"/Qbicles/GetListDate",type:"POST",dataType:"json",data:{dayofweek:n,type:t,Pattern:i,customDate:r,LastOccurenceDate:u,firstOccurenceDate:f}})}function EventGenarateDateTable(n){var i=$("#hdEventRecurrenceType").val(),r=$("#patternEvent :selected").val(),f=$("input[name='recur-final-event']").val(),e=$("input[name='event-recur-start']").val(),u="",t,o;r==""&&(r="0");t="";o=0;u=r=="2"?$("#month-dates-event :selected").val():"0";i=="0"?$(".dailyEvent").each(function(){$(this).is(":checked")&&(t==""?t=$(this).val():t+=","+$(this).val())}):i=="1"?$(".weeklyEvent").each(function(){$(this).is(":checked")&&(t==""?t=$(this).val():t+=","+$(this).val())}):$(".monthEvent").each(function(){$(this).is(":checked")&&(t==""?t=$(this).val():t+=","+$(this).val())});GetListDateEvent(t,i,r,u,f,e).done(function(t){var u,f,r;if(t!=""){for(u="",f="",$("#lstEventDate tbody tr").remove(),r=0;r<t.length;r++)u+="<tr>",u+="<td>"+t[r].Name+"<\/td>",u+='<td><input type="checkbox" '+(t[r].selected?"checked":"")+' value="'+t[r].Value+'" onclick="OnCheckType(this,\''+t[r].ShortName+'\')"  att-date="'+t[r].Date+'"  ><\/td>',u+=" <\/tr>",f+=t[r].ShortName+",";$("#lstEventDate tbody").append(u)}n||$(".exclusion-list-event").attr("style").indexOf("display: block;")>0?$(".exclusion-list-event").css({display:"block"}):$(".exclusion-list-event").css({display:"none"});i==2&&$(".monthEvent").each(function(){f!=null&&f.indexOf($(this).val())>-1?$(this).prop("checked",!0):$(this).prop("checked",!1)})})}function changePatternEvent(){$("#patternEvent :selected").val()=="2"?($("#customDateEvent").show(),$("#hdcustomDate").val($("#month-dates-event :selected").val())):$("#customDateEvent").hide();EventGenarateDateTable()}function AddRemoveAtvRelatedEv(n,t,i){$(i).prop("checked")?$('#create-event-related  select[name=ActivitiesRelate] option[value="'+n+'"]').length<=0&&$("#create-event-related  select[name=ActivitiesRelate]").append('<option selected value="'+n+'">'+t+"<\/option>").select2():($('#create-event-related  select[name=ActivitiesRelate] option[value="'+n+'"]').remove(),$("#create-event-related  select[name=ActivitiesRelate]").select2())}function CountCanEventDelete(n){$.getJSON("/Events/CountCanEventsDelete",{ceventId:n},function(t){var i=confirm(_L("ERROR_MSG_359",[t]));i&&($.LoadingOverlay("show"),$.ajax({method:"POST",url:"/Events/RecurringEventsDelete",data:{ceventId:n}}).done(function(n){LoadingOverlayEnd();n.result?($("#stop-recurring-event").prop("disabled",!0),cleanBookNotification.success(_L("ERROR_MSG_94"),"Qbicles")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}))})}var isBusyAddEventForm=!1,lstDate=[],uiEls={$form_event_addedit:$("#form_event_addedit"),$eventName:$("#eventName"),$createEvent:$("#create-event"),$singleEventDate:$(".single-event-date"),$eventQbicleId:$("#eventQbicleId")};EventSubmit=function(){var n=new FormData(uiEls.$form_event_addedit[0]);n.append("listDate",lstDate);isDisplayFlicker(!0);$.ajax({type:"post",cache:!1,url:"/Events/SaveEvent",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddEventForm=!0},success:function(n){var t,i;n.result?(uiEls.$createEvent.modal("toggle"),isBusyAddEventForm=!1,n.msg!=""&&(htmlActivityRender(n.msg,0),isDisplayFlicker(!1)),$("#eventKey").val()!=""?location.reload():(ResetEvent(),t=$(".calendar-view-dashboard").datepicker().data("datepicker"),t&&(i=t.currentDate,CalTabActive(i.getFullYear(),i.getMonth()+1)))):(isBusyAddEventForm=!1,cleanBookNotification.error(n.msg,"Qbicles"))},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");isDisplayFlicker(!1);isBusyAddEventForm=!1}}).always(function(){LoadingOverlayEnd()})};$(document).ready(function(){function n(n){if(!n.id)return n.text;var t=n.element.attributes.avatarUrl.value;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+t.toLowerCase()+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function t(n){if(!n.id)return n.text;var t=n.element.attributes.avatarUrl.value;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+t.toLowerCase()+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}$("#create-event-related  select[name=ActivitiesRelate]").on("select2:unselect",function(n){var t=n.params.data.id,i="input[value="+t+"]";$(i).bootstrapToggle("off")});setTimeout(function(){$("#rleventActivities").dataTable({destroy:!0,serverSide:!0,processing:!0,paging:!0,searching:!0,ajax:{url:"/Tasks/AtivitiesRelated",data:function(n){return $.extend({},n,{currentQbicleId:$("#eventQbicleId").val(),currentActivityKey:$("#eventKey").val()})}},columns:[{title:"Name",data:"Name",searchable:!0},{title:"Type",data:"Type",searchable:!0},null],columnDefs:[{targets:2,data:"Id",render:function(n,t,i){return'<input class="chkevtoggle" data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" onchange="AddRemoveAtvRelatedEv('+n+",'"+i.Name.replace("'","")+'\',this)"  type="checkbox" value="'+n+'">'}}]})},2e3);$("#rleventActivities").on("draw.dt",function(){$.each($(".chkevtoggle"),function(n,t){var i=$("#create-event-related select[name=ActivitiesRelate]").val(),r=$(t).val();i!=null&&i.indexOf(r)>=0?$(t).bootstrapToggle("on"):$(t).bootstrapToggle("off")})});$(".select2avatar-event").select2({placeholder:"Please select",templateResult:n,templateSelection:t});uiEls.$singleEventDate.daterangepicker({singleDatePicker:!0,timePicker:!0,autoApply:!0,showDropdowns:!0,autoUpdateInput:!0,cancelClass:"btn-danger",opens:"left",locale:{cancelLabel:"Clear",format:$dateTimeFormatByUser},minDate:moment()});$(".scroll-basket").slimScroll({height:"300px",railOpacity:1,railVisible:!0,alwaysVisible:!0,wheelStep:30,touchStep:30,color:"#989696",railColor:"#e1e1e1"});var i=setInterval(function(){document.readyState=="complete"&&($("input[name='event-recur-start']").val($("#deadline").val()),$("input[name='event-duration']").val($("#Eventduration").val()+" "+$("#Eventmode :selected").text().trim().toLowerCase()),clearInterval(i))},200);uiEls.$form_event_addedit.validate({ignore:"",rules:{Name:{required:!0,minlength:5},Location:{required:!0}}})});