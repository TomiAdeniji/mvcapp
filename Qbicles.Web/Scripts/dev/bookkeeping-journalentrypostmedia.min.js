function ShowTransactionComment(n){$.LoadingOverlay("show");$("#transaction-attachments").empty();var t="/BKJournalEntries/ShowTransactionComment?id="+n;$("#transaction-comments-view").load(t,function(){LoadingOverlayEnd();$tranComments.modal("toggle")})}function ShowTransactionAttachments(n){$.LoadingOverlay("show");$traderJournalDetailBkTransactionAttachments=[];$traderJournalDetailBkTransactionAttachmentExisted={AssociatedFiles:[]};$("#transaction-comments-view").empty();var t="/BKJournalEntries/ShowTransactionAttachments?id="+n;$("#transaction-attachments").load(t,function(){LoadingOverlayEnd();$tranAttachments.modal("toggle")})}function JournalEntryDetailAddAnother(n){var r=GenerateUUID(),i=$(".attachments_"+n+" input.inputfile"),t="<div id='manage-id-"+r+'\' class="row attachment_row"> <div class="col-xs-12">';t+='<div class="form-group"> <label for="name">Name<\/label> <input type="text" name="name" class="form-control inputfilename'+(i.length+1)+'">';t+='<\/div> <\/div> <div class="col-xs-12"> <div class="form-group"> <label for="file">File<\/label>';t+='<input type="file" name="file" onchange="JournalEntryDetailChangeFile(this,'+(i.length+1)+","+n+')" class="form-control inputfile">  <\/div>  <\/div> <\/div>';$(".attachments_"+n+" div.repeater_wrap").append(t)}function JournalEntryDetailChangeFile(n,t,i){var r=$(".attachments_"+i+" input.inputfilename"+t).val(),u,f;for($(n).length>0&&$(n)[0].files.length>0&&r.lenght==0&&(r=$(n)[0].files[0].name),u=$(".attachments_"+i+" input.inputfile"),f=0;f<u.length;f++)u[0]!==n&&$(u[0]).val()==$(n).val()&&($(n).val(""),cleanBookNotification.error(_L("ERROR_MSG_351",[r]),"Qbicles"),r="");$(".attachments_"+i+" .inputfilename"+t).val(r)}function JournalEntryDetailConfirmAddViewer(n,t=false){var r,i,u,e,f;for($traderJournalDetailBkTransactionAttachmentExisted={AssociatedFiles:[]},$traderJournalDetailBkTransactionAttachments=[],r=$(".attachments_"+n+" input.inputfile"),i=0;i<r.length;i++)$(".attachments_"+n+" .inputfilename"+(i+1)).val()==""&&r[i].files.length>0&&$(".attachments_"+n+" .inputfilename"+(i+1)).val(r[i].files[0].name.substr(0,r[i].files[0].name.lastIndexOf("."))),r[i].files.length>0?(u=r[i].files[0],fileExtension=u.name.split(".").pop(),e=_.find($qbiclesFileTypes,function(n){return n.Extension===fileExtension}),f={Id:GenerateUUID(),Name:u.name,Extension:u.name.split(".").pop(),Size:u.size,IconPath:e.IconPath,File:u},$("div.attachments_"+n+" .inputfilename"+(i+1)).val()!==""&&(f.Name=$("div.attachments_"+n+" .inputfilename"+(i+1)).val()+"."+fileExtension),$traderJournalDetailBkTransactionAttachments.push(f)):$("#fileid-"+n+"-"+(i+1)).length>0&&$traderJournalDetailBkTransactionAttachmentExisted.AssociatedFiles.push({Id:parseInt($("#fileid-"+n+"-"+(i+1)).val()),Name:$(".inputfilename"+(i+1)).val(),IconPath:$("#inputiconpath_edit"+(i+1)).val()});t&&JournalEntryDetailLoadAttachmentListViewer()}function JournalEntryDetailLoadAttachmentListViewer(){$("#transaction-attachments ul.domain-change-list").empty();_.forEach($traderJournalDetailBkTransactionAttachmentExisted.AssociatedFiles,function(n){var t=" <li> <a href='javascript:void(0)'>";t+='<img src="'+n.IconPath+'" style="max-width: 80px; height: auto; padding-right: 10px;">';t+=n.Name+" <\/a> <\/li>";$("#transaction-attachments ul.domain-change-list").append(t)});_.forEach($traderJournalDetailBkTransactionAttachments,function(n){var t=" <li> <a href='javascript:void(0)'>";t+='<img src="'+n.IconPath+'" style="max-width: 80px; height: auto; padding-right: 10px;">';t+=n.Name+" <\/a> <\/li>";$("#transaction-attachments ul.domain-change-list").append(t)})}function ProcessBKTransactionMedia(n){$.LoadingOverlay("show");JournalEntryDetailConfirmAddViewer(n,!1);$traderJournalDetailBkTransactionAttachments.length>0?UploadBatchMediasS3ClientSide($traderJournalDetailBkTransactionAttachments).then(function(){SubmitBKTransactionMedia(n)}):SubmitBKTransactionMedia(n)}function SubmitBKTransactionMedia(n){if($traderJournalDetailBkTransactionAttachmentExisted.length===0&&$traderJournalDetailBkTransactionAttachments.length===0){LoadingOverlayEnd();return}var t=[];_.forEach($traderJournalDetailBkTransactionAttachments,function(n){n.File={};t.push(n)});$.ajax({type:"post",url:"/BKJournalEntries/SaveBKTransactionMedia?id="+n,data:{bKTransactionAssociatedFiles:$traderJournalDetailBkTransactionAttachmentExisted,bkTransactionAttachments:t},dataType:"json",success:function(t){$tranAttachments.modal("toggle");t.result?(cleanBookNotification.updateSuccess(),$("#attachment-"+n).text($traderJournalDetailBkTransactionAttachmentExisted.AssociatedFiles.length+$traderJournalDetailBkTransactionAttachments.length)):cleanBookNotification.error(t.msg,"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_56"),"Qbicles")}}).always(function(){LoadingOverlayEnd()})}function ShowBkTransactionDetail(n){var t="/Bookkeeping/ShowBkTransactionDetail?id="+n;AjaxElementShowModal(t,"je-more")}var $qbiclesFileTypes=[],$traderJournalDetailBkTransactionAttachments=[],$traderJournalDetailBkTransactionAttachmentExisted={AssociatedFiles:[]},$tranComments,$tranAttachments;$(document).ready(function(){$qbiclesFileTypes=[];$.ajax({type:"post",url:"/FileTypes/GetFileTypes",dataType:"json",success:function(n){$qbiclesFileTypes=n},error:function(){}}).always(function(){LoadingOverlayEnd()})});$tranComments=$("#comments-view");$tranAttachments=$("#attachments-view");