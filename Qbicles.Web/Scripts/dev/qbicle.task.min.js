function StartProgress(n){$.ajax({url:"/Tasks/StartProgress",data:{taskKey:$("#taskKey").val()},type:"Post",dataType:"json","async":!1}).done(function(t){t.result?(t.Object&&t.Object.Complete?(cleanBookNotification.success(_L("ERROR_MSG_363"),"Task"),$("#inprogress").hide(),$("#notstarted").hide(),$("#complete").show(),$("#btn-task-edit").remove(),$("#countdown_task").text(t.Object.Countdown),$(".performance-popup,.performance").show()):(cleanBookNotification.success(_L("ERROR_MSG_114"),"Task"),$("#inprogress").show(),$("#notstarted").hide()),$(".completion").show(),$(n).hide(),$(".task-breakdown input[type=checkbox]").prop("disabled",!1),$("#disabledchecks").hide()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")}).fail(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")})}function ConfirmChanges(n){$(n).hide();var t=[];$.each($("input[name='StepInstance']:checked"),function(){t.push($(this).val())});$.ajax({url:"/Tasks/StepComplete",data:{taskKey:$("#taskKey").val(),stepInstance:t},type:"Post",dataType:"json","async":!1}).done(function(n){var t,r,i;n.result?(cleanBookNotification.success(_L("ERROR_MSG_115"),"Task"),n.Object.length>0&&(t=0,$.each(n.Object,function(n,i){if(i.Complete){var r=$("#StepInstance_"+i.StepId),u=r.parent();r.remove();u.addClass("completed-info");u.prepend('<i style="width: 25px;" class="fa fa-check-circle green"><\/i>');t+=i.Percent}}),t=t>100?100:t,t==100||n.Object2&&n.Object2.Complete===!0?($("#inprogress").hide(),$("#notstarted").hide(),$("#complete").show(),r=n.Object2.ActualEnd,$("#task-deadline").text(r),$(".performance-popup").show(),$("#btn-task-edit").remove()):$(".performance-popup").hide(),i=$(".progress-bar"),i.css("width",t+"%"),i.attr("aria-valuenow",t),$(".percent-task").text(t+"%"))):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")}).fail(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")})}function PerformanceReview(){var n=$("select[name=stars]").val();if(!n){cleanBookNotification.error(_L("ERROR_MSG_364"),"Task");return}$.ajax({url:"/Tasks/PerformanceReview",data:{taskKey:$("#taskKey").val(),rating:$("select[name=stars]").val()},type:"Post",dataType:"json","async":!1}).done(function(n){var i,t;if(n.result){if($("#performance-review").modal("toggle"),cleanBookNotification.success(_L("ERROR_MSG_116"),"Task"),n.Object){if(i=n.Object.rating,i){for(t=1;t<6;t++)t<=i?$(".star-"+t).css("color","#fc8b02"):$(".star-"+t).css("color","#f1f1f1");$(".performance small").text(i+" out of 5")}$(".performance").show();$(".performance-popup").hide();$("#inprogress").hide();$("#notstarted").hide();$("#complete").show()}}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")}).fail(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")})}$(document).ready(function(){$(".task-breakdown input[type=checkbox]").bind("click",function(){$(".task-breakdown input:checkbox:checked").length>0?$(".confirm").show():$(".confirm").hide()});$("button.btn-addworklog").click(function(){var n={ActivityKey:$("#taskKey").val(),Days:$("input[name='est-days']").val(),Hours:$("input[name='est-hours']").val(),Minutes:$("input[name='est-mins']").val()};if(n.Days==0&&n.Hours==0&&n.Minutes==0){cleanBookNotification.error(_L("ERROR_MSG_118"),"Task");return}$.ajax({url:"/Tasks/AddWorkLog",data:n,type:"Post",dataType:"json","async":!1}).done(function(n){var t,i,r;n.result?(cleanBookNotification.success(_L("ERROR_MSG_119"),"Task"),$("#inprogress").show(),$("#notstarted").hide(),t=n.Object,t&&(i=t.Days?t.Days+"d ":"",i+=t.Hours?t.Hours+"h ":"",i+=t.Minutes?t.Minutes+"m":"",r="<tr><td>{date}<\/td><td>{myhours}<\/td><\/tr>",$("#task-time table tbody tr.row-nodata").remove(),$("#task-time table tbody").append(r.replace("{date}",n.Object.DateTime).replace("{myhours}",i)))):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")}).fail(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task")})})});