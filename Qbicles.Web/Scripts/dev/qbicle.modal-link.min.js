$(function(){function f(){isDisplayFlicker(!0);var i=new FormData(document.getElementById("frm-link"));$.ajax({type:"post",url:"/Links/SaveLink",data:i,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){t=!0},success:function(i){t=!1;i.result?(n.$modallink.modal("hide"),i.msg!=""&&(htmlActivityRender(i.msg,0),isDisplayFlicker(!1)),$("#hdlinkKey").val()!=""?(cleanBookNotification.success(_L("ERROR_MSG_99"),"Qbicles"),location.reload()):(n.$frmlink.trigger("reset"),n.$frmlink.validate().resetForm(),$(".preview-link").hide(),cleanBookNotification.success(_L("ERROR_MSG_100"),"Qbicles"))):i.result===!1&&i.Object?uiEls.$form_topic_addedit.validate().showErrors(i.Object):i.result===!1&&i.msg?cleanBookNotification.error(i.msg,"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){t=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");isDisplayFlicker(!1)}}).always(function(){LoadingOverlayEnd()})}var t=!1,r=1,u=1,i=!1,n={$frmlink:$("#frm-link"),$modallink:$("#create-link"),$previewlinkimg:$(".preview-link-img")};lkFunc={validateAddComment:function(){var n=$("#txt-comment-link").val();n.length>1500?$("#addcomment-error").show():$("#addcomment-error").hide()},AddCommentToLink:function(n){if(!i){var t=$("#txt-comment-link");t.val()&&!$("#addcomment-error").is(":visible")&&(isPlaceholder(!0,"#list-comments-link"),i=!0,$.ajax({url:"/QbicleComments/AddCommentToLink",data:{message:t.val(),linkKey:n},type:"POST",success:function(n){n.result&&(t.val(""),n.msg!=""&&($("#list-comments-link").prepend(n.msg),isDisplayFlicker(!1)));i=!1},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Task");isPlaceholder(!1,"");i=!1}}))}},LoadMorePosts:function(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityPosts",data:{activityKey:n,size:r*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadPosts").remove();return}$("#"+i).append(n).hide().fadeIn(250);r=r+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})},LoadMoreMedias:function(n,t,i){$.ajax({url:"/Qbicles/LoadMoreActivityMedias",data:{activityId:n,size:u*t},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadMedias").remove();return}$("#"+i).append(n).hide().fadeIn(250);u=u+1},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}};$(document).ready(function(){function i(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}n.$frmlink.validate({rules:{Name:{required:!0,minlength:5},fileFeaturedImage:{filesize:!0},URL:{required:!0,url:!0}}});n.$previewlinkimg.change(function(){var n=$(this).data("target");i(this,n);$(n).fadeIn()});n.$frmlink.submit(function(i){if((i.preventDefault(),!t)&&n.$frmlink.valid()){$.LoadingOverlay("show");var r=document.getElementById("link-upload-file").files;r&&r.length>0?UploadMediaS3ClientSide("link-upload-file").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#media-object-key").val(n.objectKey);$("#media-object-name").val(n.fileName);$("#media-object-size").val(n.fileSize);f()}):f()}})})});