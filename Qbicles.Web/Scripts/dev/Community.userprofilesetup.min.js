function saveAndFinish(){var s,t,u,h,f,e,c,n,i,l,r,a,o,v;if(updateCoverImage(!0),updateAvatar(!0),updateProfileText(!0),saveProfileFiles(!0),s=[],t=$("#skill-list div.community-competencies"),t.length>0)for(n=0;n<t.length;n++){if(u=$(t[n]).find("input.skill_tags").val().split(","),h=[],u.length>0)for(f=0;f<u.length;f++)h.push({Id:u[f]});s.push({Id:$(t[n]).find("input.skill_id").val(),Name:$(t[n]).find("p.skill_name").text(),Tags:h,Level:$(t[n]).find("span.skill_level").text(),Description:$(t[n]).find("p.skill_description").text()})}if(e=$("#userProfile_tags").val(),c=[],e.length>0)for(n=0;n<e.length;n++)c.push({Id:e[n]});if(i=$("#listEmployer div.portlet"),l=[],i.length>0)for(r=0;r<i.length;r++)$(i[r]).find("input.employer_dates").val()!=null&&(a=$(i[r]).find("input.employer_dates").val().split("-"),o={Id:$(i[r]).find("input.employer_id").val(),Employer:$(i[r]).find("div.employer_name").text().trim(),Role:$(i[r]).find("p.employer_role").text()},o.StartDate=a[0].trim(),o.EndDate=a[1].trim(),l.push(o));v={StrapLine:$("#profile_strapline").val(),Skills:s,Tags:c};$.ajax({type:"post",url:"/UserProfile/SaveAndFinish",data:{userProfile:v,employments:l},dataType:"json",success:function(n){n.actionVal==1?(cleanBookNotification.updateSuccess(),location.href="/Community/UserProfilePage?id="+n.msgId):(n.actionVal==3||n.actionVal==2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function updateCoverImage(n){var i=new FormData,t=$("#image_featured");i.append("Cover-profile",t[0].files[0]);t.length>0&&t[0].files.length>0&&$.ajax({type:"post",url:"/UserProfile/CommunityChangeFeatureUserImage",data:i,contentType:!1,processData:!1,dataType:"json",success:function(t){n||(t.actionVal==1?cleanBookNotification.updateSuccess():(t.actionVal==3||t.actionVal==2)&&cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function changeImageCover(n){if(ValidateFileImage(n)){var t=$("#image_featured");reader.onload=function(n){$("div.community-profile-upper").attr("style","background-image: url('"+n.target.result+"');")};reader.readAsDataURL(t[0].files[0])}}function changeImageAvatar(n){if(ValidateFileImage(n)){var t=$("#upload_image_avatar");reader.onload=function(n){$("div.community-side div.community-avatar").attr("style","background-image: url('"+n.target.result+"');")};reader.readAsDataURL(t[0].files[0])}}function previewUserProfile(){var t=$("#userProfile_tags option:selected"),n,i;if($("#profile_preview_tags").empty(),t.length>0)for(n=0;n<t.length;n++)i='<a class="topic-label"> <span class="label label-info">'+$(t[n]).text()+"<\/span> <\/a>",$("#profile_preview_tags").append(i);$("#preview_trapline").text($("#profile_strapline").val());$(".previewUserProfile").removeClass("hidden");$(".editProfile").addClass("hidden")}function returnEdit(){$(".editProfile").removeClass("hidden");$(".previewUserProfile").addClass("hidden")}function changeProfileDescription(){$(".profile_description").text($("#txtprofile_description").val())}function updateAvatar(n){var i=new FormData,t=$("#upload_image_avatar");i.append("avatar-profile",t[0].files[0]);t.length>0&&t[0].files.length>0&&$.ajax({type:"post",url:"/UserProfile/CommunityChangeUserAvatar",data:i,contentType:!1,processData:!1,dataType:"json",success:function(t){n||(t.actionVal==1?cleanBookNotification.updateSuccess():(t.actionVal==3||t.actionVal==2)&&cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function updateProfileText(n){$("#txtprofile_description").val().length>0&&$.ajax({type:"post",url:"/UserProfile/UpdateProfileText?profileText="+$("#txtprofile_description").val(),contentType:!1,processData:!1,dataType:"json",success:function(t){n||(t.actionVal==1?cleanBookNotification.updateSuccess():t.actionVal==2&&cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function addSkill(){var f=[],i=UniqueId(),t=$("#skill-list div.community-competencies").length+1,r,u,n;if($("#input_skill_tags").val()&&$("#input_skill_tags").val().length>0)for(r=0;r<$("#input_skill_tags").val().length;r++)f.push({Id:$("#input_skill_tags").val()[r]});u={Name:$("#input_skill_name").val(),Level:$("#input_skill_level").val(),Tags:f,Description:$("#input_skill_description").val()};n='<div class="panel-group community-competencies skill-class-'+i+' newskill" role="tablist" aria-multiselectable="true" style="margin-bottom: 15px;">';n+='<input type="hidden" class="skill_id" value=""/> <input type="hidden" class="skill_tags" value="" />';n+='<div class="panel panel-default"> <div class="panel-heading" role="tab" id="heading-'+t+'">';n+='<h4 class="panel-title">';n+='<a role="button"class="button_skill" data-toggle="collapse" data-parent="#accordion-competencies" href="#collapse-'+t+'" aria-expanded="false" aria-controls="collapse-'+t+'">';n+='<i class="more-less fa fa-plus"><\/i> <p class="skill_name">'+u.Name+'<\/p><br /> <span class="skill_level">'+u.Level+"<\/span> ";n+='<\/a> <\/h4> <\/div> <div id="collapse-'+t+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-'+t+'">';n+='<div class="panel-body" style="padding: 20px;"> <p class="skill_description"> '+u.Description+" <\/p>  <br />";n+='<a href="#" class="btn btn-warning editProfile" onclick="editSkill(\'skill-class-'+i+'\')" data-toggle="modal" data-target="#app-community-edit-skill"><i class="fa fa-pencil"><\/i><\/a>  ';n+='<a href="#" class="btn btn-danger editProfile" onclick="deleteSkill(\'skill-class-'+i+'\')"><i class="fa fa-trash"><\/i><\/a>';n+="<\/div> <\/div> <\/div>  <\/div>";$("#skill-list").append(n);$("#skill-list div.skill-class-"+i+" input.skill_tags").val($("#input_skill_tags").val().join(","));$("#input_skill_tags").val([]);$("#input_skill_name").val("");$("#input_skill_level").val("");$("#input_skill_description").val("");$("select").not(".multi-select").select2()}function editSkill(n){divSkillClass=n;var t=$("."+n+" input.skill_tags").val().split(","),i=$("."+n+" p.skill_name").text(),r=$("."+n+" span.skill_level").text(),u=$("."+n+" p.skill_description").text();$("#modal_skill_name").val(i);$("#modal_skill_level").val(r);$("#modal_skill_tags").val(t);$("select").not(".multi-select").select2();$("#modal_skill_description").val(u.trim())}function deleteSkill(n){$("."+n).remove()}function updateSkill(){$("."+divSkillClass+" input.skill_tags").val($("#modal_skill_tags").val().join(","));$("."+divSkillClass+" p.skill_name").text($("#modal_skill_name").val());$("."+divSkillClass+" span.skill_level").text($("#modal_skill_level").val());$("."+divSkillClass+" p.skill_description").text($("#modal_skill_description").val());$("."+divSkillClass+".newskill").length==0&&$("."+divSkillClass).addClass("skill_update");divSkillClass=null;$("#modal_skill_name").val("");$("#modal_skill_level").val("");$("#modal_skill_tags").val([]);$("select").not(".multi-select").select2();$("#modal_skill_description").val("");$("#app-community-edit-skill").modal("toggle")}function cancelEditSkill(){$("#modal_skill_name").val("");$("#modal_skill_level").val("");$("#modal_skill_tags").val([]);$("select").not(".multi-select").select2();$("#modal_skill_description").val("")}function addEmployment(){var i=UniqueId(),t={Name:$("#form_employ_name").val(),Role:$("#form_employ_role").val(),Dates:$("#form_employ_dates").val()},n;if(t.Name==""||t.Role==""||t.Dates=="")return!1;n='<div class="portlet portlet_'+i+'"> <input type="hidden" class="employer_id" value="0"/>';n+='<input type="hidden" class="employer_dates" value="'+t.Dates+'"/>';n+='<div class="portlet-header employer_name">'+t.Name+' <\/div> <div class="portlet-content">';n+='<div class="row"> <div class="col-xs-6 associated-mini"> <p class="employer_role" style="position: relative; top: 7px;">'+t.Role+"<\/p>";n+='<\/div> <div class="col-xs-6 text-right"> <div class="btn-group options">';n+='<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';n+='<i class="fa fa-cog"><\/i> <\/button> <ul class="dropdown-menu dropdown-menu-right">';n+='<li><a href="#" data-toggle="modal" onclick="editEmployer(\'portlet_'+i+'\')" data-target="#app-community-edit-work-history">Edit<\/a><\/li>';n+='<li><a href="#" onclick="deleteEmployer(\'portlet_'+i+"')\">Delete<\/a><\/li>  <\/ul> <\/div> <\/div> <\/div> <\/div> <\/div>";$("#listEmployer").append(n);$("#form_employ_name").val("");$("#form_employ_role").val("");$("#form_employ_dates").val("")}function editEmployer(n){employGuidID=n;var t=$("."+n+" div.employer_name").text().trim(),i=$("."+n+" p.employer_role").text(),r=$("."+n+" input.employer_dates").val();$("#employer_name").val(t);$("#employer_role").val(i);$("#employer_dates").val(r)}function deleteEmployer(n){$("."+n).remove()}function employerConfirmChange(){$("."+employGuidID+" div.employer_name").text($("#employer_name").val());$("."+employGuidID+" p.employer_role").text($("#employer_role").val());$("."+employGuidID+" input.employer_dates").val($("#employer_dates").val());employGuidID=null;$("#employer_name").val("");$("#employer_role").val("");$("#employer_dates").val("");$("#app-community-edit-work-history").modal("toggle")}function cancelChangeEmployer(){$("#employer_role").val("");$("#employer_name").val("");$("#employer_dates").val("")}function LoadFile(n){var r=UniqueId(),i='<li class="newFile '+r+' "> <span class="btn btn-danger delete_item" onclick="myFileDelete(this.parentElement, \''+n.Name.replace(/\./g,"_")+'\')"><i class="fa fa-trash"><\/i><\/span>',t,n;i+='<a> <img src="..'+n.Type.IconPath+'" style="max-width: 80px; height: auto; padding-right: 10px;"> '+n.Name+" <\/a>";i+='<input type="file" name="file" class="form-control myfile hidden"><input type="text" value="'+n.Name+'" class="form-control hidden"><\/li>';$("#ulMyfile").append(i);t='<article class="activity media '+n.Name.replace(/\./g,"_")+'" style="margin-bottom: 0;">';t+='<div class="activity-detail" style="padding-left: 0; max-width: 100%;"> <div class="activity-overview media">';t+='<div class="row"> <div class="col-xs-12 col-sm-5 col-md-6 col-lg-5"> <a href="#">';t+='<img src="..'+n.Type.IconPath+'" class="img-responsive"> <\/a> <\/div> <div class="col-xs-12 col-sm-7 col-md-6 col-lg-7 description">';t+="<h5>"+n.Name+'<\/h5> <p><\/p> <small> <\/small> <\/div> <\/div> <\/div> <\/div> <div class="clearfix"><\/div> <\/article>';$("#listMyFile").append(t);n=$("#myfile_input_file").clone(!0);$("#ulMyfile li."+r+" input.myfile")[0].files=n[0].files;$("#input_file_name").val("");$("#myfile_input_file").val("")}function addFile(){var i=new FormData,n=$("#input_file_name").val(),t=$("#myfile_input_file");t.length>0&&t[0].files.length>0?(n.length==0&&(n=t[0].files[0].name,$("#input_file_name").val(n)),i.append(n,t[0].files[0]),LoadingOverlay(),$.ajax({type:"post",url:"/UserProfile/CheckProfileFiles",data:i,contentType:!1,processData:!1,dataType:"json",success:function(n){setTimeout(function(){$.LoadingOverlay("hide")},2e3);n.actionVal==1?n.Object!=null&&n.Object.length>0&&LoadFile(n.Object[0]):(n.actionVal==3||n.actionVal===2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){setTimeout(function(){$.LoadingOverlay("hide")},2e3);cleanBookNotification.error(n.responseText,"Qbicles")}})):cleanBookNotification.warning("Please selected a file.","Qbicles")}function myFileDelete(n,t){$("."+t+" input.file_profile").length>0?($("."+t+" input.file_profile").addClass("fileDelete"),$("."+t).addClass("hidden")):$("."+t).remove()}function saveProfileFiles(n){var r=$("#ulMyfile input.fileDelete"),u,i,f,t;if(r.length>0){for(u=[],t=0;t<r.length;t++)u.push(parseInt($(r[t]).val()));$.ajax({type:"post",url:"/UserProfile/DeleteFiles",data:{lstId:u},dataType:"json",success:function(t){if(t.actionVal===1)for(var i=0;i<r.length;i++)$(r[0].parentElement).remove();n||(t.actionVal===1?cleanBookNotification.updateSuccess():(t.actionVal===3||t.actionVal===2)&&cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}if(i=$("#ulMyfile li.newFile"),f=new FormData,i.length>0){for(t=0;t<i.length;t++)$(i[t]).find("input.myfile")[0].files.length>0&&f.append($($(i[t]).find("input")[1]).val(),$(i[t]).find("input.myfile")[0].files[0]);$.ajax({type:"post",url:"/UserProfile/CommunityUserAddNewFiles",data:f,contentType:!1,processData:!1,dataType:"json",success:function(n){n.actionVal==1?cleanBookNotification.updateSuccess():(n.actionVal==3||n.actionVal===2)&&cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}}function DownLoadUserProfileFile(n,t,i){var r=t+"."+i,u={Uri:n,Name:r};$.ajax({type:"post",url:"/Medias/DownloadFile",datatype:"json",data:u,success:function(n){var i=document.createElement("a");i.download=t;i.href=n;document.body.appendChild(i);i.click();document.body.removeChild(i);delete i},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}})}function ShowAddUserToSlGroupCandidateView(){LoadingOverlay();var n="/Network/ShowAddCandidateView?candidateId="+$("#candidate-id").val();$("#shortlist-candidate").empty();$("#shortlist-candidate").load(n);$("#shortlist-candidate").modal("show");LoadingOverlayEnd()}function showChangeSlGroupView(n){LoadingOverlay();var t=$("#active-group-id").val(),i="/Network/ShowAddCandidateView?candidateId="+n+"&slGroupId="+t;$("#shortlist-candidate").empty();$("#shortlist-candidate").load(i);$("#shortlist-candidate").modal("show");LoadingOverlayEnd()}function loadUserShortlistGroupByDomain(n){var t=$("#add-candidate-form select[name=shortlistGroup]");$(n).val!="0"?$("#slgroups-container").fadeIn():$("#slgroups-container").fadeOut();$.get("/Network/GetUserSlGroupByDomain?domainId="+$(n).val(),function(n){t.select2("destroy");t.empty();$.each(n,function(n,i){t.append('<option value="'+i.id+'">'+i.text+"<\/option>")});var i=$("#active-group-id").val();$("option[value="+i+"]").attr("selected","true");t.select2()})}function initAddCandidateForm(){var n=$("#add-candidate-form");n.validate({rules:{domain:{required:!0},shortlistGroup:{required:!0}}});n.submit(function(t){if(t.preventDefault(),n.valid())$.ajax({method:"POST",dataType:"JSON",url:"/Network/AddSlGroupCandidate",data:{userId:$("#candidate-id").val(),slGroupId:$("#slgroups").val()},success:function(n){if(n.result){cleanBookNotification.success("Add User to Shortlist Group successfully.","Qbicles");$("#shortlist-candidate").modal("hide");$("#shortlist").fadeOut();$("#shortlisted").fadeIn();var t=$("#candidate-list");t!=null&&t.DataTable().ajax.reload()}else cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}})})}function connectC2CProfilePage(n,t){$.LoadingOverlay("show");$.post("/C2C/ConnectC2C",{linkId:n,type:2},function(n){$.LoadingOverlay("hide");n.result?(cleanBookNotification.success("Connection request sent. "+t+" will need to approve your request, and will appear as a pending contact in your Community hub until then."),$("#pending").show(),$("#connect").hide()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function connectC2CPublicProfilePage(n,t,i){$.LoadingOverlay("show");$.post("/C2C/ConnectC2C",{linkId:n,type:2},function(n){if($.LoadingOverlay("hide"),n.result)if(i)window.location="/C2C";else{cleanBookNotification.success("Connection request sent. You can track the status in your Community hub.");var t=$("#candidate-list");t!=null&&t.DataTable().ajax.reload()}else!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function initSharedQbicleShow(){var n=$("#qbicles-container"),t=$("#pagiation-qbicles");t.pagination({dataSource:"/UserInformation/GetSharedQbicles",locator:"items",totalNumberLocator:function(n){return n.totalNumber},pageSize:20,ajax:{data:{userId:$("#candidate-id").val()},beforeSend:function(){n.LoadingOverlay("show")}},callback:function(t){var r=t.length,i="";$.each(t,function(n,t){i+=sharedQbicleTemplate(t)});n.html(i);n.LoadingOverlay("hide")}})}function sharedQbicleTemplate(n){var i=n.LogoUri+"&size=T",r=n.QbicleName,u=n.DomainName,f=n.DomainOwner,t="<li>";return t+='<a href="javascript:void(0)" onclick="QbicleSelected(\''+n.QbicleKey+"', 'Dashboard')\">",t+='<div class="owner-avatar">',t+='<div class="avatar-sm" style="background: url(\''+i+"');\"><\/div>",t+="<\/div>",t+="<h5>"+r+"<br><small>"+u+" "+f+"<\/small><\/h5>",t+"<\/a><\/li>"}var reader=new FileReader,divSkillClass=null,employGuidID=null;