function initPlugin(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0,onChange:function(n,t){t===!0?(updateTemporaryselectedProduct(),updateTemporaryselectedStore()):t===!1&&(updateTemporaryselectedProduct(),updateTemporaryselectedStore())}});var n=$dateFormatByUser.toUpperCase(),t=moment($("#txtFilterDaterange").data("maxdate"),n).toDate();$(".daterange").daterangepicker({autoUpdateInput:!1,cancelClass:"btn-danger",opens:"right",maxDate:t,locale:{cancelLabel:"Clear",format:n}});$(".daterange").on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format($dateFormatByUser.toUpperCase())+" - "+t.endDate.format($dateFormatByUser.toUpperCase()))});$(".daterange").on("cancel.daterangepicker",function(){$(this).val(null)})}function initSearch(){$("#txtFilterPeopleKeyword").keyup(delay(function(){initFindPeoble()},500));$("#slFilterType").change(function(){initFindPeoble()});$("#slFilterPeopleType").change(function(){initFindPeoble()});$("#filters-contacts input[name=search]").keyup(delay(function(){_c2cQbiceId="0";isC2CAllContactShown=!1;c2cContactTabPage=0;loadC2CQbicleContent(!0,!1,!0)},500));$("#filters-contacts select[name=orderBy]").change(function(){isC2CAllContactShown=!1;c2cContactTabPage=0;loadC2CQbicleContent(!0,!1,!0)});$("#filters-contacts select[name=contactType]").change(function(){_c2cQbiceId="0";isC2CAllContactShown=!1;c2cContactTabPage=0;loadC2CQbicleContent(!0,!1,!0)});$("#connection-shown-type li").click(function(){$(this).hasClass("active")||(_c2cQbiceId="0",$("#connection-shown-type li").removeClass("active"),$(this).addClass("active"),$(".widget-contacts li").remove(),loadC2CQbicleContent(!0))});$(".filter-stores input[name=search]").keyup(delay(function(){initFindBusinessStores()},500));$(".filter-stores select[name=locations]").change(function(){initFindBusinessStores()});$("#psearching").keyup(delay(function(){initFindProducts()},500));$("#pcountry-selector").on("change",function(){initFindProducts()});$('#products select[name="loc"]').change(function(){initFindProducts()})}function initFindPeoble(){var n=$("#data-container-people"),t=$("#pagiation-people");t.pagination({dataSource:"/C2C/FindPeople",locator:"items",totalNumberLocator:function(t){return n.LoadingOverlay("hide"),t.totalNumber},pageSize:8,ajax:{data:{PeopleType:$("#slFilterPeopleType").val(),ContactType:$("#slFilterType").val(),keyword:$("#txtFilterPeopleKeyword").val()},beforeSend:function(){n.LoadingOverlay("show")}},callback:function(t){var u=t.length,f=(u%4==0?0:4)-u%4,e=$("#api-uri").val(),i="",r;for($.each(t,function(n,t){i+=peopleTemplate(t,e)}),r=0;r<f;r++)i+='<article class="col" style="box-shadow: none; background: transparent;"><\/article>';n.html(i)}})}function peopleTemplate(n,t){var i='<article class="col"><span class="last-updated">'+(n.Type==2?"Individual":"Business")+"<\/span>";return i+='<a href="'+(n.Type==2?"/Community/UserProfilePage?uId="+n.UserId:"/Commerce/PublishBusinessProfile?id="+n.UserId)+'"><div class="avatar" style="background-image: url(\''+t+n.AvatarUri+"&size=T');\">&nbsp;<\/div>",i+='<h1 style="color: #333;">'+n.FullName+"<\/h1>",i+="<\/a>",i+='<div class="row" style="padding: 20px 20px 0 20px;">',i+=n.HasConnected?'<a href="#" class="btn btn-primary community-button" onclick="connectC2C(\''+n.UserId+"','"+fixQuoteCode(n.FullName)+"',"+n.Type+', true)"><i class="fa fa-comments"><\/i> &nbsp; Chat<\/a>':'<a href="#" class="btn btn-info community-button" onclick="connectC2C(\''+n.UserId+"','"+fixQuoteCode(n.FullName)+"',"+n.Type+', false)"><i class="fa fa-heart-o"><\/i> &nbsp; Connect<\/a>',i+"<\/div><\/article>"}function connectC2C(n,t,i,r){$.LoadingOverlay("show");$.post("/C2C/ConnectC2C",{linkId:n,type:i},function(n){if($.LoadingOverlay("hide"),n.result){_c2cQbiceId=n.Object;r||(i==1?cleanBookNotification.success(_L("CONNECTED_SUCCESS",[t]),"Community"):cleanBookNotification.success(_L("SENT_INVITE_MSG_SUCCESS",[t]),"Community"));initFindPeoble();loadC2CQbicleContent(!0);$('a[data-target="#c2c-comms"]').click();var u=n.Object2;u=="Blocked"?$("#connection-shown-type a[href=#blocked]").click():$("#connection-shown-type a[href=#all]").click()}else!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function setLikeBy(n,t,i,r,u){u.stopPropagation();var f=$($(u.target)[0]),e=$(".widget-contacts li.active").data("linkid"),o=i==2?"Individual":"Business";$.post("/C2C/SetLikeBy",{qId:n,linkId:t,type:i,isFavorite:r},function(u){u.result?r?(f.text("Remove from Favourites"),f.attr("onclick","setLikeBy("+n+",'"+t+"',"+i+","+!r+",event)"),t==e&&$(".plainmenu a[name=favourite-option]").text("Remove from Favourites"),cleanBookNotification.success("Add to Favourite successfully","Qbicles"),$("li[data-linkid="+t+"] a p").text(o+", Favourites")):(f.text("Add to Favourites"),f.attr("onclick","setLikeBy("+n+",'"+t+"',"+i+","+!r+",event)"),t==e&&$(".plainmenu a[name=favourite-option]").text("Add to Favourites"),cleanBookNotification.success("Remove from Favourite successfully","Qbicles"),$("li[data-linkid="+t+"] a p").text(o)):!u.result&&u.msg?cleanBookNotification.error(_L(u.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")}).done(function(){f.closest(".contactoptside").removeClass("open");$("#connection-shown-type a[name=favourite]").closest("li").hasClass("active")?loadC2CQbicleContent(!0):getC2CTalkNum()})}function loadC2CQbicleContent(n,t,i){if(!isC2CContactTabBusy){n&&(isC2CAllContactShown=!1,c2cContactTabPage=0);i&&(c2cContactTabPage=0);var r={keyword:$("#filters-contacts input[name=search]").val(),orderby:$("#filters-contacts select[name=orderBy]").val(),contactType:$("#filters-contacts select[name=contactType]").val(),c2cQbicleKey:_c2cQbiceId,isAllShown:$("#connection-shown-type a[href=#all]").closest("li").hasClass("active"),isFavouriteShown:$("#connection-shown-type a[href=#fav]").closest("li").hasClass("active"),isRequestShown:$("#connection-shown-type a[href=#new]").closest("li").hasClass("active"),isSentShown:$("#connection-shown-type a[href=#sent]").closest("li").hasClass("active"),isBlockedShown:$("#connection-shown-type a[href=#blocked]").closest("li").hasClass("active"),PageIndex:c2cContactTabPage};$.ajax({method:"POST",dataType:"JSON",data:r,url:"/C2C/LoadC2CQbiclesContent",beforeSend:function(){isC2CContactTabBusy=!0;$("#connection-shown-type li").css("pointer-events","none");$("#contact-tab-previous")&&$("#contact-tab-previous").html('<div class="text-center"><img src="/Content/DesignStyle/img/loading-new.gif" style="width: 180px; height: auto;"><\/div><br />')},success:function(n){var i=n.Data;t!=null&&t?$(i.ModelString).insertBefore("#contact-tab-previous"):($(".widget-contacts").LoadingOverlay("show"),$(".widget-contacts").html(""),$(".widget-contacts").append('<div id="contact-tab-previous"><\/div>'),$(i.ModelString).insertBefore("#contact-tab-previous"));c2cContactTabPage>=i.ModelCount?isC2CAllContactShown=!0:(c2cContactTabPage=c2cContactTabPage+1,isC2CAllContactShown=!1)},error:function(){}}).then(function(){isC2CContactTabBusy=!1;$("#contact-tab-previous").empty();t!=null&&t||(getC2CTalkNum(),$(".widget-contacts").LoadingOverlay("hide"),n?$("ul.widget-contacts > li.active > a").click():$("ul.widget-contacts > li:first-child > a").click());$("#connection-shown-type li").css("pointer-events","")})}}function tabTimeLine(){var n=$(".contained-sidebar");$(n).scrollTop(0);$(n).scroll(function(){if(!isC2CAllContactShown&&$("ul.subapps-nav li.active.tab-activities").length>0&&isC2CAllContactShown==!1)return setTimeout(function(){loadC2CQbicleContent(!1,!0)},100),isC2CAllContactShown});n.css("overscroll-behavior","contain")}function initC2CQbicleEventClick(){$(document).on("click","ul.widget-contacts > li > a",function(){$("ul.widget-contacts li").removeClass("active");$(this).closest("li").addClass("active");$("html").scrollTop(0);setTimeout(function(){var n,t,i;$("#post-text").val("");TypingNotification(!1);initC2cQbicleDefaultActive();n=$("ul.widget-contacts li.active");_c2cQbiceId=n.data("c2cqbicleid");$domainKey=n.data("c2cdomainid");$connectedC2C=n.data("communityemail");$("#hdfCurrentQbicleId").val(_c2cQbiceId);t=n.data("status");i=n.data("type");t=="Approved"?($(".c2c-not-blocked").show(),loadDataDashboardC2C(!0),viewProfileByC2CQbicle(n,i)):t=="Blocked"||t=="Cancel"?($(".c2c-not-blocked").hide(),loadDataDashboardC2C(!0),viewProfileByC2CQbicle(n,i)):loadC2CStatusInfo();setCommunityTalkViewed(_c2cQbiceId,i)},100)})}function setC2CStatusBy(n,t,i){$.post("/C2C/SetStatusBy",{key:n,status:t,type:i},function(n){n.result?(cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Community"),t=="Approved"?loadC2CQbicleContent(!0):loadC2CQbicleContent(!1,!1,!0)):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function removeCommunityQbicleById(n,t){var i="";t=="c2c"?i="/C2C/RemoveC2CQbicleById":(t="b2c")&&(i="/B2C/RemoveB2CQbicleById");$.post(i,{key:n},function(n){n.result?(_c2cQbiceId="0",cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Community"),loadC2CQbicleContent(!1)):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function viewProfileByC2CQbicle(n,t){$commonName=n.data("forename");var r=n.data("linkid"),o=n.data("c2cqbicleid"),i=n.data("status"),u=n.data("logourl"),f=n.data("isliked"),s=n.data("qid"),e=n.data("iscurrentreq");$(".order-context-flyout-div").hide();$(".customer-action").hide();$(".business-action").empty();$(".plainmenu a[name=req-accept-option], .plainmenu a[name=req-decline-option], .plainmenu a[name=sent-cancel-option]").hide();t==1?($.ajax({type:"post",url:"/B2C/CheckExistB2cOrders",data:{qbicleKey:_c2cQbiceId},dataType:"json",success:function(n){n==!0&&$(".order-context-flyout-div").show()},error:function(){}}).always(function(){}),$(".user-viewprofile").attr("href","/Commerce/PublishBusinessProfile?id="+r),$(".plainmenu button").css("background-image","url('"+u+"')"),i=="Blocked"?($(".plainmenu a[name=block-option]").text("Unblock"),$(".plainmenu a[name=favourite-option]").hide(),$(".c2c-not-blocked").hide()):($(".plainmenu a[name=block-option]").text("Block"),$(".plainmenu a[name=favourite-option]").show(),$(".c2c-not-blocked").show(),$(".business-action").html("<button onclick='browseB2CCatalog();' class='btn btn-success fab'><i class='fa fa-shopping-basket'><\/i><\/button>"))):($(".user-viewprofile").attr("href","/Community/UserProfilePage?uId="+r),$(".plainmenu button").css("background-image","url('"+u+"')"),i=="Blocked"?($(".plainmenu a[name=block-option]").text("Unblock"),$(".plainmenu a[name=favourite-option]").hide(),$(".c2c-not-blocked").hide()):(i=="Pending"&&(e?$(".plainmenu a[name=sent-cancel-option]").show():$(".plainmenu a[name=req-accept-option], .plainmenu a[name=req-decline-option]").show()),$(".customer-action").show(),$(".plainmenu a[name=block-option]").text("Block"),$(".plainmenu a[name=favourite-option]").show(),$(".c2c-not-blocked").show()));f?$(".plainmenu a[name=favourite-option]").text("Remove from Favourites"):$(".plainmenu a[name=favourite-option]").text("Add to Favourites")}function blockContact(n,t){var i=$("ul.widget-contacts li[data-c2cqbicleid="+n+"]"),r=confirm("Are you sure you want to block "+i.data("forename")+"?");r==!0&&setC2CStatusBy(n,"Blocked",t)}function toggleBtnInStores(){var n=$("#add-filter"),t=$("#clear-filter"),u=$(".filter-stores input[name=search]").val(),i=$("#stores-results"),r=$("#data-container-businesses"),f=$("#stores-splash"),e=$("#filter-store-info")[0].innerText;u||e!=0||$("#country-search").val()!=0?(n.show(),t.show(),i.show(),r.show(),$("#stores-subfilter").fadeIn()):(n.hide(),t.hide(),i.hide(),r.show(),f.show(),$("#stores-subfilter").fadeOut())}function searchproducts(){$("#products-splash").hide();$("#products-results").hide();$("#products-subfilter").hide();var n=$("#filter-product-info")[0].innerText;$("#psearching").val()==""&&$('#products select[name="loc"]').val()==0&&n==0?($("#products-splash").fadeIn(),console.log("false")):($("#products-results").fadeIn(),$("#products-subfilter").fadeIn(),console.log("true"))}function TemporaryClearFilterStore(){$("option",$("#community-stores-filter .checkmulti")).each(function(){$(this).removeAttr("selected").prop("selected",!0)});$(".checkmulti").multiselect("refresh");$("#community-stores-filter input[name=LimitMyConnections]").prop("checked",!1);$('#litmitMyConnections div[data-toggle="toggle"]').removeClass("btn-success").addClass("btn-default off")}function updateTemporaryselectedStore(){var n=$("#categories-search option:selected").length,t=$("#categories-search option").length,i=$('#litmitMyConnections div[data-toggle="toggle"]').hasClass("btn-success");n<t||i?$("#reset-filter-store").removeAttr("disabled"):$("#reset-filter-store").attr("disabled","")}function toggleCagetorySelect(){$(".optional-form").toggle()}function dynamicWhitelistTagify(){var n=[],t=$("#productTag option");for(let i=0;i<t.length;i++)n.push(t[i].text);distinctList=[...new Set(n)];tagify.whitelist=distinctList}function FilterByListInTagify(){var n="";if(inputTagify.value){n=JSON.parse(inputTagify.value);for(let t=0;t<JSON.parse(inputTagify.value).length;t++)n.push(JSON.parse(inputTagify.value)[t].value)}return n}function backupFilterProduct(){previousChoiceTagify=inputTagify.value;previousChoiceSelect=$("#listBrands option:selected").map(function(n,t){return t.value})}function TemporaryClearFilterProduct(){backupFilterProduct();tagify.removeAllTags();$("#listBrands").multiselect("selectAll",!1);$("#listBrands").multiselect("refresh");updateTemporaryselectedProduct();$("#reset-filter-products").attr("disabled","")}function RestoreOptionFilterProduct(){inputTagify.value=previousChoiceTagify}function ClearFilterProduct(){tagify.removeAllTags();inputTagify.value=null;$("#listBrands").multiselect("selectAll",!1);$("#listBrands").multiselect("refresh");initFindProducts()}function FilterDataTable(n,t){$(".dtproducts").DataTable().columns(2).search(t,!0,!1,!1).draw();$(".dtproducts").DataTable().search(n).draw();updateTotalSelectedProduct()}function updateTotalSelectedProduct(){var n=0,t=$("#listBrands + .btn-group .multiselect-container li.active").length,i=$("#listBrands + .btn-group .multiselect-container li").length,r;t<i&&(n+=1);inputTagify.value&&(r=JSON.parse(inputTagify.value),n=n+1);$("#add-filter-products .label.label-info").text(n);n>0?($("#clear-filter-products").removeAttr("disabled"),$("#reset-filter-products").removeAttr("disabled")):($("#clear-filter-products").attr("disabled",""),$("#reset-filter-products").attr("disabled",""))}function updateTemporaryselectedProduct(){var n=inputTagify.value.length,t=$("#listBrands option:selected").length;n+t>0?$("#reset-filter-products").removeAttr("disabled"):$("#reset-filter-products").attr("disabled","")}function updateTotalSelectedCategory(){var n=0,t,i,r;$("#categories-search").val()?(t=$("#categories-search").val().length,i=$("#categories-search")[0].options.length,t!=i&&(n=n+1)):$("#categories-search")[0].options.length!=0&&(n=n+1);r=$("#community-stores-filter input[name=LimitMyConnections]").prop("checked");r&&(n=n+1);$("#add-filter .label.label-info").text(n);n>0?$("#clear-filter").removeAttr("disabled"):$("#clear-filter").attr("disabled","")}function initFindBusinessStores(){var r=$("#data-container-businesses"),t=$("#shopping-container"),e=$("#stores-splash"),u=$("#pagiation-businesses"),i=$("#categories-search").val(),f=$("#stores-results"),n;u.pagination({dataSource:"/B2C/GetBusinessStores",locator:"items",totalNumberLocator:function(i){return t.LoadingOverlay("hide"),n=i.totalNumber,i.totalNumber},pageSize:8,ajax:{data:{keyword:$(".filter-stores input[name=search]").val(),AreaOfOperation:$("#country-search").val(),categoryIds:i?i.toString():"",limitMyConnections:$("#community-stores-filter input[name=LimitMyConnections]").prop("checked"),IsAllPublicStoreShown:$("#show-all-store-btn").css("display")=="none"},beforeSend:function(){t.LoadingOverlay("show");toggleBtnInStores()}},callback:function(t){var u,e;$("#stores").addClass("active fade in");var o=(count%4==0?0:4)-count%4,s=$("#api-uri").val(),i="";for($.each(t,function(n,t){i+=businessTemplate(t,s)}),u=0;u<o;u++)i+='<article class="col" style="box-shadow: none; background: transparent;"><\/article>';r.html(i);e="";n>0&&(e="<div><h5>"+n+" store(s) found<\/h5><\/div>");f.html(e);isShopDetailBeingShown==!0&&($("#stores").removeClass("active fade in"),isShopDetailBeingShown=!1);toggleBtnInStores()}});updateTotalSelectedCategory()}function businessTemplate(n){var t='<article class="col">';return t+='<a href="#business-catalogues" data-toggle="tab" aria-expanded="true" onclick="loadB2CBusinessCatalogues(\''+n.DomainKey+'\')"><div class="avatar" style="background-image: url(\''+n.LogoUri+"&size=T');\">&nbsp;<\/div>",t+='<h1 style="color: #333;">'+n.BusinessName+"<\/h1>",t+="<\/a>",t+='<p class="qbicle-detail">'+n.BusinessSummary+"<\/p>",t+='<div style="padding: 10px 0;">',_.forEach(n.Tags,function(n){t+='<label class="label label-lg label-soft">'+n+"<\/label> "}),t+="<\/div>",t+="<\/article>"}function loadB2CBusinessCatalogues(n){var t=$("#business-catalogues");t.empty();t.LoadingOverlay("show");t.load("/B2C/LoadB2CBusinessCatalogues",{domainKey:n,isLoadAll:!1},function(){t.LoadingOverlay("hide")})}function loadB2CBusinessCatalogDetail(n){var t=$("#business-catalog-detail");t.empty();t.LoadingOverlay("show");t.load("/B2C/LoadB2CBusinessCatalogDetail",{catalogKey:n},function(){t.LoadingOverlay("hide")})}function loadB2CBusinessCatalogDetailForProductTab(n){var t=$("#business-catalog-detail");$("#products").removeClass("active in");t.addClass("active in");t.empty();t.LoadingOverlay("show");t.load("/B2C/LoadB2CBusinessCatalogDetail",{catalogKey:n},function(){t.LoadingOverlay("hide");$("#catalog-detail-back-btn").attr("data-target","#products")})}function createB2COrderDiscussion(n,t){$.LoadingOverlay("show");$.post("/B2C/CreateB2COrderDiscussion",{businessDomainKey:n,catalogId:t},function(n){n.result?location.href="/B2C/DiscussionOrder?disKey="+n.msgId:!n.result&&n.msg?(cleanBookNotification.error(_L(n.msg),"B2C"),LoadingOverlayEnd()):(cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"B2C"),LoadingOverlayEnd())})}function timeline(){$(window).scrollTop(0);$(window).scroll(function(){if(!isC2CAllContactShown&&$("ul.subapps-nav li.active.tab-activities").length>0&&previousShown==!1)return loadingNewC2C(),previousShown=!0})}function loadMoreActivitiesC2C(n){if(!isBusy){var t=[];$("#select-activity").val()!="0"&&t.push($("#select-activity").val());var r={Key:_c2cQbiceId,Size:loadCountActivity*qbiclePageSize,ActivityTypes:t,TopicIds:[],Apps:[],Daterange:$("#txtFilterDaterange").val()},i=$("ul.widget-contacts li.active"),u=i?i.data("type"):2;$.ajax({url:"/C2C/LoadMoreC2CActivities",data:{fillterModel:r,type:u},type:"POST","async":!1,beforeSend:function(){isBusy=!0},success:function(t){var i,r;if(isBusy=!1,t.isHidden){_c2cQbiceId=0;loadC2CQbicleContent(!0);cleanBookNotification.warning(_L("WARNING_MSG_REMOVECONTACT"),"Community");setTimeout(function(){$("ul.widget-contacts > li:first-child > a").click()},500);return}$("#previous").empty();isFirstLoad==0&&(loadModalC2CActivities(),isFirstLoad=1,$("#first-load-icon:visible").length>0&&(showQbicleStream(),$(window).scrollTop(0)));t.length!==0?(n?($("#dashboard-page-display").html(""),$("#dashboard-page-display").append('<div id="previous"><\/div>'),$(t.ModelString).insertBefore("#previous").fadeIn(250)):$(t.ModelString).insertBefore("#previous").fadeIn(250),i=$("#dashboard-date-today"),i.length>0&&($("#dashboard-date-today .day-date").first().addClass("day-date-first"),i.addClass("day-block-first")),removeDom()):(n&&($("#dashboard-page-display").html(""),$("#dashboard-page-display").append('<div id="previous"><\/div>')),previousShown=!0);t.ModelCount&&(r=t.ModelCount-loadCountActivity*qbiclePageSize,previousShown=r<=0?!0:!1);$(".op-forward").remove()},error:function(){isBusy=!1;showQbicleStream()}});loadCountActivity=loadCountActivity+1}}function showQbicleStream(){$("#first-load-icon").hide();$("#latch").show();$("#dashboard-page-display").show()}function loadingNewC2C(){$("#previous div.text-center")&&$("#previous").html('<div class="text-center"><img src="/Content/DesignStyle/img/loading-new.gif" style="width: 180px; height: auto;"><\/div><br />');setTimeout(function(){loadMoreActivitiesC2C()},500)}function loadDataDashboardC2C(n){n&&($(window).scrollTop(0),loadCountActivity=0,isFirstLoad=0,$("#dashboard-page-display").hide(),$("#first-load-icon").show());setTimeout(function(){loadMoreActivitiesC2C(n);onCommunityConnected()},100)}function removeDom(){$("#comms-activities .day-block").each(function(){$(this).find("article").length==0&&$(this).remove()})}function addTopicToFilter(n,t){if($('#select-topic option[value="'+n+'"]').length<=0){$("#select-topic").append($("<option>",{value:n,text:t})).select2({placeholder:"Please select"});$("#select-topic").on("change.select2",function(){LoadDataDashboard(!0)})}$('#toppic-value option[value="'+n+'"]').length<=0&&$("#toppic-value").append($("<option>",{value:n,text:t})).select2()}function resetFilters(){$(".removefilters").hide();$("#select-activity").val("0").trigger("change");$("#txtFilterDaterange").val("");loadDataDashboardC2C(!0)}function loadModalC2CActivities(){var n=$("ul.widget-contacts li.active");n.length>0&&n.data("status")=="Approved"?$("#modal-activities").load("/C2C/LoadModalActivities",function(){$("#modal-activities select.select2").not("select.select2-hidden-accessible").select2({placeholder:"Please select"});$('#modal-activities input[data-toggle="toggle"]').bootstrapToggle();initNextPreviousTab("#form_task_addedit","#taskTabs")}):$("#modal-activities").empty()}function initNextPreviousTab(n,t){$(n+" .btnNext").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").next("li").find("a").trigger("click")});$(n+" .btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find(t+" .active").prev("li").find("a").trigger("click")})}function latchformobile(){$(document).width()<1200&&$(".interact").waypoint(function(n){n=="down"&&($(".interact").addClass("mobile-top"),$(".block-container").addClass("compensate-sticky"));n=="up"&&($(".block-container").removeClass("compensate-sticky"),$(".interact").removeClass("mobile-top"))},{offset:"25%"})}function loadC2CStatusInfo(){var n=$("#block-content-approve");n.load("/C2C/LoadC2CQbicleStatusInfo",{key:_c2cQbiceId},function(){onCommunityConnected()})}function initC2cQbicleDefaultActive(){var n=$("ul.widget-contacts > li.active > a").attr("href");n=="#comms-waiting-approve"?($("#comms-activities").removeClass("in active"),$(n).addClass("in active")):($("#comms-waiting-approve").removeClass("in active"),$(n).addClass("in active"))}function getC2CTalkNum(){var n=$("#filters-contacts input[name=search]").val(),t=$("#filters-contacts select[name=contactType]").val();$.ajax({type:"GET",dataType:"JSON",url:"/C2C/GetCommunityTalkNum",data:{keyword:n,contactType:t},success:function(n){$("#connection-shown-type a[name=all]").text("All ("+n.allNum+")");$("#connection-shown-type a[name=favourite]").text("Favourites ("+n.favouriteNum+")");$("#connection-shown-type a[name=request] #count").text(n.requestNum);$("#connection-shown-type a[name=sent]").text("Sent ("+n.sentNum+")");$("#connection-shown-type a[name=blocked]").text("Blocked ("+n.blockedNum+")")},error:function(){}})}function setCommunityTalkViewed(n,t){$.ajax({method:"POST",dataType:"JSON",url:"/C2C/SetC2CConnectionViewedStatusAndGetShoppingAbility",data:{key:n,type:t},success:function(i){if(i.result&&($('li[data-c2cqbicleid="'+n+'"] .comms-newstuff').attr("hidden","hidden"),t==1)){var r=i.Object;r==null||r.IsB2CActive==!1?$(".business-action").hide():$(".business-action").show();r!=null&&r.HasPublicCatalog?($(".business-action > button").removeClass("disabled"),$(".business-action").removeAttr("data-tooltip"),html5tooltips.refresh()):($(".business-action > button").addClass("disabled"),$(".business-action").attr("data-tooltip","No shopping catalogs available"),html5tooltips.refresh())}}})}function setQbicleRemoved(n){var t="/C2C/RemoveQbicleFromUser?qKey="+n;$.ajax({method:"POST",dataType:"JSON",url:t,success:function(n){n.result?(loadC2CQbicleContent(!0),cleanBookNotification.updateSuccess("Qbicles")):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}})}function deletePost(n,t){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Qbicles",message:_L("WARNING_MSG_DELETEPOST"),callback:function(i){if(i){$.LoadingOverlay("show");$.post("/Posts/DeletePost",{key:t},function(t){$.LoadingOverlay("hide");t.result?($("#"+n).remove(),cleanBookNotification.success("Your post was successfully deleted.")):!t.result&&t.msg?cleanBookNotification.error("There was an issue deleting this post. Please try again","Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")});return}}})}function addPostToDiscuss(n){$.LoadingOverlay("show");$.get("/Posts/GetMessageOfPost?key="+n,function(n){$("#create-discussion-qb").modal("show");$("#discussion-summary").val(n.message);$.LoadingOverlay("hide")})}function loadEditPostModal(n,t){$("#edit-post").modal("show");$.LoadingOverlay("show");$("#edit-post").load("/Qbicles/GenerateEditPostModal",{postKey:t},function(){$("#edit-post select[name=topic]").select2({placeholder:"Please select"});$("#frmEditPost").submit(function(t){if(t.preventDefault(),$(this).valid()){$.LoadingOverlay("show");var i={key:$("#frmEditPost input[name=PostKey]").val(),message:$("#frmEditPost textarea[name=postcontent]").val(),topicId:$("#frmEditPost select[name=topic]").val()};$.post("/QbicleComments/UpdatePost",i,function(t){if(t.result){$("#edit-post").modal("hide");var r=$("#frmEditPost select[name=topic] option:selected").text();$("#"+n+" .topic-label").html('<span class="label label-info">'+fixQuoteCode(r)+"<\/span>");$("#"+n+" .activity-overview p").text(i.message);$("#"+n+" .post-event").text("Edited post");cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Qbicles")}else!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$.LoadingOverlay("hide")})}else return});$.LoadingOverlay("hide")})}function browseB2CCatalog(){var n=$("#b2c-catalogues");n.LoadingOverlay("show");n.empty();n.load("/B2C/LoadB2CCatalogues",{domainKey:$domainKey},function(){n.LoadingOverlay("hide");$("#b2c-catalogues").modal("toggle");loadB2CCatalogues($domainKey)})}function loadB2CCatalogDetail(n){var t=$("#business-catalog-detail");t.LoadingOverlay("show");t.empty();t.load("/B2C/LoadB2CBusinessCatalogDetail",{catalogKey:n},function(){$("ul.subapps-nav li.active").removeClass("active");$("ul li.shopping-li").addClass("active");$(".options").hide();$(".options-shopping").fadeIn();$("#c2c-comms").removeClass("active fade in");$("#shopping").addClass("active fade in");$("#business-catalogues").removeClass("active fade in");$("#stores").removeClass("active fade in");$("#business-catalog-detail").addClass("active fade in");$("#b2c-catalogues").modal("toggle");t.LoadingOverlay("hide")})}function loadB2CCatalogues(n){var t=$("#business-catalogues");t.empty();t.load("/B2C/LoadB2CBusinessCatalogues",{domainKey:n,isLoadAll:!1},function(){})}function productTemplate(n){var t='<tr role="row"><td>';return t+='<a href="javascript:void(0)"><div class="dtitemimg" onclick="loadB2CBusinessCatalogDetailForProductTab(\''+n.Key+"')\" style=\"background-image: url('"+n.ProductImage+"');\"><\/div><\/a>",t+="<\/td>",t+='<td class="sorting_1">',t+='<h5><a href="javascript:void(0)" onclick="loadB2CBusinessCatalogDetailForProductTab(\''+n.Key+"')\" >"+n.ProductName+"<\/a><\/h5>",t+="<small>"+n.ProductSKU+"<\/small>",t+="<\/td>",t+='<td class="provider">',t+='<a href="javascript:void(0)" onclock="loadB2CBusinessCatalogues(\''+n.DomainKeyEncrypt+"')\">"+n.ProviderName+"<\/a>",t+='<h5 class="hide">'+n.Brand+"<\/h5>",t+="<\/td>",t+='<td class="price">',t+=""+n.ProductPrice+"",t+="<\/td>",t+='<td class="text-right">',t+='<a href="javascript:void(0)" class="btn btn-success community-button sm w-auto" onclick="loadB2CBusinessCatalogDetailForProductTab(\''+n.Key+"')\">Shop now<\/a>",t+="<\/td>",t+"<\/tr>"}function listBrandTemplate(n,t){return'<option value="'+t+'">'+n.NameDomain+"<\/option>"}function initFindProducts(){searchproducts();updateTotalSelectedProduct();var n=$("#products-results-dttable").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#products-results-dttable").LoadingOverlay("show"):$("#products-results-dttable").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/C2C/LoadShoppingProductListDT",type:"POST",data:function(n){return $.extend({},n,{keySearch:$("#psearching").val(),countryName:$("#pcountry-selector").val(),lstBrandIds:$("#listBrands").val(),lstProductTags:FilterByListInTagify()})}},columns:[{data:"CategoryItemId",orderable:!1,render:function(n,t,i){var r="";return r+='<a href="/Commerce/PublishBusinessProfile?id='+i.BusinessId+'">',r+=' <div class="dtitemimg" style="background-image: url(\''+i.CatItemImageUri+"');\">",r+="<\/div>",r+"<\/a>"}},{data:"CategoryItemId",orderable:!0,render:function(n,t,i){var r="";return r+="<h5>",r+='<a href="/Commerce/PublishBusinessProfile?id='+i.BusinessId+'">'+i.CategoryItemName+"<\/a>",r+="<\/h5>",r+("<small>"+i.SKU+"<\/small>")}},{data:"B2BProfileBusinessName",orderable:!1,render:function(n,t,i){return""+('<a href="/Commerce/PublishBusinessProfile?id='+i.BusinessId+'">'+i.B2BProfileBusinessName+"<\/a>")}},{data:"Price",orderable:!0},{data:"CatalogId",orderable:!1,render:function(n,t,i){return""+('<a href="javascript:void(0)" onclick="loadB2CBusinessCatalogDetailForProductTab(\''+i.CatalogKey+'\')" class="btn btn-success community-button sm w-auto">Shop now<\/a>')}}]});$("#products-results").LoadingOverlay("hide");dynamicWhitelistTagify()}function intitDatatableAgain(){$("#products-results .dtproducts").DataTable().destroy();$("#products-results .dtproducts").DataTable({language:{lengthMenu:"_MENU_ &nbsp; per page"},search:{regex:!0,smart:!1}})}function dynamicListBrandMultiSelect(n){var t="";$.each(n,function(n,i){t+=listBrandTemplate(i,n)});$("#community-products-filter #listBrands").html(t);$("#community-products-filter #listBrands").multiselect("rebuild")}function InitSplashTab(){$("#products-splash").LoadingOverlay("show");$.ajax({method:"POST",dataType:"JSON",url:"/C2C/GetFeaturedProductForShoppingTab",success:function(n){if(n!=null){$("#products-splash-content").empty();var t="";n.forEach(function(n){n.Type==1?t+=SplashFImageTemplate(n):n.Type==2&&(t+=SplashFProductTemplate(n))});$("#products-splash-content").html(t)}}}).then(function(){$("#products-splash").LoadingOverlay("hide")})}function SplashFProductTemplate(n){var t="";return t+='<div class="col">',t+='<a href="javascript:void(0)" onclick="loadB2CBusinessCatalogDetailForProductTab(\''+n.AssociatedCatalogKey+"')\">",t+='<div class="productimg" style="margin-bottom: 5px; background-image: url(\''+n.LogoImageUri+"'); border-radius: 5px; overflow: hidden;\"><\/div>",t+='<div class="whom">',t+='<div class="avatarc" style="background-image: url(\''+n.BusinessLogo+"');\">&nbsp;<\/div>",t+='<div class="whominfo text-left">',t+='<h5 style="color: #333;">'+n.CategoryItemName+"<\/h5>",t+="<small>"+n.BusinessName+"<\/small>",t+="<\/div>",t+='<div class="price">',t+="<h5>"+n.PriceStr+"<\/h5>",t+="<\/div>",t+="<\/div>",t+="<\/a>",t+"<\/div>"}function SplashFImageTemplate(n){var t="";return t+='<div class="col">',n.FeaturedImageURL==""?t+='<div class="commsimgfeature" style="background-image: url(\''+n.LogoImageUri+"');\"><\/div>":(t+='<a href="'+n.FeaturedImageURL+'" target="_blank">',t+='<div class="commsimgfeature" style="background-image: url(\''+n.LogoImageUri+"');\"><\/div>",t+="<\/a>"),t+"<\/div>"}var _c2cQbiceId="0",$domainKey="",$connectedC2C="",loadCountActivity=0,isFirstLoad=0,previousShown=!1,isBusy=!1,isShopDetailBeingShown=!1,$commonName,inputTagify,tagify,backupBrands;$(document).ready(function(){var t,n;tabTimeLine();loadC2CQbicleContent(!0,!1);initFindPeoble();initSearch();initC2CQbicleEventClick();$("ul.widget-contacts > li.active > a").click();initC2cQbicleDefaultActive();intitDatatableAgain();initPlugin();t=getQuerystring("tab");t=="shopping"?(n=getQuerystring("shopid"),n&&(isShopDetailBeingShown=!0),$("a[data-target=#shopping]").trigger("click"),setTimeout(function(){n&&(loadB2CBusinessCatalogues(n),$("#linkshop").click(),setTimeout(function(){var n=getQuerystring("catalogkey");n&&(loadB2CBusinessCatalogDetail(n),$("#business-catalog-detail").addClass("active fade in"),$("#business-catalogues").removeClass("active fade in"))},200))},200)):t=="contacts"&&$("a[data-target=#all-contacts]").trigger("click")});var c2cContactTabPage=0,isC2CContactTabBusy=!1,isC2CAllContactShown=!1;$commonName="";$("#shopping #add-filter").click(function(){toggleCagetorySelect()});$("#shopping #clear-filter").click(function(){TemporaryClearFilterStore();initFindBusinessStores();updateTotalSelectedCategory()});$(".filter-stores input[name=search]").focus(function(){toggleBtnInStores()});$(".filter-stores input[name=search]").focusout(function(){toggleBtnInStores()});$("#reset-filter-store").click(function(){TemporaryClearFilterStore();$("#reset-filter-store").attr("disabled","")});$("#litmitMyConnections").click(delay(function(){updateTemporaryselectedStore()},500));$("#shopping #add-filter-products").click(function(){});$("#shopping #clear-filter-products").click(function(){ClearFilterProduct()});$("#reset-filter-products").click(function(){TemporaryClearFilterProduct()});inputTagify=document.querySelector('textarea[name="input-custom-dropdown"]');tagify=new Tagify(inputTagify,{enforceWhitelist:!0,whitelist:[],maxTags:20,dropdown:{maxItems:5,classname:"tags-look",enabled:0,closeOnSelect:!1,mode:"mix",enforceWhitelist:!0}});tagify.on("add",function(){$("#reset-filter-products").removeAttr("disabled")});tagify.on("remove",function(){updateTemporaryselectedProduct()});