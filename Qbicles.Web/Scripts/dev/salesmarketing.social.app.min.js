function pad(n,t){for(var i=n+"";i.length<t;)i="0"+i;return i}function SocialCampaignAdd(){$.ajax({url:"/SalesMarketing/GetDependencyCheckManual",type:"GET",success:function(n){if(LoadingOverlayEnd(),n.status){var t=n.netwokType,i=n.brands,r=n.ideaThemes;t>0&&i>0&&r>0?SMSocialCampaignAdd():($("#app-marketing-social-auto-dependencies").empty(),$("#app-marketing-social-auto-dependencies").load("/SalesMarketing/DependencyCheckPartial?type=0",function(){$("#app-marketing-social-auto-dependencies").modal("show")}))}else LoadingOverlayEnd(),cleanBookNotification.error(n.message,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SMSocialCampaignAdd(){$("#app-marketing-manual-social-campaign-add").empty();$("#app-marketing-social-campaign-add").empty();$("#app-marketing-email-campaign-add").empty();$("#app-marketing-social-campaign-add").load("/SalesMarketing/SocialCampaignAdd",function(){$("#app-marketing-social-campaign-add").modal("show");$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#social-campaign-workgroup").select2({placeholder:"Please select"});$("#slBrandCampaign").select2({placeholder:"Please select",allowClear:!0});isValidWorkgroup();var n=$("#frm_marketing-social-campaign_add");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});$(".previewimg").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});disableCampaignForm(!0)})}function ManualSocialCampaignAdd(){$.ajax({url:"/SalesMarketing/GetDependencyCheckManual",type:"GET",success:function(n){if(LoadingOverlayEnd(),n.status){var t=n.brands,i=n.ideaThemes;t>0&&i>0?SMManualSocialCampaignAdd():($("#app-marketing-social-auto-dependencies").empty(),$("#app-marketing-social-auto-dependencies").load("/SalesMarketing/DependencyCheckPartial?type=1",function(){$("#app-marketing-social-auto-dependencies").modal("show")}))}else LoadingOverlayEnd(),cleanBookNotification.error(n.message,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SMManualSocialCampaignAdd(){$("#app-marketing-manual-social-campaign-add").empty();$("#app-marketing-social-campaign-add").empty();$("#app-marketing-email-campaign-add").empty();$("#app-marketing-manual-social-campaign-add").load("/SalesMarketing/ManualSocialCampaignAdd",function(){$("#app-marketing-manual-social-campaign-add").modal("show");$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#social-campaign-workgroup").select2({placeholder:"Please select"});$("#slBrandCampaign").select2({placeholder:"Please select",allowClear:!0});isValidWorkgroup();var n=$("#frm_marketing-social-campaign_add");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});$(".previewimg").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});disableCampaignForm(!0)})}function DPEmailCampaignAdd(){$.ajax({url:"/SalesMarketing/GetDependencyCheckManual",type:"GET",success:function(n){if(LoadingOverlayEnd(),n.status){var t=n.brands,i=n.ideaThemes,r=n.segments;t>0&&i>0&&r>0?EmailCampaignAdd():($("#app-marketing-social-auto-dependencies").empty(),$("#app-marketing-social-auto-dependencies").load("/SalesMarketing/DependencyCheckPartial?type=3",function(){$("#app-marketing-social-auto-dependencies").modal("show")}))}else LoadingOverlayEnd(),cleanBookNotification.error(n.message,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function EmailCampaignAdd(){$("#app-marketing-manual-social-campaign-add").empty();$("#app-marketing-social-campaign-add").empty();$("#app-marketing-email-campaign-add").empty();$("#app-marketing-email-campaign-add").load("/SalesMarketing/EmailCampaignAdd",function(){$("#app-marketing-email-campaign-add").modal("show");$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#social-campaign-workgroup").select2({placeholder:"Please select"});$("#slBrandCampaign").select2({placeholder:"Please select",allowClear:!0});isValidWorkgroup();var n=$("#frm_marketing-email-campaign_add");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});$(".previewimg").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});disableCampaignForm(!0);$(".select2").select2()})}function SocialBrandOptionsLoad(n){var t=$(n).val();t>0?($("#brandoptions").show(),t&&($("#brandoptions").empty(),$("#brandoptions").load("/SalesMarketing/SocialBrandOptions",{brandId:t},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}))):$("#brandoptions").hide()}function SocialBrandOptionsLoadForEdit(n){var t=$(n).val(),i=$("#hdfBrandId").val();t>0?($("#brandoptions").show(),t&&($("#brandoptions").empty(),$("#brandoptions").load("/SalesMarketing/SocialBrandOptions",{brandId:t},function(){if($(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0}),i===t){var n=$("#hdfBrandProducts").val().split(","),r=$("#hdfValuePropositons").val().split(","),u=$("#hdfAttributes").val().split(",");$("#brandoptions select[name=brandproducts]").val(n);$("#brandoptions select[name=brandproducts]").multiselect("refresh");$("#brandoptions select[name=attributes]").val(u);$("#brandoptions select[name=attributes]").multiselect("refresh");$("#brandoptions select[name=valueprops]").val(r);$("#brandoptions select[name=valueprops]").multiselect("refresh")}else $("#brandoptions select[name=brandproducts]").val(""),$("#brandoptions select[name=brandproducts]").multiselect("refresh"),$("#brandoptions select[name=attributes]").val(""),$("#brandoptions select[name=attributes]").multiselect("refresh"),$("#brandoptions select[name=valueprops]").val(""),$("#brandoptions select[name=valueprops]").multiselect("refresh")}))):$("#brandoptions").hide()}function EmailBrandOptionsLoad(n){var t=$(n).val();t>0?($("#brandoptions").show(),t&&($("#brandoptions").empty(),$("#brandoptions").load("/SalesMarketing/EmailBrandOptions",{brandId:t},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}))):$("#brandoptions").hide()}function EmailBrandOptionsLoadForEdit(n){var t=$(n).val(),i=$("#hdfBrandId").val();t>0?($("#brandoptions").show(),t&&($("#brandoptions").empty(),$("#brandoptions").load("/SalesMarketing/EmailBrandOptions",{brandId:t},function(){if($(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0}),i===t){var n=$("#hdfBrandProducts").val().split(","),r=$("#hdfValuePropositons").val().split(","),u=$("#hdfAttributes").val().split(",");$("#brandoptions select[name=brandproducts]").val(n);$("#brandoptions select[name=brandproducts]").multiselect("refresh");$("#brandoptions select[name=attributes]").val(u);$("#brandoptions select[name=attributes]").multiselect("refresh");$("#brandoptions select[name=valueprops]").val(r);$("#brandoptions select[name=valueprops]").multiselect("refresh")}else $("#brandoptions select[name=brandproducts]").val(""),$("#brandoptions select[name=brandproducts]").multiselect("refresh"),$("#brandoptions select[name=attributes]").val(""),$("#brandoptions select[name=attributes]").multiselect("refresh"),$("#brandoptions select[name=valueprops]").val(""),$("#brandoptions select[name=valueprops]").multiselect("refresh")}))):$("#brandoptions").hide()}function SocialTwitter(){var n=$("#frm-twitter");n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=new FormData(n[0]);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:i,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n!==null?window.location.href=n.AuthorizationURL:(cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing"),isBusyAddTaskForm=!1);LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}})}function SocialFacebookPage(){var n=$("#frm-facebook");n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=new FormData(n[0]);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:i,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n!==null?window.location.href=n.AuthorizationURL:(cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing"),isBusyAddTaskForm=!1);LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}})}function SocialFacebookGroup(){isFacebookPage=!1;var n=$("#frm-facebook-group");n.submit(function(t){if(t.preventDefault(),n.valid()){$.LoadingOverlay("show");var i=new FormData(n[0]);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:i,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n!==null?window.location.href=n.AuthorizationURL:(cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing"),isBusyAddTaskForm=!1);LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}})}function AddProfileFacebookPage(n,t,i,r){$.LoadingOverlay("show");var u={id:n,name:t,picture:i,access_token:r};$.ajax({url:"/SalesMarketing/AddProfileFacebookPage",data:u,type:"POST",success:function(t){LoadingOverlayEnd();t.status?($("#fp_"+n).remove(),manage_options("#options-config"),$(".section-detail").hide(),$(".intro-config").show(),$(".appnav").hide(),LoadSocicalConfigs(),cleanBookNotification.success(_L("ERROR_MSG_207"),"Sales Marketing")):(LoadingOverlayEnd(),cleanBookNotification.error(t.message,"Sales Marketing"))},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function AddProfileFacebookGroup(n,t,i,r){$.LoadingOverlay("show");var u={id:n,name:t,picture:i,access_token:r};$.ajax({url:"/SalesMarketing/AddProfileFacebookGroup",data:u,type:"POST",success:function(t){LoadingOverlayEnd();t.status?($("#fg_"+n).remove(),manage_options("#options-config"),$(".section-detail").hide(),$(".intro-config").show(),$(".appnav").hide(),LoadSocicalConfigs(),cleanBookNotification.success(_L("ERROR_MSG_207"),"Sales Marketing")):(LoadingOverlayEnd(),cleanBookNotification.error(t.message,"Sales Marketing"))},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function LoadModalSocialNetworkFacebook(n){$.getJSON("/SalesMarketing/GetSocialNetworkById",{id:n,provider:"Facebook"},function(n){n!==null&&(SocialFacebookPage(),$("#fbpClientId").val(n.ClientId),$("#fbpClientSecret").val(n.ClientId))})}function LoadModalSocialNetworkTwitter(n){$.getJSON("/SalesMarketing/GetSocialNetworkById",{id:n,provider:"Twitter"},function(n){n!==null&&(SocialTwitter(),$("#twConsumerKey").val(n.ConsumerKey),$("#twconsumerSecret").val(n.ConsumerSecret),$("#twUserAccessToken").val(n.UserAccessToken),$("#twUserAccessSecret").val(n.UserAccessSecret))})}function readImgURL(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result)};i.readAsDataURL(n.files[0])}}function ReloadTopics(){var t=$("#setting_qbicle").val(),n=$("#setting_topic"),i=$("#btn-addWorkgroup");t>0?$.getJSON("/SalesMarketing/LoadTopicsByQbicleId",{qid:t},function(t){t&&t.length>0&&(n.prop("disabled",!1),i.prop("disabled",!1),n.empty(),n.select2({data:t,placeholder:"Please select"}),updateSetting())}):(n.prop("disabled",!0),i.prop("disabled",!0))}function updateSetting(){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketing/UpdateSetting",data:{id:$("#settingId").val(),qId:$("#setting_qbicle").val(),tId:$("#setting_topic").val()},type:"POST",success:function(n){LoadingOverlayEnd();n.result?cleanBookNotification.success(_L("ERROR_MSG_208"),"Sales Marketing"):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function isValidWorkgroup(){var t=$("#social-campaign-workgroup").val(),n=$("#social-campaign-workgroup option:selected");$("td.info-process").text(n.attr("process"));$("td.info-members").text(n.attr("members"));disableCampaignForm(t?!1:!0)}function disableCampaignForm(n){var t="#frm_marketing-social-campaign_add",i;n?($(t+" input[name=Name]").prop("disabled",!0),$(t+" input[name=foldername]").prop("disabled",!0),$(t+" input[name=featuredimg]").prop("disabled",!0),$(t+" textarea[name=Details]").prop("disabled",!0),$("#social-campaign-folders").prop("disabled",!0),$("#slBrandCampaign").prop("disabled",!0),$(t+" .checkmulti").multiselect("disable"),$(".preview-workgroup").hide()):($(t+" input[name=Name]").prop("disabled",!1),$(t+" input[name=foldername]").prop("disabled",!1),$(t+" input[name=featuredimg]").prop("disabled",!1),$(t+" textarea[name=Details]").prop("disabled",!1),$("#social-campaign-folders").prop("disabled",!1),$(t+" .checkmulti").multiselect("enable"),i=$("#social-campaign-workgroup"),$(".preview-workgroup .info-process").text(i.attr("process")),$(".preview-workgroup .info-members").text(i.attr("members")),$("#slBrandCampaign").prop("disabled",!1),$(".preview-workgroup").show(),ReloadFolders())}function socialNextTheme(){$("#v-campaigntitle").html($("#campaigntitle").val());$("#v-campaignsummary").html($("#campaignsummary").val());$("#article-feature-img").css("background-image","url("+imageSrc+")")}function LoadSocicalCampains(n){var t=$("#social-cmp-search").val(),i=$("#social-cmp-target-type").val(),r=$("#social-cmp-campaign-type").val(),u;$.LoadingOverlay("show");n&&$.ajax({url:"/SalesMarketing/CountSocialCampains",data:{search:t,targnetworks:i,campaigntype:r},"async":!1,type:"POST",success:function(n){totalCamp=n;skip=0;totalCamp>take&&$("#load-camp").show();$("#campaigns-social div.from-community").html("")},error:function(){totalCamp=0;skip=0}});u=$("#campaigns-social div.from-community").html();$("#campaigns-social div.from-community").load("/SalesMarketing/LoadSocialCampains",{search:t,targnetworks:i,campaigntype:r,skip:skip,take:take},function(){$("#campaigns-social div.from-community").prepend(u);totalCamp==$("#campaigns-social div.from-community .col").length?$("#load-camp").hide():$("#load-camp").show();skip+=take;LoadingOverlayEnd()})}function LoadEmailCampaigns(n){var t=$("#email-campaign-search").val(),i=$("#target-segment-search").val(),r;$.LoadingOverlay("show");n&&$.ajax({url:"/SalesMarketing/CountEmailCampaigns",data:{search:t,targetsegments:i},"async":!1,type:"POST",success:function(n){totalCamp=n;skip=0;totalCamp>take&&$("#load-email-camp").show();$("#campaigns-email div.from-community").html("")},error:function(){totalCamp=0;skip=0}});r=$("#campaigns-email div.from-community").html();$("#campaigns-email div.from-community").load("/SalesMarketing/LoadEmailCampaigns",{search:t,targetsegments:i,skip:skip,take:take},function(){$("#campaigns-email div.from-community").prepend(r);totalCamp==$("#campaigns-email div.from-community .col").length?$("#load-email-camp").hide():$("#load-email-camp").show();skip+=take;LoadingOverlayEnd()});$.LoadingOverlay("hide")}function LoadSocicalConfigs(){$.LoadingOverlay("show");$("#app-config").load("/SalesMarketing/LoadSocicalConfigs",function(){$("#setting_qbicle,#setting_topic").select2({placeholder:"Please select"});InitDatatableEmailTemplate();initSESIdentitiesTable();LoadingOverlayEnd()})}function addMembers(n){var t=$("#slMembers").val();t||(t=[]);t.push(n);$("#slMembers").val(t)}function removeMembers(n){var t=$("#slMembers").val();t&&t.remove(n);$("#slMembers").val(t);$("#apr"+n).prop("checked",!1);$("#apr"+n).change()}function isApprover(n,t){var i;$(t).prop("checked")?(i=$("#slReviewersApprovers").val(),i||(i=[]),i.push(n),$("#slReviewersApprovers").val(i)):(i=$("#slReviewersApprovers").val(),i&&i.remove(n),$("#slReviewersApprovers").val(i))}function FilterMembers(){try{var n=$("#smkeyword").val(),t=$("#slShow").val();n?$("#wgMembers li").each(function(){var i=$(this),r=i.attr("fullname");t=="1"?i.hasClass("ismember")&&r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide():r.toLowerCase().indexOf(n.toLowerCase())!==-1?i.show():i.hide()}):t=="1"?($("ul.widget-contacts li.ismember").show(),$("ul.widget-contacts li:not(.ismember)").hide()):$("ul.widget-contacts li").show()}catch(i){return}}function SyncTrader(){$("#app-marketing-trader-sync .affected").load("/SalesMarketing/LoadSyncTrader",function(){$("#trader-table").DataTable({destroy:!0,responsive:!0,order:[[0,"asc"]],language:{lengthMenu:"_MENU_ &nbsp; per page"}});$(".loading").hide();$(".affected").fadeIn()})}function LoadContacts(){$(".mdv2-col-dash").LoadingOverlay("show");$("#contacts-ages").load("/SalesMarketing/LoadContact",function(){$("#age-ranges-table").DataTable({destroy:!0,responsive:!0,searching:!1,order:[[0,"asc"]],language:{lengthMenu:"_MENU_ &nbsp; per page"}});$(".mdv2-col-dash").LoadingOverlay("hide")})}function onChangeAgeRange(n,t){var i=parseInt($("#ip-start-age-range-"+n).val()),r=parseInt($("#ip-end-age-range-"+n).val());i<0?cleanBookNotification.error(_L("ERROR_MSG_209"),"Sales Marketing"):r<0?cleanBookNotification.error(_L("ERROR_MSG_210"),"Sales Marketing"):i>r?cleanBookNotification.error(_L("ERROR_MSG_211"),"Sales Marketing"):($.ajax({url:"/SalesMarketing/SaveAgeRange",data:{id:n,idCus:t,start:i,end:r},"async":!1,type:"POST",success:function(n){LoadingOverlayEnd();n.result?cleanBookNotification.success(_L("ERROR_MSG_212"),"Sales Marketing"):n.msg&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}),LoadingOverlayEnd())}function AddRowContacTable(n){$.ajax({url:"/SalesMarketing/SaveAgeRange",data:{id:-1,idCus:n,start:1,end:10},"async":!1,type:"POST",success:function(n){LoadingOverlayEnd();n.result?LoadContacts():n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}});LoadingOverlayEnd()}function DeleteAgeRange(n){var t=confirm("Do you want remove this record?");t==!0&&($.ajax({url:"/SalesMarketing/DeleteAgeRange",data:{id:n},"async":!1,type:"POST",success:function(n){LoadingOverlayEnd();n.result?(LoadContacts(),cleanBookNotification.success(_L("ERROR_MSG_213"),"Sales Marketing")):n.msg&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}),LoadingOverlayEnd())}function LoadModalWorkgroup(n){$("#app-marketing-workgroup-add").load("/SalesMarketing/LoadModalWorkgroup",{id:n},function(){$("#source-qbicle,#default-topic,#slShow").select2();$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#slProcess").change(function(){n.valid()});var n=$("#frm-workgroup-addedit");n.validate({ignore:"",rules:{Name:{required:!0,minlength:5},Process:{required:!0}}});$(".btnNext").click(function(){var n=$(this).closest(".modal");$(n).find(".app_subnav .active").next("li").find("a").trigger("click")});$(".btnPrevious").click(function(){var n=$(this).closest(".modal");$(n).find(".app_subnav .active").prev("li").find("a").trigger("click")});n.submit(function(t){var i,r,u;if(t.preventDefault(),i=$("#domainId-workgroup").val(),i===""){cleanBookNotification.error(_L("ERROR_MSG_214"),"Sales Marketing");return}if(r=$("#default-topic").val(),!r){cleanBookNotification.error(_L("ERROR_MSG_215"),"Sales Marketing");return}n.valid()?($.LoadingOverlay("show"),u=$(this).serialize(),$.ajax({type:this.method,url:this.action,data:u,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){if(n.result){$("#app-marketing-workgroup-add").modal("hide");var t=parseInt($("#wg-id").val());t>0?cleanBookNotification.success(_L("ERROR_MSG_216"),"Sales Marketing"):cleanBookNotification.success(_L("ERROR_MSG_217"),"Sales Marketing");$("#workgroups").click()}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})):$('.app_subnav a[href="#add-specifics"]').click()})})}function LoadTableWorkgroup(){$.LoadingOverlay("show");$("#content-workgroup-table").load("/SalesMarketing/LoadTableWorkgroup",function(){$("#workgroups-table").DataTable({destroy:!0,responsive:!0,order:[[0,"asc"]],language:{lengthMenu:"_MENU_ &nbsp; per page"}});LoadingOverlayEnd()})}function DeleteWorkgroup(){$.LoadingOverlay("show");var n=$("#wg-delete-id").val();$.ajax({url:"/SalesMarketing/DeleteWorkgroupById",data:{id:n},type:"POST",success:function(n){LoadingOverlayEnd();$("#app-marketing-delete-workgroup").modal("hide");n.result?(cleanBookNotification.success(_L("ERROR_MSG_218"),"Sales Marketing"),$("#wg-delete-id").val(0),LoadTableWorkgroup()):n.msg&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function DeleteSocialNetwork(){$.LoadingOverlay("show");var n=$("#sn-delete-id").val();$.ajax({url:"/SalesMarketing/DeleteSocialNetworkById",data:{id:n},type:"POST",success:function(n){LoadingOverlayEnd();$("#app-marketing-delete-socialnetwork").modal("hide");n.result?(cleanBookNotification.success(_L("ERROR_MSG_219"),"Sales Marketing"),$("#sn-delete-id").val(0),LoadSocicalConfigs()):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SetDisableSocialNetwork(n){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketing/SetDisableSocialNetworkById",data:{id:n},type:"POST",success:function(n){LoadingOverlayEnd();n.result?LoadSocicalConfigs():n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SearchThrottle(n,t){var i=null;return function(){var r=this,u=arguments;clearTimeout(i);i=window.setTimeout(function(){n.apply(r,u)},t||800)}}function AutoGenerateFolderName(){var t=$("#social-campaign-workgroup option:selected"),n=t.attr("qbicleid");n&&$.getJSON("/SalesMarketing/AutoGenerateFolderName",{qbicleId:n},function(n){n&&$("#social-newfolder-name").val(n).change()})}function SocialBrandFormReset(){$("#frm-marketing-brand").trigger("reset");$("select[name=FeaturedImageUri]").val("").change();$(".foldername").hide();$("#frm-marketing-brand").validate().resetForm();$("#brandFolderName").removeClass("valid");$("#imgbrandpreview").hide()}function getTotalPageBrand(){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketingBrand/LoadBrands",type:"GET",data:{skip:0,take:0,keyword:$("#brandSearch").val(),isLoadingHide:$("#isLoadingHideBrand").is(":checked")?!0:!1},"async":!0,success:function(n){if(n.result){var t=n.Object.totalRecord;t>0?initPagination(t,brandPageSize,"#brandPaginateTemplate"):($("#app-brands .from-community").html(""),$("#brandPaginateTemplate").css("display","none"))}LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function SocialBrandLoad(n,t){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketingBrand/LoadBrands",type:"GET",data:{skip:n,take:t,keyword:$("#brandSearch").val(),isLoadingHide:$("#isLoadingHideBrand").is(":checked")?!0:!1},"async":!0,success:function(n){n.result&&($("#app-brands .from-community").html(n.Object.strResult),$("#brandPaginateTemplate").css("display","block"));LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function initPagination(n,t,i){if(n!=0){var r=$(i),u=function(){for(var i=[],t=1;t<=n;t++)i.push(t);return i}(),f={prevText:"&nbsp; &laquo; Prev &nbsp;",nextText:"&nbsp; Next &raquo; &nbsp;",currentPage:1,pageSize:t,dataSource:u,callback:function(n,r){switch(i){case"#brandPaginateTemplate":SocialBrandLoad((r.pageNumber-1)*t,t);break;case"#segmentPaginateTemplate":SocialSegmentContent((r.pageNumber-1)*t,t);break;case"#placePaginateTemplate":LoadPlace((r.pageNumber-1)*t,t);break;case"#areaPaginateTemplate":LoadArea((r.pageNumber-1)*t,t);break;case"#pipelinePaginateTemplate":LoadPipeline((r.pageNumber-1)*t,t);break;case"#ideaPaginateTemplate":LoadIdeas((r.pageNumber-1)*t,t)}}};r.pagination(f)}}function SocialBrandAutoGenerateFolderName(){$.getJSON("/SalesMarketingBrand/AutoGenerateFolderName",function(n){n&&$("#brandFolderName").val(n)})}function LoadModalIdea(n){$("#app-marketing-idea-add").load("/SalesMarketingIdea/GenerateModalIdeaAddEdit",{ideaId:n},function(){$(".previewimgidea").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});var n=$("#frm-idea-theme");n.validate({rules:{Name:{required:!0,minlength:5,maxlength:35},Explanation:{required:!0,maxlength:200},Url:{url:!0}}})})}function ProcessSMIdea(){var n=$("#frm-idea-theme"),r=$("#frm-idea-theme select[name=Type]").val(),t,i;if(!r){n.validate().showErrors({Type:"This field is required."});return}if(t=$("#frm-idea-theme select[name=ResourcesFolder]").val(),!t){n.validate().showErrors({ResourcesFolder:"This field is required."});return}if(t=="0"&&!$("#ideaFolderName").val()){n.validate().showErrors({FolderName:"This field is required."});return}$("#frm-idea-theme").valid()&&($.LoadingOverlay("show"),i=document.getElementById("sm-idea-upload-media").files,i&&i.length>0?UploadMediaS3ClientSide("sm-idea-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-idea-object-key").val(n.objectKey);$("#sm-idea-object-name").val(n.fileName);$("#sm-idea-object-size").val(n.fileSize);SubmitSMIdea()}):($("#sm-idea-object-key").val(""),$("#sm-idea-object-name").val(""),$("#sm-idea-object-size").val(""),SubmitSMIdea()))}function SubmitSMIdea(){var n=new FormData($("#frm-idea-theme")[0]);$("#ideaLinks tr[lnkUrl]").each(function(){n.append("Links[]",$(this).attr("lnkUrl"))});$.ajax({type:"post",cache:!1,url:"/SalesMarketingIdea/SaveIdea",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-idea-add").modal("hide"),getTotalPageIdea(),SocialIdeaFormReset(),cleanBookNotification.success(_L("ERROR_MSG_198"),"Sales Marketing")):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function getTotalPageIdea(){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketingIdea/LoadIdeas",type:"GET",data:{skip:0,take:0,keyword:$("#txtIdeaKeyword").val(),isActive:$("#slIdeaStatus").val(),isLoadingHide:$("#isLoadingHideIdea").is(":checked")?!0:!1},"async":!0,success:function(n){if(n.result){var t=n.Object.totalRecord;t>0?initPagination(t,ideaPageSize,"#ideaPaginateTemplate"):($("#app-ideas .from-community").html(""),$("#ideaPaginateTemplate").css("display","none"))}LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function LoadIdeas(n,t){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketingIdea/LoadIdeas",type:"GET",data:{skip:n,take:t,keyword:$("#txtIdeaKeyword").val(),isActive:$("#slIdeaStatus").val(),isLoadingHide:$("#isLoadingHideIdea").is(":checked")?!0:!1},"async":!0,success:function(n){n.result&&($("#app-ideas .from-community").html(n.Object.strResult),$("#ideaPaginateTemplate").css("display","block"));LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function ShowOrHideIdea(n){$.ajax({url:"/SalesMarketingIdea/ShowOrHideIdea",data:{id:n},type:"POST",success:function(n){n.result?getTotalPageIdea():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SocialIdeaAutoGenerateFolderName(){$.getJSON("/SalesMarketingIdea/AutoGenerateFolderName",function(n){n&&$("#ideaFolderName").val(n)})}function SocialIdeaFormReset(){$("#frm-idea-theme").trigger("reset");$("select[name=Type]").val("").change();$("select[name=ResourcesFolder]").val("").change();$("#ideaFolderName").hide();$("#frm-idea-theme").validate().resetForm();$("#ideaFolderName").removeClass("valid");$("#imgideapreview").hide()}function extractHostname(n){var t=document.createElement("a");return(t.href=$(n).val(),t.origin)?t.origin:""}function SocialIdeaAddLink(){var t=$("#frm-idea-theme input[name=Url]"),n,i;t.valid()&&(n=extractHostname(t),$('#ideaLinks tr[lnkUrl="'+n+'"]').length==0?($("#ideaLinks").show(),i='<tr lnkUrl="'+n+'"><td><a href="'+n+'" target="_blank"><i class="fa fa-external-link"><\/i> &nbsp; '+n+'<\/a><\/td><td> <button class="btn btn-danger" onclick="SocialIdeaRemoveLink(this)"><i class="fa fa-trash"><\/i><\/button><\/td><\/tr>',$("#ideaLinks").append(i),$(".links-associate").show(),t.val("")):t.val(""))}function SocialIdeaRemoveLink(n){$(n).parent().parent().remove();$("#ideaLinks tr").length==1&&$("#ideaLinks").hide()}function socialIdeaUseInCampaign(n,t){t?($(".other").hide(),$("#rs-"+n).show(),$(".usetheme"+n).hide(),$(".change"+n).show(),$("#ideaId").val(n)):($(".other").show(),$(".change"+n).hide(),$(".usetheme"+n).show())}function SocialContactCriteriaAdd(){var n=$("#frmContactCriteria");n.validate({rules:{Label:{required:!0,maxlength:150}}});n.submit(function(t){if((t.preventDefault(),!isBusyAddTaskForm)&&n.valid()){$.LoadingOverlay("show");SocialReIndexPost();var i=$(this).attr("action"),r=$(this).attr("method"),u=$(this).serialize();$.ajax({url:i,type:r,data:u,beforeSend:function(){isBusyAddTaskForm=!0},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).done(function(n){isBusyAddTaskForm=!1;n.result?($("#app-marketing-contact-criteria-add").modal("hide"),SocialContactCriteriaContent(),$("#hdfCriteriaId").val()=="0"?(cleanBookNotification.success(_L("ERROR_MSG_226"),"Sales Marketing"),SocialContactCriteriaReset()):(cleanBookNotification.success(_L("ERROR_MSG_227"),"Sales Marketing"),SocialContactCriteriaEdit(0))):cleanBookNotification.error(n.msg,"Sales Marketing");LoadingOverlayEnd()})}})}function SocialContactCriteriaReset(){$("#frmContactCriteria")[0].reset();$("#frmContactCriteria").validate().resetForm();$("#chkmandatoryfield").bootstrapToggle("off");$(".box-custome-option .input-group").remove()}function SocialCustomOptionAdd(){var n=$(".box-custome-option div.input-group").length+2,t='<div class="input-group option'+(n+1)+'" style="margin-bottom: 15px;">';t+='<input type="hidden" class="ipId" name="Options['+n+'].Id" value="0" />';t+='<input type="text" name="Options['+n+'].Label" class="form-control ipLabel" placeholder="Option '+(n+1)+'">';t+='<input type="hidden" class="ipDisplayOrder" name="Options['+n+'].DisplayOrder" value="'+(n+1)+'" />';t+='<span class="input-group-btn">';t+='<button class="btn btn-danger" onclick="$(this).parent().parent().remove();"><i class="fa fa-trash"><\/i><\/button><\/span><\/div>';$("#btnaddoption").before(t)}function SocialContactCriteriaContent(){$(".mdv2-col-dash").LoadingOverlay("show");$("#contacts-criteria").load("/SalesMarketingContact/LoadContentCriteria",function(){function i(){var n=$(this).parents("tr");t(n,"up")}function r(){var n=$(this).parents("tr");t(n,"down")}function t(t,i){var o=n.row(t).index(),s=-1,f,h,r,e,c,u;i==="down"&&(s=1);f=n.row(o).data();f[0]=parseInt(f[0])+s;h=o+s;r=$(f[4]);h>0?(r.find(".dtMoveUp").length==0&&r.find("ul.dropdown-menu").prepend('<li><a href="#" class="dtMoveUp">Move up<\/a><\/li>'),r.find(".dtMoveDown").length==0&&(r.find("ul.dropdown-menu .dtMoveUp").length==0?r.find("ul.dropdown-menu").prepend('<li><a href="#" class="dtMoveDown">Move down<\/a><\/li>'):r.find("ul.dropdown-menu .dtMoveUp").after('<li><a href="#" class="dtMoveDown">Move down<\/a><\/li>'))):r.find(".dtMoveUp").parent().remove();f[4]='<div class="btn-group options">'+r.html()+"<\/div>";e=n.row(o+s).data();e[0]=parseInt(e[0])-s;c=o;u=$(e[4]);c>0?(u.find(".dtMoveUp").length==0&&u.find("ul.dropdown-menu").prepend('<li><a href="#" class="dtMoveUp">Move up<\/a><\/li>'),u.find(".dtMoveDown").length==0&&(u.find("ul.dropdown-menu .dtMoveUp").length==0?u.find("ul.dropdown-menu").prepend('<li><a href="#" class="dtMoveDown">Move down<\/a><\/li>'):u.find("ul.dropdown-menu .dtMoveUp").after('<li><a href="#" class="dtMoveDown">Move down<\/a><\/li>'))):u.find(".dtMoveUp").parent().remove();e[4]='<div class="btn-group options">'+u.html()+"<\/div>";n.row(o).data(e);n.row(h).data(f);n.draw(!1);SocialMoveUpDownOrderCriteria(f[5],h+1,e[5],o+1)}var n=$("#tblCriteriaDef").DataTable({drawCallback:function(){$("#tblCriteriaDef tr:last .dtMoveDown").remove();$(".dtMoveUp").unbind("click");$(".dtMoveDown").unbind("click");$(".dtMoveUp").click(i);$(".dtMoveDown").click(r)}});$(".mdv2-col-dash").LoadingOverlay("hide")})}function SocialContactCriteriaEdit(n){$("#app-marketing-contact-criteria-add").load("/SalesMarketingContact/GenerateModalCriteriaAddEdit",{criteriaId:n},function(){$("#chkmandatoryfield").bootstrapToggle();SocialContactCriteriaAdd();n>0&&$("#app-marketing-contact-criteria-add").modal("show")})}function SocialContactCriteriaRemove(n){isBusyAddTaskForm||$.ajax({url:"/SalesMarketingContact/RemoveCriteria",type:"post",data:{criteriaId:n},beforeSend:function(){isBusyAddTaskForm=!0},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).done(function(n){isBusyAddTaskForm=!1;n.result?($("#app-marketing-contact-criteria-add").modal("hide"),SocialContactCriteriaContent(),cleanBookNotification.success(_L("ERROR_MSG_228"),"Sales Marketing")):cleanBookNotification.error(n.msg,"Sales Marketing");LoadingOverlayEnd()})}function SocialContactCriteriaStatus(n,t){isBusyAddTaskForm||$.ajax({url:"/SalesMarketingContact/SetStatusContactCriteria",type:"post",data:{criteriaId:n,status:t},beforeSend:function(){isBusyAddTaskForm=!0},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).done(function(n){isBusyAddTaskForm=!1;n.result?(SocialContactCriteriaContent(),cleanBookNotification.success(_L("ERROR_MSG_229"),"Sales Marketing")):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()})}function SocialReIndexPost(){$(".box-custome-option .input-group").each(function(n){var f=$(this).find(".ipId"),e=$(this).find(".ipLabel"),o=$(this).find(".ipDisplayOrder"),t=2+n,s,r,h,u,c,i;f.length>0&&(s=f.attr("name"),r=$('input[name="'+s+'"]'),r.attr("placeholder","Option "+(t+1)),r.attr("name","Options["+t+"].Id"));e.length>0&&(h=e.attr("name"),u=$('input[name="'+h+'"]'),u.attr("placeholder","Option "+(t+1)),u.attr("name","Options["+t+"].Label"));o.length>0&&(c=o.attr("name"),i=$('input[name="'+c+'"]'),i.attr("placeholder","Option "+(t+1)),i.attr("name","Options["+t+"].DisplayOrder"),i.val(t+1))})}function SocialMoveUpDownOrderCriteria(n,t,i,r){if(isBusyAddTaskForm)return!1;var u={MoveUpId:n,MoveUpOrder:t,MoveDownId:i,MoveDownOrder:r};$.ajax({url:"/SalesMarketingContact/MoveUpDownOrderCriteria",type:"post",data:u,"async":!1,beforeSend:function(){isBusyAddTaskForm=!0},error:function(){return isBusyAddTaskForm=!1,cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing"),!1}}).done(function(n){return isBusyAddTaskForm=!1,n.result?(cleanBookNotification.success(_L("ERROR_MSG_230"),"Sales Marketing"),!0):(cleanBookNotification.error(n.msg,"Sales Marketing"),!1)})}function SocialSegmentFormReset(){$("#frm-segment").trigger("reset");$("#segment-1 select[name=Type]").val("").change();$("#segment-1 select[name=Areas]").val([]).change();$("#segment-1 select[name=Areas]").multiselect("refresh");$("#frm-segment").validate().resetForm();$("#more-criteria-content").empty();$('#tabSegment a[href="#segment-1"]').tab("show")}function SocialMoreCriteria(){var t=$("#more-criteria-content .criteria-el").length+1,n=[];$(".item-criterial").each(function(){var t=$(this).val();if(t)n.push(t);else{cleanBookNotification.error(_L("ERROR_MSG_370"),"Sales Marketing");return}});$.ajax({url:"/SalesMarketingSegment/GenerateMoreCriteria",type:"get",data:{index:t,criterias:JSON.stringify(n)},error:function(){isBusyAddTaskForm=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},success:function(n){if(n){var t=$(n);$("#more-criteria-content div.criteria-el").length==0&&t.find(".lblAnd").remove();$("#more-criteria-content").append(t);$(".select2").select2({placeholder:"Please select"});$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}}})}function SocialGenerateList(n){var t,i,r;$("#frm-segment").valid()&&(t=[],$(".criteria-el").each(function(n){var i=$('.criteria-el select[name="Criterias['+n+'].CriteriaId"]').val(),r=$('.criteria-el select[name="Criterias['+n+'].CriteriaValues"]').val();i&&r&&t.push({CriteriaId:i,CriteriaValues:r})}),i=$("#segment-1 select[name=Areas]").val(),r={clauses:t,areaIds:i?i:[],cContacts:n},$('#tabSegment a[href="#segment-3"]').tab("show"),$("#lst-contact-content").load("/SalesMarketingSegment/GenerateListContact",r,function(){$("#lst-contacts").DataTable({destroy:!0,responsive:!0,order:[[0,"asc"]],language:{lengthMenu:"_MENU_ &nbsp; per page"}});$("#lst-contacts").on("draw.dt",function(){$("#lst-contacts tbody input:checkbox").bootstrapToggle()});$("#lst-contacts tbody input:checkbox").bootstrapToggle()}))}function bindValCheckbox(n){var t=$(n);t.prop("checked")?$("#hdfSelectContacts option[value='"+t.val()+"']").attr("selected","selected"):$("#hdfSelectContacts option[value='"+t.val()+"']").removeAttr("selected")}function getTotalPageSegment(){$(".mdv2-col-dash").LoadingOverlay("show");var n=$("#segmentTypes").val(),t={skip:0,take:0,keyword:$("#segmentSearch").val(),types:n?n:[],isLoadingHide:$("#isLoadingHideSegment").is(":checked")?!0:!1};$.ajax({url:"/SalesMarketingSegment/LoadContentSegment",type:"GET",data:t,"async":!0,success:function(n){if(n.result){var t=n.Object.totalRecord;t>0?initPagination(t,segmentPageSize,"#segmentPaginateTemplate"):($("#app-brands .from-community").html(""),$("#segmentPaginateTemplate").css("display","none"))}$(".mdv2-col-dash").LoadingOverlay("hide")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");$(".mdv2-col-dash").LoadingOverlay("hide")}})}function SocialSegmentContent(n,t){$(".mdv2-col-dash").LoadingOverlay("show");var i=$("#segmentTypes").val(),r={skip:n,take:t,keyword:$("#segmentSearch").val(),types:i?i:[],isLoadingHide:$("#isLoadingHideSegment").is(":checked")?!0:!1};$.ajax({url:"/SalesMarketingSegment/LoadContentSegment",type:"GET",data:r,"async":!0,success:function(n){n.result&&($("#contacts-segments .from-community").html(n.Object.strResult),$("#segmentPaginateTemplate").css("display","block"));$(".mdv2-col-dash").LoadingOverlay("hide")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");$(".mdv2-col-dash").LoadingOverlay("hide")}})}function SocialLoadOptionVal(n,t){var u=$(n).val(),i,r;if(u){if(i=[],$(".criteria-el").each(function(n){var t=$('.criteria-el select[name="Criterias['+n+'].CriteriaId"]').val();t&&i.push(t)}),r=i.filter(function(n){return n==u}),r&&r.length>1){cleanBookNotification.error(_L("ERROR_MSG_205"),"Sales Marketing");$(n).val("").change();return}$.ajax({url:"/SalesMarketingSegment/GetOptionValuesByCriteriaId",type:"get",data:{criteriaId:$(n).val()},error:function(){isBusyAddTaskForm=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},success:function(n){if(n.length>0){var i=$("#"+t);$("#"+t+" option").remove();$.each(n,function(n,t){i.append('<option value="'+t.id+'">'+t.text+"<\/option>")});i.multiselect("destroy");i.hide();i.multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})}}})}}function LoadModalArea(n){$("#app-marketing-area-add").load("/SalesMarketing/LoadModalArea",{id:n},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0})})}function ProcessSMArea(){if($("#frm-area-addedit").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-area-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-area-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-area-object-key").val(n.objectKey);$("#sm-area-object-name").val(n.fileName);$("#sm-area-object-size").val(n.fileSize);SubmitSMAreaPlace()}):SubmitSMAreaPlace()}}function SubmitSMAreaPlace(){var n=new FormData($("#frm-area-addedit")[0]);$.ajax({type:"post",url:"/SalesMarketing/SaveSMPlaceArea",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){if(n.result){$("#app-marketing-area-add").modal("hide");var t=parseInt($("#areaId").val());t>0?cleanBookNotification.success(_L("ERROR_MSG_234"),"Sales Marketing"):cleanBookNotification.success(_L("ERROR_MSG_235"),"Sales Marketing");getTotalPageArea()}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function ShowOrHideArea(n){$.ajax({url:"/SalesMarketing/ShowOrHideArea",data:{id:n},type:"POST",success:function(n){n.result?getTotalPageArea():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function LoadModalPlace(n){$("#app-marketing-place-add").load("/SalesMarketing/LoadModalPlace",{id:n},function(){$("#app-marketing-place-add").modal("show");$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#frm-place-addedit").validate({ignore:"",rules:{Name:{required:!0,minlength:4,maxlength:50},Summary:{maxlength:200}}})})}function SubmitPlaceAdd(){var n=new FormData($("#frm-place-addedit")[0]);$.ajax({type:"post",url:"/SalesMarketing/SavePlace",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){if(n.result){$("#app-marketing-place-add").modal("hide");var t=parseInt($("#placeId").val());t>0?cleanBookNotification.success(_L("ERROR_MSG_200"),"Sales Marketing"):cleanBookNotification.success(_L("ERROR_MSG_237"),"Sales Marketing");getTotalPagePlace()}else n.msg?cleanBookNotification.error(n.msg,"Sales Marketing"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function ShowOrHidePlace(n){$.ajax({url:"/SalesMarketing/ShowOrHidePlace",data:{id:n},type:"POST",success:function(n){n.result?getTotalPagePlace():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function getTotalPageArea(){var n=$("#txtArea").val(),t=$("#isLoadingHideArea").is(":checked")?!0:!1;$.LoadingOverlay("show");$.ajax({url:"/SalesMarketing/CountListArea",data:{name:n,isLoadingHide:t},"async":!1,type:"POST",success:function(n){n>0?initPagination(n,areaPageSize,"#areaPaginateTemplate"):($("#content-area").html(""),$("#areaPaginateTemplate").css("display","none"));LoadingOverlayEnd()},error:function(){LoadingOverlayEnd()}})}function LoadArea(n,t){var i=$("#txtArea").val(),r=$("#isLoadingHideArea").is(":checked")?!0:!1,u;$.LoadingOverlay("show");u=$("#content-area").html();$.ajax({url:"/SalesMarketing/LoadArea",data:{name:i,skip:n,take:t,isLoadingHide:r},cache:!1,type:"POST","async":!1,success:function(n){$("#content-area").html(n);$("#areaPaginateTemplate").css("display","block");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function getTotalPagePipeline(){var n=$("#txtPipeline").val(),t=$("#isLoadingHidePipeline").is(":checked")?!0:!1;$.LoadingOverlay("show");$.ajax({url:"/SalesMarketing/CountListPipeline",data:{name:n,isLoadingHide:t},"async":!1,type:"POST",success:function(n){n>0?initPagination(n,pipelinePageSize,"#pipelinePaginateTemplate"):($("#content-pipeline").html(""),$("#pipelinePaginateTemplate").css("display","none"));LoadingOverlayEnd()},error:function(){LoadingOverlayEnd()}})}function LoadPipeline(n,t){var i=$("#txtPlace").val(),r=$("#isLoadingHidePipeline").is(":checked")?!0:!1,u;$.LoadingOverlay("show");u=$("#content-pipeline").html();$.ajax({url:"/SalesMarketing/LoadPipeline",data:{name:i,skip:n,take:t,isLoadingHide:r},cache:!1,type:"POST","async":!0,success:function(n){$("#content-pipeline").html(n);$("#pipelinePaginateTemplate").css("display","block");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function ShowOrHidePipeline(n){$.ajax({url:"/SalesMarketing/ShowOrHidePipeline",data:{id:n},type:"POST",success:function(n){n.result?getTotalPagePipeline():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function LoadModalPipeline(n){$("#app-marketing-pipeline-addedit").load("/SalesMarketing/LoadModalPipeline",{id:n},function(){$("#app-marketing-pipeline-addedit").modal("show")})}function ProcessSMPipeline(){var n;if($("#frm-pipeline-addedit").valid()){var t=[],r=[],i=!0;if($("#steps .fieldtitle").each(function(){$(this).val()==""&&(i=!1);t.push($(this).val());r.push($(this).attr("data-id"))}),t.length==0){cleanBookNotification.error(_L("ERROR_MSG_509"),"Sales Marketing");return}if(!i){cleanBookNotification.error(_L("ERROR_MSG_600"),"Sales Marketing");return}$.LoadingOverlay("show");n=document.getElementById("sm-pipeline-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-pipeline-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-pipeline-object-key").val(n.objectKey);$("#sm-pipeline-object-name").val(n.fileName);$("#sm-pipeline-object-size").val(n.fileSize);SubmitSMPipeline()}):SubmitSMPipeline()}}function SubmitSMPipeline(){var n=new FormData($("#frm-pipeline-addedit")[0]),t=[],i=[],r=!0;$("#steps .fieldtitle").each(function(){$(this).val()==""&&(r=!1);t.push($(this).val());i.push($(this).attr("data-id"))});n.append("steps",JSON.stringify(t));n.append("idSteps",JSON.stringify(i));$.ajax({type:"post",url:"/SalesMarketing/SavePipeline",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){if(n.result){$("#app-marketing-pipeline-addedit").modal("hide");var t=parseInt($("#Id").val());t>0?(cleanBookNotification.success(_L("ERROR_MSG_609"),"Sales Marketing"),location.reload()):(cleanBookNotification.success(_L("ERROR_MSG_610"),"Sales Marketing"),getTotalPagePipeline())}else cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function LoadModalPipelineContactDetail(n,t){$.LoadingOverlay("show");$(".pipelineContactId").val(n);$("#app-marketing-pipeline-contact-manage").load("/SalesMarketing/LoadModalPipelineContactDetail",{id:n},function(){$("#app-marketing-pipeline-contact-manage").modal("show");LoadCampaignsOfContact(t);LoadPipelineTasks();LoadPipelineEvents();$("#tblPipelineTasks").DataTable().ajax.reload();LoadingOverlayEnd()})}function LoadModalPipelineContact(n){$.LoadingOverlay("show");$("#app-marketing-pipeline-prospect-addedit").load("/SalesMarketing/LoadModalPipelineContact",{id:n},function(){$("#app-marketing-pipeline-prospect-addedit").modal("show");LoadingOverlayEnd()})}function LoadExistPipelineContacts(n,t){$.LoadingOverlay("show");$("#pipelineContacts").load("/SalesMarketing/LoadExistPipelineContacts",{name:n,id:t},function(){LoadingOverlayEnd()})}function LoadNewPipelineContacts(n){$.LoadingOverlay("show");$("#newContacts").load("/SalesMarketing/LoadNewPipelineContacts",{name:n,pipelineId:$("#pipelineId").val()},function(){LoadingOverlayEnd()})}function showExistPipelineContact(n){$.LoadingOverlay("show");$(".contact").load("/SalesMarketing/ShowExistPipelineContact",{id:n},function(){$(".select2").select2({placeholder:"Please select"});LoadingOverlayEnd()})}function showNewPipelineContact(n){$.LoadingOverlay("show");$(".contact-2").load("/SalesMarketing/ShowNewPipelineContact",{id:n},function(){$(".select2").select2({placeholder:"Please select"});$frm_pipelinecontact_add=$("#frm-pipelinecontact-add");$frm_pipelinecontact_add.submit(function(n){if(n.preventDefault(),$frm_pipelinecontact_add.valid()){$.LoadingOverlay("show");var t=new FormData($frm_pipelinecontact_add[0]);t.append("pipelineId",$("#pipelineId").val());$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:t,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_611"),"Sales Marketing"),location.reload()):(cleanBookNotification.error(n.msg?n.msg:_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing"),isBusyAddTaskForm=!1);LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}});LoadingOverlayEnd()})}function savePipelineContact(){var n=new FormData;n.append("id",$("#pipelineContactId").val());n.append("pipelineId",0);n.append("contactId",0);n.append("rating",$("#rating").val());n.append("potentialValue",$("#potentialValue").val());$.ajax({type:"POST",cache:!1,url:"/SalesMarketing/SavePipelineContact",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(){},error:function(){isBusyAddTaskForm=!1}})}function removePipelineContact(n){var t=[];t.push(n);removeListPipelineContact(t)}function removeListPipelineContact(n){$.LoadingOverlay("show");$.ajax({url:"/SalesMarketing/RemovePipelineContact",data:{pipelineContactId:JSON.stringify(n)},"async":!1,type:"POST",success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_612"),"Sales Marketing"),location.reload()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()}})}function moveOnePipelineContact(n){selectedPipelineContact.push(n)}function LoadCampaignsOfContact(n){$("#campaignPipeline").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#campaignPipeline").LoadingOverlay("show"):$("#campaignPipeline").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,pageLength:12,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketing/LoadCampaignsOfContact",type:"POST",data:function(t){return $.extend({},t,{contactId:n})}},columns:[{data:null,orderable:!1,width:"250px",render:function(n,t,i){return pad(i.Id,3)}},{data:"Name",orderable:!1},{data:"Type",orderable:!1},{data:null,orderable:!1,width:"250px",render:function(n,t,i){return'<button class="btn btn-info" onclick="window.location.href=\'/SalesMarketing/SMEmail?id='+i.Id+'\'"><i class="fa fa-eye"><\/i> &nbsp; View<\/button>'}}],order:[[1,"asc"]]})}function SubmitTaskSaleMarketing(){$.LoadingOverlay("show");var n=new FormData($form_task_addedit[0]);$.ajax({type:"POST",url:"/SalesMarketing/SaveSMQbicleTask",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#create-task").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_613"),"Sales Marketing"),$("#tblPipelineTasks").DataTable().ajax.reload(),ResetTask()):cleanBookNotification.error("Have an error!","Sales Marketing")},error:function(n){cleanBookNotification.error("Have an error, detail: "+n.error,"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})}function SaveTaskSaleMarketing(){var i;if(lstDate=[],$("#taskName").val()==""||$("#taskProgrammedStart").val()==""||$("#taskDuration").val()=="0"||$("#taskDescription").val()==""){cleanBookNotification.error(_L("ERROR_MSG_601"),"Task");return}if(i=task_validtabs(),i){if(!ValidateStepsWeight()){cleanBookNotification.error(_L("ERROR_MSG_602"),"Task");$('#taskTabs a[href="#create-task-checklist"]').tab("show");return}if(!isBusyAddTaskForm){$("#hdTaskLastOccurrence").val($("input[name='recur-final']").val());var t="",n="",r=$("#hdTaskRecurrenceType").val();if(r=="0"?(t="",n="",$(".daily").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):r=="1"?(t="",n="",$(".weekly").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):(t="",n="",$(".monthTask").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})),$("#create-task-recurrence").find("input[name=isRecurs]").is(":checked")&&$("#lstDate tbody tr").find("input[type='checkbox']").each(function(){$(this).is(":checked")&&lstDate.push($(this).attr("att-date"))}),$("#create-task-recurrence").find("input[name=isRecurs]").is(":checked")&&lstDate.length<=0){cleanBookNotification.error(_L("ERROR_MSG_603"),"Task");return}$("#hdTaskDayOrMonth").val(t);$("#hdTaskDayOfWeek").val(n);$form_task_addedit.data("validator").settings.ignore=$("input[name=isSteps]").prop("checked")?"":":hidden";$form_task_addedit.valid()?(ReDataStep(),$.ajax({url:"/Tasks/DuplicateTaskNameCheck",data:{cubeId:$("#taskQbicleId").val(),taskKey:$("#taskKey").val(),taskName:$("#taskName").val()},type:"GET",dataType:"json","async":!1}).done(function(n){if(n.result)$form_task_addedit.validate().showErrors({Name:_L("ERROR_MSG_604")});else if($("#taskAttachments").val()){var t=checkfile($("#taskAttachments").val());t.stt?SubmitTaskSaleMarketing():$form_task_addedit.validate().showErrors({taskAttachments:t.err})}else SubmitTaskSaleMarketing()}).fail(function(){$("#form_task_addedit").validate().showErrors({Name:_L("ERROR_MSG_606")})})):task_validtabs()}}}function ProcessSMEventMedia(){$.LoadingOverlay("show");var n=document.getElementById("event-media-upload").files;n&&n.length>0?UploadMediaS3ClientSide("event-media-upload").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#event-object-key").val(n.objectKey);$("#event-object-name").val(n.fileName);$("#event-object-size").val(n.fileSize);SubmitSMEvent()}):SubmitSMEvent()}function SubmitSMEvent(){var n=new FormData(uiEls.$form_event_addedit[0]);$.ajax({type:"POST",url:"/SalesMarketing/SaveEvent",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#create-event").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_614"),"Sales Marketing"),$("#tblPipelineEvents").DataTable().ajax.reload(),ResetEvent()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");isBusyAddTaskForm=!1;LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function SaveQbicleEvent(){if(!isBusyAddEventForm){lstDate=[];$("#hdLastOccurrence").val($("input[name='recur-final-event']").val());var t="",n="",i=$("#hdEventRecurrenceType").val();if(i=="0"?(t="",$(".dailyEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):i=="1"?(t="",$(".weeklyEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})):(t="",$(".monthEvent").each(function(){t+=$(this).attr("att-checked");$(this).is(":checked")&&(n==""?n=$(this).val():n+=","+$(this).val())})),$("#hdDayOrMonth").val(t),$("#hdEventDayOfWeek").val(n),$("#create-event-recurrence").find("input[name=isRecurs]").is(":checked")&&$("#lstEventDate tbody tr").find("input[type='checkbox']").each(function(){$(this).is(":checked")&&lstDate.push($(this).attr("att-date"))}),$("#create-event-recurrence").find("input[name=isRecurs]").is(":checked")&&lstDate.length<=0){cleanBookNotification.error(_L("ERROR_MSG_607"),"Event");return}if(uiEls.$form_event_addedit.valid())$.ajax({url:"/Events/DuplicateEventNameCheck",data:{cubeId:uiEls.$eventQbicleId.val(),eventKey:$eventKey,EventName:$("#eventName").val()},type:"GET",dataType:"json"}).done(function(n){if(n.result)uiEls.$form_event_addedit.validate().showErrors({Name:_L("ERROR_MSG_608")});else if($("#eventAttachments").val()){var t=checkfile($("#eventAttachments").val());t.stt?ProcessSMEventMedia():uiEls.$form_event_addedit.validate().showErrors({eventAttachment:t.err})}else ProcessSMEventMedia()}).fail(function(){uiEls.$form_event_addedit.validate().showErrors({Name:_L("ERROR_MSG_EXCEPTION_SYSTEM")})});else if($("#create-event-overview .error").length)return $('#eventTabs a[href="#create-event-overview"]').tab("show"),!1}}function LoadPipelineTasks(){$("#tblPipelineTasks").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#tblPipelineTasks").LoadingOverlay("show"):$("#tblPipelineTasks").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,deferLoading:30,pageLength:12,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketing/LoadPipelineTasks",type:"POST",data:function(n){return $.extend({},n,{pipelineContactId:$("#pipelineContactId").val()})}},columns:[{data:null,orderable:!1,width:"250px",render:function(n,t,i){return pad(i.Id,3)}},{data:"Title",orderable:!1},{data:"Summary",orderable:!1},{data:"Deadline",orderable:!1},{data:"Status",orderable:!1,render:function(n,t,i){return i.Status==="Pending"?'<span class="label label-info label-lg">Pending<\/span>':i.Status==="In progress"?'<span class="label label-warning label-lg">In progress<\/span>':i.Status==="Overdue"?'<span class="label label-danger label-lg">Overdue<\/span>':'<span class="label label-success label-lg">Complete<\/span>'}}]})}function LoadPipelineEvents(){$("#tblPipelineEvents").on("processing.dt",function(n,t,i){i&&$(".loadingoverlay").length===0?$("#tblPipelineEvents").LoadingOverlay("show"):$("#tblPipelineEvents").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,deferLoading:30,pageLength:12,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketing/LoadPipelineEvents",type:"POST",data:function(n){return $.extend({},n,{pipelineContactId:$("#pipelineContactId").val()})}},columns:[{data:null,orderable:!1,width:"250px",render:function(n,t,i){return pad(i.Id,3)}},{data:"Title",orderable:!1},{data:"StartDate",orderable:!1}]})}function getTotalPagePlace(){var n=$("#txtPlace").val(),t=$("#slArea").val()?$("#slArea").val():0,i=$("#isLoadingHidePlace").is(":checked")?!0:!1;$(".mdv2-col-dash").LoadingOverlay("show");$.ajax({url:"/SalesMarketing/CountListPlace",data:{name:n,areaId:t,isLoadingHide:i},"async":!1,type:"POST",success:function(n){n>0?initPagination(n,placePageSize,"#placePaginateTemplate"):($("#content-place").html(""),$("#placePaginateTemplate").css("display","none"));$(".mdv2-col-dash").LoadingOverlay("hide")},error:function(){$(".mdv2-col-dash").LoadingOverlay("hide")}})}function LoadPlace(n,t){var i=$("#txtPlace").val(),r=$("#slArea").val()?$("#slArea").val():0,u=$("#isLoadingHidePlace").is(":checked")?!0:!1,f;$.LoadingOverlay("show");f=$("#content-place").html();$.ajax({url:"/SalesMarketing/LoadPlace",data:{name:i,areaId:r,skip:n,take:t,isLoadingHide:u},cache:!1,type:"POST","async":!0,success:function(n){$("#content-place").html(n);$("#placePaginateTemplate").css("display","block");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function LoadModelAddSMContact(){$("#app-marketing-contact-add").load("/SalesMarketing/LoadModalAddSMContact",{},function(){$("#Places").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#frm-smcontact-add .multi").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400});$("#frm-smcontact-add .select2").select2({placeholder:"Please select"})})}function ProcessContact(){if($("#frm-smcontact-add").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-contact-upload-media").files;n&&n.length>0&&UploadMediaS3ClientSide("sm-contact-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-contact-object-key").val(n.objectKey);$("#sm-contact-object-name").val(n.fileName);$("#sm-contact-object-size").val(n.fileSize);SubmitSaleMarketingContact()})}}function LoadSMContacts(){$("#tblSMContact").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#tblSMContact").LoadingOverlay("show"):$("#tblSMContact").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,dom:'<"top"fl<"clear">>rt<"bottomtable"ip<"clear">>',serverSide:!0,info:!1,stateSave:!1,bLengthChange:!0,paging:!0,searching:!1,responsive:!0,scrollX:!1,autoWidth:!0,deferLoading:30,pageLength:10,lengthMenu:[[10,20,50,100],[10,20,50,100]],ajax:{url:"/SalesMarketing/LoadSMContact",type:"POST",data:function(n){return $.extend({},n,{search:$("#smContactSearch").val()})}},columns:[{data:"AvatarUri",orderable:!1,width:"80px",render:function(n,t,i){return'<a href="/SalesMarketing/ShowEditSMContract?contactId='+i.Id+'"><div class="table-avatar mini" style="background-image: url('+$("#api").val()+i.AvatarUri+'&size=T);"><\/div><\/a>'}},{data:"Name",orderable:!0},{data:"Email",orderable:!0},{data:"Phone",orderable:!0},{data:"SourceName",orderable:!0},{data:"ReceiveEmail",orderable:!0,render:function(n,t,i){var r;return i.ReceiveEmail=="Yes"?'<span class="label label-lg label-success">Yes<\/span>':'<span class="label label-lg label-danger">No<\/span>'}},{data:null,orderable:!1,width:"250px",render:function(n,t,i){return'<button class="btn btn-primary" style="margin-right:3px" onclick="window.location.href = \'../SalesMarketing/ShowEditSMContract?contactId='+i.Id+'\'"><i class="fa fa-eye"><\/i> &nbsp; Manage<\/button><button class="btn btn-danger" onclick="DeleteSMContact('+i.Id+')"><i class="fa fa-trash"><\/i> &nbsp; Remove<\/button>'}}],order:[[1,"asc"],[2,"asc"],[3,"asc"],[4,"asc"],[5,"asc"]]})}function DeleteSMContact(n){var t=confirm("Do you want remove this record?");t==!0&&($.ajax({url:"/SalesMarketing/DeleteSMContact",data:{id:n},"async":!1,type:"POST",success:function(n){LoadingOverlayEnd();n.result?($("#tblSMContact").DataTable().ajax.reload(),cleanBookNotification.success(_L("ERROR_MSG_240"),"Sales Marketing")):n.msg&&cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}),LoadingOverlayEnd())}function changeCustomCriteria(){var n=[];$(".criteria.select2").each(function(){$(this).val()!=null&&n.push($(this).val())});$("#Options").val(n)}function showImageFromInputFile(n,t){if(n.files&&n.files[0]){var i=new FileReader;i.onload=function(n){$(t).attr("src",n.target.result);$(t).css({display:"block"})};i.readAsDataURL(n.files[0])}}function changeBirthDay(){var t=$("#DateOfBirth").val();if(t){var n=t.split("-"),u=new Date(n[2],n[1]-1,n[0]),f=Date.now()-u.getTime(),e=new Date(f),i=Math.abs(e.getUTCFullYear()-1970),r=!1;$("#AgeRanges option").each(function(){var n=$(this).text().split("-");!r&&n&&i>=parseInt(n[0])&&i<=parseInt(n[1])&&($("#AgeRanges").val($(this).val()).trigger("change"),r=!0)})}}function saveTabActive(n){$.post("/SalesMarketing/SaveTabActive",{tab:n})}function changePipelineContactsToStep(n,t,i){$.ajax({url:"/SalesMarketing/ChangePipelineContactToStep",data:{pipelineContactId:JSON.stringify(n),stepId:t},"async":!1,type:"POST",success:function(n){i&&(n.result?cleanBookNotification.success(_L("ERROR_MSG_615"),"Sales Marketing"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing"));$("#pipeline_step").load("/SalesMarketing/LoadSteps",{pipelineId:$("#pipelineId").val()},function(){$(".column").sortable({connectWith:".column",handle:".portlet-content",revert:0,cancel:".portlet-toggle",placeholder:"portlet-placeholder ui-corner-all",receive:function(n,t){var i=[],r;i.push($(t.item[0]).attr("data-id"));r=$(this).attr("data-id");changePipelineContactsToStep(i,r,!1)}});$(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'><\/span>")})},error:function(){i&&cleanBookNotification.error("Have a error","Sales Marketing")}})}function DBformatOptions(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+($(n.element).attr("LogoUri")==""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function DBformatSelected(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+($(n.element).attr("LogoUri")==""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function LoadModalBrandById(n){$("#app-marketing-brand-add").load("/SalesMarketingBrand/LoadModalBrandById",{id:n},function(){$("#featuredImageUri").select2({placeholder:"Please select"});$(".previewimgbrand").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()})})}function ProcessSaleMarketingBranch(){var n,t;if($("#frm-marketing-brand").valid()){if(n=$("#frm-marketing-brand select[name=FeaturedImageUri]").val(),!n||n=="0"&&!$("#brandFolderName").val()){LoadingOverlayEnd();$frm_marketing_brand.validate().showErrors({FolderName:"This field is required."});return}$.LoadingOverlay("show");t=document.getElementById("sm-brand-upload-image").files;t&&t.length>0?UploadMediaS3ClientSide("sm-brand-upload-image").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-brand-object-key").val(n.objectKey);$("#sm-brand-object-name").val(n.fileName);$("#sm-brand-object-size").val(n.fileSize);SubmitSaleMarketingBranch()}):($("#sm-brand-object-key").val(""),$("#sm-brand-object-name").val(""),$("#sm-brand-object-size").val(""),SubmitSaleMarketingBranch())}}function ShowOrHideBrand(n){$.ajax({url:"/SalesMarketingBrand/ShowOrHideBrand",data:{id:n},type:"POST",success:function(n){n.result?getTotalPageBrand():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function LoadModalSegment(n){$("#app-marketing-segment-add").load("/SalesMarketingSegment/GenerateModalSegmentAddEdit",{segmentId:n},function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$("#segmentType").select2({placeholder:"Please select"});var n=$("#frm-segment");n.validate({ignore:[],rules:{Name:{required:!0,maxlength:150,minlength:3},Summary:{maxlength:250}},invalidHandler:function(){$('#segment-1 label.error:not([style*="display: none"])').length!=0?$('#tabSegment a[href="#segment-1"]').tab("show"):$('#segment-2 label.error:not([style*="display: none"])').length!=0&&$('#tabSegment a[href="#segment-2"]').tab("show")}})})}function ShowOrHideSegment(n){$.ajax({url:"/SalesMarketingSegment/ShowOrHideSegment",data:{id:n},type:"POST",success:function(n){n.result?getTotalPageSegment():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing");LoadingOverlayEnd()},error:function(){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}function RemoveQueue(){var n,t;$.LoadingOverlay("show");n=$("#btnRemoveQueue").attr("data-type");t=n==="SocialCampaign"?"/SalesMarketing/RemoveQueueSchedule":"/SalesMarketing/RemoveEmailQueueSchedule";$.ajax({type:"post",url:t,datatype:"json",data:{campaignId:$("#btnRemoveQueue").attr("data-id")},success:function(t){LoadingOverlayEnd();t.result?(n==="SocialCampaign"?LoadSocicalCampains(!0):LoadEmailCampaigns(!0),cleanBookNotification.success(_L("ERROR_MSG_404"),"Sales Marketing")):cleanBookNotification.error(_L("ERROR_MSG_405"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_405"),"Sales Marketing");LoadingOverlayEnd()}})}function LoadSocialCampaignEditModal(n){$.LoadingOverlay("show");$("#app-marketing-manual-social-campaign-edit").html("");$("#app-marketing-email-campaign-edit").html("");$("#app-marketing-social-campaign-edit").load("/SalesMarketing/SocialCampaignEdit?id="+n,function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".select2").select2({placeholder:"Please select"});var n=$("#frm_marketing-social-campaign_addedit");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});$("#slBrandCampaign").val()&&$("#slBrandCampaign").trigger("change");isValidWorkgroup();n.submit(function(t){var u,i,f;if(t.preventDefault(),u=$("#social-campaign-workgroup").val(),!u){cleanBookNotification.error(_L("ERROR_MSG_168"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(i=$("#social-campaign-folders").val(),!i||i==="0"&&!$("#social-newfolder-name").val()){cleanBookNotification.error(_L("ERROR_MSG_169"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(f=$("#slBrandCampaign").val(),!f){cleanBookNotification.error(_L("ERROR_MSG_170"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(n.valid()){$.LoadingOverlay("show");var r=new FormData(n[0]),e=$("#social-campaign-workgroup option:selected"),o=e.attr("qbicleid"),s=e.attr("topicid");r.append("qbicleFolderId",o);r.append("topicid",s);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:r,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#app-marketing-social-campaign-edit").modal("hide"),LoadSocicalCampains(!0),cleanBookNotification.success(_L("ERROR_MSG_167"),"Sales Marketing")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}else{$(".admintabs a[href=#social-overview]").tab("show");return}});LoadingOverlayEnd()})}function LoadManualSocialCampaignEditModal(n){$.LoadingOverlay("show");$("#app-marketing-email-campaign-edit").html("");$("#app-marketing-social-campaign-edit").html("");$("#app-marketing-manual-social-campaign-edit").load("/SalesMarketing/ManualSocialCampaignEdit?id="+n,function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".select2").select2({placeholder:"Please select"});isValidWorkgroup();$("#slBrandCampaign").val()&&$("#slBrandCampaign").trigger("change");var n=$("#frm_marketing-social-campaign_addedit");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});n.submit(function(t){var u,i,f;if(t.preventDefault(),u=$("#social-campaign-workgroup").val(),!u){cleanBookNotification.error(_L("ERROR_MSG_168"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(i=$("#social-campaign-folders").val(),!i||i==="0"&&!$("#social-newfolder-name").val()){cleanBookNotification.error(_L("ERROR_MSG_169"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(f=$("#slBrandCampaign").val(),!f){cleanBookNotification.error(_L("ERROR_MSG_170"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(n.valid()){$.LoadingOverlay("show");var r=new FormData(n[0]),e=$("#social-campaign-workgroup option:selected"),o=e.attr("qbicleid"),s=e.attr("topicid");r.append("qbicleFolderId",o);r.append("topicid",s);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:r,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#app-marketing-manual-social-campaign-edit").modal("hide"),LoadSocicalCampains(!0),cleanBookNotification.success(_L("ERROR_MSG_167"),"Sales Marketing")):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}else{$(".admintabs a[href=#social-overview]").tab("show");return}});LoadingOverlayEnd()})}function LoadEmailCampaignEditModal(n){$.LoadingOverlay("show");$("#app-marketing-social-campaign-edit").html("");$("#app-marketing-manual-social-campaign-edit").html("");$("#app-marketing-manual-social-campaign-add").html("");$("#app-marketing-email-campaign-edit").load("/SalesMarketing/EmailCampaignEdit?id="+n,function(){$(".checkmulti").multiselect({includeSelectAllOption:!1,enableFiltering:!1,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(".select2").select2({placeholder:"Please select"});isValidWorkgroup();$("#slBrandCampaign").val()&&$("#slBrandCampaign").trigger("change");var n=$("#frm_marketing-email-campaign_edit");n.validate({ignore:"#social-newfolder-name",rules:{Name:{required:!0,minlength:5}}});n.submit(function(t){var u,i,f;if(t.preventDefault(),u=$("#social-campaign-workgroup").val(),!u){cleanBookNotification.error(_L("ERROR_MSG_168"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(i=$("#social-campaign-folders").val(),!i||i==="0"&&!$("#social-newfolder-name").val()){cleanBookNotification.error(_L("ERROR_MSG_169"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(f=$("#slBrandCampaign").val(),!f){cleanBookNotification.error(_L("ERROR_MSG_170"),"Sales Marketing");$(".admintabs a[href=#social-overview]").tab("show");return}if(n.valid()){$.LoadingOverlay("show");var r=new FormData(n[0]),e=$("#social-campaign-workgroup option:selected"),o=e.attr("qbicleid"),s=e.attr("topicid");r.append("qbicleFolderId",o);r.append("topicid",s);$.ajax({type:this.method,cache:!1,url:this.action,enctype:"multipart/form-data",data:r,processData:!1,contentType:!1,beforeSend:function(){isBusy=!0},success:function(n){n.result?($("#app-marketing-email-campaign-edit").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_171"),"Sales Marketing"),LoadEmailCampaigns(!0)):n.msg&&cleanBookNotification.error(n.msg,"Sales Marketing");isBusy=!1;LoadingOverlayEnd()},error:function(){isBusy=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}})}else{$(".admintabs a[href=#social-overview]").tab("show");return}});LoadingOverlayEnd()})}function ReloadFolders(){var t=$("#social-campaign-workgroup option:selected"),n=t.attr("qbicleid");n&&$.getJSON("/SalesMarketing/LoadFoldersByQbicle",{qbicleId:n},function(n){n&&n.length>0&&(n.push({id:0,text:"Create a new folder"}),$("#social-campaign-folders").empty(),$("#social-campaign-folders").append('<option value=""><\/option><option value="0">Create a new folder<\/option>'),$("#social-campaign-folders").select2({data:n,placeholder:"Please select"}),$("#social-campaign-folders").val($("#CurrentFolderId").val()).trigger("change"))})}function changeListSegments(){var t,n;$.LoadingOverlay("show");n=$("#campaignsegments").val();n||(t=$("#campaignsegments option"),n=$.map(t,function(n){return n.value}));$.ajax({type:"post",url:"/SalesMarketing/CountContacts",datatype:"json",data:{lstSegments:n},success:function(n){$("#includedSegments").text(n.Object.lstSegments);$("#totalRecipients").text(n.Object.totalContacts);LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})}function InitDatatableEmailTemplate(){$("#tblEmailTemplates").DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,autoWidth:!1,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketing/GetEmailTemplates"},columns:[{title:"Name",data:"TemplateName",width:"20%",searchable:!0,orderable:!0},{title:"Description",data:"TemplateDescription",width:"50%",searchable:!0,orderable:!0},{title:"Created",data:"CreateDate",searchable:!0,orderable:!0},{title:"Options",data:"Id",searchable:!1,orderable:!1},],columnDefs:[{targets:2,data:"CreateDate",render:function(n,t,i){return n+' by <a href="/Community/UserProfilePage?uId='+i.CreateById+'">'+i.CreateBy+"<\/a>"}},{targets:3,data:"Id",render:function(n){var t='<a href="/SalesMarketing/EmailBuilder?id='+n+'" class="btn btn-warning"><i class="fa fa-pencil"><\/i><\/a> ';return t+('<button type="button" onclick="DeleteEmailTemplate('+n+')" class="btn btn-danger"><i class="fa fa-trash"><\/i><\/button>')}},]})}function DeleteEmailTemplate(n){bootbox.confirm({show:!0,backdrop:!0,closeButton:!0,animate:!0,title:"Sales Marketing",message:_L("ERROR_MSG_708"),callback:function(t){if(t){$.post("/SalesMarketing/DeleteEmailTemplateById",{id:n},function(n){n.result?(cleanBookNotification.success(_L("REMOVE_MSG_SUCCESS"),"Operator"),$("#tblEmailTemplates").DataTable().ajax.reload()):!n.result&&n.msg?cleanBookNotification.error(n.msg):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"))});return}}})}function VerifyEmailSES(){var n=$("#ses-email-identity").val();LoadingOverlay();$.ajax({type:"POST",dataType:"JSON",url:"/SalesMarketing/SendVerifyEmailSES",data:{email:n},success:function(n){n.result?($("#sm-verify-email").modal("hide"),$("#ses-email-identity").val(""),cleanBookNotification.success("Send verification email successfully!","Sales Marketing"),$("#ses-identites-table").DataTable().ajax.reload()):cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){LoadingOverlayEnd()})}function initSESIdentitiesTable(){var n=$("#ses-identites-table").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#ses-identites-table").LoadingOverlay("show",{minSize:"70x60px"}):$("#ses-identites-table").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,ajax:{url:"/SalesMarketing/LoadSESIdentities",type:"POST",data:function(n){return $.extend({},n,{key:"",status:0})}},columns:[{data:"Address",orderable:!0},{data:"Added",orderable:!0},{data:"StatusLabel",orderable:!0},{data:"Options",orderable:!1,render:function(n,t,i){return""+('<button class="btn btn-danger" onclick="removeSESIdentity(\''+i.Id+'\')"><i class="fa fa-trash"><\/i><\/button>')}}]})}function removeSESIdentity(n){var t="/SalesMarketing/DeleteSESIdentity?identityId="+n;$("#ses-identites-table").LoadingOverlay("show",{minSize:"70x60px"});$.ajax({type:"POST",dataType:"JSON",url:t,success:function(n){n.result?(cleanBookNotification.success("Delete identity successfully!","Sales Marketing"),$("#ses-identites-table").DataTable().ajax.reload()):cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){$("#ses-identites-table").LoadingOverlay("hide")})}function UpdateIdentityStatus(){$("#ses-identites-table").LoadingOverlay("show",{minSize:"70x60px"});$.ajax({type:"POST",dataType:"JSON",url:"/SalesMarketing/UpdateSESIdentityStatus",success:function(n){n.result?(cleanBookNotification.success("Update identities status successfully!","Sales Marketing"),$("#ses-identites-table").DataTable().ajax.reload()):cleanBookNotification.error(n.msg,"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){$("#ses-identites-table").LoadingOverlay("hide")})}function CheckEmailVerifyAvailable(){var n=$("#ses-email-identity").val();n!=""?$("#ses-identity-confirm-btn").removeAttr("disabled"):$("#ses-identity-confirm-btn").attr("disabled","disabled")}var skip=0,take=8,totalCamp=0,totalArea=0,totalPlace=0,totalPipeline=0,selectedPipelineContacts=[],selectedPipelineContact=[],uiEls={$form_event_addedit:$("#form_event_addedit"),$eventName:$("#eventName"),$createEvent:$("#create-event"),$singleEventDate:$("#single-event-date"),$eventQbicleId:$("#eventQbicleId")},$frm_campaign_add=$("#frm_marketing-social-campaign_add"),isBusyAddTaskForm=!1,isFacebookPage=!1,brandCountRecord=1,segmentCountRecord=0;$("#load-camp").on("click",function(){LoadSocicalCampains(!1)});$("#load-email-camp").on("click",function(){LoadEmailCampaigns(!1)});ProcessPlaceAdd=function(){if($("#frm-place-addedit").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-place-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-place-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-place-object-key").val(n.objectKey);$("#sm-place-object-name").val(n.fileName);$("#sm-place-object-size").val(n.fileSize);SubmitPlaceAdd()}):($("#sm-place-object-key").val(""),$("#sm-place-object-name").val(""),$("#sm-place-object-size").val(""),SubmitPlaceAdd())}};$("#btnRemovePipelineContact").on("click",function(){removeListPipelineContact(selectedPipelineContacts)});$("#btnMovePipelineContact").on("click",function(){changePipelineContactsToStep(selectedPipelineContact.length!=0?selectedPipelineContact:selectedPipelineContacts,$("#stepId").val(),!0)});SubmitSaleMarketingContact=function(){var n=new FormData($("#frm-smcontact-add")[0]);$.ajax({type:"post",url:"/SalesMarketing/SaveSMContact",data:n,cache:!1,enctype:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-contact-add").modal("hide"),$("#tblSMContact").DataTable().ajax.reload(),cleanBookNotification.success(_L("ERROR_MSG_239"),"Sales Marketing")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Sales Marketing"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})};$("#btnClearSelected").on("click",function(){selectedPipelineContacts=[];$(".alert_matches.projects p").text(selectedPipelineContacts.length+" contacts selected");$('.pipeline-block .portlet.rework input[type="checkbox"]').prop("checked",!1);$(".alert_matches.projects").removeClass("active")});jQuery().sortable&&$(function(){$(".column").sortable({connectWith:".column",handle:".portlet-content",revert:0,cancel:".portlet-toggle",placeholder:"portlet-placeholder ui-corner-all",receive:function(n,t){var i=[],r;i.push($(t.item[0]).attr("data-id"));r=$(this).attr("data-id");changePipelineContactsToStep(i,r,!1)}});$(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'><\/span>");$(".portlet-toggle").on("click",function(){var n=$(this);n.toggleClass("ui-icon-minusthick ui-icon-plusthick");n.closest(".portlet").find(".portlet-content").toggle()})});$('.pipeline-block .portlet.rework input[type="checkbox"]').bind("click",function(){var n,t;$(this).closest(".portlet").toggleClass("toggled");n=$(this).val();$(this).prop("checked")==!0?($(".alert_matches.projects").addClass("active"),selectedPipelineContacts.push(n)):($(".alert_matches.projects").removeClass("active"),t=selectedPipelineContacts.indexOf(n),t!==-1&&selectedPipelineContacts.splice(t,1));$(".alert_matches.projects p").text(selectedPipelineContacts.length+" contacts selected")});SubmitSaleMarketingBranch=function(){var n=new FormData($("#frm-marketing-brand")[0]);$.ajax({type:"post",cache:!1,url:"/SalesMarketingBrand/SaveSaleMarketingBrand",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-brand-add").modal("hide"),isBusyAddTaskForm=!1,cleanBookNotification.success(_L("ERROR_MSG_140"),"Sales Marketing"),getTotalPageBrand()):(cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing"),isBusyAddTaskForm=!1);LoadingOverlayEnd()},error:function(){isBusyAddTaskForm=!1;LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){LoadingOverlayEnd()})};ProcessSegmentAdd=function(){if($("#frm-segment").valid()){$.LoadingOverlay("show");var n=document.getElementById("sm-segment-upload-media").files;n&&n.length>0?UploadMediaS3ClientSide("sm-segment-upload-media").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd("hide");cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#sm-segment-object-key").val(n.objectKey);$("#sm-segment-object-name").val(n.fileName);$("#sm-segment-object-size").val(n.fileSize);SubmitSegmentAdd()}):($("#sm-segment-object-key").val(""),$("#sm-segment-object-name").val(""),$("#sm-segment-object-size").val(""),SubmitSegmentAdd())}};SubmitSegmentAdd=function(){var n=new FormData($("#frm-segment")[0]);$.ajax({type:"post",cache:!1,url:"/SalesMarketingSegment/SaveSegment",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){isBusyAddTaskForm=!0},success:function(n){n.result?($("#app-marketing-segment-add").modal("hide"),cleanBookNotification.success(_L("ERROR_MSG_204"),"Sales Marketing"),getTotalPageSegment()):cleanBookNotification.error(n.msg?n.msg:"Have an error!","Sales Marketing")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Sales Marketing")}}).always(function(){isBusyAddTaskForm=!1;LoadingOverlayEnd()})};$(".previewimg").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});$(".previewimgresource").change(function(){var n=$(this).data("target");readImgURL(this,n);$(n).fadeIn()});$(document).ready(function(){var n,t;if($(".select2avatarDomain").select2({placeholder:"Please select",templateResult:DBformatOptions,templateSelection:DBformatSelected,dropdownCssClass:"withdrop"}),LoadSMContacts(),window.location.pathname.includes("SMApps"))switch(tabConfig){case"True":$('ul#tab-apps a[href="#app-config"]').click();facebookPage==="True"&&(facebookType==="1"?(SocialFacebookPage(),$("#app-marketing-social-facebook-page-add").modal("show"),n=parseInt(facebookPageCount),n===0&&cleanBookNotification.error(_L("ERROR_MSG_401"),"Sales Marketing")):facebookType==="2"&&(SocialFacebookGroup(),$("#app-marketing-social-facebook-group-add").modal("show"),t=parseInt(facebookGroupCount),t===0&&cleanBookNotification.error(_L("ERROR_MSG_402"),"Sales Marketing")));break;case"Contacts":$('ul#tab-apps a[href="#sm-contacts"]').click();$("#tblSMContact").DataTable().ajax.reload();break;case"Contacts.Segments":$('ul#tab-apps a[href="#sm-contacts"]').click();$('ul#tab-contacts a[href="#contacts-segments"]').click();break;case"Contacts.Locations":$('ul#tab-apps a[href="#sm-contacts"]').click();$('ul#tab-contacts a[href="#contacts-locations"]').click();break;case"Contacts.Criteria":$('ul#tab-apps a[href="#sm-contacts"]').click();$('ul#tab-contacts a[href="#contacts-criteria"]').click();break;case"Contacts.Ages":$('ul#tab-apps a[href="#sm-contacts"]').click();$('ul#tab-contacts a[href="#contacts-ages"]').click();break;case"Campaigns.Social":$('ul#tab-apps a[href="#app-ideas"]').click();$('ul#tab-campaigns a[href="#campaigns-social"]').click();break;case"Campaigns.Ideas":$('ul#tab-apps a[href="#app-ideas"]').click();$('ul#tab-campaigns a[href="#app-ideas"]').click();break;case"Campaigns.Emails":$('ul#tab-apps a[href="#app-ideas"]').click();$('ul#tab-campaigns a[href="#campaigns-email"]').click();break;case"Pipelines":$('ul#tab-apps a[href="#app-pipelines"]').click();break;case"Loyalty":$('ul#tab-apps a[href="#app-loyalty"]').click();break;case"Configs":$('ul#tab-apps a[href="#app-config"]').click();break;case"Configs.EmailTemplates":$('ul#tab-apps a[href="#app-config"]').click();setTimeout(function(){$('ul#tab-configs a[href="#smconfig-templates"]').click()},1e3);break;case"Configs.Settings":$('ul#tab-apps a[href="#app-config"]').click();setTimeout(function(){$('ul#tab-configs a[href="#smconfig-0"]').click()},1e3);break;case"Configs.Workgroups":$('ul#tab-apps a[href="#app-config"]').click();setTimeout(function(){$('ul#tab-configs a[href="#smconfig-1"]').click()},1e3);break;case"Configs.EmailVerification":$('ul#tab-apps a[href="#app-config"]').click();setTimeout(function(){$('ul#tab-configs a[href="#smconfig-emails"]').click()},1e3);break;default:$('ul#tab-apps a[href="#app-brands"]').click()}$("#txtSMContact").keyup(SearchThrottle(function(){}));$("#txtArea").keyup(SearchThrottle(function(){getTotalPageArea()}));$("#txtPlace").keyup(SearchThrottle(function(){getTotalPagePlace()}));$("#social-cmp-search").keyup(SearchThrottle(function(){LoadSocicalCampains(!0)}));$("#social-cmp-target-type").change(function(){LoadSocicalCampains(!0)});$("#social-cmp-campaign-type").change(function(){LoadSocicalCampains(!0)});$("#email-campaign-search").keyup(SearchThrottle(function(){LoadEmailCampaigns(!0)}));$("#target-segment-search").change(function(){LoadEmailCampaigns(!0)});$("#brandSearch").keyup(SearchThrottle(function(){getTotalPageBrand()}));$("#isLoadingHideBrand").change(SearchThrottle(function(){getTotalPageBrand()}));$("#isLoadingHideSegment").change(SearchThrottle(function(){getTotalPageSegment()}));$("#isLoadingHidePlace").change(SearchThrottle(function(){getTotalPagePlace()}));$("#isLoadingHideArea").change(SearchThrottle(function(){getTotalPageArea()}));$("#isLoadingHidePipeline").change(SearchThrottle(function(){getTotalPagePipeline()}));$("#isLoadingHideIdea").change(SearchThrottle(function(){getTotalPageIdea()}));$("#txtIdeaKeyword").keyup(SearchThrottle(function(){getTotalPageIdea()}));$("#txtCriteriaSearch").keyup(SearchThrottle(function(){$("#tblCriteriaDef").DataTable().search($("#txtCriteriaSearch").val()).draw(!1)}));$("#txtPipeline").keyup(SearchThrottle(function(){getTotalPagePipeline()}));SocialContactCriteriaAdd();Array.prototype.remove=function(n){for(var t in this)this[t].toString()==n.toString()&&this.splice(t,1)}});