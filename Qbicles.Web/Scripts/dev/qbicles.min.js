function formatOptions(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+($(n.element).attr("LogoUri")===""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function formatSelected(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+($(n.element).attr("LogoUri")===""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function AddnewQbicleClick(){$("#close-reopen-qbicle").hide();$selectDomain.removeAttr("disabled","");ClearError();$("#qbicleImg2").attr("src","");$("#qbicleImg2").css({display:"none"});$("#btnPrevious").click();$("#form_qbicle_addedit2").find('[name="qbicName"]').focus();$modal_group_title.text($("input[name='modal_add_title']").val())}function ClearInputModalAddEdit(){$qbicName.val("");$qbicImage.val("");$("#qbicleImg2").attr("src","");$qbicDescription.val("");$("#qbicUserDomainSelect2").val(currentUserId).trigger("change");$("#managerId").val(currentUserId).trigger("change");ClearError()}function SaveQbicleFromDomain(){$qbicName.val()===""?($("#btnPrevious").click(),$("#form_qbicle_addedit2").valid()):QbicleValidationForm()}function QbicleValidationForm(){$("#form_qbicle_addedit2").valid()&&$.ajax({url:"/Qbicles/DuplicateQbicleNameCheck",data:{key:"0",qbicName:$qbicName.val()},type:"GET",dataType:"json"}).done(function(n){n.result?($("#btnPrevious").click(),$("#form_qbicle_addedit2").validate().showErrors({Name:_L("ERROR_MSG_41")})):ProcessQbicleDomainLogo()}).fail(function(){$("#btnPrevious").click();setTimeout(function(){$("#form_qbicle_addedit2").validate().showErrors({Name:_L("ERROR_MSG_42")})},100)})}function ProcessQbicleDomainLogo(){$.LoadingOverlay("show");var n=document.getElementById("qbicImage2").files;n&&n.length>0?UploadMediaS3ClientSide("qbicImage2").then(function(n){if(n.objectKey==="no_image"||n.objectKey==="no-image"){LoadingOverlayEnd();cleanBookNotification.error(_L("ERROR_MSG_S3_UPLOAD"),"Qbicles");return}$("#qbicle-domain-logo-uri").val(n.objectKey);QbiclesDomainSubmit()}):QbiclesDomainSubmit()}function ApplySearch(){$("#qbicles-list").LoadingOverlay("show");var n={Open:$checkOpen.is(":checked"),Closed:$checkClosed.is(":checked"),Name:$nameSearch.val(),Peoples:$selectPeople.val(),Topics:$selectTopic.val(),order:$("#order :selected").val(),IsShowHidden:$("#isShowHidden").is(":checked")?!0:!1};$("#remove-filters").removeAttr("disabled");$.ajax({type:"post",url:"/Qbicles/ApplyFilterQbicle",data:n,dataType:"html",success:function(n){n!==""&&($("#qbicles-dash-grid").empty(),$("#qbicles-dash-grid").append(n))},error:function(){}}).always(function(){$("#qbicles-list").LoadingOverlay("hide",!0)})}function ShowOrHideQbicle(n,t){$.ajax({type:"post",url:"/Qbicles/ShowOrHideQbicle",data:{key:n,isHidden:!t},dataType:"json",success:function(n){n.result?ApplySearch():cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function ConfigQbicle(n){$("#qbicId").val(n)}function RemoveFilter(){$checkOpen.prop("checked",!0).trigger("change");$checkClosed.prop("checked",!1).trigger("change");$nameSearch.val("");$selectPeople.val("").trigger("change");$selectTopic.val("").trigger("change");$("#order").val(4).trigger("change");$("#isShowHidden").bootstrapToggle("off");ApplySearch();$("#remove-filters").attr("disabled","disabled")}function UpdateQbiclesSettings(){$.LoadingOverlay("show");var n=$form[0];$.ajax({type:n.method,cache:!1,url:"/Qbicles/SaveQbicle",enctype:"multipart/form-data",data:new FormData(n),processData:!1,contentType:!1,beforeSend:function(){},success:function(n){n.result?($qbicleModal.modal("toggle"),cleanBookNotification.updateSuccess(),location.reload(!0),ApplySearch!==undefined&&ApplySearch()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");setTimeout(function(){$.LoadingOverlay("hide")},500)},error:function(){setTimeout(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$.LoadingOverlay("hide")},500)}})}function GetQbicle(n){return $.ajax({url:"/Qbicles/GetQbicle",type:"GET",dataType:"json",data:{key:n}})}var loadImg,loadImgCreateQbicle;$.fn.modal.prototype.constructor.Constructor.DEFAULTS.backdrop="static";$.fn.modal.prototype.constructor.Constructor.DEFAULTS.keyboard=!1;var $qbicleCreateModal=$("#create-qbicle"),$modal_group_title=$("#create-qbicle [class='modal-title']"),$form_qbicle_addedit2=$("#form_qbicle_addedit2"),$qbicName=$("#qbicName2"),$qbicImage=$("#qbicImage2"),$qbicDescription=$("#qbicDescription2"),$qbicScopeSelect=$("#qbicScopeSelect"),$qbicUserDomainSelect=$("#qbicUserDomainSelect2"),$selectDomain=$("#domainId"),$open_close=0,$cubeOpen=!0,$cubeClosed=!0,$cubePublic=!0,$cubePrivate=!0,$cubeSearch="",$checkPublic=$("#checkPublic"),$checkPrivate=$("#checkPrivate"),$checkOpen=$("#checkOpen"),$checkClosed=$("#checkClosed"),$selectPeople=$("#filter-people"),$selectTopic=$("#filter-topics"),$nameSearch=$("#searchQbicles"),$qbicleGuests=$("#qbicleGuests");jQuery(function(n){n(".td-scroll-up").click(function(){n("html, body").animate({scrollTop:"0px"},"slow")});var t=setInterval(function(){if(document.readyState==="complete"){setTimeout(function(){n(".td-scroll-up").click()},200);clearInterval(t);return}},200);$qbicUserDomainSelect.on("select2:unselecting",function(n){n.params.args.data.id===currentUserId&&n.preventDefault()});$selectDomain.change(function(){n("#loadingAddEditGif").show();n("#selectUser").hide();var t=n(this).find("option:selected");n.ajax({type:"post",url:"/Domain/GetUsersByDomainId",datatype:"json",data:{domainId:t.val()},success:function(t){t.result&&$qbicUserDomainSelect.empty().append(t.Object);n("#loadingAddEditGif").hide();n("#selectUser").show()}})});n("#qbicleNameSelected").text("@Model.Name");n("#qbicleLogoSelect").attr("src","");n("#qbicleGuests").on("beforeItemAdd",function(t){var i=t.item;if(!t.options||!t.options.preventPost){if(validateEmail(i))return n.ajax({type:"post",url:"/Account/CheckUserEmailInSystem",datatype:"json",data:{userEmail:t.item},success:function(r){r.result&&(n("#qbicleGuests").tagsinput("remove",i,{preventPost:!0}),t.item=r.msg,n("#qbicleGuests").tagsinput("add",t.item,{preventPost:!0}))}}),t;t.cancel=!0}});n(".select2avatarDomain").select2({placeholder:"Please select",templateResult:formatOptions,templateSelection:formatSelected,dropdownCssClass:"withdrop"});n(".select2avatar").select2({placeholder:"Please select",templateResult:formatOptions,templateSelection:formatSelected});n("#searchQbicles").keyup(delay(function(){ApplySearch()},1e3));n("#order").on("change",function(){ApplySearch()});n("#isShowHidden").on("change",function(){ApplySearch()})});loadImg=function(n){var t=document.getElementById("qbicleImg");t.src=URL.createObjectURL(n.target.files[0])};loadImgCreateQbicle=function(n){$("#qbicleImg2").attr("src",URL.createObjectURL(n.target.files[0]));$("#qbicleImg2").css({display:"block"})};QbiclesDomainSubmit=function(){var n=new FormData(document.getElementById("form_qbicle_addedit2"));$.ajax({type:"post",cache:!1,url:"/Qbicles/SaveQbicle",enctype:"multipart/form-data",data:n,processData:!1,contentType:!1,beforeSend:function(){},success:function(n){n.result?($qbicleCreateModal.modal("toggle"),cleanBookNotification.updateSuccess(),ClearInputModalAddEdit(),ApplySearch()):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")},error:function(){setTimeout(function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles");$.LoadingOverlay("hide")},2e3)}}).always(function(){LoadingOverlayEnd()})};var $qbicleModal=$("#edit-qbicle"),$form=$("#form_qbicle_addedit"),previous_shown=!1,$isFilter=!1,isServerBusy=!1;