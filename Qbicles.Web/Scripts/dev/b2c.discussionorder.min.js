function loadCurrencySettings(){var n=$("#domainid").val(),t="/Qbicles/GetCurrencySettings";n!=null&&(t="/Qbicles/GetCurrencySettingsByDomain?domainId="+n);$.ajax({url:t,type:"get","async":!1,success:function(n){currencySetting=n?n:{currencyGroupSeparator:",",CurrencySymbol:"",SymbolDisplay:0,DecimalPlace:2}},error:function(){cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Qbicles")}})}function initOrderItemsShow(){var n=$("#items-container"),t=$("#pagiation-items");t.pagination({dataSource:"/B2C/SearchB2COrderItems",locator:"items",totalNumberLocator:function(t){return n.LoadingOverlay("hide"),t.totalNumber},pageSize:6,ajax:{data:{scatids:JSON.stringify($("#orer-item-search-categories").val()),keyword:$("#orer-item-search-text").val(),bdomainKey:$("#domain-key").val()},beforeSend:function(){n.LoadingOverlay("show")}},callback:function(t){var u=t.length,f=(u%3==0?0:3)-u%3,i="",r;for($.each(t,function(n,t){i+=itemTemplate(t)}),r=0;r<f;r++)i+='<div class="col">&nbsp;<\/div>';n.html(i)}})}function itemTemplate(n){var i=$("#domain-key").val(),t='<div class="col"><a href="#product-more-menu" data-toggle="modal" onclick="showItemContent('+n.Id+",'"+i+"')\">";return t+='<div class="productimg" style="background-image: url(\''+n.ImageUri+"');\"><\/div >",t+='<div class="priceblock">',t+="<p>"+n.Name+"<\/p>",t+='<label class="label label-lg label-soft">'+n.CategoryName+"<\/label> &nbsp; <span>"+n.Price+"<\/span><\/div>",t+"<\/a><\/div>"}function showOrderCartB2C(n){if((n!=null||n!=undefined)&&($cartbusy=n),$cartbusy==!1){$("#cart").LoadingOverlay("show");$("#order-cart-tab").empty();$cartbusy=!0;var t=$("#discussionKey").val(),i=$("#domain-key").val(),r="/B2C/B2COrderCartShow?disKey="+t+"&domainKey="+i;$("#order-cart-tab").load(r,function(){$("#cart").LoadingOverlay("hide",!0);$cartbusy=!1;OrderProcessedCheck()})}}function showItemContent(n,t){var i=$("#tradeorderid").val(),r="/B2C/B2COrderItemContentShow?itemId="+n+"&domainKey="+t+"&orderId="+i;LoadingOverlay();$("#item-content-modal").empty();$("#item-content-modal").load(r);$("#item-content-modal").modal("show");LoadingOverlayEnd()}function AddItemToB2COrder(n){var i,r;$("#add-new-item-to-order-modal").LoadingOverlay("show");var u=$("#tradeorderid").val(),f=$("#isCustomerDiscussion").val(),e={Id:u},o={Id:$posVariantSelected.Id,Price:_.toNumber($posVariantSelected.Price),ImageUri:_.isEmpty($posVariantSelected.ImageUri)?$("#variant-image").val():$posVariantSelected.ImageUri},t=[],s=$("#item-extras div label div input");_.forEach(s,function(n){if($("#"+n.id).prop("checked")){var i=$("#"+n.id).attr("extra-id"),r=parseFloat($("#"+n.id).val()),u={Id:i,Price:r};t.push(u)}});i=parseInt($("#item-quantity").val());r=parseFloat($("#order-total-prices").attr("value"));$.ajax({type:"POST",url:"/B2C/AddItemToB2COrder",data:{disKey:$("#discussionKey").val(),b2cOrder:e,variant:o,extras:t,quantity:i,includedTaxAmount:r,posItemId:n,voucherId:$("#voucher-seleced-id").val()},datatype:"JSON",success:function(n){if(n.result==!1){cleanBookNotification.error(n.msg,"Qbicles");return}if(n.result==!0&&cleanBookNotification.success("Add item to B2C Order successfully","Qbicles"),$("#item-content-modal").modal("hide"),f=="true"){var t=Number($("#item-count").text());$("#item-count").text(t+1)}else reloadDataTable()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#add-new-item-to-order-modal").LoadingOverlay("hide",!0)})}function removeItemFromB2COrder(n){$("#cart").LoadingOverlay("show");var t=$("#discussionKey").val();$.ajax({method:"POST",dataType:"JSON",url:"/B2C/RemoveItemFromB2COrder?disKey="+t+"&itemId="+n,success:function(){showOrderCartB2C()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#cart").LoadingOverlay("hide",!0)})}function businessRemoveB2COrderItem(n){if(confirm("Do you want to completely remove this item from the cart?")){$("#cart").LoadingOverlay("show");var t=$("#discussionKey").val();$("#order-list").LoadingOverlay("show",!0);$.ajax({method:"POST",dataType:"JSON",url:"/B2C/RemoveItemFromB2COrder?disKey="+t+"&itemId="+n,success:function(){reloadDataTable()},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#order-list").LoadingOverlay("hide",!0)})}}function customerAcceptOrder(n){$("#frmCustomerDelivery").LoadingOverlay("show");var t=$("#discussionKey").val();$.ajax({method:"POST",dataType:"JSON",data:$("#frmCustomerDelivery").serialize(),url:"/B2C/setB2COrderAcceptedByCustomer?disKey="+t,success:function(t){t.result?(cleanBookNotification.updateSuccess(),$(n).css("display","none"),$("#processing").css("display",""),$("#customer-order-processing-modal").modal("show")):!t.result&&t.msg?cleanBookNotification.error(_L(t.msg),"Qbicles"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles");$("#btnAgreeTerms").removeAttr("disabled")}}).always(function(){$("#frmCustomerDelivery").LoadingOverlay("hide",!0)})}function LoadMorePostsDiscussionOrder(n,t,i){$("#"+i).LoadingOverlay("show");$("#btnLoadPosts").hide();$.ajax({url:"/Qbicles/LoadMoreActivityPosts",data:{activityKey:n,size:CountPost*t,isDiscussionOrder:!0},cache:!1,type:"POST",dataType:"html",beforeSend:function(){},success:function(n){if(n===""){$("#btnLoadPosts").remove();return}$("#btnLoadPosts").show();$("#"+i).append(n).fadeIn(250);CountPost=CountPost+1;var t=$(".mdv2-col-user");t.animate({scrollTop:t.prop("scrollHeight")},500)},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles")}}).always(function(){$("#"+i).LoadingOverlay("hide",!0)})}function UpdateOrderItemInfo(n){var t=$("#tradeorderid").val(),i={Id:n,Variant:{Discount:parseFloat($("#itemdiscount"+n).val())}};$.ajax({method:"POST",dataType:"JSON",url:"/B2C/UpdateItemInfor",data:JSON.stringify({disKey:$("#discussionKey").val(),tradeOrderId:t,updatedItem:i}),contentType:"application/json",success:function(n){n.result?(reloadDataTable(),$("#totalpricestr").text(currencySetting.CurrencySymbol+Number(n.Object).toFixed(currencySetting.DecimalPlace))):cleanBookNotification.error(n.msg)},error:function(n){cleanBookNotification.error(n.msg)}}).always(function(){LoadingOverlayEnd()})}function B2COrderProcessingModalShow(){var n=$("#discussionKey").val();$("#used-default-settings").val()=="false"?ShowWorkgroupsModal(n):($("#business-order-manage").LoadingOverlay("show"),$.ajax({method:"POST",dataType:"JSON",url:"/B2C/ProcessB2COrderUseDefaultWorkgroupSettings",data:{tradeOrderId:$("#tradeorderid").val(),disKey:n},success:function(t){t.result?(cleanBookNotification.updateSuccess(),$(".submit-options").attr("style","display: none"),$(".submit-note").show(),OrderProcessedCheck(),$(".datatable input[type=number]").prop("disabled","true")):(ShowWorkgroupsModal(n),cleanBookNotification.warning("Missing default workgroup settings","Qbicles"))},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#business-order-manage").LoadingOverlay("hide",!0)}))}function ShowWorkgroupsModal(n){var t="/B2C/OrderProcessingModal?disKey="+n;LoadingOverlay();$("#order-processing-modal").empty();$("#order-processing-modal").load(t);$("#order-processing-modal").modal("show");LoadingOverlayEnd()}function initOrderProcessingForm(){var n=$("#orderprocessing-frm");n.validate({rule:{paymentacc:{required:!0},salewg:{required:!0},invoicewg:{required:!0},paymentwg:{required:!0},transferwg:{required:!0}}});n.submit(function(t){t.preventDefault();n.valid()&&($("#order-processing-modal").modal("hide"),$("#business-order-manage").LoadingOverlay("show"),$.ajax({method:"POST",dataType:"JSON",url:"/B2C/ProcessB2COrder",data:{tradeOrderId:$("#tradeorderid").val(),PaymentAccId:$("#paymentacc").val(),disKey:$("#discussionKey").val(),SaleWGId:$("#salewg").val(),InvoiceWGId:$("#invoicewg").val(),PaymentWGId:$("#paymentwg").val(),TransferWGId:$("#transferwg").val()},success:function(n){n.result?(cleanBookNotification.updateSuccess(),$(".submit-options").attr("style","display: none"),$(".submit-note").show(),$("#b2c-order-status").text("Processing"),$("#b2c-order-status").removeClass().addClass("label label-lg label-info"),$("#add-invoice-button").removeAttr("disabled"),$(".datatable input[type=number]").prop("disabled","true"),OrderProcessedCheck()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#business-order-manage").LoadingOverlay("hide",!0)}))})}function checkForSubmitAbility(){var n=$("#paymentacc").val(),t=$("#salewg").val(),i=$("#invoicewg").val(),r=$("#paymentwg").val(),u=$("#transferwg").val();n!=""&&t!=""&&i!=""&&r!=""&&u!=""?$("#orderprocessing-frm").find("button[type=submit]").removeAttr("disabled"):$("#orderprocessing-frm").find("button[type=submit]").attr("disabled","disabled")}function updateOrderItemQuantity(n){$("#cart").LoadingOverlay("show");$("#order-list").LoadingOverlay("show");clearTimeout(delayTimer);delayTimer=setTimeout(function(){var r={Id:$("#tradeorderid").val()},t=$("#quantity"+n).val(),i;t<=0&&cleanBookNotification.warning("The quantity of the item must be greater than 0. The wrong quantity number will be reset to 1");i="/B2C/ChangeOrderItemQuantity";$.ajax({method:"POST",dataType:"JSON",url:i,data:{disKey:$("#discussionKey").val(),b2cOrder:r,newQuantity:t,itemId:n},success:function(n){n.result?(cleanBookNotification.updateSuccess(),showOrderCartB2C(),reloadDataTable()):cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n.msg,"Qbicles")}}).always(function(){$("#cart").LoadingOverlay("hide",!0);$("#order-list").LoadingOverlay("hide",!0)})},1e3)}function reloadDataTable(){currencySetting||loadCurrencySettings();reloadStatusSubmit();$("#voucher-applied-info").hide();$("#voucher-applied-name").html("");$("#voucher-applied-code").html("");$("#voucher-seleced-id").val(0);$("#order-list").DataTable().ajax.reload(function(n){n.data[0]!=null?($("#totalpricestr").text(currencySetting.CurrencySymbol+n.data[0].TotalPrice.toFixed(currencySetting.DecimalPlace)),parseFloat(n.data[0].VoucherId)>0&&($("#voucher-applied-info").show(),$("#voucher-applied-name").html(n.data[0].VoucherName),$("#voucher-applied-code").html(n.data[0].VoucherCode),$("#voucher-seleced-id").val(parseFloat(n.data[0].VoucherId)))):$("#totalpricestr").text(currencySetting.CurrencySymbol+Number(0).toFixed(currencySetting.DecimalPlace))})}function reloadStatusSubmit(){var n=$("#tradeorderid").val();$.get("/B2C/GetIsAgreedByCustomer?oid="+n,function(n){$("#proceed").prop("disabled",!n.isAgreedByCustomer);n.isAgreedByBoth&&$(".submit-options").attr("style","display: none");n.customerInfo&&$(".customer-info").html(n.customerInfo);console.log("--------------reloadStatusSubmit-dev------------------");console.log(n.orderStatus);console.log("--------------End reloadStatusSubmit-dev------------------");$("#b2c-order-status").text(n.orderStatus);$("#b2c-order-status").removeClass().addClass("label label-lg label-"+n.orderStatusCss)})}function activeInteraction(n,t){$.post("/B2C/ActiveInteraction",{disId:n},function(n){n.result?($("#store").addClass("mdlock"),$("#talktoagent").show(),$(t).parent().hide()):!n.result&&n.msg?cleanBookNotification.error(_L(n.msg),"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community")})}function managedelivery(n){var t=$(n).val();t==1?($(".address-them").show(),$(".methods").show(),$(".note-desc").text("Delivery note (optional)")):t==2?($(".address-them").hide(),$(".methods").hide(),$(".note-desc").text("Note: (enter notes for pickup)")):t==0&&($(".address-them").hide(),$(".methods").show(),$(".note-desc").text("Delivery note (optional)"));$(".note-box").show();validAgreeTerms()}function addAppendOptionAddress(n){var t=$("select[name=delivery]"),i;t.find("option[value='"+n.Id+"']").length?t.val(n.Id).trigger("change"):(i=new Option(n.Address,n.Id,!0,!0),$(".add-new-address").before(i),t.val(n.Id).trigger("change"))}function validAgreeTerms(){var r=$("#receive-method-selector"),n=r.val(),i=$("select[name=delivery]").val(),u=$("input[name=someoneName]").val(),t=$("li.basket-item").length;t>0&&n==1&&u&&i?$("#btnAgreeTerms").removeAttr("disabled"):t>0&&n==0&&i?$("#btnAgreeTerms").removeAttr("disabled"):t>0&&n==2?$("#btnAgreeTerms").removeAttr("disabled"):$("#btnAgreeTerms").attr("disabled",!0)}function initFormSaveAddress(){var n=$("#frmuseraddressadd");n.submit(function(t){(t.preventDefault(),$cartbusy)||n.valid()&&($.LoadingOverlay("show"),$.ajax({type:this.method,cache:!1,url:this.action,data:$(this).serialize(),dataType:"json",beforeSend:function(){$cartbusy=!0},success:function(n){n.result?(n.Object&&addAppendOptionAddress(n.Object),$("#user-address-add").modal("hide"),cleanBookNotification.success(_L("UPDATE_MSG_SUCCESS"),"Community")):!n.result&&n.msg?cleanBookNotification.error(n.msg,"Community"):cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community");$cartbusy=!1;LoadingOverlayEnd()},error:function(){$cartbusy=!1;cleanBookNotification.error(_L("ERROR_MSG_EXCEPTION_SYSTEM"),"Community");LoadingOverlayEnd()}}))})}function MethodChange(){var n=$("#pay-method").val();$("#pay-reference").val("");n=="Card"||n=="Electronic Transfer"?$("#pay-card").show():$("#pay-card").hide()}function ValidPaymentAmount(){var t=parseFloat($("#payment-total").val()),i=parseFloat($("#b2c-payment-total").val()),r=parseFloat($("#pay-amount").val()),n=i-t;return i<t+r?(cleanBookNotification.warning("Amount to pay must be less than "+n,"Qbicles"),$("#pay-amount").val(n),$("#confirm-payment").addClass("disabled"),$("#confirm-payment").attr("disabled"),!1):n===0?($("#confirm-payment").addClass("disabled"),$("#confirm-payment").attr("disabled"),cleanBookNotification.warning("Paid out, can't create a new one","Qbicles"),!1):($("#confirm-payment").removeAttr("disabled"),$("#confirm-payment").removeClass("disabled"),!0)}function ShowPaystackPaymentPopup(n){ValidPaymentAmount()&&$.ajax({type:"post",url:"/B2C/GetB2COrerPaymentPaystackPopupData",data:{tradeOrderKey:n},dataType:"json",success:function(t){if(t.result){var i=t.Object;if($("#pay-amount").val(i.amount),Number(i.chargeAmount)>0){let t=PaystackPop.setup({key:i.publicKey,email:i.userEmail,amount:i.amount*100,subaccount:i.subAccCode,transaction_charge:i.chargeAmount,bearer:"subaccount",onClose:function(){},callback:function(){CreateB2CPayment(n,!1,!0)}});t.openIframe()}else{let t=PaystackPop.setup({key:i.publicKey,email:i.userEmail,bearer:"subaccount",amount:i.amount*100,subaccount:i.subAccCode,onClose:function(){},callback:function(){CreateB2CPayment(n,!0,!0)}});t.openIframe()}}else cleanBookNotification.error(t.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}})}function CreateB2CPayment(n,t,i){(t!=!1||ValidPaymentAmount())&&(LoadingOverlay("show"),$.ajax({type:"post",url:"/B2C/CreateB2CPayment",data:{tradeOrderId:n,isCutomer:i,payment:{Amount:$("#pay-amount").val(),Reference:$("#pay-reference").val(),PaymentMethod:{Name:$("#pay-method").val()}}},dataType:"json",success:function(n){if(n.result){ReloadPaymentTab();$("#cart-li-tab").removeClass();$("#order-cart-tab").removeClass().addClass("tab-pane fade");$(".payment-tab a").trigger("click");reloadStatusSubmit();var t=parseFloat($("#payment-total").val()),i=parseFloat($("#pay-amount").val());$("#payment-total").val(t+i);$(".search_dt_payment").show();cleanBookNotification.createSuccess()}else cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){LoadingOverlayEnd()}))}function SelectedVoucher(n,t,i){$("#choosevoucher").hide();$("#voucher-name").html(t);$("#voucher-code").html(i);$("#voucher-seleced-id").val(n);$("#voucher").show();ApplyVoucherOrderB2C(n)}function RemoveVoucher(){$("#voucher").hide();$("#choosevoucher").show();$("#voucher-name").html("");$("#voucher-code").html("");$("#voucher-seleced-id").val(0);ApplyVoucherOrderB2C(0)}function ApplyVoucherOrderB2C(n){$("#cart").LoadingOverlay("show");$.ajax({type:"post",url:"/B2C/ApplyVoucherOrderB2C",data:{discussionKey:$("#discussionKey").val(),tradeOrderId:$("#tradeorder-key").val(),voucherId:n},dataType:"json",success:function(n){n.result?showOrderCartB2C():cleanBookNotification.error(n.msg,"Qbicles")},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){$("#cart").LoadingOverlay("hide",!0)})}function AddInvoicePayment(){$("#pay-amount").val(0);$("#pay-amount").removeClass("disabled");$("#pay-method").val("Cash").trigger("change");$("#confirm-payment").removeAttr("disabled");$("#confirm-payment").removeClass("disabled");$("#b2c-payment-add").modal("toggle")}function OrderProcessedCheck(){$.ajax({type:"post",url:"/B2C/OrderProcessedCheck",data:{disKey:$("#discussionKey").val()},dataType:"json",success:function(n){n.Processed&&($(".payment-total-text").text(n.InvoiceTotalTxt),$("#payment-remain-amount").val(n.PaymentRemain),$("#pay-now-text").text(n.PaymentRemainTxt),$("#b2c-payment-total").val(n.SaleTotal),$("#b2c-order-invoice-id").val(n.InvoiceKey),$("#add-invoice-button").attr("disabled",!1),$(".pay-tab-header").remove(),$(".search_dt_payment").show(),$("#tab4").removeAttr("style"))},error:function(n){cleanBookNotification.error(n,"Qbicles")}}).always(function(){})}function UpdateB2COrderStatus(n){var r=$("#discussionId").val(),t="",i="";n==0&&(t="Awaiting processing",i="label label-lg label-primary");n==1?(t="Processing",i="label label-lg label-info",$("#cart-li-tab a").trigger("click")):n==2||n==3?(t="Ready for payment",i="label label-lg label-warning",showOrderCartB2C()):n==4&&(t="Complete",i="label label-lg label-success",showOrderCartB2C());$("#b2c-order-status").text(t);$("#b2c-order-status").removeClass().addClass(i);$("#order-context-flyout-status-"+r).text(t);$("#order-context-flyout-status-"+r).removeClass().addClass(i)}function DisplayPaymentTabToCustomer(){$(".payment-tab").show()}function ReloadPaymentTab(){var n="/TraderPayments/InvoicePaymentContent?key="+$("#b2c-order-invoice-id").val();$("#tab4").empty();$("#tab4").load(n,function(){LoadingOverlayEnd();$(".payment-tab").show()})}var CountPost=1,currencySetting,$cartbusy,delayTimer,refreshIntervalId;busycomment=!1;currencySetting={CurrencySymbol:0,DecimalPlace:0};$cartbusy=!1;$(document).ready(function(){loadCurrencySettings();$(".select2modal").select2();$(".toggle-switch").bootstrapToggle();initFormSaveAddress();$("#user-address-add").on("hidden.bs.modal",function(){var n=$("#slDeliveryAddress").val();n==0&&$("#slDeliveryAddress").val("").trigger("change")});$("#orer-item-search-text").keyup(delay(function(){initOrderItemsShow()},500));$("#orer-item-search-categories").change(function(){initOrderItemsShow()});$("#order-search-key").keyup(delay(function(){$("#order-list").DataTable().ajax.reload()},500));$("#order-search-categories").change(function(){$("#order-list").DataTable().ajax.reload()});$("#b2c-order-tab-menu li").click(function(){$("#tab4").removeAttr("style")})});initCustomerDiscussionPage=function(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});initOrderItemsShow();showOrderCartB2C()};initBusinessDiscussionPage=function(){$(".checkmulti").multiselect({includeSelectAllOption:!0,enableFiltering:!0,buttonWidth:"100%",maxHeight:400,enableClickableOptGroups:!0});$(document).ready(function(){initOrderItemsTable()});initOrderItemsShow()};initOrderItemsTable=function(){currencySetting||loadCurrencySettings();$("#order-list").on("processing.dt",function(n,t,i){$("#processingIndicator").css("display","none");i?$("#order-list").LoadingOverlay("show"):$("#order-list").LoadingOverlay("hide",!0)}).DataTable({destroy:!0,serverSide:!0,paging:!0,searching:!1,responsive:!0,lengthMenu:[[5,10,20,50,100],[5,10,20,50,100]],pageLength:5,ajax:{url:"/B2C/LoadB2COrderItems",type:"POST",data:function(n){return $.extend({},n,{discussionKey:$("#discussionKey").val(),searchKey:$("#order-search-key").val()})}},columns:[{data:"ItemName",orderable:!0,render:function(n,t,i){var r="",u;if(i.SourceName!=""){if(r+=i.ItemName,r+=" <i class='fa fa-info-circle blue' data-tooltip='Source item: "+i.SourceName+"'><\/i>",r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',i.CatItemHasMultipleVariants?(r+='<div class="col-xs-6">',r+="<h6>"+i.Variant.Name+"<\/h6>",r+="<\/div>"):(r+='<div class="col-xs-6">',r+="<h6><\/h6>",r+="<\/div>"),r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Variant.AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>",i.Extras!=null)for(u=0;u<i.Extras.length;u++)r+='<div class="row cartitemxtra" style="margin-top: 10px; padding: 0;">',r+='<div class="col-xs-6">',r+="<h6> + "+i.Extras[u].Name+"<\/h6>",r+="<\/div>",r+='<div class="col-xs-6 text-right">',r+="<h6>"+currencySetting.CurrencySymbol+" "+i.Extras[u].AmountInclTax.toFixed(currencySetting.DecimalPlace)+"<\/h6><\/div>",r+="<\/div>",r+="<\/div>"}else r+=i.ItemName;return r}},{data:"CategoryName",orderable:!0},{data:"Quantity",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<input type='number' min='1' itemId='"+i.ItemId+"' "+r+"  id='quantity"+i.ItemId+"' class='form-control quantity-item' value='"+i.Quantity+"' onchange=\"updateOrderItemQuantity("+i.ItemId+');">'}},{data:"ItemInitialPrice",orderable:!1,render:function(n,t,i){return i.ItemInitialPrice.toFixed(currencySetting.DecimalPlace)}},{data:"Discount",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?"":"disabled";return"<input type='number' min='0' max='100' itemId='"+i.ItemId+"' "+r+"  id='itemdiscount"+i.ItemId+"' class='form-control itemdiscount' value='"+i.Discount+"'>"}},{data:"TaxInfo",orderable:!1},{data:"PriceString",orderable:!1,className:"price"},{data:"ItemId",orderable:!1,render:function(n,t,i){var r=i.IsAllowEdit?i.ItemId:" ",u=i.IsAllowEdit?"":"disabled";return"<button "+u+' " class="btn btn-danger" onclick="businessRemoveB2COrderItem('+r+')"><i class="fa fa-trash"><\/i><\/button>'}}],drawCallback:function(){var n=delay(function(){var i,t,r;$("#recalculatebtn").removeAttr("disabled");var u=$(this),f=u.parents("tr"),e=$("#order-list").DataTable(),n=$(f).find("input[type=number]").attr("itemId");$("#taxes"+n).parent().addClass("taxItem"+n);i=$("#tradeorderid").val();t=$("#itemdiscount"+n).val();t=t?t:0;t<0?(cleanBookNotification.error("The discount must be greater or equal to 0.","Qbicles"),t=0,$("#itemdiscount"+n).val(0)):t>100&&(cleanBookNotification.error("The discount must be less than or equal to 100.","Qbicles"),t=0,$("#itemdiscount"+n).val(0));r=$("#taxes"+n);r!=null?(LoadingOverlay(),$.ajax({method:"POST",dataType:"JSON",url:"/B2C/ReCalculateTax",data:{tradeOrderId:i,discount:t,itemId:n},success:function(t){t.result?UpdateOrderItemInfo(n):(LoadingOverlayEnd(),cleanBookNotification.error(t.msg,"Qbicles"))},error:function(n){LoadingOverlayEnd();cleanBookNotification(n.msg,"Qbicles")}})):e.cell(".taxItem"+n).data("--")},1e3),t=delay(function(){$("#recalculatebtn").removeAttr("disabled");var r=$(this),u=r.parents("tr"),f=$("#order-list").DataTable(),n=$(u).find("input[type=number]").attr("itemId");$("#itemdiscount"+n).parent().addClass("discountContainer"+n);var o=parseFloat($("#pureprice"+n).val()),i=parseFloat($("#totalprice"+n).val()),e=parseFloat($("#itemprice"+n).val()),t=parseFloat(100-e/i*100);t<0?(cleanBookNotification.error("The updated price must not cause the discount to be less than 0.","Qbicles"),t=0,$("#itemprice"+n).val(i)):t>100&&(cleanBookNotification.error("The updated price must not cause the discount to be greater than 100.","Qbicles"),t=0,$("#itemprice"+n).val(i));f.cell(".discountContainer"+n).data(t);LoadingOverlay();UpdateOrderItemInfo(n)},1e3);$(".itemdiscount").on("change",n);$(".price").on("change",t)}})};refreshIntervalId=0;