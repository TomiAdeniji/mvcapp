function formatOptions(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img" style="background-image: url(\''+($(n.element).attr("LogoUri")==""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function formatSelected(n){if(!n.id)return n.text;return $('<div class="select2imgwrap"><div class="select2img mini" style="background-image: url(\''+($(n.element).attr("LogoUri")==""?"/Content/DesignStyle/img/icon_domain_default.png":$(n.element).attr("api")+""+$(n.element).attr("LogoUri"))+'\');"><\/div> <span class="select2text">'+n.text+"<\/span><\/div>")}function OnchangeEmail(){$("#UserEmail").val()!=""?$(".confirm-add").removeAttr("disabled"):$(".confirm-add").attr("disabled","disabled")}function SearchPeopleData(){var n=$("#searchPeople").val(),t=$("#ddlRoleLevel :selected").val(),i=$("#ddlDomainRole").val()==null?[]:$("#ddlDomainRole").val();$("#Peoplelist").LoadingOverlay("show");$.ajax({url:"/OurPeople/SearchPeopleData/",data:{peopleName:n,roleLevel:t,domainRole:i},cache:!1,type:"POST","async":!0,success:function(n){n&&($("#content-peoplelist").html(n),$("#Peoplelist").DataTable());$("#Peoplelist").LoadingOverlay("hide")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");$("#Peoplelist").LoadingOverlay("hide")}})}function InvitedUser(){var n=$("#UserEmail").val();validateEmail(n)?($.LoadingOverlay("show"),setTimeout(function(){var t=$(".loadingoverlay").attr("style"),i;t.indexOf("opacity")>-1&&(t=t.substring(0,t.indexOf("opacity")));$(".loadingoverlay").attr("style",t);i="/OurPeople/Invitation/";$.ajax({url:i,data:{email:n},cache:!1,type:"POST","async":!1,success:function(t){t.result?(cleanBookNotification.success(_L("ERROR_MSG_499",[n]),$("#people-user-add").find(".modal-title").html()),$("#manage-invites").click(),SearchInvitationPeople(),$("#UserEmail").val(""),$("#people-user-add").modal("hide")):t.msg!=""?cleanBookNotification.warning(t.msg,$("#people-user-add").find(".modal-title").html()):cleanBookNotification.error(_L("ERROR_MSG_495"),$("#people-user-add").find(".modal-title").html());LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})},200)):(cleanBookNotification.error(_L("ERROR_MSG_496"),$("#people-user-add").find(".modal-title").html()),LoadingOverlayEnd())}function reSendEmail(n,t,i){$.LoadingOverlay("show");setTimeout(function(){var r=$(".loadingoverlay").attr("style"),u;r.indexOf("opacity")>-1&&(r=r.substring(0,r.indexOf("opacity")));$(".loadingoverlay").attr("style",r);u="/OurPeople/ReSendInvitation/";$.ajax({url:u,data:{Id:n,email:t,RecipientName:i},cache:!1,type:"POST","async":!1,success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_500",[t])),SearchInvitationPeople()):cleanBookNotification.error(_L("ERROR_MSG_497"));LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})},200)}function ConfirmRemoveUserFromDomain(n,t){$("#hduserId").val(n);$("#lblUserName").html(t);$("#lblDomainName").html($(".select2avatarDomain :selected").html());$("#PromoteOrDemoteConfirm").modal("show")}function RemoveUserFromDomain(){RemovedUserFromDomain($("#hduserId").val(),$("#lblUserName").html(),$("#lblDomainName").html())}function PromoteOrDemoteUser(n,t,i){var r="/OurPeople/PromoteOrDemoteUser/";$.LoadingOverlay("show");setTimeout(function(){var u=$(".loadingoverlay").attr("style");u.indexOf("opacity")>-1&&(u=u.substring(0,u.indexOf("opacity")));$(".loadingoverlay").attr("style",u);$.ajax({url:r,data:{userId:n,PromoteOrDemoteTo:t,currentPossition:i},cache:!1,type:"POST","async":!1,success:function(n){var r="";r+=t>i?"Promote "+(t==3?"to Domain Admin":t==2?"to Qbicle Creator":""):"Demote "+(t==2?"to Qbicle Creator":t==2?"to Domain User":"");n.result?(cleanBookNotification.success(r+" success"),initPeopleList(),$("#PromoteOrDemoteConfirm").modal("hide")):cleanBookNotification.error(r+" fail");LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})},200)}function SearchInvitationPeople(){var n=$("#searchInvitation").val(),t=$("#ddlStatus :selected").val();$("#lstInvitation").LoadingOverlay("show");$.ajax({url:"/OurPeople/SearchInvitationPeople/",data:{peopleName:n,status:t},cache:!1,type:"POST","async":!0,success:function(n){n&&($("#content-invites").empty(),$("#content-invites").html(n),$("#lstInvitation").DataTable({destroy:!0,searching:!1,order:[[3,"desc"]]}));$("#lstInvitation").LoadingOverlay("hide")},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");$("#lstInvitation").LoadingOverlay("hide")}})}function validateEmail(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())}function RemovedUserFromDomain(n,t,i){var r="/OurPeople/RemovedUserFromDomain/";$.LoadingOverlay("show");setTimeout(function(){var u=$(".loadingoverlay").attr("style");u.indexOf("opacity")>-1&&(u=u.substring(0,u.indexOf("opacity")));$(".loadingoverlay").attr("style",u);$.ajax({url:r,data:{userId:n},cache:!1,type:"POST","async":!1,success:function(n){n.result?(cleanBookNotification.success(_L("ERROR_MSG_501",[t,i])),GetCurrentMembers(),initPeopleList(),$("#PromoteOrDemoteConfirm").modal("hide")):cleanBookNotification.error(_L("ERROR_MSG_498",[t,i]));LoadingOverlayEnd()},error:function(n){cleanBookNotification.error(n.responseText,"Qbicles");LoadingOverlayEnd()}})},200)}function GetCurrentMembers(){$.ajax({type:"GET",url:"/OurPeople/GetCurrentUserAllowed",data:"data",success:function(n){$(".user-slots").text(n)}})}function UpdatePeopleData(){initPeopleList();GetCurrentMembers()}function initPeopleList(){var u=$("#info-people-datatable").attr("currentuserid"),n=$("#info-people-datatable").attr("administrators"),t=$("#info-people-datatable").attr("manager"),i=$("#info-people-datatable").attr("user"),r=$("#Peoplelist");r.DataTable().clear();r.DataTable({destroy:!0,serverSide:!0,paging:!0,pagingTag:"button",searching:!1,ordering:!1,responsive:!0,lengthMenu:[[10,20,50,100],[10,20,50,100]],pageLength:10,aaSorting:[],ajax:{url:"/OurPeople/SearchPeopleDataTable",type:"POST",data:function(n){return $("#Peoplelist").LoadingOverlay("show"),$.extend({},n,{peopleName:$("#searchPeople").val(),roleLevel:$("#ddlRoleLevel :selected").val(),domainRole:$("#ddlDomainRole").val()==null?[]:$("#ddlDomainRole").val()})},complete:function(){$("#Peoplelist").LoadingOverlay("hide")}},columns:[{render:function(n,t,i){return html=`<td><div class="table-avatar mini" style="background-image: url('`+i.ImageUri+`"&size=T")');">&nbsp;</div></td>`}},{render:function(n,t,i){return html=` <td><a href="/Community/UserProfilePage?uId=`+i.Id+`">`+i.FullName+`</a></td>`}},{data:"CreatedDate"},{render:function(n,t,i){return html=`<td><a href="mailto:`+i.Email+`">`+i.Email+`</a></td>`}},{render:function(n,t,i){return html=`<td><span class="label label-lg label-primary">`+i.TypeUser+`</span></td>`}},{render:function(n,t,i){return html=``,i.lstRole.length>0&&i.lstRole.forEach(n=>{html+=`<span class="label label-lg label-info" style="margin-bottom:3px;display: inline-flex;">`+n+`</span><br />`}),html}},{data:"QbiclesCount"},{render:function(r,f,e){return html=``,e.TypeUserId==n&&e.Id==u||(html2=e.TypeUserId==n?`<li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+t+`, `+n+`)"><i class="fa fa-arrow-down"></i> &nbsp; Demote to Qbicle Creator</a></li>
                                    <li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+i+`, `+n+`)"><i class="fa fa-arrow-down"></i> &nbsp; Demote to Domain User</a></li>
                                    <li><a href="#" onclick="ConfirmRemoveUserFromDomain('`+e.Id+`','`+e.FullName+`')"><i class="fa fa-trash"></i> &nbsp; Remove from Domain</a></li>`:e.TypeUserId==t?`<li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+n+`, `+t+`)"><i class="fa fa-arrow-up"></i> &nbsp; Promote to Domain Admin</a></li>
                                    <li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+i+`, `+t+`)"><i class="fa fa-arrow-down"></i> &nbsp; Demote to Domain User</a></li>
                                    <li><a href="#" onclick="ConfirmRemoveUserFromDomain('`+e.Id+`','`+e.FullName+`')"><i class="fa fa-trash"></i> &nbsp; Remove from Domain</a></li>`:`<li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+n+`, `+i+`)"><i class="fa fa-arrow-up"></i> &nbsp; Promote to Domain Admin</a></li>
                                    <li><a href="#" onclick="PromoteOrDemoteUser('`+e.Id+`', `+t+`, `+i+`)"><i class="fa fa-arrow-up"></i> &nbsp; Promote to Qbicle Creator</a></li>
                                    <li><a href="#" onclick="ConfirmRemoveUserFromDomain('`+e.Id+`','`+e.FullName+`')"><i class="fa fa-trash"></i> &nbsp; Remove from Domain</a></li>`,html=`<div class="btn-group options">
                                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-cog"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-right" style="right: 0;">
                                    `+html2+`
                                    </ul>
                                </div>`),html}}]})}jQuery(function(n){n(".select2avatarDomain").select2({placeholder:"Please select",templateResult:formatOptions,templateSelection:formatSelected,dropdownCssClass:"withdrop"})});$("#searchPeople").keyup(delay(function(){initPeopleList()},500));initPeopleList();