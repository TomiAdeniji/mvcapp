@using Qbicles.BusinessRules;
@using Qbicles.Models;
@model List<QbicleActivity>
@{
    var pinned = (List<QbicleActivity>)ViewBag.myPinned;
    var api = (string)ViewBag.DocRetrievalUrl;
    var strIdtag = "";
    Qbicle _qbicle = new Qbicle();
    var dateFormat = ViewBag.CurrentDateFormat;
}
<style>
    .records-h article.review {
        border-left: 5px solid #00c0ef !important;
    }

    .records-h article.denied {
        border-left: 5px solid #dd4b39 !important;
    }
</style>
@if (Model != null && Model.Any())
{

    foreach (var item in Model)
    {
        strIdtag = "";
        var showDetail = "";
        _qbicle = item.Qbicle != null ? item.Qbicle : new Qbicle();
        if (item.ActivityType == QbicleActivity.ActivityTypeEnum.TaskActivity)
        {
            var QbTask = (QbicleTask)item;
            var taskStatus = 0;
            if (!QbTask.isComplete && QbTask.ActualStart == null && QbTask.ProgrammedEnd >= DateTime.UtcNow)
            { taskStatus = 0; }
            else if (!QbTask.isComplete && QbTask.ActualStart != null && QbTask.ProgrammedEnd >= DateTime.UtcNow)
            { taskStatus = 1; }
            else if (!QbTask.isComplete && QbTask.ProgrammedEnd < DateTime.UtcNow)
            { taskStatus = 2; }
            else if (QbTask.isComplete)
            { taskStatus = 3; }

            <article class="@(taskStatus == 0 ? "pending" : (taskStatus == 1 ? "started" : (taskStatus == 2 ? "overdue" : (taskStatus == 3 ? "complete" : ""))))">
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                @{var isPinned = (pinned != null && pinned.Any(e => e.Id == QbTask.Id)) ? true : false;}
                                @if (isPinned)
                                {
                                    <li><a href="javascript:void(0);" onclick="UnPinnedActivity('@QbTask.Id',false, event)" id="textPin-@QbTask.Id"><span id="textPin-@QbTask.Id"> Unpin this</span></a></li>

                                }
                                else
                                {
                                    <li><a href="javascript:void(0);" onclick="MydeskPinnedActivity('@QbTask.Id',false,event)" id="textPin-@QbTask.Id"><span id="textPin-@QbTask.Id"> Pin this</span></a></li>
                                }
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#task-more" onclick="LoadTaskMoreModal('@QbTask.Key')">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Task</span>
                                }
                                else
                                {
                                    if (taskStatus == 0)
                                    {
                                        <span class="label label-lg label-warning">Pending</span>
                                    }
                                    else if (taskStatus == 1)
                                    {
                                        <span class="label label-lg label-success">In progress</span>
                                    }
                                    else if (taskStatus == 2)
                                    {
                                        <span class="label label-lg label-danger">Overdue</span>
                                    }
                                    else
                                    {
                                        <span class="label label-lg label-soft">Complete</span>
                                    }
                                }

                                &nbsp;@QbTask.Id - @QbTask.Name
                            </p>
                        </a>
                    </div>
                    <div class="col dueblock hidden-xs">
                        <p>
                            @if (QbTask.ProgrammedEnd != null)
                            {
                                if (taskStatus == 0)
                                {
                                    <i class="fa fa-calendar iconlb"></i><span>&nbsp; @QbTask.ProgrammedEnd.Value.ToString(dateFormat + " hh:mmtt").ToLower()</span>
                                }
                                else if (taskStatus == 1)
                                {
                                    <i class="fa fa-calendar iconlb"></i><span>&nbsp; @QbTask.ProgrammedEnd.Value.ToString(dateFormat + " hh:mmtt").ToLower()</span>
                                }
                                else if (taskStatus == 2)
                                {

                                    <i class="fa fa-calendar iconlb"></i><span class="red">&nbsp; @QbTask.ProgrammedEnd.Value.ToString(dateFormat + " hh:mmtt").ToLower()</span>
                                }
                                else if (taskStatus == 3)
                                {
                                    <i class="fa fa-calendar iconlb"></i><span>&nbsp;Completed @(QbTask.ActualEnd?.ToString(dateFormat + " hh:mmtt").ToLower() ?? "")</span>
                                }
                            }

                        </p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (QbTask.Folders != null && item.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in item.Folders)
                            {
                                <span class="label label-lg label-info tag_@tag.Id">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }

                        }
                        <input type="hidden" id="hdTagIds-@QbTask.Id" name="hdTagIds" value="@strIdtag" />
                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@QbTask.Id,false)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>
        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.EventActivity)
        {
            var QbEvent = (QbicleEvent)item;
            var css = "";
            if (QbEvent.isComplete || QbEvent.End < DateTime.UtcNow)
            {
                css = "complete oldevent";
            }
            <article class="@css">
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    @{var isPinned = (pinned != null && pinned.Any(e => e.Id == QbEvent.Id)) ? true : false;}
                                    @if (isPinned)
                                    {
                                        <a class="dropdown-item" href="javascript:void(0);" onclick="UnPinnedActivity('@QbEvent.Id',false, event)">
                                            <span id="textPin-@QbEvent.Id">&nbsp; Unpin this</span>
                                        </a>

                                    }
                                    else
                                    {
                                        <a class="dropdown-item" href="javascript:void(0);" onclick="MydeskPinnedActivity('@QbEvent.Id',false,event)">
                                            <span id="textPin-@QbEvent.Id">&nbsp; Pin this</span>
                                        </a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#event-more" onclick="LoadEventMoreModal('@QbEvent.Key')">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Event</span>
                                }
                                else
                                {
                                    <span class="label label-lg label-soft">@QbEvent.EventType</span>
                                }

                                &nbsp;@QbEvent.Name
                            </p>
                        </a>
                    </div>
                    <div class="col dueblock hidden-xs">
                        <p><i class="fa fa-calendar iconlb"></i> @QbEvent.Start.ToString(dateFormat + " hh:mmtt").ToLower()</p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (QbEvent.Folders != null && QbEvent.Folders.Any())
                        {

                            foreach (var tag in item.Folders)
                            {
                                <span class="label label-lg label-info tag_@tag.Id">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }
                        }
                        <input type="hidden" id="hdTagIds-@QbEvent.Id" name="hdTagIds" value="@strIdtag" />
                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@QbEvent.Id,false)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>
        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.MediaActivity)
        {
            var QbMedia = (QbicleMedia)item;
            var mediaLastupdate = QbMedia.VersionedFiles.Where(e => !e.IsDeleted).OrderByDescending(x => x.UploadedDate).FirstOrDefault();
            var fileType = mediaLastupdate != null && mediaLastupdate.FileType != null ? Utility.GetFileTypeDescription(mediaLastupdate.FileType.Extension) : "";

            <article>
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    @{var isPinned = (pinned != null && pinned.Any(e => e.Id == QbMedia.Id)) ? true : false;}
                                    @if (isPinned)
                                    {
                                        <a class="dropdown-item" href="javascript:void(0);" onclick="UnPinnedActivity('@QbMedia.Id',false, event)">
                                            <span id="textPin-@QbMedia.Id">&nbsp; Unpin this</span>
                                        </a>

                                    }
                                    else
                                    {
                                        <a class="dropdown-item" href="javascript:void(0);" onclick="MydeskPinnedActivity('@QbMedia.Id',false,event)">
                                            <span id="textPin-@QbMedia.Id">&nbsp; Pin this</span>
                                        </a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#media-more" onclick="LoadMediaMoreModal('@QbMedia.Key')">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Media</span>
                                }
                                else
                                {
                                    <span class="label label-lg label-soft">@fileType.ToUpper()</span>
                                }
                                &nbsp;@QbMedia.Name
                            </p>
                        </a>
                    </div>
                    <div class="col dueblock hidden-xs">
                        <p><i class="fa fa-calendar iconlb"></i> &nbsp; @QbMedia.StartedDate.ToString(dateFormat + " hh:mmtt").ToLower()</p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (QbMedia.Folders != null && QbMedia.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in QbMedia.Folders)
                            {
                                <span class="label label-lg label-info tag_@tag.Id">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }

                        }
                        <input type="hidden" id="hdTagIds-@QbMedia.Id" name="hdTagIds" value="@strIdtag" />

                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@QbMedia.Id,false)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>

        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.ApprovalRequest)
        {
            var QbApproval = (ApprovalReq)item;
            var manuJob = QbApproval.Manufacturingjobs.FirstOrDefault();
            if (QbApproval.Sale.Any())
            {
                var apr = QbApproval.Sale.FirstOrDefault();
                showDetail = "/TraderSales/SaleReview?key=" + apr.Key;
            }
            else if (QbApproval.Purchase.Any())
            {
                var apr = QbApproval.Purchase.FirstOrDefault();
                showDetail = "/TraderPurchases/PurchaseReview?id=" + apr.Id;
            }
            else if (QbApproval.TraderContact.Any())
            {
                var apr = QbApproval.TraderContact.FirstOrDefault();
                showDetail = "/TraderContact/ContactReview?id=" + apr.Id;
            }
            else if (QbApproval.Invoice.Any())
            {
                var apr = QbApproval.Invoice.FirstOrDefault();
                showDetail = "/TraderInvoices/InvoiceReview?key=" + apr.Key;
            }
            else if (QbApproval.Payments.Any())
            {
                var apr = QbApproval.Payments.FirstOrDefault();
                showDetail = "/TraderPayments/PaymentReview?id=" + apr.Id;
            }
            else if (QbApproval.SpotCounts.Any())
            {
                var apr = QbApproval.SpotCounts.FirstOrDefault();
                showDetail = "/TraderSpotCount/SpotCountReview?id=" + apr.Id;
            }
            else if (QbApproval.WasteReports.Any())
            {
                var apr = QbApproval.WasteReports.FirstOrDefault();
                showDetail = "/TraderWasteReport/WasteReportReview?id=" + apr.Id;
            }
            else if (QbApproval.Manufacturingjobs.Any())
            {
                var apr = QbApproval.Manufacturingjobs.FirstOrDefault();
                showDetail = "/Manufacturing/ManuJobReview?id=" + apr.Id;
            }
            else if (QbApproval.ConsumptionReports.Any())
            {
                var apr = QbApproval.ConsumptionReports.FirstOrDefault();
                showDetail = "/Spanneredfree/ConsumeReportReview?id=" + apr.Id;
            }
            else if (QbApproval.TillPayment.Any())
            {
                var apr = QbApproval.TillPayment.FirstOrDefault();
                showDetail = "/CashManagement/TillPaymentReview?tillPaymentId=" + apr.Id;
            }
            var PriorityName = "";
            var cssStatus = "";
            switch (QbApproval.RequestStatus)
            {
                case ApprovalReq.RequestStatusEnum.Pending:
                    cssStatus = "review";
                    PriorityName = "Awaiting Review";
                    break;
                case ApprovalReq.RequestStatusEnum.Reviewed:
                    cssStatus = "pending";
                    PriorityName = "Awaiting Approval";

                    break;
                case ApprovalReq.RequestStatusEnum.Approved:
                    cssStatus = "complete";
                    PriorityName = ApprovalReq.RequestStatusEnum.Approved.ToString();
                    break;
                case ApprovalReq.RequestStatusEnum.Denied:
                case ApprovalReq.RequestStatusEnum.Discarded:
                    cssStatus = "complete";
                    PriorityName = ApprovalReq.RequestStatusEnum.Discarded.ToString();
                    break;
            }

            <article class="@cssStatus">
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    @{var isPinned = (pinned != null && pinned.Any(e => e.Id == QbApproval.Id)) ? true : false;}
                                    @if (isPinned)
                                    {
                                        <a href="javascript:void(0);" onclick="UnPinnedActivity('@QbApproval.Id',false, event)" id="textPin-@QbApproval.Id"><span id="textPin-@QbApproval.Id"> Unpin this</span></a>
                                    }
                                    else
                                    {
                                        <a href="javascript:void(0);" onclick="MydeskPinnedActivity('@QbApproval.Id',false, event)" id="textPin-@QbApproval.Id"><span id="textPin-@QbApproval.Id"> Pin this</span></a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#process-more" onclick="LoadProcessMoreModal('@QbApproval.Key')">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Process</span>
                                }
                                else
                                {
                                    if (QbApproval.RequestStatus == ApprovalReq.RequestStatusEnum.Pending)
                                    {
                                        <span class="label label-lg label-info">@PriorityName</span>
                                    }
                                    else if (QbApproval.RequestStatus == ApprovalReq.RequestStatusEnum.Approved)
                                    {
                                        <span class="label label-lg label-success">@PriorityName</span>
                                    }
                                    else if (QbApproval.RequestStatus == ApprovalReq.RequestStatusEnum.Denied)
                                    {
                                        <span class="label label-lg label-danger">@PriorityName</span>
                                    }
                                    else if (QbApproval.RequestStatus == ApprovalReq.RequestStatusEnum.Reviewed)
                                    {
                                        <span class="label label-lg label-warning">@PriorityName</span>
                                    }
                                    else
                                    {
                                        <span class="label label-lg label-danger">@PriorityName</span>
                                    }

                                }

                                &nbsp;@(QbApproval.Manufacturingjobs.Count() <= 0 ? QbApproval.Name : ("Compound Item Assembly: " + (manuJob?.Reference?.FullRef ?? "") + " " + (manuJob?.Product?.Name ?? "")))
                            </p>
                        </a>
                    </div>
                    @{
                        var source = "";
                        if (QbApproval.JournalEntries.Any() || QbApproval.BKAccounts.Any())
                        {
                            source = "Bookkeeping";
                        }
                        else if (QbApproval.ConsumptionReports.Any())
                        {
                            source = "Spannered";
                        }
                        else
                        {
                            source = "Trader";
                        }
                    }
                    <div class="col dueblock hidden-xs">
                        <p><i class="fa fa-calendar iconlb"></i> &nbsp; @source, @QbApproval.StartedDate.ToString(dateFormat + " hh:mmtt").ToLower()</p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (QbApproval.Folders != null && QbApproval.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in QbApproval.Folders)
                            {
                                <span class="label label-lg label-info tag_@tag.Id">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }
                        }
                        <input type="hidden" id="hdTagIds-@QbApproval.Id" name="hdTagIds" value="@strIdtag" />

                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@QbApproval.Id,false)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>
        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.ApprovalRequestApp)
        {
            var QbApprovalApp = (ApprovalReq)item;
            var PriorityName = "";
            var cssStatus = "";
            switch (QbApprovalApp.RequestStatus)
            {
                case ApprovalReq.RequestStatusEnum.Pending:
                    cssStatus = "review";
                    PriorityName = "Awaiting Review";
                    break;
                case ApprovalReq.RequestStatusEnum.Reviewed:
                    cssStatus = "pending";
                    PriorityName = "Awaiting Approval";

                    break;
                case ApprovalReq.RequestStatusEnum.Approved:
                    cssStatus = "complete";
                    PriorityName = ApprovalReq.RequestStatusEnum.Approved.ToString();
                    break;
                case ApprovalReq.RequestStatusEnum.Denied:
                case ApprovalReq.RequestStatusEnum.Discarded:
                    cssStatus = "complete";
                    PriorityName = ApprovalReq.RequestStatusEnum.Discarded.ToString();
                    break;
            }

            <article class="@cssStatus">
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    @{var isPinned = (pinned != null && pinned.Any(e => e.Id == QbApprovalApp.Id)) ? true : false;}
                                    @if (isPinned)
                                    {
                                        <a href="javascript:void(0);" onclick="UnPinnedActivity('@QbApprovalApp.Id',false, event)" id="textPin-@QbApprovalApp.Id"><span id="textPin-@QbApprovalApp.Id"> Unpin this</span></a>
                                    }
                                    else
                                    {
                                        <a href="javascript:void(0);" onclick="MydeskPinnedActivity('@QbApprovalApp.Id',false, event)" id="textPin-@QbApprovalApp.Id"><span id="textPin-@QbApprovalApp.Id"> Pin this</span></a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#process-more" onclick="LoadProcessMoreModal('@QbApprovalApp.Key')">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Process</span>
                                }
                                else
                                {
                                    if (QbApprovalApp.RequestStatus == ApprovalReq.RequestStatusEnum.Pending)
                                    {
                                        <span class="label label-lg label-info">@PriorityName</span>
                                    }
                                    else if (QbApprovalApp.RequestStatus == ApprovalReq.RequestStatusEnum.Approved)
                                    {
                                        <span class="label label-lg label-success">@PriorityName</span>
                                    }
                                    else if (QbApprovalApp.RequestStatus == ApprovalReq.RequestStatusEnum.Denied)
                                    {
                                        <span class="label label-lg label-danger">@PriorityName</span>
                                    }
                                    else if (QbApprovalApp.RequestStatus == ApprovalReq.RequestStatusEnum.Reviewed)
                                    {
                                        <span class="label label-lg label-warning">@PriorityName</span>
                                    }
                                    else
                                    {
                                        <span class="label label-lg label-danger">@PriorityName</span>
                                    }
                                }

                                &nbsp;@QbApprovalApp.Name
                            </p>
                        </a>

                    </div>
                    @{
                        var source = "";
                        if (QbApprovalApp.JournalEntries.Any() || QbApprovalApp.BKAccounts.Any())
                        {
                            source = "Bookkeeping";
                        }
                        else if (QbApprovalApp.EmailPostApproval.Any() || QbApprovalApp.CampaigPostApproval.Any())
                        {
                            source = "Sales & Marketing";
                        }
                        else if (QbApprovalApp.OperatorClockIn.Any() || QbApprovalApp.OperatorClockOut.Any())
                        {
                            source = "Operator";
                        }
                        else
                        {
                            source = "Trader";
                        }
                    }
                    <div class="col dueblock hidden-xs">
                        <p><i class="fa fa-calendar iconlb"></i> &nbsp; @source, @QbApprovalApp.StartedDate.ToString(dateFormat + " hh:mmtt").ToLower()</p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (QbApprovalApp.Folders != null && QbApprovalApp.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in QbApprovalApp.Folders)
                            {
                                <span class="label label-lg label-info tag_@tag.Id">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }
                        }
                        <input type="hidden" id="hdTagIds-@QbApprovalApp.Id" name="hdTagIds" value="@strIdtag" />

                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@QbApprovalApp.Id,false)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>
        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.Link)
        {
            var qbLink = (QbicleLink)item;
            var mediaLinkupdate = qbLink.FeaturedImage != null ? qbLink.FeaturedImage.VersionedFiles.Where(e => !e.IsDeleted).OrderByDescending(x => x.UploadedDate).FirstOrDefault() : null;

            <article>
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                @{var isPinned = (pinned != null && pinned.Any(e => e.Id == qbLink.Id)) ? true : false;}
                                <li>
                                    @if (isPinned)
                                    {
                                        <a href="javascript:void(0);" onclick="UnPinnedActivity('@qbLink.Id',false, event)" id="textPin-@qbLink.Id"><span id="textPin-@qbLink.Id"> Unpin this</span></a>
                                    }
                                    else
                                    {
                                        <a href="javascript:void(0);" onclick="MydeskPinnedActivity('@qbLink.Id',false, event)" id="textPin-@qbLink.Id"><span id="textPin-@qbLink.Id"> Pin this</span></a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#link-more" onclick="LoadLinkMoreModal(@qbLink.Id)">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Task</span>
                                }
                                &nbsp;@qbLink.Name
                            </p>
                        </a>
                    </div>
                    <div class="col dueblock hidden-xs">
                        <p><a href="@qbLink.URL" target="_blank"><i class="fa fa-external-link iconlb"></i> &nbsp; @qbLink.URL</a></p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (qbLink.Folders != null && qbLink.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in qbLink.Folders)
                            {
                                <span class="label label-lg label-info">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }

                        }
                        <input type="hidden" id="hdTagIds-@qbLink.Id" name="hdTagIds" value="@strIdtag" />

                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@qbLink.Id)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>

        }
        else if (item.ActivityType == QbicleActivity.ActivityTypeEnum.DiscussionActivity)
        {
            var qbDiscussion = (QbicleDiscussion)item;
            var urldisDetail = "";
            var isActive = true;
            if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.IdeaDiscussion)
            {
                urldisDetail = "/SalesMarketingIdea/DiscussionIdea?disId=" + qbDiscussion.Id;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.PlaceDiscussion)
            {
                urldisDetail = "/SalesMarketingLocation/DiscussionPlace?disId=" + qbDiscussion.Id;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.GoalDiscussion)
            {
                urldisDetail = "/Operator/DiscussionGoal?disId=" + qbDiscussion.Id;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.ComplianceTaskDiscussion)
            {
                urldisDetail = "/Operator/DiscussionComplianceTask?disId=" + qbDiscussion.Id;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.CashManagement)
            {
                urldisDetail = "/CashManagement/DiscussionCashManagementShow?disKey=" + qbDiscussion.Key;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.B2CProductMenu)
            {
                urldisDetail = "/B2C/DiscussionMenu?disKey=" + qbDiscussion.Key;
            }
            else if (qbDiscussion.DiscussionType == QbicleDiscussion.DiscussionTypeEnum.B2COrder)
            {
                urldisDetail = "/B2C/DiscussionOrder?disKey=" + qbDiscussion.Key;
            }
            else
            {
                urldisDetail = "/Qbicles/DiscussionQbicle?disKey=" + qbDiscussion.Key;
            }

            if (qbDiscussion.ExpiryDate != null && qbDiscussion.ExpiryDate <= DateTime.UtcNow) { isActive = false; }
            else { isActive = true; }

            <article class="@(isActive ? "started" : "complete discussed")">
                <div class="record">
                    <div class="col" style="flex: 0 1 40px;">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle more" type="button" data-toggle="dropdown" style="padding: 0;">
                                <i class="fa fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li>
                                    @{var isPinned = (pinned != null && pinned.Any(e => e.Id == qbDiscussion.Id)) ? true : false;}
                                    @if (isPinned)
                                    {
                                        <a href="javascript:void(0);" onclick="UnPinnedActivity('@qbDiscussion.Id',false, event)" id="textPin-@qbDiscussion.Id"><span id="textPin-@qbDiscussion.Id"> Unpin this</span></a>
                                    }
                                    else
                                    {
                                        <a href="javascript:void(0);" onclick="MydeskPinnedActivity('@qbDiscussion.Id',false, event)" id="textPin-@qbDiscussion.Id"><span id="textPin-@qbDiscussion.Id"> Pin this</span></a>
                                    }
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="col titleblock">
                        <a href="#" data-toggle="modal" data-target="#discussion-more" onclick="LoadDiscussionMoreModal(@qbDiscussion.Id)">
                            <p class="tasktitle">
                                @if (ViewBag.TabType == 1)
                                {
                                    <span class="label label-lg label-soft">Discussion</span>
                                }
                                else
                                {
                                    if (isActive)
                                    {
                                        <span class="label label-lg label-success">Active</span>
                                    }
                                    else
                                    {
                                        <span class="label label-lg label-danger">Expired</span>
                                    }
                                }
                                &nbsp;@qbDiscussion.Name
                            </p>
                        </a>
                    </div>
                    <div class="col dueblock hidden-xs">
                        <p>
                            <i class="fa fa-user iconlb"></i> &nbsp;
                            @qbDiscussion.ActivityMembers.Count() participants
                        </p>
                    </div>
                    <div class="col taglist text-right hidden-xs hidden-sm">
                        @if (qbDiscussion.Folders != null && qbDiscussion.Folders.Any())
                        {
                            strIdtag = "";
                            foreach (var tag in qbDiscussion.Folders)
                            {
                                <span class="label label-lg label-info">#@tag.Name</span>
                                if (string.IsNullOrEmpty(strIdtag))
                                {
                                    strIdtag = tag.Id + "";
                                }
                                else
                                {
                                    strIdtag += "," + tag.Id;
                                }
                            }

                        }
                        <input type="hidden" id="hdTagIds-@qbDiscussion.Id" name="hdTagIds" value="@strIdtag" />

                        <a href="#" class="label label-lg label-soft" data-toggle="modal" data-target="#tags-manage" onclick="EditTags(@qbDiscussion.Id)"><i class="fa fa-pencil"></i></a>
                    </div>
                </div>
            </article>
        }
    }
}
@*<ul class="pagination">
        <li class="active"><a href="#">1</a></li>
        <li><a href="#">2</a></li>
        <li><a href="#">Next &nbsp; <i class="fa fa-angle-right"></i></a></li>
    </ul>*@